!function(n){var e=false||document.getElementById("newBridge");speedLogTime=(new Date).getTime(),speedLogId=speedLogTime+(1e7*Math.random()).toString(16).substr(0,4)+"_"+(new Date).getTime()+"_"+Math.random().toString().substr(2,5),function(n){function e(n,e){return _(n,e)}function t(n,e,t){if(null==t&&(null==e?(t=n,n=null):(t=e,e=null,n instanceof Array&&(e=n,n=null))),null!=t){var r=window.opera;if(!n&&document.attachEvent&&(!r||"[object Opera]"!==r.toString())){var a=S();n=a&&a.getAttribute("data-require-id")}n?(i(n,e,t),z&&clearTimeout(z)):C[0]={deps:e,factory:t}}}function r(){var n=H.config[this.id];return n&&"object"==typeof n?n:{}}function i(n,e,t){T[n]||(T[n]={id:n,depsDec:e,deps:e||["require","exports","module"],factoryDeps:[],factory:t,exports:{},config:r,state:O,require:q(n),depMs:[],depMkv:{},depRs:[],depPMs:[]})}function a(n){var e=T[n];if(e&&!f(n,j)){var t=e.deps,r=e.factory,i=0;"function"==typeof r&&(i=Math.min(r.length,t.length),!e.depsDec&&r.toString().replace(/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,"").replace(/require\(\s*(['"'])([^'"]+)\1\s*\)/g,function(n,e,r){t.push(r)}));var a=[];$(t,function(t,r){var o,u,c=I(t),f=w(c.mod,n);f&&!P[f]?(c.res&&(u={id:t,mod:f,res:c.res},B[f]=1,e.depPMs.push(f),e.depRs.push(u)),(o=e.depMkv[f])||(o={id:c.mod,absId:f,hard:i>r},e.depMs.push(o),e.depMkv[f]=o,a.push(f))):o={absId:f},i>r&&e.factoryDeps.push(u||o)}),e.state=j,c(n),g(a)}}function o(){for(var n in B)u(n),s(n)}function u(n){function e(n){if(!f(n,j))return!1;if(f(n,F)||t[n])return!0;t[n]=1;var r=T[n],i=!0;return $(r.depMs,function(n){return i=e(n.absId)}),i&&$(r.depRs,function(n){return i=!(!n.absId||!f(n.absId,L))}),i&&(r.state=F),i}var t={};e(n)}function c(e){function t(){if(!r&&i.state===F){r=1;var t=1,a=[];if($(i.factoryDeps,function(n){var e=n.absId;return P[e]||(s(e),f(e,L))?void a.push(e):(t=0,!1)}),t){try{var o=l(a,{require:i.require,exports:i.exports,module:i}),u=i.factory,c="function"==typeof u?u.apply(n,o):u;null!=c&&(i.exports=c),i.invokeFactory=null,delete B[e]}catch(n){if(r=0,/^\[MODULE_MISS\]"([^"]+)/.test(n.message)){var d=i.depMkv[RegExp.$1];return void(d&&(d.hard=1))}throw n}p(e)}}}var r,i=T[e];i.invokeFactory=t,$(i.depPMs,function(n){d(n,function(){$(i.depRs,function(t){t.absId||t.mod!==n||(t.absId=w(t.id,e),g([t.absId],o))})})})}function f(n,e){return T[n]&&T[n].state>=e}function s(n){var e=T[n];e&&e.invokeFactory&&e.invokeFactory()}function l(n,e){var t=[];return $(n,function(n,r){t[r]=e[n]||m(n)}),t}function d(n,e){if(f(n,L))return void e();var t=N[n];t||(t=N[n]=[]),t.push(e)}function p(n){var e=N[n]||[];T[n].state=L;for(var t=e.length;t--;)e[t]();e.length=0,delete N[n]}function m(n){return f(n,L)?T[n].exports:null}function v(n){$(C,function(e){i(n,e.deps,e.factory)}),C.length=0,a(n)}function g(e,t,r,i){function u(){if(!c){var r=1;$(e,function(n){return P[n]?void 0:r=!!f(n,L)}),r&&(c=1,"function"==typeof t&&t.apply(n,l(e,P)))}}if("string"==typeof e){if(s(e),!f(e,L))throw new Error('[MODULE_MISS]"'+e+'" is not exists!');return m(e)}i=i||{};var c=0;e instanceof Array&&(u(),c||($(e,function(n){P[n]||f(n,L)||(d(n,u),i[n]||(n.indexOf("!")>0?y:h)(n,r),a(n))}),o()))}function h(n){function e(){var e=t.readyState;if(void 0===e||/^(loaded|complete)$/.test(e)){t.onload=t.onreadystatechange=null,t=null,v(n);for(var r in B)a(r);o()}}if(!G[n]&&!T[n]){G[n]=1;var t=document.createElement("script");t.setAttribute("charset","utf-8"),t.setAttribute("data-require-id",n),t.src=M(n+".js"),t.async=!0,t.readyState?t.onreadystatechange=e:t.onload=e,R(t)}}function y(n,e){function t(e){o.exports=e||!0,p(n)}function i(i){var o=e?T[e].require:_;i.load(a.res,o,t,r.call({id:n}))}if(!T[n]){var a=I(n),o={id:n,state:j};T[n]=o,t.fromText=function(n,e){B[n]=1,new Function(e)(),v(n)},i(m(a.mod))}}function b(n,e){var t=A(n,1,e);return t.sort(D),t}function x(){H.baseUrl=H.baseUrl.replace(/\/$/,"")+"/",J=b(H.paths),Q=b(H.map,1),$(Q,function(n){n.v=b(n.v)}),K=[],$(H.packages,function(n){var e=n;"string"==typeof n&&(e={name:n.split("/")[0],location:n,main:"main"}),e.location=e.location||e.name,e.main=(e.main||"main").replace(/\.js$/i,""),e.reg=U(e.name),K.push(e)}),K.sort(D),V=b(H.urlArgs,1),W=b(H.noRequests),$(W,function(n){var e=n.v,t={};n.v=t,e instanceof Array||(e=[e]),$(e,function(n){t[n]=1})})}function k(n,e,t){$(e,function(e){return e.reg.test(n)?(t(e.v,e.k,e),!1):void 0})}function M(n){var e=/(\.[a-z0-9]+)$/i,t=/(\?[^#]*)$/,r="",i=n,a="";t.test(n)&&(a=RegExp.$1,n=n.replace(t,"")),e.test(n)&&(r=RegExp.$1,i=n.replace(e,""));var o,u=i;return k(i,J,function(n,e){u=u.replace(e,n),o=1}),o||k(i,K,function(n,e,t){u=u.replace(t.name,t.location)}),/^([a-z]{2,10}:\/)?\//i.test(u)||(u=H.baseUrl+u),u+=r+a,k(i,V,function(n){u+=(u.indexOf("?")>0?"&":"?")+n}),u}function q(n){function e(e,r){if("string"==typeof e)return t[e]||(t[e]=g(w(e,n))),t[e];if(e instanceof Array){var i=[],a=[],o=[];$(e,function(e,t){var r=I(e),u=w(r.mod,n);a.push(u),B[u]=1,r.res?(i.push(u),o[t]=null):o[t]=u});var u={};$(a,function(n){var e;k(n,W,function(n){e=n}),e&&(e["*"]?u[n]=1:$(a,function(t){return e[t]?(u[n]=1,!1):void 0}))}),g(a,function(){$(o,function(t,r){null==t&&(o[r]=w(e[r],n))}),g(o,r,n)},n,u)}}var t={};return e.toUrl=function(e){return M(w(e,n))},e}function w(n,e){if(!n)return"";e=e||"";var t=I(n);if(!t)return n;var r=t.res,i=E(t.mod,e);if($(K,function(n){var e=n.name;return e===i?(i=e+"/"+n.main,!1):void 0}),k(e,Q,function(n){k(i,n,function(n,e){i=i.replace(e,n)})}),r){var a=m(i);r=a.normalize?a.normalize(r,function(n){return w(n,e)}):w(r,e),i+="!"+r}return i}function E(n,e){if(0===n.indexOf(".")){var t=e.split("/"),r=n.split("/"),i=t.length-1,a=r.length,o=0,u=0;n:for(var c=0;a>c;c++){var f=r[c];switch(f){case"..":if(!(i>o))break n;o++,u++;break;case".":u++;break;default:break n}}return t.length=i-o,r=r.slice(u),t.concat(r).join("/")}return n}function I(n){var e=n.split("!");return e[0]?{mod:e[0],res:e[1]}:null}function A(n,e,t){var r=[];for(var i in n)if(n.hasOwnProperty(i)){var a={k:i,v:n[i]};r.push(a),e&&(a.reg="*"===i&&t?/^/:U(i))}return r}function S(){if(X)return X;if(Y&&"interactive"===Y.readyState)return Y;for(var n=document.getElementsByTagName("script"),e=n.length;e--;){var t=n[e];if("interactive"===t.readyState)return Y=t,t}}function R(n){X=n,nn?Z.insertBefore(n,nn):Z.appendChild(n),X=null}function U(n){return new RegExp("^"+n+"(/|$)")}function $(n,e){if(n instanceof Array)for(var t=0,r=n.length;r>t&&!1!==e(n[t],t);t++);}function D(n,e){var t=n.k||n.name,r=e.k||e.name;return"*"===r?-1:"*"===t?1:r.length-t.length}var T={},B={},O=1,j=2,F=3,L=4,_=q();e.version="1.8.6",e.loader="esl",e.toUrl=_.toUrl;var z;t.amd={};var N={},P={require:e,exports:1,module:1},C=[],G={},H={baseUrl:"./",paths:{},config:{},map:{},packages:[],noRequests:{},urlArgs:{}};e.config=function(n){function e(n){i.push(n)}if(n){for(var t in H){var r=n[t],i=H[t];if(r)if("urlArgs"===t&&"string"==typeof r)H.urlArgs["*"]=r;else if(i instanceof Array)$(r,e);else if("object"==typeof i)for(var t in r)i[t]=r[t];else H[t]=r}x()}},x();var J,K,Q,V,W,X,Y,Z=document.getElementsByTagName("head")[0],nn=document.getElementsByTagName("base")[0];nn&&(Z=nn.parentNode),n.define||(n.define=t,n.require||(n.require=e),n.esl=e)}(e);var require=e.require,define=e.define;require.config({ 'baseUrl': '//aff-im.cdn.bcebos.com/onlineEnv/embed/1695303513/asset', 'paths': { 'cl': 'common/css' }, 'packages': [ { 'name': 'bull', 'location': '../dep/bull/asset', 'main': 'main' }, { 'name': 'im-lib', 'location': '../dep/im-lib/0.1.0/asset/pc', 'main': 'main' }, { 'name': 'im-core', 'location': '../dep/im-core/0.2.0/asset', 'main': 'main' }, { 'name': 'im-filter', 'location': '../dep/im-filter/0.1.0/asset', 'main': 'main' }, { 'name': 'qiao-im-msdk', 'location': '../dep/im-core/0.2.0/asset', 'main': 'proxy' } ] }),define("bull/aop/JointPoint",["require"],function(require){function e(e,t,n,i,o,r){this.thisp=e,this.args=t,this.modName=n,this.funcName=i,this.func=o,this.returnValue=r}return e.prototype={constructor:e,getThis:function(){return this.thisp},getArgs:function(){return this.args},getModName:function(){return this.modName},getFuncName:function(){return this.funcName},getFunc:function(){return this.func},setReturnValue:function(e){this.returnValue=e},getReturnValue:function(){return this.returnValue}},e}),define("bull/aop/aopEmitter",["require","./main"],function(require){function e(e,n,i){var o=[],r=t;if(r=r[e]||{},r=r[n]||{},r=r[i]||[],"[object Array]"==={}.toString.call(r))for(var a=0;a<r.length;a++)o.push(r[a]);return o}var exports={},t={};return exports.on=function(e,n,i,o){var r=t;r[e]=r[e]||{},r=r[e],r[n]=r[n]||{},r=r[n],r[i]=r[i]||[],r=r[i],r.push({func:o.func,funcName:o.funcName,modName:o.modName})},exports.getBefore=function(t,n){return e(require("./main").TypeEnum.BEFORE,t,n)},exports.queryBefore=function(e,t){var n=exports.getBefore();if(console.log("method before "+e+" -> "+t+":"),!n.length)return void console.log("none");for(var i=0;i<n.length;i++)console.log(n[i].modName+" -> "+n[i].funcName);console.log("-----------------------------------")},exports.getAfter=function(t,n){return e(require("./main").TypeEnum.AFTER,t,n)},exports.queryAfter=function(e,t){var n=exports.getAfter();if(!n.length)return void console.log("none");console.log("method after "+e+" -> "+t+":");for(var i=0;i<n.length;i++)console.log(n[i].modName+" -> "+n[i].funcName);console.log("-----------------------------------")},exports.getRegisterAop=function(e){var n={},i=[],o=t[e];for(var r in o)if(o.hasOwnProperty(r)){var a=o[r];for(var s in a)if(a.hasOwnProperty(s)){if(!n[s])n[s]=!0,i.push({modName:r,funcName:s,from:a[s][0].modName})}}return i},exports.emit=function(t,n,i,o){for(var r=e(t,n,i),a=0;a<r.length;a++)r[a].func(o)},exports}),define("bull/microPromise/microPromise",["require"],function(require){function e(){for(var e=arguments.length,n=0,i=t(),o=[],r=0;r<e;r++){var a=arguments[r];!function(t){a.then(function(r){if(n++,o[t]=r,n===e)i.resolve.apply(i,o)},function(){i.reject()})}(r)}return i.promise()}var t=function(){function e(){for(var e=this,t=0;t<o.length;t++)!function(t){if(a&&a[0]&&a[0].then)a[0].then(function(){o[t].apply(e,arguments)});else setTimeout(function(){o[t].apply(e,a)},0)}(t)}function n(){for(var e=this,t=0;t<r.length;t++)!function(t){setTimeout(function(){r[t].apply(e,a)},0)}(t)}function i(e,n){var i=t();if(l===c.resolved){var f=this;setTimeout(function(){e.apply(f,a)},0)}else if(l===c.reject){var f=this;setTimeout(function(){n.call(f,s)},0)}else{if(e)o.push(function(){i.resolve(e.apply(f,arguments))});if(n)r.push(function(e){n(e),i.reject()})}return i.promise()}if(!this instanceof t)return new t;var o=[],r=[],a=[],s="",c={pendding:1,resolved:2,rejected:3},l=c.pendding;return{resolve:function(){var t=Array.prototype.slice.call(arguments,0);if(l===c.pendding)a=t,l=c.resolved,e.call(this)},reject:function(e){if(l===c.pendding)s=e,l=c.rejected,n.call(this)},then:i,promise:function(){return{then:i}}}};return{Deferred:t,when:e}}),define("bull/aop/main",["require","./JointPoint","./aopEmitter","../loader","../microPromise/microPromise"],function(require){function e(e,t,n){r.emit(a.BEFORE,e,t,n)}function t(e,t,n){r.emit(a.AFTER,e,t,n)}function n(e){return e=e||"",e.replace(/^\s|\s$/g,"")}function i(e){e=e||"";var t=e.split(","),i=n(t[0]||""),o=n(t[1]),r=n(t[2]);return t=i.split("."),{packageName:t[0],modName:t[1],funcName:t[2],before:o,after:r}}var exports={},o=require("./JointPoint"),r=require("./aopEmitter"),a=exports.TypeEnum={BEFORE:"type1",AFTER:"type2"};return exports.createAopProxy=function(n,i,r){var a=require("../loader"),s=require("../microPromise/microPromise");return function(){var c=[],l=Array.prototype.slice.call(arguments,0),f=new o(this,l,n,i,r),u={jointPoint:f,microPromise:s};e(n,i,f);var d=a.getInjection(n)||{},m=d[i]||[];if("[object Array]"==={}.toString.call(m))for(var p=0;p<m.length;p++){var _=m[p];if(_ in u)c.push(u[_]);else c.push(a.get(_))}c=c.concat(l);var h=r.apply(this,c);if(h&&h.then)h.then(function(e){f.setReturnValue(e),t(n,i,f)});else f.setReturnValue(h),t(n,i,f);return h}},exports.aspectRegister=function(e,t,n){var o=require("../loader");if(-1===e.indexOf("."))e=t+"."+e;for(var s=0;s<n.length;s++)!function(t){t.before&&r.on(a.BEFORE,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.before,func:function(n){var i=o.get(e)[t.before];if(!i)throw'module "'+e+"\" don't have method "+t.before;i.apply(n.getThis(),n.getArgs())}}),t.after&&r.on(a.AFTER,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.after,func:function(n){var i=o.get(e)[t.after];if(!i)throw'module "'+e+"\" don't have method "+t.after;i.apply(n.getThis(),n.getArgs())}})}(i(n[s]))},exports}),define("bull/loader",["require","./aop/main"],function(require){function e(t,n){var i;if("function"==typeof n){e(t,n.prototype);var o=c(t,r,n);return o.prototype=n.prototype,o}else{for(var r in n)if(n.hasOwnProperty(r))if("function"==typeof(i=n[r]))n[r]=c(t,r,i);return n}}function t(e){e=e||[];for(var t=0;t<e.length;t++)exports.init(e[t])}function n(t,n){for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];if(i=n+"."+i,r.hasOwnProperty(i)){if(o._belong&&i!==o._belong)throw'module conflict: module "'+i+'" is already register to "'+o._belong+'"'}else{if(o._belong)throw'module "'+i+'" already register to "'+o._belong+'"';o._belong=i,r[i]=e(i,o)}}}function i(e,t){e=e||[];for(var n=0;n<e.length;n++){var i=e[n];a[i.id]=a[i.id]||{};var o=a[i.id],r=i.method;for(var s in r)o[s]=r[s]}}function o(e,t){for(var n=0;n<e.length;n++){var i=e[n];l(i.id,t,i.pointCut)}}var exports={},r={},a={},s=require("./aop/main"),c=s.createAopProxy,l=s.aspectRegister;return exports.init=function(e){if(!e._initialized){e._initialized=!0;var r=e.package;if(!r&&(e.resource||e.aspect))throw"package name not found";t(e.importConfig),e.resource&&n(e.resource,r),e.aspect&&o(e.aspect,r),e.injection&&i(e.injection,r)}},exports.getInjection=function(e){return a[e]},exports.getDeps=function(e){var t=a[e],n={};for(var i in t)if(t.hasOwnProperty(i))for(var o=t[i],r=0;r<o.length;r++)n[o[r]]=!0;delete n[e];var s=[];for(var i in n)if(i.indexOf(".")>-1)s.push(i);return s},exports.queryDep=function(e){var t=exports.getDeps(e);if(console.log("deps of "+e+" is:"),!t.length)console.log("none");for(var n=0;n<t.length;n++)console.log(t[n]);console.log("-----------------------------------")},exports.getModules=function(e){e=e||"";var t=[];for(var n in r)if(r.hasOwnProperty(n))if(e){if(n.indexOf(e)>-1)t.push(n)}else t.push(n);return t},exports.queryModule=function(e){var t=exports.getModules(e);if(e)console.log('modules contains "'+e+'":');else console.log("all modules:");for(var n=0;n<t.length;n++)console.log(t[n]);console.log("-----------------------------------")},exports.queryInvoke=function(e){var t=[],n={};for(var i in a)if(a.hasOwnProperty(i)){var o=a[i];for(var r in o)if(o.hasOwnProperty(r))for(var s=o[r],c=0;c<s.length;c++){var l=s[c];if(l===e){var f=i+l;if(f in n)continue;else n[f]=!0;t.push({modName:i,funcName:r})}}}if(t.length){console.log("module "+e+" used by these method:");for(var c=0;c<t.length;c++)console.log(t[c].modName+" -> "+r)}else console.log("module"+e+" used nowhere");console.log("-----------------------------------")},exports.checkDep=function(){var e,t=0;console.log("checking deps:");for(var n in r)if(r.hasOwnProperty(n)){e=exports.getDeps(n);for(var i=0;i<e.length;i++)if(!exports.has(e[i]))if(e[i].indexOf(".")>-1)t++,console.log(e[i]+" is required by "+n+" but now missing")}if(!t)console.log("all dependencies is ready");console.log("-----------------------------------")},exports.has=function(e){return e in r},exports.get=function(e){if(e in r)return r[e];else throw'module "'+e+'" not found'},exports}),define("bull/main",["require","./loader","./aop/aopEmitter"],function(require){function e(){var e=document.createElement("div"),t=e.style;t.position="fixed",t.right="20px",t.top="20px",t.border="solid 1px black",t.backgroundColor="#eee",e.innerHTML="\u70b9\u6b64\u67e5\u770b<br/>\u6a21\u5757\u5173\u7cfb";var n=!1;e.onclick=function(){if(!n)n=!0,require(["bull/debug"],function(e){n=!1,e.entry()})},document.body.insertBefore(e,document.body.firstChild)}function t(){if(location.hash.indexOf("bullDebug")>-1)e()}var exports={},n=require("./loader"),i=require("./aop/aopEmitter");return exports.get=n.get,exports.queryBefore=i.queryBefore,exports.queryAfter=i.queryAfter,exports.queryInvoke=n.queryInvoke,exports.queryDep=n.queryDep,exports.checkDep=n.checkDep,exports.queryModule=n.queryModule,exports.init=function(e){t(),n.init(e)},exports}),define("bull",["bull/main"],function(e){return e}),define("im-lib/lang/isObject",[],function(){return function(e){return"[object Object]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/isArray",[],function(){return function(e){return"[object Array]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/extend",[],function(){return function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}),define("im-lib/lang/each",["require","./isArray"],function(require){return function(e,t,n){if(require("./isArray")(e)){for(var i=e.length,o=0;o<i;o++)if("function"==typeof t)t.call(n,e[o],o,e)}else for(var r in e)if(e.hasOwnProperty(r))t.call(n,r,e[r],e)}}),define("im-lib/lang",["require","./lang/isObject","./lang/isArray","./lang/extend","./lang/each"],function(require){var exports={};return exports.isObject=require("./lang/isObject"),exports.isArray=require("./lang/isArray"),exports.extend=require("./lang/extend"),exports.each=require("./lang/each"),exports}),define("im-lib/json",[],function(){function e(e){if(/["\\\x00-\x1f]/.test(e))e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=r[e];if(t)return t;else return t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)});return'"'+e+'"'}function t(e){var t,n,i,r=["["],a=e.length;for(n=0;n<a;n++)switch(typeof(i=e[n])){case"undefined":case"function":case"unknown":break;default:if(t)r.push(",");r.push(o(i)),t=1}return r.push("]"),r.join("")}function n(e){return e<10?"0"+e:e}function i(e){return'"'+e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+'"'}function o(n){switch(typeof n){case"undefined":return"undefined";case"number":return isFinite(n)?String(n):"null";case"string":return e(n);case"boolean":return String(n);default:if(null===n)return"null";else if(n instanceof Array)return t(n);else if(n instanceof Date)return i(n);else{var r,a,s=["{"],c=o;for(var l in n)if(Object.prototype.hasOwnProperty.call(n,l))switch(typeof(a=n[l])){case"undefined":case"unknown":case"function":break;default:if(r)s.push(",");r=1,s.push(c(l)+":"+c(a))}return s.push("}"),s.join("")}}}var exports={};exports.parse=function(e){if(window.JSON&&JSON.parse)return JSON.parse(e);else return new Function("return ("+e+")")()},exports.stringify=function(e){if(window.JSON&&JSON.stringify)return JSON.stringify(e);else return o(e)};var r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return exports}),define("im-lib/net",[],function(){function e(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest}var exports={};return exports.imgRequest=function(e){document.createElement("img").src=e},exports.jsonp=function(e,t){function n(){return(new Date).getTime()}function i(){return Math.random().toString().substr(2)}function o(e){if(e){var t=e.parentNode;if(t&&11!==t.nodeType)t.removeChild(e)}}function r(e){var t="";if("string"==typeof e)t=e;else if("object"==typeof e)for(var i in e)if(e.hasOwnProperty(i))t+="&"+i+"="+encodeURIComponent(e[i]);return t+="&_time="+n(),t=t.substr(1)}function a(e,a,s,c){var l,f=(a.op,a.l);a=null,e=e+(-1===e.indexOf("?")?"?":"&")+r(a);var u=/callback=(\w+)/.exec(e);if(u&&u[1])l=u[1];else l="jsonp_bridge_"+n()+"_"+i(),e=e.replace("?","?"+t.key+"="+l+"&");var d=document.createElement("script");d.type="text/javascript",d.src=e,d.id="id_"+l,d.charset="utf-8";var m=!0,p=null;if(window[l]=function(e){clearTimeout(p),window[l]=void 0;var t=document.getElementById("id_"+l);setTimeout(function(){o(t)},0),s(e),m=!1},"onerror"in d)d.onerror=function(){c&&c(),o(d)},m=!1;var _=1e4;if(1===f)_+=2e4;p=setTimeout(function(){if(m)c&&c(),o(d)},_);var h=document.getElementsByTagName("head")[0];if(h)setTimeout(function(){h.appendChild(d)},0)}a(e,t,t.success,t.failure)},exports.request=function(t,n){var i=e(),o=n.headers||{},r=3e4,a=setTimeout(function(){i.onreadystatechange=null,i.abort(),n.failure&&n.failure()},r);if(i.open(n.method||"GET",t),o["Content-Type"])o["Content-Type"]=o["Content-Type"],i.setRequestHeader("Content-Type",o["Content-Type"]),delete o["Content-Type"];return i.onreadystatechange=function(){if(4===i.readyState)if(clearTimeout(a),i.status>=200&&i.status<300||304===i.status){if(n.success)n.success(i.responseText)}else if(n.failure)n.failure()},i.send(n.data),i},exports.upload=function(e,t,n,i,o){function r(){i(),u.onload=function(){},u.parentNode.removeChild(u)}function a(){o(),u.onerror=function(){},u.parentNode.removeChild(u)}if("/"===e.charAt(0)&&!/^\/\//.test(e))e=location.protocol+"//"+location.host+e;if("[object String]"===Object.prototype.toString.call(t)&&window.clouda){var s=t;clouda.device.fs.post(s,e,{onsuccess:function(e){if(i)i(e)},onfail:function(){if(o)o()},uploadKey:n,param:{}})}else if(t.nodeName){var c="upload_iframe"+parseInt(1e4*Math.random(),10),l='<iframe id="'+c+'" name="'+c+'" width="0" height="0" border="0" style="width: 0; height: 0; border: none;">',f=document.createElement("div");f.innerHTML=l;var u=f.getElementsByTagName("iframe")[0];if(document.body.appendChild(u),t.setAttribute("target",c),t.setAttribute("action",e),t.setAttribute("method","post"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),u.attachEvent)u.attachEvent("onload",r),u.attachEvent("onerror",a);else u.onload=r,u.onerror=a;t.submit()}else if(window.FormData){var d=new FormData;if(t.fileName)d.append(n,t,t.fileName);else d.append(n,t);exports.request(e,{success:i,failure:o,data:d,method:"post"})}},exports.initWs=function(e,t,n){e.init(t,n)},exports.ws=function(e,t,n,i){e.sendMsg(t,n,i)},exports}),define("im-lib/util",[],function(){var exports={},e="0123456789ABCDEF";return exports.uuid=function(){for(var t=[],n=0;n<32;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);t[12]="4",t[16]=e.substr(3&t[16]|8,1);var i=t.join("").toLowerCase();return i=i.toLowerCase(),i=i.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.decodeHTML=function(e){return e=e||"",e.replace("&lt;","<").replace("&gt;",">").replace("&amp;","&").replace("&quot;",'"').replace("&nbsp;"," ")},exports.encodeHTML=function(e){return e=e||"",e.replace(/</g,"&lt").replace(/>/g,"&gt").replace(/&/g,"&amp").replace(/"/g,"&quot").replace(/ /g,"&nbsp")},exports.getText=function(e){var t="";if(3===e.nodeType||4===e.nodeType)t+=exports.decodeHTML(e.nodeValue);else if("IMG"===e.tagName)if(e.getAttribute("data-face-id"))return"["+e.getAttribute("data-face-text")+"]";else return"[\u56fe\u7247]";else if(8!==e.nodeType)for(var n=0;n<e.childNodes.length;n++)t+=exports.getText(e.childNodes[n]);return t},exports.isSupportWs=function(){return"function"==typeof window.WebSocket&&"function"==typeof window.WebSocket.prototype.send}(),exports.padLeft=function(e,t,n){n=n||"0";for(var i=e.toString().length;i<t;)e=n+e,i++;return e},exports.msgid=function(){for(var e=[],t=0;t<5;t++)e[t]=Math.floor(10*Math.random());return(new Date).getTime()+e.join("")},exports.getCookie=function(e,t){var n=e+"=",i="";if(document.cookie.length>0){var o=document.cookie.indexOf(n);if(o>-1){o+=n.length;var r=document.cookie.indexOf(";",o);if(-1===r)r=document.cookie.length;i=t?unescape(document.cookie.substring(o,r)):document.cookie.substring(o,r)}}return i},exports}),define("im-lib/Emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var o=n[e].length;if(o>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+o+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var o,r=0;r<i.length;r++)if((o=i[r])===t||o.listener===t){i.splice(r,1);break}return this},t.emit=function(e){var t=this._getEvents(),n=t[e],i=Array.prototype.slice.call(arguments,1);if(n){n=n.slice(0);for(var o=0,r=n.length;o<r;o++)n[o].apply(this,i)}return this},t.listeners=function(e){return this._getEvents()[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t},e}),define("im-lib/userData",[],function(){function e(e){return e.replace(o,"___")}function t(){}function n(){if(!i)try{return i=document.createElement("input"),i.type="hidden",i.addBehavior("#default#userData"),document.body.appendChild(i),!0}catch(e){return i={load:t,save:t,getAttribute:t,setAttribute:t,removeAttribute:t},!1}return!0}var exports={},i=null,o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),r=location.hostname+"_bridge_im";return exports.setItem=function(t,o){if(n()){t=e(t);var a=new Date;a.setDate(a.getDate()+365),i.expires=a.toUTCString(),i.load(r),i.setAttribute(t,o),i.save(r)}},exports.getItem=function(t){if(!n())return"";else return t=e(t),i.load(r),i.getAttribute(t)},exports.removeItem=function(){if(n())key=e(key),i.load(r),i.removeAttribute(key),i.save(r)},exports.clear=function(){var e=new Date;e.setDate(e.getDate()-1),i.expires=e.toUTCString()},exports}),define("im-lib/localStorage",["require","./userData"],function(require){var e,exports={};try{e=window.localStorage||require("./userData")}catch(t){e=require("./userData")}return exports.setItem=function(t,n){try{e.setItem(t,n)}catch(e){}},exports.getItem=function(t){return e.getItem(t)},exports.removeItem=function(t){e.removeItem(t)},exports.clear=function(){e.clear()},exports}),define("im-lib/main",["require","./lang","./json","./net","./util","./Emitter","./localStorage"],function(require){return{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage")}}),define("im-lib",["im-lib/main"],function(e){return e}),define("im-core/main",["require","im-lib","im-lib/Emitter","bull","./bullConfig"],function(require){function e(module,e,t){module.on(e,function(){var n=Array.prototype.slice.call(arguments);n.unshift(t||e),exports.emit.apply(exports,n)})}var t=require("im-lib"),n=require("im-lib/Emitter"),i=require("bull"),exports={};n.mixin(exports);var o=!1,r=[],a=null;return exports.messageHandler=function(e,n){var i=n.adata&&t.json.parse(n.adata)||{},o=i.displayName||i.nickname||e.sinfo.nickname||n.from,r=1e3*n.time;exports.decode(n,function(e){if(1==+e.role||"server"===e.role)e.recognize=n.recognize||{};if(e.about=1===n.aboutMoney?"money":"other",n.menuMessage&&n.menuMessage.headContent)e.menuMessage=n.menuMessage,e.text=n.menuMessage.headContent;else e.menuMessage=!1;if(e.msgId=n.msgid||r,exports.pushReadedMsg(n),"offlineChatFormText"!==n.reason)if(exports.emit("message",e,o,r,n.msgHandlerType||""),1===n.aboutMoney)exports.emit("systemMessage","\u6d89\u53ca\u8d44\u91d1\u4ea4\u6613\u65f6\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\uff01")})},exports.decode=function(e,t){},exports.init=function(e){var t=require("bull"),n=require("./bullConfig");t.init(n),exports.initCore(e),document.addEventListener("visibilitychange",function(){exports.pushReadedMsg()})},exports.getTargetMsg=function(e){if(e){if(r[e-1].seqId)return r[e-1];else return exports.getTargetMsg(e-1)}else return!1},exports.pushReadedMsg=function(e,t,n){if(n&&n.seqId)r.push(n);else if(r.length)n=exports.getTargetMsg(r.length);else return;if("boolean"!=typeof n||n){var o=document.querySelector(".qiao-mobile-lite-mask-show");if(!document.hidden&&o){if(i.get("data.config").getServer().siteObj.userCommonSwitch.isOpenStateOfRead&&n.seqId){var s={content:{waiterMaxMsgId:n.msgid,waiterMaxSeqId:n.seqId,sid:n.sid,eid:String(n.eid),bid:e.bid}};if(a)clearTimeout(a);a=setTimeout(function(){t.hasReadedMsg(s)},1e3)}}}},exports.initCore=function(t,n,i,o,r){i.extend(exports,o),exports.addPlugin(),i.extend(n,r||{}),n.anonym=n.bid?0:1,t.on("message",exports.messageHandler);var a=["error","reconnect","connected","disconnect","offline","csoffline","invitefail","queueing","otherwebimalive","fetchhistorysuccess","fetchhistoryfail","fetchhistoryfinish","visitorblock","autoendtalk","currentIR","showMsgRemind","csonline","transferError","fininshIR","updateNewCSR","visitorTransfer","unknownMsg","aiAssistance","reCallMsg","checkServiceVersion","handleCallAudioEvent"];i.each(a,function(n){e(t,n)})},exports.addPlugin=function(){for(var e=0;e<arguments.length;e++)exports.plugin(arguments[e])},exports.connect=function(e,t,n,i,r){function a(a){if(n.isBlocked())return o={type:i,options:r},exports.emit("visitorblock",{blocktype:n.isBlocked()}),void exports.emit("blocked",{blocktype:n.isBlocked()});if(a.invited)a.status=3;switch(a.status){case 0:case 1:case 2:e.connect(i,r);break;case 3:if(r.invited||a.invited)a.invited=1,a.from=r.from,e.connect(i,a);else a.reason="talk to other",e.disconnect(a,function(n){if(t.usingWs)e.wsPickSucc(n),e.wsPick()}),e.setStopPick(!1),e.pick();break;case 4:e.connect(i,r);break;default:e.connect(i,r)}}if(exports.emit("startconnect"),n.isLogin())a(t);else n.login(a,function(){exports.emit("error",{type:"init"})},function(e){exports.emit("visitorblock",{blocktype:e})})},exports.checkcode=function(e,t){e.checkcode(t,function(){if(o)exports.connect(o.type,o.options),o=!1})},exports.confirm=function(e){e.confirm(function(){if(o)exports.connect(o.type,o.options),o=!1})},exports.auth=function(e,t,n){if(e.isLogin());else e.login(function(){exports.emit("connected")},function(){exports.emit("error",{type:"init"})})},exports.send=function(e,t,n,i){function o(e,t){if(t&&t.extra&&0==+t.extra.riskType&&1==+t.extra.riskResult)exports.emit("checkUpHF",n,t.extra);exports.emit("sendfinish",n),exports.emit("sendsuccess",n)}function r(){exports.emit("sendfail",n)}if(exports.emit("trysendmsg"),!e.isConnected())return exports.emit("sendfail",n),!1;else return exports.emit("sendMobileData",n),t.encode(n,function(t){t.adata=i,e.send(t,o,r)},r),!0},exports.falseFeedback=function(e,t,n,i){function o(){exports.emit("falseFeedbackSuccess",n,i)}function r(){exports.emit("falseFeedbackFail",n,i)}return e.falseFeedback(n,i,o,r),!0},exports.preSend=function(e,t,n){if(!e.isConnected())return!1;e.preSend({mtype:0,content:n.text,isMobileWebIm:n.isMobileWebIm||!1})},exports.recommendUsed=function(e,t,n){if(!e.isConnected())return!1;e.recommendUsed({msgid:n.msgid,used_type:n.used_type,user_id:n.user_id})},exports.disconnect=function(e,t,n,i){if(exports.emit("sessioncut"),!1!==i)e.disconnect();if(!1!==n)t.logout()},exports.plugin=function(e,t){if(t.encoder)e.addEncoder(t.encoder);if(t.decoder)e.addDecoder(t.decoder);if(t.emit)t.emit=function(){var e=Array.prototype.slice.call(arguments);exports.emit.apply(exports,e)}},exports.get=function(e,t){return e.get(t)},exports.getConfig=function(e,t){if(t)return e[t];else return e},exports.getAuth=function(e,t){if(t)return e[t];else return e},exports.isConnected=function(e){return e.isConnected()},exports.sendOfflineMsg=function(e,t,n,i){function o(){exports.emit("sendofflinemsgfinish",n),exports.emit("sendofflinemsgsuccess",n)}function r(){exports.emit("sendofflinemsgfail",n)}if(e.isConnected())return exports.emit("sendofflinemsgfail",n),!1;else return t.encode(n,function(t){t.adata=i,e.send(t,o,r)},r),!0},exports.fetchHistory=function(e,t){e.fetchHistory(t)},exports.fetchSessionMessage=function(e){e.fetchSessionMessage()},exports.isBlocked=function(e){return e.isBlocked()},exports.checkVersion=function(e,t,n,i){console.log(e,"config1111");var o={uid:e.tid,funcs:["client_app_voicecom","client_app_call"]};t.checkVersion(o,n,i)},exports}),define("im-core",["im-core/main"],function(e){return e}),define("im-core/plugin/fileTransfer",["require","../main"],function(require){var e=1,exports={};exports.encoder={};var t=exports.encoder;t.fileAccept=function(t,n){n({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,size:t.size,type:"accept"}}})},t.fileVUpload=function(t,n){n({mtype:e,content:{type:"file",msgInfo:t.msgInfo,data:{status:t.status,bcsName:t.bcsName,name:t.name,size:t.size,type:"vUpload"}}})},t.fileVDownLoad=function(t,n){n({mtype:e,content:{type:"file",data:{status:t.status,bcsName:t.bcsName,name:t.name,type:"vDownLoad"}}})},t.fileVCancelSend=function(t,n){n({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,type:"vCancelSend"}}})},exports.decoder={};var n=require("../main");return exports.decoder.fileTransfer=function(e,t){e=e||{};var i=e.content||{},o=i.data||{},r=i.msgInfo||{},a={bcsName:o.bcsName,name:o.name},s="";switch(o.type){case"accept":s="fileAccept",a.status=o.status;break;case"sDownLoad":s="fileSDownLoad",a.status=o.status;break;case"sUpLoad":s="fileSUpload",a.size=o.size;break;case"vCancelSend":s="vCancelSend";break;case"vDownLoad":s="vDownLoad",a.status=o.status;break;case"vUpload":s="vUpload"}n.emit(s,a,r,e.msgHandlerType||"")},exports}),define("qiao-im-msdk/plugin/fileTransfer",["im-core/plugin/fileTransfer"],function(e){return e}),define("im-core/const",[],function(){var exports={};return exports.PLATFORM_PC=0,exports.PLATFORM_MOBILE=1,exports.SERVER_TIEXIN=1,exports.SERVER_DUZHAN=2,exports.SERVER_QIAO=3,exports.AUTH_TYPE_LOCAL=0,exports.AUTH_TYPE_QIAO=4,exports.AUTH_TYPE_DUZHAN=5,exports.CHAT_TYPE_USER=0,exports.CHAT_TYPE_GROUP=1,exports.CHAT_TYPE_IR=4,exports.PUSH_TYPE_BYE=2,exports.PUSH_TYPE_CHAT=3,exports.PUSH_TYPE_OFFLINE=4,exports.PUSH_TYPE_FETCH_HISTORY=5,exports.PUSH_TYPE_PRE_SEND=6,exports.PUSH_TYPE_FETCH_SESSION_MESSAGE=7,exports.PUSH_TYPE_MSG_SYNC=9,exports.PUSH_TYPE_RECOMMEND_USED=15,exports.PUSH_TYPE_READED_MSG=16,exports.CHART_START_TYPE="vsturl:u",exports.BLOCK_TYPE={IP_BLOCK:1,BID_BLOCK:2,CONFIRM_BLOCK:3,CODE_BLOCK:4,DIRECT_BLOCK:5},exports}),define("qiao-im-msdk/const",["im-core/const"],function(e){return e}),define("im-core/config",["require","./const"],function(require){var e=require("./const");return{bid:"",siteid:"",eid:"",likeCrm:"1",filterAdvertisement:"1",csrfToken:"",crossDomain:!1,platform:e.PLATFORM_PC,server:e.SERVER_QIAO,authType:e.AUTH_TYPE_QIAO,authToken:"bridge",urlRoot:"/",sid:"-100",tid:"-1",fromType:1,ttype:1,reasons:["vstreq:u","vstsys:u","vstwtr:u","vsturl:u","vstwtr:f","vstreq:f","vstsys:f","vstsys:i"],isPageOnload:!0,isSessionConnected:!1,webSocket:!1,usingWs:!1,wsUrl:"/"}}),define("qiao-im-msdk/config",["im-core/config"],function(e){return e}),define("im-core/plugin/unknownMsg",["require","im-lib","../config","im-core"],function(require){function e(e,t){t({content:{content:{data:e.content,msgInfo:e.msgInfo||{},type:e.msgType||""},type:a},mtype:r})}function t(e,t){e=e||{};var a=e.content||{},c=a.content;if(a.mtype===o||a.mtype===r)try{c=n.json.parse(a.content),c.msgInfo=c.msgInfo||{};var l=e.adata&&n.json.parse(e.adata)||{};c.nickname=l.nickname||s}catch(e){c=a.content}c.role=e.from===i.bid?0:1,require("im-core").emit("unknownMsg",c)}var exports={},n=require("im-lib"),i=require("../config"),o=1,r=4,a="unable message",s="\u5bf9\u65b9";return exports.encoder={},exports.encoder[a]=e,exports.decoder={},exports.decoder["unable message"]=t,exports}),define("qiao-im-msdk/plugin/unknownMsg",["im-core/plugin/unknownMsg"],function(e){return e}),define("base/pc/lib",["require"],function(require){function e(e,t){var n="",i=e<0,o=Math.abs(e)+"";if(o.length<t)n=new Array(t-o.length+1).join("0");return(i?"-":"")+n+o}var exports={},t=/\{\s*\[(?:native code|function)\]\s*\}/i;return exports.isType=function(e,t){return{}.toString.call(e).indexOf("[object "+t)>=0},exports.isNative=function(e){return!(!e||!t.test(e))},exports.instanceOf=function(e,t){return e&&e.hasOwnProperty&&e instanceof t},exports.extend=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&"_belong"!==n)e[n]=t[n];return e},exports.getBid=function(){var e,t=(+new Date).toString(),n=Math.floor(1e5*Math.random()).toString(),i=5-n.length;if(i>0)for(e=0;e<i;e++)n+="0";return t+n},exports.uuid=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},exports.parseTime=function(t,n){function i(e,t){n=n.replace(e,t)}if("string"!=typeof n)return t.toString();var o=t.getFullYear(),r=t.getMonth()+1,a=t.getDate(),s=t.getHours(),c=t.getMinutes(),l=t.getSeconds();return i(/yyyy/g,e(o,4)),i(/yy/g,e(parseInt(o.toString().slice(2),10),2)),i(/MM/g,e(r,2)),i(/M/g,r),i(/dd/g,e(a,2)),i(/d/g,a),i(/HH/g,e(s,2)),i(/H/g,s),i(/hh/g,e(s%12,2)),i(/h/g,s%12),i(/mm/g,e(c,2)),i(/m/g,c),i(/ss/g,e(l,2)),i(/s/g,l),n},exports.trim=function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},exports.transferDate=function(e){if(e=+e,isNaN(e))return e;var t=+new Date(e),n=["\u4eca\u5929","\u6628\u5929"],i=864e5,o=new Date,r=parseInt((+o-6e4*o.getTimezoneOffset())/i,10),a=r-parseInt((t-6e4*o.getTimezoneOffset())/i,10);if((a=Math.abs(a))<n.length)return n[a];else return exports.parseTime(new Date(e),"yyyy-MM-dd")},exports.preventDefault=function(e){if(e&&e.preventDefault)e.preventDefault();else window.event.returnValue=!1;return!1},exports}),define("embed/log/main",["require","../../base/pc/lib"],function(require){function e(e){return!s[e]&&(s[e]="uuid_"+r.uuid()),s[e]}function t(){return!s.tabid&&(s.tabid="tabid_"+(new Date).getTime()),s.tabid}function n(e){return(new Date).getTime()-a[e]}function i(e,t){a[e]=t||+new Date}function o(e){var t=1,n=e.match(/(iPad).*OS\s([\d_]+)/),i=!n&&e.match(/(iPhone\sOS)\s([\d_]+)/),o=e.match(/(Android);?[\s\/]+([\d.]+)?/);if(n||i)t=3;else if(o)t=2;return t}var r=require("../../base/pc/lib"),exports={},a={},s={pushTotalMsg:0,pushFailMsg:0,pickMsg:0,pushMsg:0,ifLoopStart:!1},c={};exports.componentIsShow={icon:0,toolbar:0},exports.smartInvite={expGroup:"",text:"",isUse:0,ideaType:-1,query:-1,startObj:{}},exports.smartCommunication={isAutoDirectCom:-1,getIntelWelLan:-1,showIntelWelLan:-1},exports.isInviteOrCom=-1;var l=1,f=0,u=0,d=0,m=0,p=["m2005","m2021"];return exports.init=function(e,t,n){var i=e.getServer(),r=i.siteObj;a.eid=r.eid,a.siteid=r.siteId,a.platform=r.platform,n.bid=t.init(r.siteId,r.bid||n.bid,r.session),a.bid=n.bid,a.logRoot=e.staticDomain,a.startTime=i.startTime,exports.smartInvite.likeCrm=i.configBox.inviteBox.likeCrm,exports.smartInvite.inviteBox=i.configBox.inviteBox;var s=i.configBox;if(0==+s.inviteBox.likeCrm&&1==+o(navigator.userAgent))if(0==+s.isWebim&&1==+s.webimConfig.isOpenAutoDirectCom&&1!=+s.seekIcon.iconType&&1==+i.siteObj.isCsOnline)exports.isInviteOrCom=2;else if(1==+s.inviteBox.autoInvite||1==+s.inviteBox.smartBoxEnable&&0!=+s.inviteBox.smartBoxOpen)exports.isInviteOrCom=1},exports.addLightMsg=function(e){if("sub"==(e.role?"sub":"custom"))s.pickMsg++;else s.pushMsg++,s.pushTotalMsg++},exports.sendFailMsg=function(){s.pushFailMsg++},exports.logQueue=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"queue",brgeyemid:"m2007",winType:"webimLight",cost:c.render+n("m2013"),queueCost:n("m2013")})},exports.logConnect=function(){if(exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"connected",brgeyemid:"m2007",winType:"webimLight",cost:c.render+n("m2013"),transferCost:n("m2013")}),!s.ifLoopStart)exports.logPickMsg(),exports.logPushMsg(),s.ifLoopStart=!0},exports.logTransferFail=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"failed",brgeyemid:"m2007",winType:"webimLight",cost:c.render+n("m2013"),transferCost:n("m2013")})},exports.logOpenWebim=function(){exports.sendLog(t(),{cncttype:"openWebim",uuid:e("openUUID"),brgeyemid:"m2006"})},exports.logClickSeek=function(e,n,i,o){var r={brgeyemid:"m2005",url:document.URL,referrer:document.referrer,bclid:n.get("BCLID")};if(exports.smartInvite.isPcSmart&&"accept"===i&&o)if(+exports.smartInvite.smartButtonType){for(var a=!1,s=o.target.className.split(" "),c=0;c<s.length;c++)if("nb-invite-ok-show"===s[c])a=!0;if(a)d+=1,r.smartNthClickBtnInvite=d}else m+=1,r.smartNthClickBgInvite=m;i&&(r.type=i),exports.sendLog(t(),r)},exports.logPickMsg=function(){var e=function(){var e=s.pickMsg;if(s.pickMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2004"});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logPushMsg=function(){var e=function(){var e=s.pushMsg;if(s.pushMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2003",isAutoDirectCom:exports.smartCommunication.isAutoDirectCom});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logEndNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2002"})},exports.logStartNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2001"})},exports.logRenderStart=function(){i("m2008",a.startTime),exports.sendLog(t(),{uuid:e("renderUUID"),brgeyemid:"m2008"})},exports.logRenderEnd=function(){c.render=n("m2008"),exports.sendLog(t(),{cncttype:"renderFinish",uuid:e("renderUUID"),brgeyemid:"m2009",cost:c.render,icon:exports.componentIsShow.icon,toolbar:exports.componentIsShow.toolbar})},exports.logEnterStart=function(){i("m2010"),exports.sendLog(t(),{cncttype:"startSite",uuid:e("enterUUID"),brgeyemid:"m2010",isInviteOrCom:exports.isInviteOrCom})},exports.logEnterEnd=function(){exports.sendLog(t(),{cncttype:"finishSite",uuid:e("enterUUID"),brgeyemid:"m2011",cost:n("m2008"),siteCost:n("m2010")})},exports.logStartTransfer=function(){i("m2013")},exports.leaveSite=function(){exports.sendLog(t(),{uuid:e("enterUUID"),brgeyemid:"m2012",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg}),exports.sendLog(t(),{uuid:e("msgFailRate"),brgeyemid:"m2014",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg})},exports.logForceTalk=function(){exports.sendLog(t(),{cncttype:"forceTalk",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickUnread=function(){exports.sendLog(t(),{cncttype:"clickUnread",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickMsgLite=function(){exports.sendLog(t(),{cncttype:"clickMsgLite",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickOnlineConsult=function(){exports.sendLog(t(),{cncttype:"clickOnlineConsult",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logClickDial=function(){exports.sendLog(t(),{cncttype:"clickDial",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logClickGetConnect=function(){exports.sendLog(t(),{cncttype:"clickGetConnect",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logMessageAutoShow=function(n){exports.sendLog(t(),{cncttype:"messageAutoShow",uuid:e("openUUID"),brgeyemid:"m2017",url:document.URL,referrer:document.referrer,bclid:n.get("BCLID")})},exports.logMessageClickShow=function(n){exports.sendLog(t(),{cncttype:"messageClickShow",uuid:e("openUUID"),brgeyemid:"m2017",url:document.URL,referrer:document.referrer,bclid:n.get("BCLID")})},exports.logInviteShow=function(n,i){if(1===l){if(0!==exports.smartInvite.likeCrm)l=0;f+=1;var o={cncttype:"inviteShow",uuid:e("openUUID"),brgeyemid:"m2018",isSmart:n,text:exports.smartInvite.text,from:i,nthShowInvite:f};exports.sendLog(t(),o)}},exports.logMsgBubbleShow=function(){exports.sendLog(t(),{cncttype:"msgBubbleShow",uuid:e("openUUID"),brgeyemid:"m2019"})},exports.logClickIcon=function(){exports.sendLog(t(),{cncttype:"clickIcon",uuid:e("openUUID"),brgeyemid:"m2020"})},exports.logClickInvite=function(n){u+=1;var i={cncttype:"clickInvite",uuid:e("openUUID"),brgeyemid:"m2021",from:n,text:exports.smartInvite.text};exports.sendLog(t(),i)},exports.logClickMsgBubble=function(){exports.sendLog(t(),{cncttype:"clickMsgBubble",uuid:e("openUUID"),brgeyemid:"m2023"})},exports.logClickSmartLogo=function(){exports.sendLog(t(),{cncttype:"clickSmartLogo",uuid:e("openUUID"),brgeyemid:"m4001"})},exports.logCloseSmartInvite=function(){exports.sendLog(t(),{cncttype:"closeSmartInvite",uuid:e("openUUID"),brgeyemid:"m4002"})},exports.logStopSmartInvite=function(n){exports.sendLog(t(),{cncttype:"stopSmartInvite",uuid:e("openUUID"),brgeyemid:"m4003",stopSmartInviteType:n})},exports.logAutoDirectCom=function(){exports.smartCommunication.isAutoDirectCom=1,exports.sendLog(t(),{cncttype:"autoDirectCom",uuid:e("openUUID"),brgeyemid:"m4004",getIntelWelLan:exports.smartCommunication.getIntelWelLan})},exports.logShowIntelWelLan=function(){exports.smartCommunication.showIntelWelLan=1,exports.sendLog(t(),{cncttype:"showIntelWelLan",uuid:e("openUUID"),brgeyemid:"m4005",isAutoDirectCom:exports.smartCommunication.isAutoDirectCom})},exports.logStopACOrIW=function(n,i){exports.sendLog(t(),{cncttype:"stopACOrIW",uuid:e("openUUID"),brgeyemid:"m4006",isInviteOrCom:exports.isInviteOrCom,getIntelWelLan:exports.smartCommunication.getIntelWelLan,stopAutoCom:n||-1,stopIntelWel:i||-1})},exports.sendLog=function(e,t,n,i,r){var s=r||{};if(s.t=(new Date).getTime(),s.ip="",s.dtype=o(navigator.userAgent),s.ucid=n.eid||a.eid,s.uid=t.get("to")||n.tid||"",s.siteid=n.siteid||a.siteid,s.tabid=i,s.bid=n.bid||a.bid,s.sessionid=t.get("sid")||n.sid||"",s.originType=0,exports.smartInvite.expGroup)s.siExpGroup=exports.smartInvite.expGroup,s.welcome=exports.smartInvite.text;s.likeCrm=exports.smartInvite.likeCrm,s.ideaType=exports.smartInvite.ideaType,s.query=exports.smartInvite.query;for(var c in exports.smartInvite.startObj)if(exports.smartInvite.startObj.hasOwnProperty(c))if("type"!==c&&"query"!==c)s[c]=exports.smartInvite.startObj[c];if(r&&r.brgeyemid&&-1!==p.indexOf(r.brgeyemid))s.from=n.fromType;e.send(a.logRoot,s)},exports}),define("common/logger",["bull"],function(){var exports={};return exports.log=function(e){try{e=e||{};var t=require("bull"),n=t.get("data.config"),i=t.get("core.config"),o=n.getServer("siteObj"),r=o.webRoot+"report/log.gif";if(!e.pstage||!e.stage||!e.logType)return void console.error("pstage,stage,logType \u4e0d\u80fd\u4e3a\u7a7a");e.loginid=o.eid||"",e.t=e.t||Date.now(),e.s=o.siteId||"",e.v=i.bid||"",e.sid=i.sid||"",e.dev=i.platform;var a=e.loginid+"-"+e.pstage+"-"+e.stage+"-"+e.v;if("START"===e.logType)sessionStorage.setItem(a,JSON.stringify(e));else if("END"===e.logType){var s={},c=sessionStorage.getItem(a)||"";if(c)s=JSON.parse(c);if(!s||"START"!==s.logType)return console.log("APM logger START not find. logCacheKey is: ",a),void sessionStorage.removeItem(a);var l=e.t-s.t;if(l<=0||l>=1e4)return console.log("APM logger timeDiff invalid. logCacheKey is: ",a,l),void sessionStorage.removeItem(a);var f=exports.uuid();s.lid=e.lid=f,e.st=s.t,e.et=e.t,exports.send(r,e),sessionStorage.removeItem(a)}}catch(e){console.log(e)}},exports.send=function(e,t,n){var i=Date.now(),o=window[i]=new Image,r="";o.onload=o.onerror=o.onabort=function(){if(window[i]=null,"function"==typeof n)n&&n()};for(var a in t)if(""!==t[1]){var s="&"+a+"="+encodeURIComponent(t[a]);r+=s}o.src=e+"?"+r.slice(1)},exports.uuid=function(){for(var e=[],t="0123456789ABCDEF",n=0;n<32;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);e[12]="4",e[16]=t.substr(3&e[16]|8,1);var i=e.join("");return i=i.toLowerCase(),i=i.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.logStatic=function(e){exports.log({pstage:1,stage:2,logType:e.logType||"START",fnName:"logStatic",t:e.t||""})},exports.logVisiterEnter=function(e){exports.log({pstage:1,stage:3,logType:e.logType||"START",fnName:"logVisiterEnter",t:e.t||""})},exports.logVisiterEnterHTJ=function(e){exports.log({pstage:1,stage:5,logType:e.logType||"START",fnName:"logVisiterEnterHTJ",t:e.t||""})},exports.logVisiterEnterAust=function(e){exports.log({pstage:1,stage:6,logType:e.logType||"START",fnName:"logVisiterEnterAust",t:e.t||""})},exports.logVisiterEnterHTJStatic=function(e){exports.log({pstage:1,stage:7,logType:e.logType||"START",fnName:"logVisiterEnterHTJStatic",t:e.t||""})},exports.logVisiterEnterHTJServer=function(e){exports.log({pstage:1,stage:8,logType:e.logType||"START",fnName:"logVisiterEnterHTJServer",t:e.t||""})},exports}),define("lib/logger",["common/logger"],function(e){return e}),define("im-core/net",["require","im-lib","common/logger"],function(require){function e(){}var exports={};require("im-lib").Emitter.mixin(exports);var t=require("common/logger"),n={INITIAL:0,INITIALIZED:1,DISABLED:2},i=n.INITIAL;return exports.canUseWs=function(e,t,o,r,a,s,c){return e.isSupportWs&&t.webSocket&&i!==n.DISABLED},exports.successFactory=function(e,t,n,i,o,r){var a=e;return function(e){try{if(-1!==Object.prototype.toString.call(e).indexOf("String"))e=t.parse(e)}catch(e){return void i()}if(a.set("sn",e.n_sn),!e.status||2===e.status)exports.emit("response",o||e.method,e.body||e),n(e.body||e,e);else{if(void 0===r)r=!0;if(r)exports.emit("auth invalid");i(e)}}},exports.wsCommands=function(e,t,o,r){return{getComCallback:function(e){return{"site/poll":{success:exports.successFactory(o.pickSuccess,o.pickFailure),failure:o.pickFailure},"chat/poll":{success:exports.successFactory(r.wsPickSucc,r.wsPickFail),failure:r.wsPickFail}}},changeStatus:function(t){i=t.status,e.usingWs=i===n.INITIALIZED},getBaseBody:function(n){return{auth:t.get(),e:e.eid,s:e.siteid,v:e.bid}},setAuth:function(n){t.set("key",n.key),e.bid=n.bid},request:function(e){exports.request(e.path,e.options,"downgrade")}}},exports.getJsonp=function(e){function t(e){var t=e.jsonp,i=document.getElementsByTagName("head")[0];e.data.callback=t;var o=n(e.data),r=document.createElement("script");if(i.appendChild(r),window[t]=function(n){i.removeChild(r),clearTimeout(r.timer),window[t]=null,e.success&&e.success(n)},r.src=e.url+"?"+o,e.time)r.timer=setTimeout(function(){window[t]=null,i.removeChild(r),e.error&&e.error({message:"\u8d85\u65f6"})},time)}function n(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.push("v="+i()),t.join("&")}function i(){return Math.floor(1e4*Math.random()+500)}e=e||{},e.data=e.data||{},t(e)},exports.wsCallBack=function(e){return exports.wsCommands()[e.type](e.data)},exports.jsonToQuery=function(e,t,n){var i=[];return t.each(n,function(n,o){if(t.isObject(o))o=e.stringify(o);if("number"!=typeof o)o=encodeURIComponent(o);i.push(n+"="+o)}),i.join("&")},exports.request=function(t,o,r,a,s,c,l){var f=t.urlRoot+s;if(c.fullPath&&!0===c.fullPath)f=s;c=c||{},c.data.sign=o.get("sign")||"";var u=c.failure||e,d=c.success||e;if("downgrade"===l)c.success=c.success;else if(!1===c.isneedlogout)c.success=exports.successFactory(d,u,s,!1);else c.success=exports.successFactory(d,u,s);var m=c.data||{};if(exports.emit("request",s,m),m.v=t.bid,m.s=t.siteid,m.e=t.eid,m.isAFF=0==+t.likeCrm?"1":"0",m.filterAdvertisement=""+t.filterAdvertisement,m.dev=t.platform,m.auth=o.get(),"chat/st"===s&&o.get("code_token"))m.code_token=o.get("code_token");if("site/st"===s)m.siteToken=t.siteToken||"";if("site/st"===s||"chat/push"===s||"site/aust"===s)m.AFDto="undefined"!=typeof xaf?xaf.getData().Token:"",m.AFDvw="undefined"!=typeof xaf?xaf.getData().view:"";if(c.data=null,exports.canUseWs(m,s,d,u,l)){if(i===n.INITIAL)r.initWs(t.wsUrl+"?v="+m.v,exports.wsCallBack);r.ws(s,m,c)}else if(t.crossDomain||c.crossDomain){if(f+=f.indexOf("?")>=0?"&":"?",f+=exports.jsonToQuery(m),c.type=m.type,c.key="cb",c.op=m.op,c.l=m.l,2===m.type&&"chat/push"===s&&!d&&!u||3===m.op&&"site/auth"===s&&!d&&!u||1===m.op&&"site/st"===s&&!d&&!u||1===m.op&&"site/aust"===s&&!d&&!u){var p=document.createElement("img");return void(p.src=f)}if("imgCross"===l)r.imgRequest(f);else r.jsonp(f,c)}else{if(c.method=c.method||"POST","POST"===c.method)c.data=a.stringify(m),f=f+"?v="+m.v;else f+=f.indexOf("?")>=0?"&":"?",f+=exports.jsonToQuery(m),f+="&v="+m.v;if(c.setCookie)f=f+"&s="+m.s,f=f+"&t="+c.setCookie;r.request(f,c)}},exports.auth=function(e,t,n,i,o){var r;if(0===e.visitType)r=t?0:1;else r=t?2:3;var a,s={success:i,failure:o,data:{op:r,dev:e.platform,ser:e.server,s_info:n}};if(!t)s.method="GET",a="imgCross";exports.request("site/auth",s,a)},exports.poll=function(e,t,n,i){function o(t){n(t),e.emit("handleCallAudioEvent",t)}var r={success:o,failure:i,data:{l:t?1:0}};exports.request("site/poll",r)},exports.site=function(e,n,i,o,r){var a={success:o,failure:r,data:{op:n?0:1,s_info:i,url:location.href}},s="site/st";if(e.vstProto)a.data.siteToken=e.siteToken,a.data.dev=e.platform,a.data.ser=e.server,a.data.bst=e.startTime||"",s="site/aust";var c;if(!n)a.method="GET",c="imgCross";window.NB_START_REQUEST_BLINK=(new Date).getTime();var l={aid:"5480",timeout:500,biz:{ev:"page_enter",customer:e.eid,bid:e.bid,length:0},complete:function(e){if(t.logVisiterEnterHTJServer({logType:"END"}),t.logVisiterEnterHTJ({logType:"END"}),t.logVisiterEnterAust({logType:"START"}),e)a.data.AFDjt=e.jt||"";exports.request(s,a,c)}};if(n)if(a.data.AFDbiz=l.biz,"undefined"!=typeof xaf)try{return t.logVisiterEnterHTJServer({logType:"START"}),void xaf.report(l)}catch(e){}exports.request(s,a,c)},exports.chat=function(e,t,n){var i={success:t,failure:n,data:e};exports.request("chat/st",i)},exports.pick=function(e,t,n,i){var o={success:n,failure:i,data:{l:1,sid:t||""}};if(e.isPageOnload||!e.isSessionConnected)exports.request("chat/poll",o);else o.data.l=0,setTimeout(function(){exports.request("chat/poll",o)},3e3)},exports.push=function(e,t,n,i){var o={success:n,failure:i,data:t||{}};if(2===t.type)o.method="GET";var r=0;if(t&&t.param&&t.param.content){var a=document.createElement("div");a.innerHTML=t.param.content,r=a.innerText.length,a=null}var s={aid:"5480",biz:{ev:"talk",customer:e.eid,bid:e.bid,length:r},complete:function(e){if(e)o.data.AFDjt=e.jt||"";exports.request("chat/push",o)}};if(3===t.type)if(o.data.AFDbiz=s.biz,"undefined"!=typeof xaf)try{xaf.report(s)}catch(e){exports.request("chat/push",o)}else exports.request("chat/push",o);else exports.request("chat/push",o)},exports.falseFeedback=function(e,t,n){var i={success:t,failure:n,data:e||{}};exports.request("nbcps-web/suggest/addContentSuggest.action",i)},exports.node=function(e,t,n){var i={success:t,failure:n,data:e||{}};exports.request("bookmanage/saveBook.action",i)},exports.validate=function(e,t,n){var i={method:"GET",success:t,failure:n,data:e||{},isneedlogout:!1};exports.request("protection/validate",i)},exports.upload=function(e,t,n,i,o,r){t.upload(e.urlRoot+n,i,"file",o,r)},exports.getUploadUrl=function(e,t,n,i){return i=i||t.uuid(),e.urlRoot+"wupload/"+i+"/"+n.get("sid")},exports.getDownloadUrl=function(e,t,n,i,o){return i=i||t.uuid(),o=o||i,e.urlRoot+"wdownload/"+i+"/"+n.get("sid")+"/"+i+"?response-content-disposition=attachment;filename="+o},exports.getDomain=function(e){e=e||"";var t=/https?:\/\/([^\/]+)/i,n=e.match(t);return null!=n&&n.length>1?n[1]:""},exports.getParam=function(e,t){t=t||"";var n=t.substr(t.indexOf("?")),i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=n.substr(1).match(i);return o&&o.length>2?decodeURIComponent(o[2]):""},exports.getXstFromLink=function(e){var t="";if(!e)return t;var n=exports.getDomain(e);if(!n||n.indexOf("baidu.com")<0)return t;if(!(t=exports.getParam("xst",e))){var i=exports.getParam("reqParam",e)||"";try{i=JSON.parse(i)}catch(e){i={}}if(i.xst)t=i.xst}return t},exports.getXst=function(){var e=exports.getXstFromLink(location.href);if(!e&&exports.getParam("referer",location.href))e=exports.getXstFromLink(exports.getParam("referer",location.href));if(!e&&document.referrer)e=exports.getXstFromLink(document.referrer);return e},exports.log=function(e,t,n){},exports.checkVersion=function(e,t,n){var i={success:t,failure:n,data:e||{}};exports.request("checkVersionFunc.action",i)},exports}),define("qiao-im-msdk/net",["im-core/net"],function(e){return e}),define("im-core/chat",["require","im-lib","embed/log/main","./config","./net"],function(require){function e(e){if(!e&&T.connected)exports.emit("disconnect");if(T.stopPick=!0,T.connected=!1,T.sid="",T.options&&1===T.options.invited)T.options.invited=0}function t(){if(!T.connected)if(T.csonline)if(!T.csonline||T.online)T.connected=!0,exports.emit("connected",{sid:T.sid}),_.each(T.msgPool,function(e){exports.emit("message",e)}),T.msgPool=[]}function n(t,n){var i={type:t};if(n)i.data=n;exports.emit("error",i),e()}function i(e,t){if(!e.pickType)T.sid=e.sid,T.to=e.uid,T.authType=e.authtype,T.csonline=!0,T.ttype=e.ttype;if(t)b.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{}}function o(){C={ifIR:!1,count:0,id:null}}function r(e){var t={},n=e.length-1;return _.each(e,function(i,o){var r=i.content.bcsName;if(2===i.mtype&&"string"==typeof i.content)i.content=JSON.parse(i.content);if("img"===i.content.type&&!t[r]){if(o>=n)return N.push(e[n]),e;_.each(e,function(n,i){if("string"==typeof n.content){var a=document.createElement("div");a.innerHTML=n.content;var s=a.getElementsByTagName("img")[0];if(s&&s.tagName&&"IMG"===s.tagName.toUpperCase()&&s.id===r){var c=e.splice(o,1);e.splice(i,0,c[0]),t[r]=1}}})}}),e}function a(e){var t;if(e&&1===e.status&&"auth invalid"===e.errinfo)n("offline"),t=!0;return t}function s(e){if(D=0,H)H=!1,exports.emit("reconnect");if(exports.isConnected()){var t=T.options.siteid;if(t)m.localStorage.setItem("ACTIVE_"+t,+new Date)}_.each(e,function(e){var t=e.msg.detail?e.msg.detail.length:0,n=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.getElementsByClassName("chat-area-service-translation-content"),i=t.getElementsByClassName("chat-area-service-reply-box"),o=t.getElementsByClassName("chat-area-service-reply-text");if(n.length&&i.length&&o.length)return i[0].removeChild(o[0]),t.innerHTML;else return e};if(e.msg.content){if(""===(e.msg.adata&&JSON.parse(e.msg.adata)["__CONFIDENTIAL-REASON__"])&&1==+b.filterAdvertisement)b.filterAdvertisement="0";e.msg.content=n(e.msg.content)}else if(t>0)for(var i=0;i<t;i++)e.msg.detail[i].content=n(e.msg.detail[i].content);var o=e.type,r=exports.pickHandler[o];if(r)r(e.msg);c(e)})}function c(e){function t(){}function n(t){c(e)}function i(e,t){var n="",i=e<0,o=Math.abs(e)+"";if(o.length<t)n=new Array(t-o.length+1).join("0");return(i?"-":"")+n+o}function o(e){if(e=+e,isNaN(e))return e;var t=+new Date(e),n=["\u4eca\u5929","\u6628\u5929"],i=864e5,o=new Date,a=parseInt((+o-6e4*o.getTimezoneOffset())/i,10),s=a-parseInt((t-6e4*o.getTimezoneOffset())/i,10);if((s=Math.abs(s))<n.length)return n[s];else return r(new Date(e),"yyyy-MM-dd")}function r(e,t){function n(e,n){t=t.replace(e,n)}if("string"!=typeof t)return e.toString();var o=e.getFullYear(),r=e.getMonth()+1,a=e.getDate(),s=e.getHours(),c=e.getMinutes(),l=e.getSeconds();return n(/yyyy/g,i(o,4)),n(/yy/g,i(parseInt(o.toString().slice(2),10),2)),n(/MM/g,i(r,2)),n(/M/g,r),n(/dd/g,i(a,2)),n(/d/g,a),n(/HH/g,i(s,2)),n(/H/g,s),n(/hh/g,i(s%12,2)),n(/h/g,s%12),n(/mm/g,i(c,2)),n(/m/g,c),n(/ss/g,i(l,2)),n(/s/g,l),t}var a={transferDate:o,parseTime:r};if(e)if(e.msg&&+e.msg.msgid&&+e.ack){var s={adata:void 0,content:"",mtype:0,msgid:e.msg.msgid,ack:e.ack},l=new Date,f=a.transferDate(l)+" "+a.parseTime(l,"HH:mm:ss");s.name="\u6211",s.timeStr=f,exports.send(s,t,n,10)}}function l(e){if(++D>q&&!H)H=!0,exports.emit("offline")}function f(e){s(e),d()}function u(e){if(l(e),!a(e))setTimeout(function(){d()},3e3)}function d(){if(!T.stopPick)setTimeout(function(){v.pick(T.sid,f,u)},0)}var m=require("im-lib"),p=m.Emitter,_=m.lang,h=require("embed/log/main"),g=1,b=require("./config"),v=require("./net"),y=!0;window.newBlinkNewMsgRecord=[];var w,S="",T={connected:!1,stopPick:!1,csonline:!1,msgPool:[],presend:{sending:!1,content:""}},k={INVITE:18,ACCEPT:20,BYE:28},x={OVER:4,TAKE_OVER:3,TRANSFER:6,RECEIVE:2},I="blocked",E="auto",M={SUCCESS:0,FAILURE:1},A={QUEUEING:2,TALKING:4},R=10,C={ifIR:!1,count:1,id:null},B={CSR:0,GROUP:1,IR:4},P={READY:0,BUSY:1,LEAVE:2,UNLOGIN:3},L={TRANSFER:0,CONVERSATION:1},O={COUNT:0,LIST:1,MSG_SYNC:0,END_TIME:0,PAGE:20,DEFAULT:5,DELAY:2e3},N=[],exports={};p.mixin(exports),v.on("auth invalid",function(){T.stopPick=!0}),exports.pickHandler={},exports.pickHandler[100]=function(e){if(exports.setConfig({tid:e.uid,sid:e.sid}),e.op===k.ACCEPT)if(e.st===M.SUCCESS)O.END_TIME=e.systime||0,T.sid=e.sid,T.to=e.uid,T.authType=e.authtype,T.csonline=!0,T.online=!0,b.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg(),O.MSG_SYNC=e.systime||0;else exports.bye();if(e.op===k.BYE)if(e.st===M.SUCCESS){var t=T.options||{};if("talk to other"===e.reason)T.stopPick=!1,t.invited=0,t.tid=b.tid,t.ttype=1,t.sid="",t.from=5,exports.connect(t.ttype,t,!1)}else exports.emit("invitefail");if(e.op===k.INVITE){if(O.END_TIME=e.systime||0,"queue"===e.reason)return void(y=!1);if(e.ttype===B.IR)C.ifIR=!0,C.id=e.uid,exports.emit("currentIR");if("re_invite"===e.reason&&b.status===A.QUEUEING)return exports.emit("queueing"),void(y=!1);if("re_invite"===e.reason){if(b.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},T.sid=e.sid,T.to=e.uid,T.authType=e.authtype,T.tid=b.tid||"",T.ttype=e.ttype,T.csonline=!0,T.online=!0,b.syncSessionHistory)exports.fetchSessionMessage();return void exports.fetchOfflineMsg()}if(e.st===M.SUCCESS)T.sid=e.sid,T.to=e.uid,T.authType=e.authtype,T.csonline=!0,T.ttype=e.ttype,b.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{};else{var n=m.json.parse(e.adata||"{}");return T.to=n.uid||"-1",T.authType=e.authtype,T.csonline=!1,exports.emit("csoffline"),void exports.fetchOfflineMsg()}exports.fetchOfflineMsg()}},exports.pickHandler[101]=function(t){if(exports.setConfig(t.uid,"tid"),t.msgHandlerType=t.msgHandlerType||"",t.opr===x.OVER)if(t.reason&&-1!==t.reason.indexOf(I))exports.emit("visitorblock",t),e();else if(t.reason&&-1!==t.reason.indexOf(E))exports.emit("autoendtalk",t),e();else n("forceover");else if(t.opr===x.TAKE_OVER)if(i(t,!0),C.ifIR)o(),exports.emit("fininshIR",{type:"invite"});else exports.emit("updateNewCSR",b.sinfo);else if(t.opr===x.TRANSFER)if(i(t,!0),C.ifIR)o(),exports.emit("fininshIR",{type:"online"});else exports.emit("updateNewCSR",b.sinfo);else if(t.opr===x.RECEIVE){var r=t.detail||{};if(r.join_action===L.TRANSFER){var a=!1,s=t.adata&&m.json.parse(t.adata)||{},c=s.transfer||{},l=t.sinfo&&m.json.parse(t.sinfo)||{};if(c.status)a=!0,exports.emit("visitorTransfer",{nickname:l.nickname||""},t.msgHandlerType);i(t,a)}}},exports.pickHandler[103]=function(e){for(var t=window.newBlinkNewMsgRecord,n=0;n<t.length;n++)if(t[n]==e.msgid)return;if(t.push(e.msgid),T.connected){if(exports.emit("message",e),C.ifIR&&e.from===C.id&&C.count)if(++C.count>=5)exports.emit("showMsgRemind",C.count),C.count=0}else T.msgPool.push(e)},exports.pickHandler[104]=function(e){if(b.status=e.status,e.status===A.QUEUEING){if(1==+g&&2==+h.isInviteOrCom)g=2,h.logStopACOrIW(-1,3);T.sid=e.sid,T.queueing=!0,exports.emit("queueing")}if(e.status===A.TALKING)if(T.queueing=!1,T.sid=e.sid,T.online=!0,t(),C.ifIR)if(""!==e.reason)exports.emit("transferError",e)},exports.pickHandler[105]=function(e){if(w)clearTimeout(w),w=null;var t=e.detail||[];if(e.type===O.COUNT){var n=0;if(_.each(t,function(e,t){n+=e.count}),n<O.DEFAULT)n=O.DEFAULT;if(n>O.PAGE)n=O.PAGE;exports.fetchHistory({count:n})}else if(e.type===O.LIST){var i=t.length;if(t[0])O.MSG_SYNC=t[0].systime||O.MSG_SYNC;if(t[i-1])O.END_TIME=t[i-1].systime||O.END_TIME;t=N.concat(t),N=[],t=r(t),_.each(t,function(e,t){e.msgHandlerType="insertBefore",exports.emit("message",e)}),exports.fetchHisFinish(!0,e)}},exports.pickHandler[106]=function(e){T.sid=e.sid,T.to=e.uid,T.authType=e.authtype,T.csonline=!0,b.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg()},exports.pickHandler[107]=function(e){if(e.webmsg){for(var t=window.newBlinkNewMsgRecord,n=0;n<t.length;n++)if(t[n]==e.msgid)return;t.push(e.msgid);var i=m.json.parse(e.webmsg);i.body.reverse(),_.each(i.body,function(e){var t=e.msg;t.msgHandlerType="insertBefore",t.time=parseInt(+t.time/1e3,10);var n=e.msg.content;if(m.lang.isArray(n))_.each(n,function(e){var n=e.pickType;if(n){var i=exports.pickHandler[n];if(e.msgHandlerType="insertBefore",i)i(e)}else t.content=e.content||e,t.mtype=e.mtype||0,exports.emit("message",t)})})}},exports.pickHandler[108]=function(e){if(C.ifIR&&e.status===P.READY)exports.emit("csonline",e,"IR");else if(!T.connected&&e.status===P.READY)exports.emit("csonline",e,"OFFLINE_MSG")},exports.pickHandler[109]=function(e){if(T.connected){var t=m.json.parse(e.content);if(m.lang.isArray(t))exports.emit("aiAssistance",e);else exports.emit("aiAssistance",[])}else exports.emit("aiAssistance",[])},exports.pickHandler[180]=function(e){if(T.connected){var t=m.json.parse(e.content);if(28==+t.type&&1==+t.tag){var n=m.json.parse(t.content),i=n.reCallMsgId+"";if(i&&i.length>0)exports.emit("reCallMsg",i)}}},exports.receiveOfflineMsg=function(e){var t={sid:"",tid:T.tid,type:e.PUSH_TYPE_MSG_SYNC,tid_authtype:b.authType,param:{systime:O.MSG_SYNC}};v.push(t,null,null)},exports.fetchHisFinish=function(e,n){if(n=n||{},e)exports.receiveOfflineMsg(),exports.emit("fetchhistorysuccess");else exports.emit("fetchhistoryfail");exports.emit("fetchhistoryfinish",n),t()},exports.fetchHistory=function(e,t){t=t||{};var n=b.offlineMsgGetType||0,i=n?"":T.sid,o=n?"-1":T.tid,r=n?b.bid:T.to,a={sid:i,tid:o,type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:b.authType,param:{type:1,gettype:n,from:r,max_count:t.count||R,from_authtype:T.authType,endtime:O.END_TIME}};v.push(a,null,exports.fetchHisFinish)},exports.fetchSessionMessage=function(e){var t=T.tid||"",n=t,i="";if(t.indexOf(":")){var o=t.split(":");n=o[0],i=o[1]||""}var r=m.json.stringify({tag:1,type:2,userId:n-0,subId:i-0,bid:b.bid}),a={sid:T.sid,tid:T.tid,type:e.PUSH_TYPE_FETCH_SESSION_MESSAGE,tid_authtype:b.authType,param:{webmsg:r}};v.push(a)},exports.bye=function(e){var t={sid:T.options.sid,tid:T.tid,type:e.PUSH_TYPE_BYE,tid_authtype:b.authType,param:{reason:"bye for invite error"}};v.push(t)};var D=0,H=!1,q=3;return exports.wsPickSucc=function(e){s(e)},exports.wsPickFail=function(e){l(e)},exports.pick=d,exports.connect=function(e,t,i,o,r){o=o||{},T.tid=o.tid||"",T.options=o;var a={op:0,sid:o.sid||"",tid:T.tid,tid_authtype:t.authType,invited:o.invited-0?1:0,rtype:o.route||0,ttype:i,inviterefer:location.href,sp_refer:o.sp_refer||"",reason:t.reasons[o.from]||e.CHART_START_TYPE};if(t.adata&&1!==o.noshowSmartInvite)a.adata=t.adata;v.chat(a,function(e){if(!1!==r)if(T.stopPick=!1,t.usingWs)exports.wsPickSucc(e),exports.wsPick();else d()},function(){n("connect")})},exports.wsPick=function(e){if(d(),e.usingWs)setTimeout(exports.wsPick,3e4)},exports.talking=function(e,n){if(n=n||{},e=e||{},b.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},T.sid=e.sid,T.to=n.tid,T.authType=e.authtype,T.csonline=!0,T.online=!0,T.tid=e.tid||"",T.options=n,T.stopPick=!1,b.syncSessionHistory)exports.fetchSessionMessage();t(),d()},exports.queue=function(e,t){t=t||{},e=e||{},b.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},T.sid=e.sid,T.to=e.uid,T.authType=e.authtype,T.csonline=!0,T.tid=e.tid||"",T.options=t,T.stopPick=!1,exports.emit("queueing"),d()},exports.preSend=function(e,t){if(!t.isMobileWebIm)if(!t.content&&!t.end||!0===T.presend.sending||t.content===T.presend.content)return;t.mtype=0,t.to=T.to,t.time=(new Date).getTime(),t.rtype=T.ttype;var n={sid:T.sid||"",tid:T.to,type:e.PUSH_TYPE_PRE_SEND,tid_authtype:T.authType,param:t};v.push(n,function(e){T.presend.sending=!1},function(e){T.presend.sending=!1}),T.presend.sending=!0,T.presend.content=t.content},exports.send=function(e,t,n,i,o){t.from=b.bid,t.to=T.to,t.time=(new Date).getTime(),t.rtype=T.ttype;var r=b.eid+String((new Date).getTime()).substring(4),s={sid:T.sid||"",tid:T.to,type:T.csonline?e.PUSH_TYPE_CHAT:e.PUSH_TYPE_OFFLINE,tid_authtype:T.authType,param:t,logId:r};if(void 0!==t.adata)s.adata=t.adata,delete t.adata;if(o&&10===o)s.type=10,s.msgid=t.msgid,s.ack=t.ack;else exports.preSend({content:"",end:!0});v.push(s,n,function(e){if(a(e),i)i()})},exports.recommendUsed=function(e,t){t.from=b.bid,t.to=T.to,t.time=(new Date).getTime(),t.rtype=T.ttype;var n=b.eid+String((new Date).getTime()).substring(4),i={sid:T.sid||"",tid:T.to,type:e.PUSH_TYPE_RECOMMEND_USED,tid_authtype:T.authType,param:t,logId:n,msgId:t.msgid};v.push(i)},exports.hasReadedMsg=function(e,t){var n=b.eid+String((new Date).getTime()).substring(4),i={sid:T.sid||"",tid:T.to,type:e.PUSH_TYPE_READED_MSG,tid_authtype:T.authType,param:t,logId:n,msgId:t.waiterMaxMsgId};v.push(i)},exports.falseFeedback=function(e,t,n,i,o){S=b.sid;var r=T.to.indexOf(":")>-1?T.to.split(":")[1]:0,a={type:t.type,info:t.text,riskType:t.extra.riskType,riskResult:t.extra.riskResult},s={content:JSON.stringify(a),deviceType:4,contentType:1,bid:b.bid,siteId:b.siteid,chatId:b.sid||S,userId:b.eid,subUserId:r};v.falseFeedback(s,i,o)},exports.disconnect=function(t,n,i){t=t||{};var o=void 0===t.tid_authtype?T.authType:t.tid_authtype;o=o||4,v.push({type:2,sid:t.sid||T.sid,tid:t.tid||T.to||-1,reason:t.reason||"",tid_authtype:o},n,i),e(!0)},exports.isConnected=function(){return T.connected},exports.setConfig=function(e,t,n){if(n)e[n]=t;else e=Object.assign(e,t);exports.emit("checkServiceVersion",e)},exports.get=function(e){return T[e]},exports.setStopPick=function(e){T.stopPick=e},exports.fetchOfflineMsg=function(e){if(b.syncFetchOfflineMsg){var n={sid:"",tid:"-1",type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:b.authType,param:{type:O.COUNT,from:T.to,from_authtype:T.authType}};v.push(n,null,exports.fetchHisFinish),w=setTimeout(function(){t()},O.DELAY)}else t()},exports.checkVersion=function(e,t,n){console.log(e,"\u6821\u9a8c\u5ba2\u670d\u7aef\u529f\u80fd\u70b9\u662f\u5426\u652f\u6301"),v.checkVersion(e,t,n)},exports}),define("qiao-im-msdk/chat",["im-core/chat"],function(e){return e}),define("im-core/plugin/img",["require","im-lib","../chat","../net","im-core/chat","../main"],function(require){function e(e){return e=e.split(u?"\\":"/"),e.pop()}function t(e){return"wupload/"+e+"/"+a.get("sid")}function n(e,t){var n=require("im-core/chat");return t=t||"a.jpg","wdownload/"+e+"/"+n.get("sid")+"/"+t}function i(n,i){var o=(e(n.path),n.bcsName),r=t(o);c[r]={msg:n,done:i};var a='<img id="'+o+'" data-uploaded="1" data-bcsName="'+o+'"/>',u={mtype:0,content:a},d={mtype:f,content:{type:l,bcsName:o}},m=require("../main");s.upload(r,n.form||n.path,function(){i(u),m.emit("imgsendsuccess",{bcsName:o,id:n.mid,status:"success"})},function(){d.content.status=1,i(d),m.emit("imgsendfail",{bcsName:o,id:n.mid,status:"fail"})})}function o(e,t){var i=e.content,o=i.bcsName,r=n(o,"img");t({type:l,bcsName:o,bcsUrl:r,status:i.status})}var r=require("im-lib").Emitter,a=require("../chat"),s=require("../net"),c={},l="img",f=1,u=/ window nt/i.test(navigator.userAgent),exports={};return r.mixin(exports),exports.encoder={},exports.encoder[l]=i,exports.decoder={},exports.decoder[l]=o,exports}),define("qiao-im-msdk/plugin/img",["im-core/plugin/img"],function(e){return e}),define("im-core/plugin/shake",["require","../main"],function(require){function e(e,t){t({mtype:i,content:{type:n}})}function t(e,t){require("../main").emit("shake",e.msgHandlerType||""),t()}var exports={},n="shake",i=4;return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("qiao-im-msdk/plugin/shake",["im-core/plugin/shake"],function(e){return e}),define("im-core/plugin/text",["require","../chat","../config","im-lib","im-core/chat"],function(require){function e(e,t){var n=document.createElement("div");n.innerHTML=e.text||"";for(var i=n.getElementsByTagName("img"),o=i.length;o;o--){var r=i[o-1];if(r.getAttribute("data-bcsName")){var a=document.createElement("img");a.setAttribute("data-bcsName",r.getAttribute("data-bcsName")),a.setAttribute("data-uploaded",r.getAttribute("data-uploaded")),a.id=r.id,r.id="";var c=r.parentNode;c.insertBefore(a,r),c.removeChild(r)}}t({mtype:s,content:n.innerHTML.replace(/\r|\n/gi,"")||""})}function t(e,t){var n=require("im-core/chat");return t=t||"a.jpg",o.urlRoot=o.urlRoot||"",o.urlRoot+"wdownload/"+e+"/"+n.get("sid")+"/"+t}function n(e){var n=document.createElement("div");n.innerHTML=e;for(var i=n.getElementsByTagName("img"),o=0;o<i.length;o++){var r=i[o],a=r.getAttribute("data-bcsName"),s=r.getAttribute("data-bcsUrl");if(a&&!s)s=t(a,a),r.setAttribute("data-bcsUrl",s)}return n.innerHTML}function i(e,t){var i=(require("../chat"),e.adata&&r.json.parse(e.adata)||{}),s=n(e.content),c=e.from===o.bid?0:1;t({confidentialreason:i["__CONFIDENTIAL-REASON__"],type:a,role:c,time:1e3*e.time,text:s||""})}var o=(require("../chat"),require("../config")),r=require("im-lib"),a="text",s=0,exports={};return exports.encoder={},exports.encoder[a]=e,exports.decoder={},exports.decoder[s]=i,exports}),define("qiao-im-msdk/plugin/text",["im-core/plugin/text"],function(e){return e}),define("im-core/plugin/transfer",[],function(){function e(e,t){t({mtype:i,content:{type:n}})}function t(e,t){t()}var exports={},n="transfer",i=4;return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("qiao-im-msdk/plugin/transfer",["im-core/plugin/transfer"],function(e){return e}),define("im-core/plugin/uploaded",[],function(){function e(e,t){t({mtype:i,content:{type:n,bcsName:e.bcsName,status:0}})}function t(e,t){t()}var exports={},n="img",i=1;return exports.encoder={},exports.encoder.uploaded=e,exports.decoder={},exports.decoder.uploaded=t,exports}),define("qiao-im-msdk/plugin/uploaded",["im-core/plugin/uploaded"],function(e){return e}),define("im-core/plugin/voice",["require","../config","../chat","../net","../main"],function(require){function e(e){return"wupload/"+e+"/"+r.get("sid")}function t(e,t){return t=t||"a.mp3",a.getDownloadUrl(e,t)}function n(n,i){var o=n.bcsName,r=e(o);s[r]={msg:n,done:i};var f={mtype:l,content:{type:c,bcsName:o,duration:n.duration,text:""}},u={mtype:l,content:{type:c,bcsName:o}},d=require("../main");a.upload(r,n.form||n.path,function(){i(f),d.emit("voicesendsuccess",{bcsName:o,fid:o,status:"success",finish:!0,url:t(o)})},function(){u.content.status=1,i(u),d.emit("voicesendfail",{bcsName:o,fid:n.mid,status:"fail",url:t(o)})})}function i(e,n){var i=e.from===o.bid?0:1,r=e.content.bcsName;e.content.type=c,e.content.role=i,e.content.fid=r,e.content.status="loading",e.content.finish=!0,e.content.url=t(r),n(e.content)}var o=require("../config"),r=require("../chat"),a=require("../net"),s={},c="voice",l=2,exports={};return exports.encoder={},exports.encoder[c]=n,exports.decoder={},exports.decoder[c]=i,exports}),define("qiao-im-msdk/plugin/voice",["im-core/plugin/voice"],function(e){return e}),define("im-core/plugin/form",["require","../chat","../config"],function(require){function e(e,t){var n=document.createElement("div");n.innerHTML=e.text||"",t({mtype:"offlineChatFormContent"===e.reason?0:o,reason:e.reason,content:n.innerHTML.replace(/\r/gi,"")||""})}function t(e,t){var o=(require("../chat"),e.content),r=e.from===n.bid?0:1;t({type:i,role:r,time:1e3*e.time,text:o||""})}var n=(require("../chat"),require("../config")),i="form",o=4,exports={};return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[o]=t,exports}),define("qiao-im-msdk/plugin/form",["im-core/plugin/form"],function(e){return e}),define("im-core/plugin/location",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.from===n.bid?0:1;e.content.type=i,e.content.role=o,e.content.text=r,t(e.content)}var n=require("../config"),i="location",o=4,r="[\u5730\u7406\u4f4d\u7f6e]",exports={};return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("qiao-im-msdk/plugin/location",["im-core/plugin/location"],function(e){return e}),define("im-core/plugin/config",["require","./fileTransfer","./unknownMsg","./img","./shake","./text","./transfer","./uploaded","./voice","./form","./location"],function(require){return{package:"coreplugin",resource:{fileTransfer:require("./fileTransfer"),unknownMsg:require("./unknownMsg"),img:require("./img"),shake:require("./shake"),text:require("./text"),transfer:require("./transfer"),uploaded:require("./uploaded"),voice:require("./voice"),form:require("./form"),location:require("./location")}}}),define("qiao-im-msdk/plugin/config",["im-core/plugin/config"],function(e){return e}),define("im-lib/websocket/config",[],function(){return{wsUrl:"/",majorVer:"1",minorVer:"0",protocol:"0",reqTimeout:2e4,wsTimeout:3e4}}),define("im-lib/websocket/const",[],function(){return{MSGINITSTATUS:{INITIAL:0,INITIALIZED:1},WSINITSTATUS:{INITIAL:0,INITIALIZING:1,INITIALIZED:2},WSSTATUS:{CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},REQMSGTYPE:{CONTROL:0,BEAT:1,TEXT:2},REQPROTYPE:{BEAT:0,REQUEST:2,ACK:5},REQSTATUS:{UNSENT:0,SENT:1,CONFIRMED:2},RESPPROTYPE:{BEATACK:1,ACK:3,REQUEST:4}}}),define("im-lib/websocket/index",["require","./const"],function(require){function e(e){return p[e.type](e.data)}function t(e){return{seqId:parseInt(e.substr(2,8),10),type:parseInt(e.substr(10,1),10)}}var exports={},n=require("./const"),i=1,o=1,r=n.MSGINITSTATUS.INITIAL,a={},s={},c={},l={},f=null,u=null,d={"site/auth":n.REQMSGTYPE.CONTROL,"site/st":n.REQMSGTYPE.CONTROL,"site/poll":n.REQMSGTYPE.BEAT,"chat/st":n.REQMSGTYPE.CONTROL,"chat/poll":n.REQMSGTYPE.BEAT,"chat/push":n.REQMSGTYPE.TEXT,ack:n.REQMSGTYPE.ACK},m={"site/auth":n.REQPROTYPE.REQUEST,"site/st":n.REQPROTYPE.REQUEST,"site/poll":n.REQPROTYPE.BEAT,"chat/st":n.REQPROTYPE.REQUEST,"chat/poll":n.REQPROTYPE.BEAT,"chat/push":n.REQPROTYPE.REQUEST,ack:n.REQPROTYPE.ACK},p={disabled:function(e){f({type:"changeStatus",data:{status:2}});for(var t in s)if(s.hasOwnProperty(t)){var n=s[t];clearTimeout(n.timeOut);var i=n.data.substr(20);try{i=JSON.parse(i);var o=n.options,r=i.method.substr(1);delete i.method,delete i.header,delete i.msgid,o.data=i,f({type:"request",data:{path:r,options:o}})}catch(e){}}},message:function(e){exports.dealMsg(e)}};return exports.generateHead=function(e,t,n){return t.majorVer+t.minorVer+e.padLeft(n.seqId,8)+n.type+t.protocol+"00001111"},exports.generateCookie=function(e){for(var t=["H_BDCLCKID_SF","BAIDUID","BDSFRCVID","eqid"],n=[],i=0;i<t.length;i++){var o=t[i],r=e.getCookie(o,!1);if(r)n.push(o+"="+r+";")}if(n.length>0)n=n.join(" ");return n},exports.encodeMsg=function(e,t,o,r){var a={};if(a.type=m[t],a.msgType=d[t],a.status=n.REQSTATUS.UNSENT,a.msgid=e.msgid(),a.type===n.REQPROTYPE.ACK)a.seqId=r.seqId;else a.seqId=i++;o.msgid=a.msgid,o.method="/"+t,o.header={cookie:exports.generateCookie(),userAgent:window.navigator.userAgent||""};var s=exports.generateHead(a);return a.data=s+JSON.stringify(o),a.options=r,a},exports.sendMsg=function(e,t,i,o,r){function a(){t.send(c.data),c.timeOut=setTimeout(a,e.reqTimeout)}var c=exports.encodeMsg(i,o,r);if(c.type===n.REQPROTYPE.REQUEST)s[c.seqId]=c,l[c.msgid]=c,a(),c.status=n.REQSTATUS.SENT;else t.send(c.data)},exports.decodeMsg=function(e){var n={},i=t(e.substr(0,20));if(n.seqId=i.seqId,n.type=i.type,n.body=""===e.substr(20)?{}:JSON.parse(e.substr(20)),null===u&&n.body.body){var o=n.body.body[0];f({type:"setAuth",data:{key:o.key,bid:o.msg.v}})}return n},exports.dealMsg=function(e){var t=exports.decodeMsg(e);if(t.type===n.RESPPROTYPE.ACK){var i=s[t.seqId];clearTimeout(i.timeOut),i.status=n.REQSTATUS.CONFIRMED,delete s[t.seqId]}else if(t.type===n.RESPPROTYPE.REQUEST){if(null===u)u=f({type:"getBaseBody",data:{}});if(exports.sendMsg("ack",u,{seqId:t.seqId}),t.seqId===o)do{try{if(l[t.body.msgid]){var i=l[t.body.msgid];i.options.success(t.body),delete l[t.body.msgid]}else a[t.body.method].success(t.body);delete c[o]}catch(e){}finally{o++}}while(t=c[o]);else if(t&&o&&t.seqId>o)c[t.seqId]=t}},exports.init=function(t,i,o,s){if(r===n.MSGINITSTATUS.INITIAL)i.wsUrl=o,f=s,a=f({type:"getComCallback"}),t.init(e),r=n.MSGINITSTATUS.INITIALIZED,f({type:"changeStatus",data:{status:1}})},exports}),define("im-lib/websocket/websocket",["require","./const"],function(require){function e(e){if(a.readyState===r.WSSTATUS.OPEN)l=r.WSINITSTATUS.INITIALIZED,s=3,exports.pushAllMsgs()}function t(e){f({type:"message",data:e.data})}function n(e){}function i(e){if(l=r.WSINITSTATUS.INITIAL,s-- >0)exports.init(f);else f({type:"disabled",data:c})}function o(){a.addEventListener("open",e),a.addEventListener("message",t),a.addEventListener("error",n),a.addEventListener("close",i)}var exports={},r=require("./const"),a=null,s=3,c=[],l=r.WSINITSTATUS.INITIAL,f=null;return exports.pushAllMsgs=function(){for(var e=null;e=c.shift();)a.send(e)},exports.send=function(e){if(l===r.WSINITSTATUS.INITIALIZED)a.send(e);else c.push(e)},exports.close=function(){a.close()},exports.init=function(e,t){if(l===r.WSINITSTATUS.INITIAL)l=r.WSINITSTATUS.INITIALIZING,a=new WebSocket(e.wsUrl),setTimeout(function(){if(l===r.WSINITSTATUS.INITIALIZING)exports.close()},e.wsTimeout),f=t,o()},exports}),define("im-lib/config",["require","./lang","./json","./net","./util","./Emitter","./localStorage","./main","./websocket/config","./websocket/const","./websocket/index","./websocket/websocket"],function(require){return{package:"imLib",resource:{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage"),main:require("./main"),wsConf:require("./websocket/config"),wsConst:require("./websocket/const"),ws:require("./websocket/index"),wssocket:require("./websocket/websocket")},injection:[{id:"imLib.net",method:{initWs:["imLib.ws"],ws:["imLib.ws"]}},{id:"imLib.ws",method:{generateHead:["imLib.util","imLib.wsConf"],generateCookie:["imLib.util"],encodeMsg:["imLib.util"],sendMsg:["imLib.wsConf","imLib.wssocket"],init:["imLib.wssocket","imLib.wsConf"]}},{id:"imLib.wssocket",method:{init:["imLib.wsConf"]}}]}}),define("im-core/auth",["require"],function(require){var e={},exports={};return exports.get=function(t,n){var i={anonym:t.anonym,key:e.key||"",sn:e.sn||"",id:t.bid||"",from:t.authType,token:t.authToken||""};if(n)return i[n]||e[n];else return i},exports.set=function(t,n){e[t]=n},exports}),define("qiao-im-msdk/auth",["im-core/auth"],function(e){return e}),define("im-core/message",["require"],function(require){function e(){}function t(t,n){return t=t||e,n=n||e,function(e){if(!1===e)n();else if(e)t(e)}}var n={},i={},exports={};return exports.encode=function(e,i,o){var r=n[e.type];if(!r)throw e.type+" message not supported";r(e,t(i,o))},exports.decode=function(e,n,o){var r=e.mtype;if(1===r||4===r||2===r)if(e.content&&e.content.type)if("file"===(r=e.content.type))r="fileTransfer";var a=i[r];if(a)a(e,t(n,o));else if(o)o()},exports.addEncoder=function(e,t){e.each(t,function(e,t){n[e]=t})},exports.addDecoder=function(e,t){e.each(t,function(e,t){i[e]=t})},exports}),define("qiao-im-msdk/message",["im-core/message"],function(e){return e}),define("im-core/site",["require"],function(require){var exports={};return exports.init=function(e,t,n){t.extend(e,n||{}),e.anonym=e.bid?0:1},exports.enter=function(e,t,n){if(t=t||function(){},n=n||function(){},e.isLogin())t();else e.login(t,n)},exports.leave=function(e){if(e.isLogin())e.logout()},exports}),define("qiao-im-msdk/site",["im-core/site"],function(e){return e}),define("im-core/user",["require","./net","common/logger"],function(require){function e(){clearTimeout(i),i=null,o=!1}var exports={},t=require("./net"),n=require("common/logger");t.on("auth invalid",function(){e()});var i,o,r={INVITE:1,AUTH:2},a=null,s=!1;exports.heartBeat=function(e){function t(){i=setTimeout(exports.heartBeat,15e3)}e.poll(!1,t,t)},exports.wsHeartBeat=function(e,t){if(t.poll(!1,exports.refresh,exports.refresh),e.usingWs)a=setTimeout(exports.wsHeartBeat,3e4)};var c={};return exports.pickSuccess=function(e,t){e.each(t,function(e){var t=c[e.type+""];if(t)t(e.msg)})},exports.pickFailure=function(){},exports.refresh=function(e,t,n){function i(){t.poll(r,function(t){e.each(t,function(e){var t=c[e.type+""];if(t)if(t(e.msg),window.nbNewWebImSid=e.msg.sid,e.msg.uid)window.nbNewWebImUid=e.msg.uid}),exports.refresh()},function(){setTimeout(exports.refresh,3e3)})}if(o){var r=Boolean(n.isPageOnload);if(r)i();else setTimeout(i,3e3)}},exports.pickHandler1=function(e,t,n,i){if("invite"===i.reason)n.sid=i.sid,n.tid=i.uid,n.fromType=2,n.ttype=0,e.emit("initiative",i);else if("chat"===i.reason)n.sid=i.sid,n.tid=i.uid,n.ttype=i.ttype,n.invited=1,n.sinfo=i.sinfo&&t.parse(i.sinfo)||{},e.emit("forcetalk",i)},exports.pickHandler104=function(e,t,n,i){if(t.status=i.status,e.emit("watchStatus",i),t.usingWs)n.pickHandler[104](i)},c[1]=function(e){exports.pickHandler1(e)},c[104]=function(e){exports.pickHandler104(e)},exports.getInfo=function(e,t){function n(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),n=e%60,i="-";if(t<0||n<0)if(i="+",t=-t,n<0)n=-n;return t+="",n+="","UTC"+i+t+":"+n}var i=window.navigator,o=window.screen;return{lang:i.language||i.systemLanguage,cbit:o.colorDepth,rsl:o.width+"*"+o.height,tz:n(),xst:encodeURIComponent(t.getXst()),referrer:encodeURIComponent(document.referrer),xstlink:encodeURIComponent(location.href)}},exports.enter=function(e,t,i){exports.loadHTJ(function(){try{var o={aid:"5480",app:"universe",ver:"1.0.0.0",timeout:2e3};xaf.init(o),e.site(!0,exports.getInfo(),function(e){if(n.logVisiterEnterAust({logType:"END"}),!exports.checkEnterResult(e,t,i))exports.getEnterResult(t,i)},i)}catch(n){e.site(!0,exports.getInfo(),function(e){if(!exports.checkEnterResult(e,t,i))exports.getEnterResult(t,i)},i)}})},exports.loadHTJ=function(e){n.logVisiterEnterHTJ({logType:"START"}),n.logVisiterEnterHTJStatic({logType:"START"});var t=document.createElement("script"),i=e||function(){};if(t.type="text/javascript",t.setAttribute("data-bdms-faccdee21b68","eyJhcHBfa2V5IjoiNTQ4MCIsImFwcF92aWV3IjoicHJvbW90ZSIsImJyb3dzZXJfdXJsIjoiaHR0cHM6Ly9zb2ZpcmUuYmFpZHUuY29tL2RhdGEvdWEvYWIuanNvbiIsImZvcm1fZGVzYyI6IiIsInNlbmRfaW50ZXJ2YWwiOjUwLCJzZW5kX21ldGhvZCI6M30="),t.readyState)t.onreadystatechange=function(){if("loaded"==t.readyState||"complete"==t.readyState)t.onreadystatechange=null,i()};else t.onload=function(){i(),n.logVisiterEnterHTJStatic({logType:"END"})};t.src="https://sofire.bdstatic.com/js/xaf3.js",document.getElementsByTagName("head")[0].appendChild(t)},exports.checkEnterResult=function(e,t,n,i,r){var a=!1;if(!n.length)return a;else return e.each(n,function(n){if(100===n.type){var s=n.msg||{};if(3===s.status&&0===t.visitType){var c=t.tid||"",l=t.sid||"";e.extend(t,s),t.tid=c,t.sid=l}else e.extend(t,s);if(a=!0,o=!0,t.usingWs)exports.wsHeartBeat();else exports.refresh();i(n.msg)}else r()}),a},exports.checkAuthResult=function(e,t,n,i,o,a,c,l){var f=!1;return n.each(o,function(n){if(n.type===r.AUTH){if(f=!0,n=n.msg||{},!n.valid&&(n.blocktype===t.BLOCK_TYPE.IP_BLOCK||n.blocktype===t.BLOCK_TYPE.BID_BLOCK||n.blocktype===t.BLOCK_TYPE.DIRECT_BLOCK))return l&&l(n.blocktype),s=n.blocktype,void e.emit("blocked",{blocktype:n.blocktype});if(!n.valid&&(n.blocktype===t.BLOCK_TYPE.CONFIRM_BLOCK||n.blocktype===t.BLOCK_TYPE.CODE_BLOCK))return s=n.blocktype,i.bid=n.v,void exports.enter(a,c);if(n.valid)i.bid=n.v,exports.enter(a,c);else c()}}),f},exports.parseEnterResult=function(e,t,n,i,a,s,c,l,f){if(s.sign)i.set("sign",s.sign||s[0].sign),window.newBlinkKey=!0;else window.newBlinkKey=!1;if(i.set("key",s.key||s[0].key),s.v||s[0].msg.v)a.bid=s.v||s[0].msg.v;var u=!1;if(!s.length)return u;else return n.each(s,function(t){if(t.type===r.AUTH)return u=!0,t=t.msg||{},f&&f(t.blocktype),isBlock=t.blocktype,void e.emit("blocked",{blocktype:t.blocktype});else if(100===t.type){if(t.v)a.bid=t.v;var i=t.msg||{};if(3===i.status&&0===a.visitType){var s=a.tid||"",d=a.sid||"";n.extend(a,i),a.tid=s,a.sid=d}else n.extend(a,i);if(u=!0,o=!0,a.usingWs)exports.wsHeartBeat();else setTimeout(function(){exports.refresh()},1);window.directConnectKey=!0,window.birdgeIsLogin=!0,c(t.msg)}else l()}),u},exports.getEnterResult=function(e,t,n){e.poll(!0,function(e){if(!exports.checkEnterResult(e,t,n))exports.getEnterResult(t,n);else window.birdgeIsLogin=!0},n)},exports.getAuthResult=function(e,t,n,i,o){t.poll(!0,function(e){if(!exports.checkAuthResult(e,n,i,o))exports.getAuthResult(n,i,o);else window.directConnectKey=!0},i)},exports.isLogin=function(){return!!i||o},exports.login=function(e,t,i,o,r,a){if(!exports.isLogin())if(i.vstProto)exports.loadHTJ(function(){try{var t={aid:"5480",app:"universe",ver:"1.0.0.0"};xaf.init(t),e.site(!0,exports.getInfo(),function(e){n.logVisiterEnterAust({logType:"END"}),exports.parseEnterResult(e,o,r,a),window.nbAustData=e[0]},r)}catch(t){e.site(!0,exports.getInfo(),function(e){exports.parseEnterResult(e,o,r,a)},r)}});else e.auth(!0,exports.getInfo(),function(e){if(e.sign)t.set("sign",e.sign||e[0].sign);if(t.set("key",e.key||e[0].key),i.bid=e.v||e[0].msg.v,!exports.checkAuthResult(e,o,!1,a))exports.getAuthResult(o,r,a)},r);else o()},exports.checkcode=function(e,t,n,i,o,r){var a=function(){e.emit("codeinvalidated")},c=function(t){if(t&&0===t.status)n.set("code_token",t.data.code_token),s=!1,e.emit("codevalidated"),r();else a()};t.validate({from:"chat",code:o,bid:i.bid},c,a)},exports.confirm=function(e,t,n){t.set("code_token","CONFIRM_CLICK"),s=!1,n()},exports.logout=function(t,n){if(e(),t.site(!1),!n.vstProto)t.auth(!1)},exports.extendPickHandler=function(e,t){e.extend(c,t.pickHandler)},exports.isBlocked=function(){return s},exports}),define("qiao-im-msdk/user",["im-core/user"],function(e){return e}),define("im-core/log",["require"],function(require){var exports={};return exports.send=function(){},exports}),define("qiao-im-msdk/log",["im-core/log"],function(e){return e}),define("im-core/bullConfig",["require","./plugin/config","im-lib/config","./main","./auth","./config","./const","./chat","./message","./site","./user","./net","./log"],function(require){return{package:"core",importConfig:[require("./plugin/config"),require("im-lib/config")],resource:{main:require("./main"),auth:require("./auth"),config:require("./config"),consts:require("./const"),chat:require("./chat"),message:require("./message"),site:require("./site"),user:require("./user"),net:require("./net"),log:require("./log")},injection:[{id:"core.main",method:{initCore:["core.chat","core.config","imLib.lang","core.consts"],connect:["core.chat","core.config","core.user"],auth:["core.user"],checkcode:["core.user"],confirm:["core.user"],send:["core.chat","core.message"],falseFeedback:["core.chat","core.message"],addPlugin:["coreplugin.fileTransfer","coreplugin.img","coreplugin.unknownMsg","coreplugin.shake","coreplugin.text","coreplugin.transfer","coreplugin.uploaded","coreplugin.voice","coreplugin.form","coreplugin.location"],preSend:["core.chat","core.message"],recommendUsed:["core.chat","core.message"],pushReadedMsg:["core.config","core.chat"],checkVersion:["core.config","core.chat"],plugin:["core.message"],disconnect:["core.chat","core.user"],messageHandler:["core.config"],get:["core.chat"],getConfig:["core.config"],bindEvent:["core.main","communicate.handler"],isConnected:["core.chat"],sendOfflineMsg:["core.chat","core.message"],fetchHistory:["core.chat"],fetchSessionMessage:["core.chat"],isBlocked:["core.user"],getAuth:["core.auth"]}},{id:"core.auth",method:{get:["core.config"]}},{id:"core.chat",method:{fetchHistory:["core.consts"],connect:["core.consts","core.config"],fetchSessionMessage:["core.consts"],bye:["core.consts"],preSend:["core.consts"],recommendUsed:["core.consts"],hasReadedMsg:["core.consts"],send:["core.consts"],falseFeedback:["core.consts"],fetchOfflineMsg:["core.consts"],receiveOfflineMsg:["core.consts"],wsPick:["core.config"],setConfig:["core.config"]}},{id:"core.message",method:{addEncoder:["imLib.lang"],addDecoder:["imLib.lang"]}},{id:"core.net",method:{jsonToQuery:["imLib.json","imLib.lang"],getUploadUrl:["core.config","imLib.util","core.main"],getDownloadUrl:["core.config","imLib.util","core.main"],request:["core.config","core.auth","imLib.net","imLib.json"],auth:["core.config"],site:["core.config"],push:["core.config"],authOut:["core.user"],upload:["core.config","imLib.net"],initLog:["core.config","data.config"],log:["imLib.net"],pick:["core.config"],canUseWs:["imLib.util","core.config"],wsCommands:["core.config","core.auth","core.user","core.chat"],successFactory:["core.auth","imLib.json"],poll:["core.chat"]}},{id:"core.site",method:{init:["core.config","imLib.lang"],enter:["core.user"],leave:["core.user"]}},{id:"core.user",method:{refresh:["imLib.lang","core.net","core.config"],getInfo:["imLib.lang","core.net"],enter:["core.net"],checkEnterResult:["imLib.lang","core.config"],getAuthResult:["core.main","core.net"],checkcode:["core.main","core.net","core.auth","core.config"],confirm:["core.main","core.auth"],login:["core.net","core.auth","core.config"],logout:["core.net","core.config"],getEnterResult:["core.net"],pickHandler1:["core.main","imLib.json","core.config"],pickHandler104:["core.main","core.config","core.chat"],heartBeat:["core.net"],checkAuthResult:["core.main","core.consts","imLib.lang","core.config"],pickSuccess:["imLib.lang"],wsHeartBeat:["core.config","core.net"],parseEnterResult:["core.main","core.consts","imLib.lang","core.auth","core.config"]}}],aspect:[{id:"core.message",pointCut:["core.main.decode, , decode"]},{id:"core.net",pointCut:["core.log.send, ,log"]}]}}),define("qiao-im-msdk/bullConfig",["im-core/bullConfig"],function(e){return e}),define("base/mobile/brower",[],function(){var e,t=document,n=new RegExp("msie (\\d+\\.\\d+)|trident","i");return{ie:function(){return n.test(navigator.userAgent)?t.documentMode||+RegExp.$1:e}(),isBDBox:/ baiduboxapp\//i.test(navigator.userAgent),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,isStrict:function(){return"CSS1Compat"===t.compatMode},isMobile:function(){return!!navigator.userAgent.match(/.*Mobile.*/)||"ontouchstart"in window}(),isIos:!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}}),define("base/mobile/dom",["require"],function(require){var exports={};return exports.hide=function(e,t){if(e.isType(t,"Array"))for(var n=t.length;n--;){var i=this.g(t[n]);i&&(i.style.display="none")}},exports.show=function(e,t){if(e.isType(t,"Array"))for(var n=t.length;n--;){var i=this.g(t[n]);i&&(i.style.display="block")}},exports.appendHTML=function(e,t){e=e||"";var n=document.createElement("div");if(n.innerHTML=e,t)for(;n.firstChild;)t.appendChild(n.firstChild);return n.childNodes},exports.g=function(e,t){var n=null;if("string"==typeof t)n=document.getElementById(t);else if(e.isType(t,"HTML"))n=t;else if(t===window)n=t;return n},exports.setStyle=function(e,t){if(e.classList)e.classList.add(t);else{var n=e.className,i=n.split(/\s/);if(-1===i.indexOf(t))i.push(t),e.className=i.join(" ")}},exports.modifyClass=function(e,t,n){for(var i=e.className,o=i.split(/\s/),r={},a=0;a<o.length;a++)r[o[a]]=!0;if(n)r[t]=!0;else delete r[t];o=[];for(var s in r)if(r.hasOwnProperty(s))o.push(s);e.className=o.join(" ")},exports.addClass=function(e,t){this.modifyClass(e,t,!0)},exports.removeClass=function(e,t){this.modifyClass(e,t,!1)},exports}),define("base/mobile/event",["require","exports"],function(require,exports){function e(e,t,n){var i;return function(){var o=this,r=arguments,a=function(){if(i=null,!n)e.apply(o,r)},s=n&&!i;if(clearTimeout(i),i=setTimeout(a,t),s)e.apply(o,r)}}var t={};exports.on=function(e,n){(t[e]=t[e]||[]).push(n)},exports.off=function(e,n){var i=[].slice.call(arguments,0).length;if(0===i.length)return void(t=[]);if(1===i.length)return delete t[e],t;else return},exports.trigger=function(e){var n=[].slice.call(arguments,1),i=t[e];if(i)for(var o=i.length;o--;)i[o].call(this,n)},exports.domOn=function(t,n,i,o,r){var a=[];if(-1!==Object.prototype.toString.call(n).indexOf("Array"))for(var s=n.length;s--;)a.push(n[s]);else a.push(n);for(var c=a.length;c--;){var l=t.g(a[c]);if(l){if(r)o=e(o,100);l.addEventListener(i,o,!1)}}},exports.domOff=function(e,t,n,i){var o=e.g(t);if(o)o.removeEventListener(n,i,!1)},exports.getTarget=function(e){return e=e,e.target}}),define("base/mobile/lib",["require"],function(require){var exports={};return exports.getBid=function(){var e,t=(+new Date).toString(),n=Math.floor(1e5*Math.random()).toString(),i=5-n.length;if(i>0)for(e=0;e<i;e++)n+="0";return t+n},exports.trim=function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},exports.preventDefault=function(e){if(e&&e.preventDefault)e.preventDefault();else window.event.returnValue=!1;return!1},exports.uuid=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},exports.isType=function(e,t){return{}.toString.call(e).indexOf("[object "+t)>=0},exports.extend=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&"_belong"!==n)e[n]=t[n];return e},exports.hexToRgb=function(e,t){var n=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,i=e.toLowerCase();if(i&&n.test(i)){i=i.substr(1);var o="";if(3===i.length){for(var r=0;r<3;r++)o+=i.slice(r,r+1).concat(i.slice(r,r+1));i=o}for(var a=[],s=0;s<6;s+=2)a.push(parseInt("0x"+i.slice(s,s+2),16));if(t)return a;else return"RGB("+a.join(",")+")"}},exports}),define("base/mobile/form",["require","./lib"],function(require){var e=require("./lib"),exports={},t=function(n){if(this._options=n||{},this._validators=n.validators||{},this._form=document.getElementById(n.el)||null,this._form.formInstance=this,this._labelMaxCount=0,!this._options.el||!this._form)return console.error("\u8868\u5355\u5143\u7d20el\u4e3a\u5fc5\u8981\u53c2\u6570\uff0c\u8bf7\u68c0\u67e5\u521d\u59cb\u5316\u914d\u7f6e"),!1;this._supportComponentList=["nb-comp-form-input"];for(var i in this._validators){var o=this._validators[i].label&&this._validators[i].label.length||0;if(this._validators[i].required)o++;if(o>this._labelMaxCount)this._labelMaxCount=o}return this._defaultValidators={mobilePhone:{pattern:"^1[3456789]\\d{9}$",errorMessage:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u624b\u673a"},phone:{pattern:"(^((0\\d{2,3})-)(\\d{7,8})(-(\\d{3,}))?$)|(^1[3456789]\\d{9}$)",errorMessage:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u624b\u673a\u6216\u5ea7\u673a"}},this.init=function(){this.initDom(),this.initEvents()},this.initDom=function(){function e(e,t){for(var n=[],i=0;i<e.length;i++){var o=e[i];if((o.getAttribute("name")||o.name)===t)n.push(o)}return n}for(var t=this,n=0;n<t._supportComponentList.length;n++){var i=this._form.getElementsByClassName(t._supportComponentList[n]),o=Array.prototype.slice.call(i,0);if(o&&o.forEach(function(e){e.addEventListener("focus",function(){var e=window.innerHeight+100;if(window.scrollY<e)window.scrollTo(0,e)})}),i&&i.length)for(var r in this._validators){var a=e(i,r),s=this._validators[r];a.forEach(function(e){var n=e.previousSibling;if(s.required)e.setAttribute("data-required",!0),n&&n.classList.add("bform-required");e.setAttribute("data-rule-"+r.toLowerCase(),!0),t.bindEvents(e)})}}},this.bindEvents=function(e){e.onfocus=function(e){e.target.focus()}},this.initEvents=function(){var t=this;this._form.onsubmit=function(n){return e.preventDefault(n),t.submit(),!1}},this.reset=function(){t.prototype.reset.call(this)},this.validate=function(){var e=this;for(var t in this._validators){var n=this._form.querySelectorAll("[data-rule-"+t.toLowerCase()+"]");n=Array.prototype.slice.call(n,0),n&&n.forEach(function(t){e.validateItem(t)})}},this.validateRegRule=function(e,t){try{return new RegExp(e).test(t)}catch(e){return!0}},this.validateItem=function(t){var n=this,i=e.trim(t.value),o=""===i||null===i,r=t.getAttribute("label"),a=t.getAttribute("name"),s=this._validators[a]||{};if(s.required)if(o)return n.occurError(t,"\u4e0d\u80fd\u4e3a\u7a7a"),void(t.value="");if((s.maxLength||s.minLength)&&!o)if(s.maxLength&&s.minLength&&(i.length>s.maxLength||i.length<s.minLength))return n.occurError(t,"\u5b57\u6570\u9650\u5236\u5728 "+s.minLength+" ~ "+s.maxLength+" \u4e4b\u95f4"),void(t.value="");else if(s.maxLength&&i.length>s.maxLength)return n.occurError(t,"\u6700\u5927\u5b57\u6570\u9650\u5236 "+s.maxLength+" \u5b57"),void(t.value="");else if(s.minLength&&i.length<s.minLength)return n.occurError(t,"\u6700\u5c0f\u5b57\u6570\u9650\u5236 "+s.minLength+" \u5b57"),void(t.value="");if(n._defaultValidators.hasOwnProperty(s.type)&&!o){var c=n._defaultValidators[s.type];if(!n.validateRegRule(c.pattern,i))return n.occurError(t,c.errorMessage||r+"\u683c\u5f0f\u9519\u8bef"),void(t.value="")}if(s.rules&&s.rules.length&&!o)for(var l=0;l<s.rules.length;l++){var f=n.validateRegRule(s.rules[l].pattern,i);if(!f)return n.occurError(t,"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684"+r),void(t.value="")}n.clearError(t)},this.occurError=function(e,t){return e.placeholder=t,e.classList.add("bform-error"),!1},this.clearError=function(e){e.classList.remove("bform-error")},this.insertAfter=function(e,t){var n=t.parentNode;if(n.lastChild===t)n.appendChild(e);else n.insertBefore(e,t.nextSibling)},this.submit=function(){this.validate();var e=this._form.querySelectorAll(".bform-error")||[];if(e.length>0)return this._options.onError&&this._options.onError(e),!1;var n=t.prototype.formData.call(this);return this._options.onSuccess&&this._options.onSuccess(n),!1},this.init(),this};return t.prototype.clearAllError=function(){var e=this._form.querySelectorAll(".bform-error")||[];e=Array.prototype.slice.call(e,0),e.forEach(function(e){e.classList.remove("bform-error")})},t.prototype.formData=function(){var t={},n=Array.prototype.slice.call(this._form.querySelectorAll("input"),0),i=Array.prototype.slice.call(this._form.querySelectorAll("textarea"),0);if(n.length>0)n.forEach(function(n){t[n.name]=e.trim(n.value)});if(i.length>0)i.forEach(function(n){t[n.name]=e.trim(n.value)});return t},t.prototype.reset=function(){return this._form.reset(),t.prototype.clearAllError.call(this),!1},exports.Bform=t,exports}),define("base/baseMobileConfig",["require","./mobile/brower","./mobile/dom","./mobile/event","./mobile/lib","./mobile/form"],function(require){return{package:"mbase",resource:{brower:require("./mobile/brower"),dom:require("./mobile/dom"),events:require("./mobile/event"),lib:require("./mobile/lib"),form:require("./mobile/form")},injection:[{id:"mbase.events",method:{domOn:["mbase.dom"],domOff:["mbase.dom"]}},{id:"mbase.dom",method:{hide:["mbase.lib"],show:["mbase.lib"],g:["mbase.lib"]}}]}}),define("common/util",[],function(){function e(e,t){for(var n,i=/<%([^%>]+)?%>/g,o=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,r="var r = [];\n",a=0,s=function(e,t){return t?r+=e.match(o)?e+"\n":"r.push(data."+e+");\n":r+=""!==e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",s};n=i.exec(e);)s(e.slice(a,n.index))(n[1],!0),a=n.index+n[0].length;return s(e.substr(a,e.length-a)),r+='return r.join("");',new Function("data",r.replace(/[\r\t\n]/g,""))(t)}function t(e){for(var t={},n=e.length;n--;){var i=e[n];if(-1!==Object.prototype.toString.call(i).indexOf("Object"))for(var o in i)if(i.hasOwnProperty(o))t[o]=i[o]}return t}function n(e,t){if(e){for(var n="",i=e.split("\x3c!-- end --\x3e"),o=i.length;o--;){var r=i[o];if(r){if(1===arguments.length)t=r.match(/\w{0,}( \-\->)/g)[0].match(/\w/g).join("");var a="\x3c!-- target: "+t+" --\x3e";if(-1!==r.indexOf(a))n=r}}return n}return""}function i(e,t){var n={};if(n.phoneReg=/(^(\d{3,4}(-?))?\d{7,8})$|^((\+86)|(86))?(1[0-9][0-9]{9})/,n.emailReg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,null!=t.match(n[e]))return!0;else return!1}function o(e){if("string"!=typeof e)return e;else return e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/\'/g,"&apos;")}function r(e){var t={};if("object"==typeof e)for(var n in e)if(e.hasOwnProperty&&e.hasOwnProperty(n))if("object"==typeof e[n])t[n]=r(e[n]);else t[n]=e[n];return t}return{template:e,pickHtml:n,regext:i,filterXSS:o,extend:t,cloneObj:r,getHost:function(e){if("string"!=typeof e)return"";var t=document.createElement("a");return t.href=e,t.hostname},isNativeFun:function(e){return/\{\s*\[native code\]\s*\}/.test(""+e)},trim:function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},getLocationUrl:function(e){if(e=e||{},!e.x||!e.y)return"";else return"//map.baidu.com/mobile/webapp/place/marker/qt=inf&vt=map&act=read_share&code=/point="+encodeURIComponent(e.x+"|"+e.y)+"&title="+encodeURIComponent(e.name||"")+"&content="+encodeURIComponent(e.alias||"")},getLocationImgUrl:function(e){if(e=e||{},!e.x||!e.y)return"";var t=e.x,n=e.y,i=e.zoom||15;return"//api.map.baidu.com/staticimage?width="+(e.width||220)+"&height="+(e.height||110)+"&center="+t+","+n+"&markers="+t+","+n+"&zoom="+i+"&markerStyles="+(e.style||"-1,//qiao.baidu.com/site/pinpc.png,-1")},isNaN:function(e){return"number"==typeof e&&+e!=+e},checkLoad:function(){var e=!1;if(e="complete"===document.readyState,document.documentElement.doScroll)try{document.documentElement.doScroll("left"),e=!0}catch(t){e=!1}return e}}}),define("lib/util",["common/util"],function(e){return e}),define("common/tpl",[],function(){var exports={},e={};return exports.parse=function(t){t=t||"";var n=0,i="";t.replace(/<\!\-\-\s*target:\s*(\w+)\s*\-\->/g,function(o,r,a){if(0!==a)e[i]=t.substring(n,a);i=r,n=a}),e[i]=t.substring(n,t.length)},exports.get=function(t){return e[t]||""},exports}),define("lib/tpl",["common/tpl"],function(e){return e}),define("common/view",["require"],function(e){var exports={};return exports.getWrap=function(e){return e.g("newBridge")},exports}),define("lib/view",["common/view"],function(e){return e}),define("common/cookie",[],function(){var exports={};return exports.get=function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=t.exec(document.cookie);return n?decodeURIComponent(n[2]):null},exports.set=function(e,t,n){n=n||{};var i;if(n.expires)if("number"==typeof(i=n.expires))i=new Date,i.setTime(n.expires+i.getTime());document.cookie=e+"="+encodeURIComponent(t)+(n.path?"; path="+n.path:"")+(n.expires?"; expires="+n.expires.toGMTString():"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":"")},exports}),define("lib/cookie",["common/cookie"],function(e){return e}),define("common/mobileConfig",["require","./util","./tpl","./view","./cookie"],function(require){return{package:"common",resource:{util:require("./util"),tpl:require("./tpl"),view:require("./view"),cookie:require("./cookie")},injection:[{id:"common.view",method:{getWrap:["mbase.dom"]}}]}}),define("lib/mobileConfig",["common/mobileConfig"],function(e){return e}),define("embed/data/config",["require"],function(require){var exports={};return exports.staticDomain="//aff-im.cdn.bcebos.com/onlineEnv",exports.getServer=function(e,t){var n=e.getWrap();return n={configBox:n.config,siteObj:n.siteConfig,startTime:n.startTime},n[t]||n},exports.isAutoInvite=function(){return!!(exports.getServer("configBox").inviteBox.autoInvite-0)},exports}),define("embed/data/bullConfig",["require","./config"],function(require){return{package:"data",resource:{config:require("./config")},injection:[{id:"data.config",method:{getServer:["common.view"]}}]}}),define("embed/embedChat/bid",["require"],function(require){function e(e,t,n){var i=n.OLDBIDKEY+e+"_BID",o=t.getItem(i);if(!o)return o;else return o=parseInt(o.substr(0,13),16).toString()}var exports={};return exports.init=function(t,n,i,o,r,a,s){if(n.isObject(s)&&void 0!==a&&""!==a)return a;var c=o.BIDPRE+r;if(!a)a=t.getItem(c)||e(r,t,o)||i.getBid();return t.setItem(c,a),a},exports}),define("embed/embedChat/consts",[],function(){return{OLDBIDKEY:"QIAO_LS_",BIDPRE:"NEWBRIDGE_BID_",TALKTYPEPRE:"NEWBRIDGE_TALK_TYPE_",DOMAIN:"//sgoutong.baidu.com"}}),define("embed/embedChat/mobile/leave",["require"],function(require){var e,exports={};return exports.init=function(t,n,i,o){i.domOn(window,"unload",function(){if(!e){if("invite"===n.visitState&&o.isIos)!1;e=!0}})},exports}),define("embed/mobilelite/lib/string",["require"],function(require){var e={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"},exports={};return exports.encodeHTML=function(e){if(!e)return"";else return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(t){if(!t)return"";else return(t+"").replace(/\&([^;]+);/g,function(t,n){var i;if(n in e)return e[n];else if(i=n.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(i[1],16));else if(i=n.match(/^#(\d+)$/))return String.fromCharCode(parseInt(i[1],10));return t})},exports.format=function(e,t){if(!e)return"";if(null==t)return e;var n="function"==typeof t?t:function(e){var n=t[e];return null==n?"":n};return(e+"").replace(/\$\{(.+?)\}/g,function(e,t){return n(t)})},exports.objectToString=function(e){var t=[],n=function(e){if("object"==typeof e&&null!==e)return this.objectToString(e);else return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var i in e)if(e.hasOwnProperty(i))t.push('"'+i+'":'+n(e[i]));return"{"+t.join(",")+"}"},exports}),define("embed/mobilelite/lib/object",["require","./string"],function(require){var e=require("./string"),exports={};exports.extend=function(e,t){for(var n=arguments.length,i=1;i<n;i++)if(t=arguments[i])for(var o in t)if(t.hasOwnProperty(o)&&void 0!==t[o])e[o]=t[o];return e},exports.extendOwn=function(e,t){for(var n=1,i=arguments.length;n<i;n++)if(t=arguments[n])for(var o in t)if(t.hasOwnProperty(o)&&e.hasOwnProperty(o)&&void 0!==t[o])e[o]=t[o];return e},exports.clone=function(e){for(var t={},n=0,i=arguments.length;n<i;n++)if(e=arguments[n])for(var o in e)if(e.hasOwnProperty(o)&&void 0!==e[o])t[o]=e[o];return t},exports.jsonToQuery=function(t){var n,i,o=[];for(var r in t)if(t.hasOwnProperty(r))if(n=t[r],exports.isArray(n))for(i=n.length;i--;)o.push(r+"="+encodeURIComponent(n[i]));else if(exports.isObject(n))o.push(r+"="+encodeURIComponent(e.objectToString(n)));else o.push(r+"="+encodeURIComponent(n));return o.join("&")};var t=Object.prototype.toString;return exports.isObject=function(e){return"[object Object]"===t.call(e)},exports.isString=function(e){return"[object String]"===t.call(e)},exports.isArray=function(e){return"[object Array]"===t.call(e)},exports.isNumber=function(e){return!!/^[0-9]+$/.test(e)},exports}),define("embed/mobilelite/lib/net/img",["require","../object"],function(require){var e=require("../object"),t=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}(),exports={};return exports.request=function(n,i,o,r){if("function"==typeof i)r=o,o=i,i=null;(i=i||{}).t=t(),n+=(n.indexOf("?")>-1?"&":"?")+e.jsonToQuery(i);var a=new Image;a.onload=function(){a.onload=null,a.onerror=null,a=null,o&&o()},a.onerror=function(){a.onload=null,a.onerror=null,a=null,r&&r()},a.src=n},exports}),define("embed/mobilelite/lib/net/ajax",["require","../object","./img"],function(require){function e(){}function t(n,i){function o(){if(4===u.readyState){try{var t=u.status}catch(e){return void c("failure")}if(c(t),t>=200&&t<300||304===t||1223===t)c("success");else c("failure");window.setTimeout(function(){if(u.onreadystatechange=e,m)u=null},0)}}function r(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest}function c(e){e="on"+e;var o=v[e],r=t[e];if(o){if(l)clearTimeout(l);if("onsuccess"!==e)o(u);else try{var c=u.responseText;c=new Function("return ("+c+")")(),i.onsuccess(c)}catch(e){return a.request(s,{errMsg:e.message||"",name:e.name||"",fileName:e.fileName||"",url:n,stack:e.stack||""}),i.onfailure(u)}}else if(r){if("onsuccess"===e)return;r(u)}}i=i||{};var l,f,u,d=i.data||"",m=!(!1===i.async),p=i.username||"",_=i.password||"",h=(i.method||"GET").toUpperCase(),g=i.headers||{},b=i.timeout||0,v={};for(f in i)if(i.hasOwnProperty(f))v[f]=i[f];if(0!==n.indexOf("http"))g["X-Requested-With"]="XMLHttpRequest";try{if(u=r(),"GET"===h){if(d)n+=(n.indexOf("?")>=0?"&":"?")+d,d=null;if(i.noCache)n+=(n.indexOf("?")>=0?"&":"?")+"b"+ +new Date+"=1"}if(p)u.open(h,n,m,p,_);else u.open(h,n,m);if(m)u.onreadystatechange=o;if("POST"===h)g["Content-Type"]=g["Content-Type"]||"application/x-www-form-urlencoded",u.setRequestHeader("Content-Type",g["Content-Type"]),delete g["Content-Type"];for(f in g)if(g.hasOwnProperty(f))u.setRequestHeader(f,g[f]);if(c("beforerequest"),b)l=setTimeout(function(){u.onreadystatechange=e,u.abort(),c("timeout")},b);if(u.send(d),!m)o()}catch(e){c("failure")}return u}function n(){return(new Date).getTime().toString(36)}function i(i,a){var s=a.onsuccess||e,c=a.onfailure||e;a.onsuccess=s,a.onfailure=c;var l=a.data||{};if(a.method===r)i+=(i.indexOf("?")>=0?"&":"?")+"_t="+n(),a.data=o(l);else l._t=n(),i+=(i.indexOf("?")>=0?"&":"?")+o(l),a.data=null;return t(i,a)}var o=require("../object").jsonToQuery,r="POST",a=require("./img"),s="http://sc.qiao.baidu.com/front/ajaxError.gif",exports={};return exports.post=function(e,t,n,o){return i(e,{method:r,data:t,onsuccess:n,onfailure:o})},exports.get=function(e,t,n,o){return i(e,{method:"GET",data:t,onsuccess:n,onfailure:o})},exports}),define("embed/mobilelite/lib/net/jsonp",["require","../object","./img"],function(require){"use strict";function e(e,i){var s=r(),c=null,h=i.timeout||null,g=i.callbackKey||d,b=s,v=i.data||{};v.t=(new Date).getTime();var y=i.charset||m,w=function(e){i.onsuccess&&i.onsuccess(e),n(c),o(b)},S=function(){i.onfail&&i.onfail(),n(c),o(b)},T=a({url:e+t(e,v,g,b),charset:y,id:s});if(f[s]=l[s]=function(){try{w.apply(null,arguments)}catch(t){p.request(_,{type:"jsonp",errMsg:t.message||"",name:t.name||"",fileName:t.fileName||"",url:e,stack:t.stack||""}),S.apply(null,arguments)}},u[s]=function(){S.apply(null,arguments)},h)c=setTimeout(function(){c=null,T.abort(),S.call(null)},h);return T.send(),T}function t(e,t,n,i){var o={}.toString.call(t),r="?";if(e.indexOf("?")>-1)r="&";var a=r+n+"="+i;if("[object Object]"===o)a+="&"+s(t);return a}function n(e){if(e)clearTimeout(e),e=null}function i(e){if(l[e])l[e]=h(e),f[e]=null,delete f[e]}function o(e){try{f[e]=null,l[e]=null,delete f[e],delete l[e]}catch(e){}}function r(){return"cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function a(e){var t,n=c.head||c.getElementsByTagName("head")&&c.getElementsByTagName("head")[0]||c.body;return{send:function(){t=c.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(n){if(!0===n||!t.readyState||/loaded|complete/.test(t.readyState)){if(t.onload=t.onreadystatechange=null,t.parentNode)t.parentNode.removeChild(t);if(t=null,!0===n)i(e.id)}},t.onerror=function(){if(t.parentNode)t.parentNode.removeChild(t);if(u[t.id])u[t.id].call(null);t=null},n.insertBefore(t,n.firstChild)},abort:function(){if(t)t.onload(!0)}}}var s=require("../object").jsonToQuery,c=document,l=window,f={},u={},d="callback",m="utf-8",p=require("./img"),_="http://sc.qiao.baidu.com/front/ajaxError.gif",h=function(e){return function(){try{l[e]=null,delete l[e]}catch(e){}}};return{request:e}}),define("embed/mobilelite/lib/ajax",["require","./net/ajax","./net/jsonp","./net/img"],function(require){var e=require("./net/ajax"),t=require("./net/jsonp"),n=require("./net/img"),i=window.location.protocol+"//p.qiao.baidu.com",exports={};return exports.ajax=function(n,o){if("jsonp"===o.type)if(-1!==n.indexOf("/smartBox/")||-1!==n.indexOf("aifanfan.baidu.com/p.gif")||-1!==n.indexOf("aifanfan.baidu.com/s.gif")||-1!==n.indexOf("affselfbuildsite")||-1!==n.indexOf("corpwechatqrcode"))return t.request(n,o);else return t.request(i+n,o);if("post"===o.method)return e.post(n,o.data,o.onsuccess,o.onfail);else return e.get(n,o.data,o.onsuccess,o.onfail)},exports.img=function(e,o){if("jsonp"===o.type)return t.request(i+e,o);n.request(e,o.data,o.onsuccess,o.onfail)},exports}),define("embed/mobilelite/lib/lang",["require"],function(require){var exports={};return exports.inherits=function(e,t){var n=function(){};n.prototype=t.prototype;var i=e.prototype,o=e.prototype=new n;for(var r in i)o[r]=i[r];return e.prototype.constructor=e,e.superClass=t.prototype,e},exports.bind=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}},exports}),define("embed/mobilelite/lib/emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getAfter=function(){if(!this._afters)this._afters={};return this._afters},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var o=n[e].length;if(o>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+o+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var o,r=0;r<i.length;r++)if((o=i[r])===t||o.listener===t){i.splice(r,1);break}return this},t.emit=function(e){for(var t=this._getEvents(),n=t[e],i=[],o=1;o<arguments.length;o++)i.push(arguments[o]);if(n)for(n=n.slice(0),o=0;o<n.length;o++)n[o]&&n[o].apply(this,i);return this},t.listeners=function(e){return this._getEvents()[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(e){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e},{Emitter:e}}),define("embed/mobilelite/lib/Storage",[],function(){function e(e){this.id=e.toUpperCase()}var t,n=window.localStorage,i=window,o=i.document,r="QIAOUSERDATACHAT"+location.hostname,a=function(){function e(e){return e.replace(a,"___")}var t,n=null,i=365,a=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");return{build:function(e){e=e||{},t=r+(e.siteid||""),i=e.expires||i},setup:function(){if(!n)try{n=o.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),o.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(o,r){o=e(o);var a=this,s=new Date;if(a.setup())return s.setDate(s.getDate()+i),n.expires=s.toUTCString(),n.load(t),n.setAttribute(o,r),n.save(t),r},getItem:function(i){if(i=e(i),this.setup())return n.load(t),n.getAttribute(i)},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}();return e.init=function(e){var i=e.siteid;if(!t)t="BDBG_IM_"+i+"_";if(!window.localStorage)n=a,n.build({siteid:i})},e.clear=function(){n.clear()},e.prototype.key=function(){return t+this.id},e.prototype.get=function(e){var t;try{t=JSON.parse(n.getItem(this.key())||"{}")}catch(e){t={}}if(e)return t[e];else return t},e.prototype.clear=function(){try{try{n.setItem(this.key(),JSON.stringify({}))}catch(e){n.clear()}}catch(e){}},e.prototype.set=function(e,t){var i=this.get();i[e]=t;try{try{n.setItem(this.key(),JSON.stringify(i))}catch(e){n.clear(),n.setItem(this.key(),JSON.stringify(i))}}catch(e){}},{Storage:e}}),define("embed/mobilelite/lib/array",["require"],function(require){var exports={};return exports.indexOfArray=function(e,t,n){var i,o,r=e.length;for(i=0;i<r;i++){if(n)o=e[i][n];else o=e[i];if(i in e&&o===t)return i}return-1},exports.removeAtArray=function(e,t){return e.splice(t,1)[0]},exports}),define("embed/mobilelite/lib/browser",["require"],function(require){var exports={};return exports.isMobile=function(){return!!navigator.userAgent.match(/.*Mobile.*/)||"ontouchstart"in window},exports.isIphonex=function(){if("undefined"!=typeof window&&window)return/iphone/gi.test(window.navigator.userAgent)&&window.screen.height>=812;else return!1},exports}),define("embed/mobilelite/lib/promise",["require","exports"],function(require,exports){function e(e){return"function"==typeof e}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(i,o){function r(e){if(!c)n(i,e),c=!0}function a(e){if(!c)i.reject(e),c=!0}function s(){var n;if(t(o)||e(o))if(n=o.then,e(n))n.call(o,r,a);else n=null;if(!n)i.fulfill(o)}var c;if(d)try{s()}catch(e){if(!c)l(e),i.reject(e)}else s()}function i(e,t,i){return function(o){function r(){var r=i(o);if(r===t)throw new TypeError;n(e,r)}if(d)try{r()}catch(t){l(t),e.reject(t)}else r()}}function o(e,t,n){if(e.status===t)f.nextTick(function(){n(e.data)});else if(t===u.FULFILLED)e.fulfillList.push(n);else if(t===u.REJECTED)e.rejectList.push(n)}function r(e){var t=e.status===u.FULFILLED?e.fulfillList:e.rejectList;if(c(e),t.length)f.nextTick(function(){for(var n;n=t.shift();)n(e.data)})}function a(t,n,r){var a=new f,c=s(a);if(e(n))n=i(a,c,n);else n=function(e){a.fulfill(e)};if(o(t,u.FULFILLED,n),e(r))r=i(a,c,r);else r=function(e){a.reject(e)};return o(t,u.REJECTED,r),c}function s(e){return{then:function(t,n){return a(e,t,n)},catch:function(t){return a(e,null,t)}}}function c(e){var t=e.status===u.FULFILLED?"resolve":"reject";if(m)f.emit(t,e.data)}function l(e){if(m)f.emit("exception",e)}function f(){this.status=u.PENDING,this.fulfillList=[],this.rejectList=[]}var u={PENDING:0,FULFILLED:1,REJECTED:2},d=!0,m=!1,p=function(){function t(){var e,t=o.length;for(e=0;e<t;e++)o[e]();o.splice(0,e)}var n,i,o=[],r="promise";if("undefined"!=typeof process&&null!==process&&"function"==typeof process.nextTick)n=function(e){return process.nextTick(e)};else if(i=window.MutationObserver||window.webKitMutationObserver){var a=new i(function(e){if(e[0].attributeName===r)t()}),s=document.createElement("div");a.observe(s,{attributes:!0}),n=function(e){o.push(e),s.setAttribute(r,Date.now?Date.now():(new Date).getTime())}}else if(e(window.postMessage))window.addEventListener("message",function(e){if(e.source===window&&e.data===r)t()},!1),n=function(e){o.push(e),window.postMessage(r,"*")};else n=function(e){setTimeout(e,0)};return n}();return f.nextTick=p,f.enableGlobalEvent=function(e){e.mixin(this),m=!0},f.disableExceptionCapture=function(){d=!1},f.enableExceptionCapture=function(){d=!0},f.all=function(e){function t(t){return function(n){if(r[t]=n,++o>=e.length)i.fulfill(r)}}function n(e){i.reject(e)}if(!Array.isArray(e))e=Array.prototype.slice.call(arguments);var i=new f,o=0,r=[];return e.forEach(function(e,i){e.then(t(i),n)}),i.promise()},f.race=function(e){function t(e){i.fulfill(e)}function n(e){i.reject(e)}var i=new f;if(!Array.isArray(e))e=Array.prototype.slice.call(arguments);return e.forEach(function(e){e.then(t,n)}),i.promise()},f.promise=function(e){var t=new f;return e(t),t.promise()},f.rejected=function(e){return this.promise(function(t){t.reject(e)})},f.fulfilled=function(e){return this.promise(function(t){t.fulfill(e)})},f.resolved=f.fulfilled,f.prototype.fulfill=function(e){if(this.status===u.PENDING)this.data=e,this.status=u.FULFILLED,r(this)},f.prototype.resolve=f.prototype.fulfill,f.prototype.reject=function(e){if(this.status===u.PENDING)this.data=e,this.status=u.REJECTED,r(this)},f.prototype.promise=function(){return s(this)},{Resolver:f}}),define("embed/mobilelite/lib/event",["require"],function(require){return{event:{on:function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else e.attachEvent("ontype",n)}}}}),define("embed/mobilelite/lib/convert",[],function(){function e(e){var t,r;e[0]=o(e[0],-180,180),e[1]=i(e[1],-74,74),t=e.slice(0);for(var s=0;s<a.length;s++)if(t[1]>=a[s]){r=c[s];break}if(!r)for(s=a.length-1;s>=0;s--)if(t[1]<=-a[s]){r=c[s];break}var l=n(e,r);return e=[l[0].toFixed(2),l[1].toFixed(2)]}function t(e){var t,i;t=[Math.abs(e[0]),Math.abs(e[1])];for(var o=0;o<r.length;o++)if(t[1]>=r[o]){i=s[o];break}var a=n(e,i);return e=[a[0].toFixed(6),a[1].toFixed(6)]}function n(e,t){if(e&&t){var n=t[0]+t[1]*Math.abs(e[0]),i=Math.abs(e[1])/t[9],o=t[2]+t[3]*i+t[4]*i*i+t[5]*i*i*i+t[6]*i*i*i*i+t[7]*i*i*i*i*i+t[8]*i*i*i*i*i*i;return n*=e[0]<0?-1:1,o*=e[1]<0?-1:1,[n,o]}}function i(e,t,n){if(null!=t)e=Math.max(e,t);if(null!=n)e=Math.min(e,n);return e}function o(e,t,n){for(;e>n;)e-=n-t;for(;e<t;)e+=n-t;return e}var exports={},r=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],a=[75,60,45,30,15,0],s=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],c=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];return exports.pixelToLngLat=function(e,n,i){return t([e/Math.pow(2,i-18),n/Math.pow(2,i-18)])},exports.lngLatToPixel=function(t,n,i){var o=e([t,n]),r=o[0]*Math.pow(2,i-18),a=o[1]*Math.pow(2,i-18);return[Math.ceil(r),Math.ceil(a)]},exports}),define("embed/mobilelite/lib/dom",[],function(){function e(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function t(t){if("-"!==t.charAt(0)){var n=i.style,r=e(t);if(!(r in n)){r=r.charAt(0).toUpperCase()+r.substring(1);for(var a,s=0;a=o[s];s++)if(a+r in n){t="-"+a+"-"+t;break}}}return t}var exports={},n=document.defaultView.getComputedStyle,i=document.createElement("div"),o=["webkit","ms","o"];return exports.getStyle=function(i,o){return o=t(o),i.style[e(o)]||n(i).getPropertyValue(o)},exports.setStyle=function(t,n,i){return n=e(n),t.style[n]=i,t},exports.setStyles=function(e,t){for(var n in t)if(t.hasOwnProperty(n))exports.setStyle(e,n,t[n]);return e},exports.setFontSize=function(e,t,n){t=t||1,n=n||14;for(var i=e.children,o=0,r=i.length;o<r;o++){if(i[o].children)exports.setFontSize(i[o],t,n);exports.setStyle(i[o],"fontSize",n*t+"px")}},exports.g=function(e){if(!e)return null;else return"string"==typeof e?document.getElementById(e):e},exports.query=function(e,t){if("string"!=typeof e)return e;else return t=t||document.body,t.querySelector(e)},exports.queryAll=function(e,t){if(Array.isArray(e))return e;t=t||document.body;var n=t.querySelectorAll(e);return Array.prototype.slice.call(n)},exports.matches=function(e,t){var n=Element.prototype,i=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector;if(i)return i.call(e,t);for(var o=exports.queryAll(t,e.parentNode),r=0;r<o.length;r++)if(o[r]===e)return!0;return!1},exports.createElement=function(e,t){var n,i=document.createElement(e),o=t||{};for(var r in o)if(n=o[r],"style"===r)i.style.cssText=n;else i.setAttribute(r,n);return i},exports.closest=function(e,t,n){n=n||document;do{if(exports.matches(e,t))return e;if(e===n)return null}while((e=e.parentNode)&&e!==document);return null},exports.addClass=function(e,t){if(e.classList)e.classList.add(t);else{for(var n=e.className?e.className.split(/\s+/):[],i=0,o=n.length;i<o;i++)if(n[i]===t)return e;n.push(t),e.className=n.join(" ")}return e},exports.removeClass=function(e,t){if(e.classList)e.classList.remove(t);else{for(var n=e.className?e.className.split(/\s+/):[],i=0,o=n.length;i<o;i++)if(n[i]===t)n.splice(i,1),i--;e.className=n.join(" ")}return e},exports.position=function(e,t){if(e&&t){var n={},i=e.getBoundingClientRect();if(t){var o=t.getBoundingClientRect();n.left=i.left-o.left,n.top=i.top-o.top}else n.left=i.left+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),n.top=i.top+Math.max(document.documentElement.scrollTop,document.body.scrollTop);return n}},exports.hide=function(e){e.style.display="none"},exports.show=function(e){e.style.display=""},exports.toggle=function(e){if("none"===e.style.display)e.style.display="block";else e.style.display="none"},exports.toggleClass=function(e,t){if(exports.hasClass(e,t))exports.removeClass(e,t);else exports.addClass(e,t)},exports.hasClass=function(e,t){if(e.classList)return e.classList.contains(t);else{for(var n=e.className.split(/\s+/),i=0,o=n.length;i<o;i++)if(n[i]===t)return!0;return!1}},exports}),define("embed/mobilelite/lib/main",["require","./lang","./ajax","./emitter","./Storage","./string","./array","./browser","./object","./promise","./event","./convert","./dom"],function(require){function e(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}var t=require("./lang"),exports={};return e(exports,require("./ajax")),e(exports,require("./emitter")),e(exports,require("./Storage")),e(exports,require("./string")),e(exports,require("./array")),e(exports,require("./browser")),e(exports,require("./object")),e(exports,require("./promise")),e(exports,require("./event")),e(exports,require("./convert")),e(exports,require("./dom")),e(exports,t),exports}),define("embed/mobilelite/const",["require"],function(require){var exports={};return exports.EVENT_MAP={LITE_SHOW:"lite:show",LITE_HIDE:"lite:hide",LITE_CLICK:"lite:click",BUBBLE_SHOW:"bubble:show",BUBBLE_HIDE:"bubble:hide",BUBBLE_CLICK:"bubble:click",BANNER_SHOW:"bubble:show",BANNER_HIDE:"bubble:hide",BANNER_CLICK:"bubble:click",IM_SHOW:"im:show",IM_HIDE:"im:hide",UNREAD_CLICK:"unread:click",IM_INIT:"im:init",ICON_CLICK:"icon:click",INVITE_CLICK:"invite:click",IM_DIRECT:"im:direct",HOT_ISSUE:"hotIssue:click",HOT_ISSUE_PUSH:"hotIssue:push",IM_MSG:"im:msg",INIT:"init",PAGE_SUGGESTED_QUESTION:"page:suggestedquestion",AUDIO_SEND_TO_VIEW:"audiosendtoview"},exports}),define("embed/mobilelite/emitter",["require","./lib/main","./const"],function(require){function e(){if(t.query("#qiaoMobileLiteAwareFraudWrap"))t.query("#qiaoMobileLiteAwareFraudWrap").parentNode.removeChild(t.query("#qiaoMobileLiteAwareFraudWrap")),t.query(".qiao-mobile-lite-webimlite-chat").style.top=window.getComputedStyle(t.query(".qiao-mobile-lite-webimlite-head")).height}var t=require("./lib/main"),n=require("./const"),i=n.EVENT_MAP,o=require("./lib/main").Emitter,r=new o,a={webimlite:{display:!1},msglite:{display:!1},msgbubble:{display:!1},msgbanner:{display:!1}};return r.on(i.IM_SHOW,function(){a.webimlite.display=!0}),r.on(i.IM_HIDE,function(){a.webimlite.display=!1,e()}),r.on(i.LITE_SHOW,function(){a.msglite.display=!0}),r.on(i.LITE_HIDE,function(){a.msglite.display=!1}),r.on(i.BUBBLE_SHOW,function(){a.msgbubble.display=!0}),r.on(i.BUBBLE_HIDE,function(){a.msgbubble.display=!1}),r.model=a,r}),define("embed/embedChat/mobile/chat",["require","exports","../../mobilelite/lib/ajax","../../mobilelite/emitter","../../mobilelite/const"],function(require,exports){function e(){}function t(e){var t=e;if(/^http:/.test(e))t=e.replace(/^http/,"https");else if(/^\/\//.test(e))t="https:"+e;return t}function n(e,t){function n(e,t){var n={BAR:"bar",ROUND:"round",SECTOR:"sector"};if(t)return n.BAR;switch(e){case 1:case 4:return n.ROUND;case 3:return n.SECTOR;default:return n.BAR}}function i(){function e(e){var t=100*c/window.innerHeight;return"center"===e?50+t/2:t}function t(){if("bottom"===g)return 100*(window.innerHeight-f)/window.innerHeight;else return 100*(f+c)/window.innerHeight+2}function n(){var e=16;return m>u?(u-e)/window.innerWidth*100:(m-e)/window.innerWidth*100}function i(){var e=.25;if(d/window.innerHeight>e&&f/window.innerHeight>e)return 2;else return 3}var r=o.position.split("-"),a=document.getElementById("nb_icon_wrap");if(a){var s=o.isFixedPosition,c=a.offsetHeight,l=a.offsetWidth,f=a.offsetTop,u=a.offsetLeft,d=window.innerHeight-(c+f),m=window.innerWidth-(l+u);if(1===s)return{float:r[0],vertical:"top"===r[1]?"top":"bottom",msgPosition:e(r[1]),maxShowNum:"center"===r[1]?2:3};else{var p=c/2+f,_=l/2+u,h=window.innerWidth/2>_?"left":"right",g=window.innerHeight/2>p?"top":"bottom";return{float:h,vertical:g,msgPosition:t(),maxShowNum:i(),offset:n()}}}else return{float:"right",vertical:"bottom",msgPosition:0,maxShowNum:3}}var o=t.seekIcon,r=t.webim,a=e.adata?e.adata:{};return{siteid:e.siteId,ucid:e.userId,userName:e.session&&e.session.uname,hisMsgCount:3,wrap:"newBridge",visitType:3,adata:a,webim:{size:1,btnColor:"#f00",companyDis:r.displayCompany?r.displayCompany:0,company:r.cpyInfo?r.cpyInfo:"",cpyTel:r.cpyTel?r.cpyTel:"",themeColor:r.webimLight.themeColor?r.webimLight.themeColor:"#4d74fa",isFullscreen:r.webimLight.isFullscreen?r.webimLight.isFullscreen:0,companyLogo:r.companyLogo?r.companyLogo:"http://aff-im.cdn.bcebos.com/onlineEnv/r/image/logo.png",mobilePrologue:e.prologue?e.prologue:"",riskImg:r.riskImg?r.riskImg:0,riskCpy:r.riskCpy?r.riskCpy:"000",isOpenSmartReply:t.isOpenSmartReply,generalRecommend:r.generalRecommend,searchTermRecommend:r.searchTermRecommend,isOpenAdvance:r.isOpenAdvance,makeCallServicePhone:r.makeCallServicePhone,isOpenTelCall:e.userCommonSwitch.isOpenTelCall||!1,isOpenVoiceCom:e.userCommonSwitch.isOpenVoiceCom||!1},issueList:t.seekIcon.barrageIssue,hotIssueList:t.seekIcon.hotIssues,msgBubbleConfig:i(),icon:{size:2,enable:o.width&&o.height,theme:n(o.skinIndex,o.isCustomerStyle),width:o.width,position:o.position,height:o.height}}}var i=require("../../mobilelite/lib/ajax"),o=require("../../mobilelite/emitter"),r=require("../../mobilelite/const"),a={},s=null;exports.getDefaultParam=function(e){var t=e.getServer("siteObj");return{v:t.userId,s:t.siteId,dev:"1",type:0,sid:"-1",tid:"-1",tid_authtype:4}},exports.refuseSuccess=function(e,t,n){var i=e.g("nb_invite_wrap");if(i)i.style.display="none";t.fromType=1},exports.acceptSuccess=function(e,n,o,r,c,l,f){var u=f[1],d=o.getServer("siteObj"),m=o.getServer("configBox").inviteBox;o.getServer("configBox");if(d.isOpenMobileLite)exports.openMobileLite(!1,f[1]);else if(0===o.getServer("configBox").webim.isMobileWebim&&"true"===d.online){if(0!==u){if(d.invited=0,3===e.status&&e.tid)d.invited=1}else if(0===u)e.gid=-1,e.invited=0,e.tid="-1";exports.openMobileLite(!1,f[1],f[2])}else{var p={};if(0===f[1])p.from=0;else if(p.from=e.fromType,e.tid&&"-1"!==e.tid)p.sessionid=e.sid;if(p.siteId=d.siteId,p.tid=e.tid||"-1",p.userId=d.userId,p.ttype=e.ttype,p.siteConfig=l.extend({},d),delete p.siteConfig.prologue,3===e.status)p.siteConfig.invited=1;else p.siteConfig.invited=0;if("false"===d.online)p.siteConfig.origin=document.title;var _=o.getServer("configBox").webim;if(p.config=new Object,p.config.themeColor=_.webim.themeColor&&_.webim.themeColor.substring(1),e.adata)p.siteConfig.adata=e.adata;if(p.siteConfig.queuing="",e.expGroup)p.siteConfig.expGroup=e.expGroup;if(!p.siteConfig.bid&&e.bid)p.siteConfig.bid=e.bid;var h=n.getXst();if(h)p.xst=h;var g=d.webRoot;if(a.reqParam=p,g+="mobile/chat",g=t(g),1==+m.smartBoxEnable&&1==+m.smartBoxOpen&&0==+m.likeCrm&&1==+m.autoInvite&&0!==f[1])exports.refuseSuccess(),exports.initSystemInvite();var b={type:"jsonp",data:{type:2,time:(new Date).getTime(),userId:o.getServer("siteObj").eid,logId:speedLogId,sourceId:"AFFSpeed"}};i.ajax("https://aifanfan.baidu.com/p.gif",b);var v=d.siteToken||"0",y=d.siteId||"-1",w=o.getServer("configBox").components||{},S="mbNBBridage"+(new Date).getTime();if(Object.keys(w).length)s=window.open(g+"?siteToken="+v+"&speedLogId="+speedLogId+"&"+n.jsonToQuery(a),S);else{var T="object"==typeof f[2]?f[2].innerText:f[2],k="object"==typeof f[2]?f[2].getAttribute("data-key"):"";s=window.open(g+"?siteToken="+v+"&siteId="+y+"&speedLogId="+speedLogId+"&"+n.jsonToQuery(a)+"&hotIssue="+encodeURIComponent(T?T:"")+"&hotIssueid="+encodeURIComponent(k?k:""),S)}}},exports.initSystemInvite=function(e){e.sid="-100",e.tid="-1",e.fromType=1,e.ttype=1},exports.watchStatus=function(e,t,n){var i=t.g("nb_invite_wrap"),o=t.g("nb_invite_smart_wrap"),r=t.g("nb_invite_abtest_wrap");if((3===n.status||"invite"==n.reason)&&"chat"!==n.reason){if(i)i.style.display="block";if(o)o.style.display="none";if(r)r.style.display="none";e.visitState="invite"}else if(4===n.status&&"waiterDirectChat"===n.reason)exports.forcetalk();else{if(i)i.style.display="none";if(o)o.style.display="none";if(r)r.style.display="none";e.visitState="",exports.initSystemInvite()}},exports.initiative=function(e,t,n){if(2===t.fromType||"to"===t.from){var i=e.g("nb_invite_wrap");if(i)i.style.display="block"}},exports.enterSuccess=function(e,t,n,i){var a=i,s=e.g("nb_invite_wrap");if(void 0!=a.status){if(3===a.status){if(s)s.style.display="block";t.sid=a.sid,t.tid=a.tid,t.fromType=2,t.ttype=0}else if(4===a.status){if(s)s.style.display="none";exports.openMobileLite(!1,2),clearTimeout(n.timeKey)}o.emit(r.EVENT_MAP.PAGE_SUGGESTED_QUESTION,a)}},exports.builtComunicate=function(e,t,n,i,r){var a=i.getServer("siteObj"),s=i.getServer().configBox.inviteBox;e.likeCrm=s.likeCrm,e.siteid=a.siteId,e.eid=a.eid,e.platform=1,e.urlRoot=a.webRoot,e.siteToken=a.siteToken,e.crossDomain=!0,e.visitType=1,e.vstProto=a.vstProto,e.startTime=a.startTime,t.init(e),n.init(e),n.enter(exports.enterSuccess),t.on("initiative",exports.initiative),t.on("watchStatus",exports.watchStatus),t.on("forcetalk",exports.forcetalk),t.on("sendMobileData",function(e){o.emit("mobileAddMessage",e)}),t.on("falseFeedbackSuccess",function(e,t){t.target.innerHTML="\u611f\u8c22\u53cd\u9988",t.target.style="color: #000",t.target.setAttribute("data-key",!1),o.emit("hfShowTip","\u53cd\u9988\u6210\u529f")}),t.on("falseFeedbackFail",function(e,t){o.emit("hfShowTip","\u53cd\u9988\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}),t.on("checkUpHF",function(e,t){var n=e.id,i=document.getElementById(n);if(i){var o=document.createElement("ins");o.className="qiao-webimlite-handle-content",o.innerHTML='\u53d1\u9001\u5931\u8d25\uff01\u542b\u6709\u654f\u611f\u8bcd\uff0c\u8bf7<span class="qiao-webimlite-reset-btn" style="color: #399df8" data-key=true> \u91cd\u65b0\u7f16\u8f91 </span>\u540e\u518d\u53d1\u9001\uff0c<span class="qiao-webimlite-misreport-btn" style="color: #399df8" data-key=true data-riskType="'+t.riskType+'" data-riskResult="'+t.riskResult+'">\u8bef\u62a5\u53cd\u9988</span>',i.parentNode.appendChild(o)}})},exports.forcetalk=function(e,t){var n=e.g("nb_invite_wrap");if(n)n.style.display="none";t.logForceTalk(),exports.openMobileLite(!0,2)},exports.openMobileLite=function(e,t,i,o,r,a){var s=i.getServer("siteObj"),c=n(s,i.getServer("configBox"));!s.isOpenMobileLite&&(s.isOpenMobileLite=1);var l=["icon:click","invite:click","auto:communication"];(0,(false||document.getElementById("newBridge")).require)(["embed/mobilelite/main"],function(t){if(t.init(c,r,a),o)t.emit("im:direct",{isForceTalk:!0,isBlocked:e.isBlocked()});else{var n=i.getServer("configBox").components||{},s=n&&n.mobileComps&&n.mobileComps.length>0;if(a&&!s)t.emit("hotIssue:click",a);else t.emit(l[r])}})},exports.refuse=function(t,n){var i=exports.getDefaultParam();i.type=1,i.sid=t.sid,i.tid=t.tid,n.push(i,exports.refuseSuccess,e)},exports.accept=function(e,t,n){var i=exports.getDefaultParam();i.type=0,i.sid=e.sid,i.tid=e.tid,exports.acceptSuccess(arguments)}}),define("embed/embedChat/mConfig",["require","./bid","./consts","./mobile/leave","./mobile/chat"],function(require){return{package:"mchat",resource:{bid:require("./bid"),consts:require("./consts"),leave:require("./mobile/leave"),chat:require("./mobile/chat")},injection:[{id:"mchat.chat",method:{builtComunicate:["core.config","core.main","core.site","data.config","mchat.bid"],watchStatus:["core.config","mbase.dom"],initiative:["mbase.dom","core.config"],refuse:["core.config","core.net"],accept:["core.config"],enterSuccess:["mbase.dom","core.config","minvite.data"],acceptSuccess:["core.config","core.net","data.config","minvite.smartyInvite","mbase.brower","imLib.lang"],refuseSuccess:["mbase.dom","core.config"],initSystemInvite:["core.config"],getDefaultParam:["data.config"],openMobileLite:["core.main","core.config","data.config"],forcetalk:["mbase.dom","log.main"]}},{id:"mchat.leave",method:{init:["core.main","core.config","mbase.events","mbase.brower"]}},{id:"mchat.bid",method:{init:["imLib.localStorage","imLib.lang","mbase.lib","mchat.consts"]}}],aspect:[{id:"mchat.chat",pointCut:["minvite.main.init, , builtComunicate"]},{id:"mchat.leave",pointCut:["mchat.chat.builtComunicate, , init"]}]}}),define("embed/invite/inviteMain",["require"],function(require){var exports={};return window.GetQueryValue=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);if(null!=n)return decodeURI(n[2]);else return null},window.acceptSmartInvite=function(e,t){var n=exports.getServerConfig(),i=e;if(navigator.userAgent.match(/(Android);?[\s\/]+([\d.]+)?/)&&+n.getServer("configBox").webim.isMobileWebim)i=e.replace(/\"/g,'\\"');exports.setSmartChat(i,t,1)},exports.getServerConfig=function(e){return e},exports.setSmartChat=function(e,t,n,i,o){if(e.adata)e.adata.IntelligentInviteMsg=n;else e.adata={IntelligentInviteMsg:n};if(i)t.acceptInvite(o)},exports.renderHtml=function(e,t,n,i,o,r){var a=t.getWrap(),s=n.getInviteStyle(),c=i.template(o,s);e.appendHTML(c,a),r.process()},exports.init=function(e){exports.renderHtml(),e.init()},exports}),define("embed/invite/inviteData",["require"],function(require){var exports={};return exports.getInviteStyle=function(e,t){var n=e.getServer("configBox").inviteBox;return t.dataProcess(n)},exports}),define("embed/invite/inviteHandler",["require"],function(require){var exports={};return exports.bindEvent=function(e,t,n){n.process();var i=n.getClickEle();e.domOn(i,"click",n.acceptInvite,!1),e.domOn([t.PREFIXID+"cancel",t.PREFIXID+"tool",t.PREFIXIDSMART+"cancel",t.PREFIXIDSMART+"tool"],"click",n.refuseInvite,!1)},exports.init=function(){exports.bindEvent()},exports}),define("embed/mobilelite/lib/md5.min",["require"],function(require){function e(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function t(e,t){return e<<t|e>>>32-t}function n(n,i,o,r,a,s){return e(t(e(e(i,n),e(r,s)),a),o)}function i(e,t,i,o,r,a,s){return n(t&i|~t&o,e,t,r,a,s)}function o(e,t,i,o,r,a,s){return n(t&o|i&~o,e,t,r,a,s)}function r(e,t,i,o,r,a,s){return n(t^i^o,e,t,r,a,s)}function a(e,t,i,o,r,a,s){return n(i^(t|~o),e,t,r,a,s)}function s(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;var s,c,l,f,u,d=1732584193,m=-271733879,p=-1732584194,_=271733878;for(s=0;s<t.length;s+=16)c=d,l=m,f=p,u=_,d=i(d,m,p,_,t[s],7,-680876936),_=i(_,d,m,p,t[s+1],12,-389564586),p=i(p,_,d,m,t[s+2],17,606105819),m=i(m,p,_,d,t[s+3],22,-1044525330),d=i(d,m,p,_,t[s+4],7,-176418897),_=i(_,d,m,p,t[s+5],12,1200080426),p=i(p,_,d,m,t[s+6],17,-1473231341),m=i(m,p,_,d,t[s+7],22,-45705983),d=i(d,m,p,_,t[s+8],7,1770035416),_=i(_,d,m,p,t[s+9],12,-1958414417),p=i(p,_,d,m,t[s+10],17,-42063),m=i(m,p,_,d,t[s+11],22,-1990404162),d=i(d,m,p,_,t[s+12],7,1804603682),_=i(_,d,m,p,t[s+13],12,-40341101),p=i(p,_,d,m,t[s+14],17,-1502002290),m=i(m,p,_,d,t[s+15],22,1236535329),d=o(d,m,p,_,t[s+1],5,-165796510),_=o(_,d,m,p,t[s+6],9,-1069501632),p=o(p,_,d,m,t[s+11],14,643717713),m=o(m,p,_,d,t[s],20,-373897302),d=o(d,m,p,_,t[s+5],5,-701558691),_=o(_,d,m,p,t[s+10],9,38016083),p=o(p,_,d,m,t[s+15],14,-660478335),m=o(m,p,_,d,t[s+4],20,-405537848),d=o(d,m,p,_,t[s+9],5,568446438),_=o(_,d,m,p,t[s+14],9,-1019803690),p=o(p,_,d,m,t[s+3],14,-187363961),m=o(m,p,_,d,t[s+8],20,1163531501),d=o(d,m,p,_,t[s+13],5,-1444681467),_=o(_,d,m,p,t[s+2],9,-51403784),p=o(p,_,d,m,t[s+7],14,1735328473),m=o(m,p,_,d,t[s+12],20,-1926607734),d=r(d,m,p,_,t[s+5],4,-378558),_=r(_,d,m,p,t[s+8],11,-2022574463),p=r(p,_,d,m,t[s+11],16,1839030562),m=r(m,p,_,d,t[s+14],23,-35309556),d=r(d,m,p,_,t[s+1],4,-1530992060),_=r(_,d,m,p,t[s+4],11,1272893353),p=r(p,_,d,m,t[s+7],16,-155497632),m=r(m,p,_,d,t[s+10],23,-1094730640),d=r(d,m,p,_,t[s+13],4,681279174),_=r(_,d,m,p,t[s],11,-358537222),p=r(p,_,d,m,t[s+3],16,-722521979),m=r(m,p,_,d,t[s+6],23,76029189),d=r(d,m,p,_,t[s+9],4,-640364487),_=r(_,d,m,p,t[s+12],11,-421815835),p=r(p,_,d,m,t[s+15],16,530742520),m=r(m,p,_,d,t[s+2],23,-995338651),d=a(d,m,p,_,t[s],6,-198630844),_=a(_,d,m,p,t[s+7],10,1126891415),p=a(p,_,d,m,t[s+14],15,-1416354905),m=a(m,p,_,d,t[s+5],21,-57434055),d=a(d,m,p,_,t[s+12],6,1700485571),_=a(_,d,m,p,t[s+3],10,-1894986606),p=a(p,_,d,m,t[s+10],15,-1051523),m=a(m,p,_,d,t[s+1],21,-2054922799),d=a(d,m,p,_,t[s+8],6,1873313359),_=a(_,d,m,p,t[s+15],10,-30611744),p=a(p,_,d,m,t[s+6],15,-1560198380),m=a(m,p,_,d,t[s+13],21,1309151649),d=a(d,m,p,_,t[s+4],6,-145523070),_=a(_,d,m,p,t[s+11],10,-1120210379),p=a(p,_,d,m,t[s+2],15,718787259),m=a(m,p,_,d,t[s+9],21,-343485551),d=e(d,c),m=e(m,l),p=e(p,f),_=e(_,u);return[d,m,p,_]}function c(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function f(e){return c(s(l(e),8*e.length))}function u(e,t){var n,i,o=l(e),r=[],a=[];if(r[15]=a[15]=void 0,o.length>16)o=s(o,8*e.length);for(n=0;n<16;n+=1)r[n]=909522486^o[n],a[n]=1549556828^o[n];return i=s(r.concat(l(t)),512+8*t.length),c(s(a.concat(i),640))}function d(e){var t,n,i="0123456789abcdef",o="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),o+=i.charAt(t>>>4&15)+i.charAt(15&t);return o}function m(e){return unescape(encodeURIComponent(e))}function p(e){return f(m(e))}function _(e){return d(p(e))}function h(e,t){return u(m(e),m(t))}function g(e,t){return d(h(e,t))}var exports={};return exports.md5=function(e,t,n){if(!t)if(!n)return _(e);else return p(e);if(!n)return g(t,e);else return h(t,e)},exports.md5}),define("embed/invite/mobile/smartyInvite",["require","../../mobilelite/lib/ajax","../../mobilelite/lib/md5.min"],function(require){function e(){var e;if(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(navigator.userAgent))e=2;else e=1;return e}function t(){if(""===(h=document.referrer))return!1;var e=["www.baidu.com","www.so.com","www.sogou.com","m.sm.cn"],t=h.split("/")[2];if(-1!==e.indexOf(t))return!0;else return!1}function n(e,t){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=t.match(n);if(null!=i)return decodeURIComponent(i[2]);else return null}function i(){if(!t())return g="";var e=h.split("/")[2],i=h.split("?")[1];if("www.baidu.com"===e)return g=n("word",i),b=n("eqid",i),g||b||"";else if("www.so.com"===e)return(g=n("q",i))||"";else if("www.sogou.com"===e)return(g=n("query",i))||"";else if("m.sm.cn"===e)return(g=n("q",i))||"";return""}function o(){var e=h;if(t()){if(0===e.indexOf("https://www.baidu.com")){var n="",i="",o=e.indexOf("url");if(-1!==o){n=e.slice(0,o);var r=e.indexOf("&",o);if(-1!==r)i=e.slice(r+1);e=n+i}}return e}return e}function r(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1;n=n<10?"0"+n:n;var i=e.getDate();i=i<10?"0"+i:i;var o=e.getHours();return o=o<10?"0"+o:o,S(""+t+n+i+o)}function a(e,t){var n=e+"=",i="";if(document.cookie.length>0){var o=document.cookie.indexOf(n);if(o>-1){o+=n.length;var r=document.cookie.indexOf(";",o);if(-1===r)r=document.cookie.length;i=t?unescape(document.cookie.substring(o,r)):document.cookie.substring(o,r)}}return i}function s(t,n,i,s,c,l){var f={query:i,title:"",creative:"",ucid:l.userId,trade:c.tradeId,siteid:l.siteId,baiduid:a("BAIDUID"),bid:t.bid,refer:o()};if(f.time=(new Date).getTime(),f.token=r(),f.device=e(),f.funtype=1,s)f.sublink=s;var u={data:f,type:"jsonp",timeout:5e3,onsuccess:function(e){if(0==+e.status){if(e=e.data,e.startObj)n.smartInvite.startObj=e.startObj,exports.ideaType=e.startObj.type||-1,n.smartInvite.query=e.startObj.query||-1;if(exports.isHasSmartAccess=e.isOpen?1:0,e.isOpen)exports.isUseSmartyInvite=1,exports.isHideInvite=0,T=e.smartText||[];else if(void 0===e.isOpen)_(n,11);else _(n,1)}exports.isFininshGetPoint=1,exports.setFinshAccessAndWise()},onfail:function(e){exports.isFininshGetPoint=1,exports.setFinshAccessAndWise(),_(n,11)}};w.ajax("/smartbox/wise/query",u)}function c(e){return 0!==e.seekIcon.width&&0!==e.seekIcon.height}function l(e){var t=e.toolbar.iconOrder;E=0;for(var n=0;n<t.length;n++)if(1===t[n].enable)if(E++,"onlineConsult"===t[n].type)M=E-1;return"1"===e.toolbar.enable&&-1!==M}function f(e){if(1===e.isFixedPosition)return-1===e.position.indexOf("top");var t=document.documentElement.clientWidth,n=document.documentElement.clientHeight,i=t*e.width*.01,o=n*e.height*.01;if(1===e.skinIndex||3===e.skinIndex||4===e.skinIndex)o=i;return e.marginTop>n/2-.5*o}function u(e){if(1===e.isFixedPosition)return-1!==e.position.indexOf("right");else return e.marginLeft>window.innerWidth/2}function d(e,t,n,i){return n+":"+e+"px;"+i+":"+t+"px;"}function m(e){var t=e.seekIcon;k="";var n=1*t.marginLeft,i=1*t.marginTop,o=document.documentElement.clientWidth,r=document.documentElement.clientHeight,a=o*t.width*.01,s=r*t.height*.01,c="left",l="top";if(1===t.skinIndex||3===t.skinIndex||4===t.skinIndex)s=a;if(1===t.isFixedPosition){if(k=t.position)var f=k.split("-");if("center"===f[1])n=5,i=.5*s,I=f[0]+":5px;top:50%;margin-top:-"+i+"px;",A=f[0]+":"+(a/2-16)+"px";else n=5,i=5+s,c=f[0],l=f[1],I=d(n,i,c,l),A=c+":"+(a/2-16)+"px"}else{var u=n+a/2;if(a+n>o)n=20,c="right";else if(u<.55*o)c="left";else n=o-n-a,c="right";if(s+i>r)i=s+20,l="bottom";else if(i>.5*r-.5*s)l="bottom",i=r-i;else i=1*t.marginTop+s;if(I=d(n,i,c,l),A=c+":"+(a/2-16)+"px;",u>.45*o&&u<.55*o)k="center",n+=.5*a,I=d(n,i,c,l),A="left:50%;margin-left:-16px"}}function p(e){e.stayTime=+e.stayTime,e.inviteInterval=+e.inviteInterval,e.closeTime=+e.closeTime}function _(e,t){e.logStopSmartInvite(t)}var exports={},h="",g="",b="",v="",y=0,w=require("../../mobilelite/lib/ajax"),S=require("../../mobilelite/lib/md5.min"),T=[],k="",x="",I="",E=0,M=-1,A=0;return exports.getExpGroupId=function(){return y},exports.hasShowInvite=0,exports.isFininshGetPoint=0,exports.ideaType=-1,exports.isHasSmartAccess=0,exports.isFinshGetSmartAccessWise=0,exports.isFinshGetShowTime=0,exports.abtestShowTimeObj={},exports.isShowInIconUp=!1,exports.isUseSmartyInvite=0,exports.setFinshAccessAndWise=function(e,t){exports.isFinshGetShowTime=1,exports.isFinshGetSmartAccessWise=1,e.renderMobileHtml()},exports.init=function(e,t,o){var r=e.getServer(),a=r.configBox,d=r.siteObj;p(a.inviteBox);var g;if(1!==a.inviteBox.smartBoxEnable||0===a.inviteBox.smartBoxOpen||0===a.inviteBox.autoInvite){if(1!==a.inviteBox.smartBoxEnable)g=3;else if(0===a.inviteBox.smartBoxOpen)g=4;else if(0===a.inviteBox.autoInvite)g=5;return _(t,g),exports.setFinshAccessAndWise(),!1}var b=c(a),y=l(a);if(b)m(a),exports.isShowInIconUp=f(a.seekIcon),exports.isShowRight=u(a.seekIcon),exports.isShowWithIcon=1;else if(y){if(exports.isShowWithToolbar=1,a.toolbar.bottomDistance<50)exports.isShowInIconUp=!0}else return g=6,_(t,g),exports.setFinshAccessAndWise(),!1;var w=i();v=n("link",h),s(o,t,w,v,a.inviteBox,d)},exports.getSmartInviteClass=function(){if(1===exports.isShowWithToolbar)return"nb-invite-wrap-smartInvite-"+E+"-"+M;else return"nb-invite-wrap-smartInvite-"+k},exports.hideInvite=function(e){exports.isHideInvite=1},exports.getSmartInviteText=function(e){if(T.length>0){var t=Math.floor(Math.random()*T.length);return T[t]}return"\u6b22\u8fce\u60a8\u6765\u54a8\u8be2"},exports.updateWelcomText=function(e,t,n,i,o){if(1===this.isUseSmartyInvite&&1===this.isHasSmartAccess){exports.hasShowInvite=1;var r=this.getSmartInviteText(i),a=r;if(-1!==a.indexOf('"')&&T.length>0){var s=a.match(/".*?"/)[0],c=a.split(s),l='<ins class="nb-invite-point">'+s+"</ins>";a=c[0]+l+c[1]}if(i.smartBaseSetting&&i.smartBaseSetting.welcome&&""!==exports.smartBackImg)a=i.smartBaseSetting.welcome.replace("\u60a8\u662f\u5426\u60f3\u54a8\u8be2\u5173\u4e8e“xxx”\u76f8\u5173\u7684\u5185\u5bb9\uff1f",a);x=r;var f=document.querySelector(".nb-smartInvite-text");if(f)f.innerHTML=a;if(n.smartInvite.text=r,0!==o.getServer("configBox").webim.isMobileWebim&&!t.isIos)r=r.replace(/"/g,'\\"');if(e.adata)e.adata.IntelligentInviteMsg=r;else e.adata={IntelligentInviteMsg:r}}},exports.getNowWelcomText=function(){return x},exports.getAdata=function(){return{IntelligentInviteMsg:x}},exports.getPosition=function(){return{invite:I,arrow:A}},exports}),define("embed/invite/mobile/inviteMMain",["require"],function(require){function e(e,n,i){clearTimeout(t);var o=0;if("show"===e){if(o=+n.closeTime,n.autoHide===i.ALLOWAUTOHIDE&&!isNaN(o)&&n.closeTime>=0)t=setTimeout(function(){exports.inviteWindowSwitch("off")},1e3*o)}else if("hide"===e)if(n.reInvite===i.ALLOWREINVITE&&"number"==typeof n.inviteInterval&&n.inviteInterval>=0)o=n.inviteInterval,t=setTimeout(function(){exports.inviteWindowSwitch("on")},1e3*o)}var t,n,exports={},i=!1;window.showOrdinaryInvite=function(){if(i)exports.delayToShow()};var o=function(e){if("string"!=typeof e)return"";var t=document.createElement("a");return t.href=e,t.hostname};return exports.delayToShow=function(e,t,n){var i=n.getServer("configBox").inviteBox,o=i.stayTime;if("number"!=typeof o||o<0)o=0;else o*=1e3;e.set(t.INVITECOOKIENAME,location.hostname,{path:"/"}),e.set(t.INVITESTARTPAGECOOKIE,location.href,{path:"/"}),setTimeout(function(){exports.inviteWindowSwitch("on")},o)},exports.inviteWindowGuard=function(e,t,r){var a=t.getServer("configBox").inviteBox;if(a.autoInvite===e.AUTOINVITEON){if(a.hasOwnProperty("maxInviteNum"))n=+a.maxInviteNum;if(+a.startPage===e.ALLPAGE)i=!0;if(+a.startPage===e.ONLYSTARTPAGE){var s=r.get(e.INVITESTARTPAGECOOKIE);if(!s)i=!0;else if(s===location.href)i=!0;else if(document.referrer){var c=o(document.referrer);if(c!==location.hostname)i=!0}else{var l=r.get(e.INVITECOOKIENAME);if(l){if(l!==location.hostname)i=!0}else i=!0}}}window.showOrdinaryInvite()},exports.inviteWindowSwitch=function(t,i,o,r,a,s){var c=o.getServer("configBox").inviteBox,l=i.WRAPID;if("on"===s){if(t.show([l]),a.logInviteShow(0,r.fromType),c.autoHide===i.ALLOWAUTOHIDE)e("show",c,i)}else if("off"===s){if(2!==r.fromType)c.hasOwnProperty("maxInviteNum")&&c.maxInviteNum&&n--,t.hide([l]);if(c.reInvite===i.ALLOWREINVITE&&c.autoInvite===i.AUTOINVITEON&&(!c.hasOwnProperty("maxInviteNum")||c.maxInviteNum&&n>0))e("hide",c,i)}},exports.showInvite=function(e,t,n){n.timeKey=setTimeout(function(){t.show("nb_invite_wrap")},e.SHOWINTERVAL)},exports.process=function(){},exports.renderHTML=function(e,t,n,i,o){var r=t.getWrap(),a=n.getInviteStyle(),s=o.template(i,a);e.appendHTML(s,r)},exports.init=function(e){exports.renderHTML(),e.init()},exports}),define("embed/invite/mobile/inviteMobileHandler",["require"],function(require){var exports={};return exports.acceptInvite=function(e,t,n,i,o){if(n.logClickInvite(i.fromType),e.accept(1),o&&1===o);else t.inviteWindowSwitch("off")},exports.refuseInvite=function(e,t,n){if(2===e.fromType)t.refuse();n.inviteWindowSwitch("off")},exports.getClickEle=function(e){return[e.PREFIXID+"ok",e.PREFIXIDSMART+"ok"]},exports.process=function(e){e.inviteWindowGuard()},exports}),define("embed/invite/mobile/inviteMobile.tpl",[],function(){return'\x3c!-- target: invitebox --\x3e<% if (data.hasOwnProperty(\'customerStylePro\') && +data.customerStylePro.isInviteFixed === 0) { %><% if (data.isCustomerStyle) { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom" id="nb_invite_wrap" style="height:<%heightPx%>px;width:<%width%>%;display:none;background-image:url(<%backImg%>);left:<%customerStylePro.inviteLeft%>px;top:<%customerStylePro.inviteTop%>px;"><% } else { %><% if (data.hasOwnProperty(\'skinBgColor\')) { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%>" id="nb_invite_wrap" style="height:<%heightPx%>px;width:<%width%>%;display:none;left:<%customerStylePro.inviteLeft%>px;top:<%customerStylePro.inviteTop%>px;background-color:<%skinBgColor%>"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%>" id="nb_invite_wrap" style="height:<%heightPx%>px;width:<%width%>%;display:none;left:<%customerStylePro.inviteLeft%>px;top:<%customerStylePro.inviteTop%>px;"><% } %><% } %><% } else { %><% if (data.isCustomerStyle) { %><% if (data.position === \'middle\') { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;height:<%heightPx%>px;width:<%width%>%;display:none;background-image:url(<%backImg%>)"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;height:<%heightPx%>px;width:<%width%>%;display:none;background-image:url(<%backImg%>)"><% } %><% } else { %><% if (data.position === \'middle\') { %><% if (data.hasOwnProperty(\'skinBgColor\')) { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;height:<%heightPx%>px;width:<%width%>%;display:none;background-color:<%skinBgColor%>"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;height:<%heightPx%>px;width:<%width%>%;display:none;"><% } %><% } else { %><% if (data.hasOwnProperty(\'skinBgColor\')) { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;height:<%heightPx%>px;width:<%width%>%;display:none;background-color:<%skinBgColor%>"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;height:<%heightPx%>px;width:<%width%>%;display:none;"><% } %><% } %><% } %><% } %>\x3c!-- // = 3 \u4e3a\u9ad8\u7ea7\u5b9a\u5236 --\x3e<% if (+data.isCustomerStyle === 3) {%><% if (+data.customerStylePro.isShowCloseBtn === 1) {%><ins class="blank-talk-style" id="nb_invite_tool" style="width:<%customerStylePro.closeBtnStyle.width%>;height:<%customerStylePro.closeBtnStyle.height%>;position: absolute;top:<%customerStylePro.closeBtnStyle.y%>;left:<%customerStylePro.closeBtnStyle.x%>;z-index:1;"></ins><% } %><% if (+data.customerStylePro.isShowLaterBtn === 1) {%><ins class="blank-talk-style" id="nb_invite_cancel"style="width:<%customerStylePro.laterBtnStyle.width%>;height:<%customerStylePro.laterBtnStyle.height%>;position: absolute;top:<%customerStylePro.laterBtnStyle.y%>;left:<%customerStylePro.laterBtnStyle.x%>;z-index:2;"></ins><% } %><% if (+data.customerStylePro.isShowConsultBtn === 1) {%><ins class="blank-talk-style" id="nb_invite_ok" style="width:<%customerStylePro.consultBtnStyle.width%>;height:<%customerStylePro.consultBtnStyle.height%>;position: absolute;top:<%customerStylePro.consultBtnStyle.y%>;left:<%customerStylePro.consultBtnStyle.x%>;z-index:3;"></ins><% } %><% } else { %><ins class="nb-invite-tool-base nb-invite-tool" id="nb_invite_tool">×</ins><ins class="nb-invite-body-base nb-invite-body"><ins class="nb-invite-welcom <%isShowText%>"><%welcome%></ins><ins class="nb-invite-btns"><% if (data.isCustomerStyle) { %><% if (data.customerStyle.hasOwnProperty(\'confirmBtnText\')) { %><ins class="nb-invite-ok" id="nb_invite_ok" style="background-color:<%customerStyle.acceptBgColor%>;color:<%customerStyle.acceptFontColor%>"><%customerStyle.confirmBtnText%></ins><% } else { %><ins class="nb-invite-ok" id="nb_invite_ok" style="background-color:<%customerStyle.acceptBgColor%>;color:<%customerStyle.acceptFontColor%>">\u54a8\u8be2\u8be6\u60c5</ins><% } %><% } else { %><% if (data.customerStyle.hasOwnProperty(\'confirmBtnText\')) { %><ins class="nb-invite-ok" id="nb_invite_ok" style="color:<%customerStyle.acceptFontColor%>"><%customerStyle.confirmBtnText%></ins><% } else { %><ins class="nb-invite-ok" id="nb_invite_ok">\u54a8\u8be2\u8be6\u60c5</ins><% } %><% } %><% if (data.customerStyle.hasOwnProperty(\'cancelBtnText\')) { %><ins class="nb-invite-no" id="nb_invite_cancel"><%customerStyle.cancelBtnText%></ins><% } else { %><ins class="nb-invite-no" id="nb_invite_cancel">\u7a0d\u540e\u518d\u8bf4</ins><% } %></ins></ins><% } %></ins>\x3c!-- end --\x3e'}),define("embed/invite/mobile/inviteMobileData",["require"],function(require){var exports={};return exports.dataProcess=function(e,t,n){var i=t.extend({},n);if(n.hasOwnProperty("customerStylePro")&&0===n.customerStylePro.isInviteFixed){var o=parseInt(n.customerStylePro.inviteLeft,10),r=parseInt(n.customerStylePro.inviteTop,10);o=o>document.documentElement.clientWidth*(1-.01*n.width)?document.documentElement.clientWidth*(1-.01*n.width):o,o=o<0?0:o,r=r>document.documentElement.clientHeight*(1-.01*n.height)?document.documentElement.clientHeight*(1-.01*n.height):r,r=r<0?0:r,i.customerStylePro.inviteLeft=o,i.customerStylePro.inviteTop=r}if(n.isCustomerStyle)i.inviteClass="nb-invite-custom";else i.inviteClass=e.SKINPRE+n.skinIndex;if(3===i.isCustomerStyle)i.backImg=i.customerStylePro.bgImgUrl;else if(i.customerStyle&&i.customerStyle.backImg)i.backImg=i.customerStyle.backImg;if(i.isShowText=["nb-hide","nb-show"][+n.isShowText],i.heightPx=.01*window.innerHeight*i.height,i.heightPxAbtext=.01*window.innerHeight*20,!i.isCustomWidth&&"bottom"===i.position)i.width=100;return i},exports}),define("embed/invite/mobile/inviteMobileConsts",[],function(){return{SHOWINTERVAL:2e3,AUTOINVITEON:1,AUTOINVITEOFF:0,ONLYSTARTPAGE:0,ALLPAGE:1,ALLOWREINVITE:1,DENYREINVITE:0,ALLOWAUTOHIDE:1,DENYAUTOHIDE:0,INVITECOOKIENAME:"nb-referrer-hostname",INVITESTARTPAGECOOKIE:"nb-start-page-url",PREFIXID:"nb_invite_",PREFIXIDSMART:"nb_invite_smart_",WRAPID:"nb_invite_wrap",WRAPIDSMART:"nb_invite_smart_wrap",SKINPRE:"nb-invite-wrap-"}}),define("embed/invite/inviteMConfig",["require","./inviteMain","./inviteData","./inviteHandler","./mobile/smartyInvite","./mobile/inviteMMain","./mobile/inviteMobileHandler","./mobile/inviteMobile.tpl","./mobile/inviteMobileData","./mobile/inviteMobileConsts"],function(require){return{package:"minvite",resource:{main:require("./inviteMain"),data:require("./inviteData"),handler:require("./inviteHandler"),smartyInvite:require("./mobile/smartyInvite"),mmain:require("./mobile/inviteMMain"),mhandler:require("./mobile/inviteMobileHandler"),tpl:require("./mobile/inviteMobile.tpl"),mdata:require("./mobile/inviteMobileData"),consts:require("./mobile/inviteMobileConsts")},injection:[{id:"minvite.main",method:{init:["minvite.handler"],renderHtml:["mbase.dom","common.view","minvite.data","common.util","minvite.tpl","minvite.mmain"],setSmartChat:["core.config","minvite.mhandler"],getServerConfig:["data.config"]}},{id:"minvite.data",method:{getInviteStyle:["data.config","minvite.mdata"]}},{id:"minvite.handler",method:{bindEvent:["mbase.events","minvite.consts","minvite.mhandler"]}},{id:"minvite.mmain",method:{init:["minvite.mhandler"],renderHTML:["mbase.dom","common.view","minvite.mdata","minvite.tpl","common.util"],showInvite:["minvite.mdata","mbase.dom"],inviteWindowGuard:["minvite.consts","data.config","common.cookie"],delayToShow:["common.cookie","minvite.consts","data.config"],inviteWindowSwitch:["mbase.dom","minvite.consts","data.config","core.config","log.main"]}},{id:"minvite.mdata",method:{dataProcess:["minvite.consts","mbase.lib"]}},{id:"minvite.mhandler",method:{bindEvent:["mbase.events","minvite.mhandler","minvite.consts","minvite.mmain"],acceptInvite:["mchat.chat","minvite.mmain","log.main","core.config"],refuseInvite:["core.config","mchat.chat","minvite.mmain"],getClickEle:["minvite.consts"],process:["minvite.mmain"]}}],aspect:[{id:"minvite.main",pointCut:["micon.main.init, , init"]}]}}),define("common/popover/index",["require"],function(require){var exports={},e={close:"popover__close"},t=function(t,n,i,o){this._blockCloseOnClickModal=o.blockCloseOnClickModal||!1,this._showClose=o.showClose||!1;var r=this;return this.initEvent=function(){t.onclick=function(){if((document.querySelectorAll(".newBridge-popover-outer")||[]).forEach(function(e){e.classList.add("newBridge-popover-hide")}),r.getShowPopper())r.setShowPopper(!1);else r.setShowPopper(!0);o.clickExtra&&o.clickExtra()},r._bgDiv.onclick=function(){if(!r._blockCloseOnClickModal)r.doClose()}},this.createBackground=function(){if(r._bgDiv=document.createElement("div"),r._bgDiv.className="newBridge-popover-bg",r._showClose)r.appendCloseIcon();n.appendChild(r._bgDiv),document.body.appendChild(n)},this.appendCloseIcon=function(){var t=document.createElement("i");t.className=e.close,t.addEventListener("click",function(){r.doClose(!0)}),i.appendChild(t)},this.doClose=function(e){if(e&&o.onClose)o.onClose();r.setShowPopper(!1)},this.setShowPopper=function(e){if(e)n.classList.remove("newBridge-popover-hide");else n.classList.add("newBridge-popover-hide")},this.getShowPopper=function(){if(n.classList.contains("newBridge-popover-hide"))return!1;else return!0},this.createBackground(),this.initEvent(),this};return exports.Popover=t,exports}),define("lib/popover/index",["common/popover/index"],function(e){return e}),define("embed/comp/mobile/compMMain",["require","../../../common/popover/index"],function(require){var exports={},e=require("../../../common/popover/index"),t="-1";return exports.renderHtml=function(e,t,n,i,o){var r=e.getTplData();if(r.mobileComps&&!r.mobileCompsOrigin)r.mobileCompsOrigin=JSON.parse(JSON.stringify(r.mobileComps)),r.mobileComps=r.mobileComps.reverse();var a=n.template(t,r);i.appendHTML(a,o.getWrap())},exports.isShowComp=function(e){var t=e.getServer("configBox").components||{};return t&&t.mobileComps&&t.mobileComps.length>0},exports.initPopper=function(n){var i=n.getTplData(),o=i.mobileComps||[],r=i.mobileBackgroundColor||"#4E6EF2",a=i.mobileIconColor||"#FFFFFF";o.forEach(function(n,i){if(1===n.compType){var s=document.querySelector("#nb_comp_im_icon_"+n.seq),c=document.querySelector("#nb_comp_im_icon_"+n.seq+"_img");if(s&&i===o.length-1)if(c.style.display="none",s.style.height="3.75em",s.style.fontSize="1em",s.style.transform="scale(1)",s.style.justifyContent="center",s.style.backgroundColor=r,s.style.color=a,3===o.length)s.style.flex=2}if(2===n.compType){var l=document.querySelector("#nb_comp_phone_icon_"+n.seq),f=document.querySelector("#nb_comp_phone_icon_"+n.seq+"_img");if(l&&i===o.length-1)if(f.style.display="none",l.style.height="60px",l.style.fontSize="16px",l.style.transform="scale(1)",l.style.justifyContent="center",l.style.backgroundColor=r,l.style.color=a,3===o.length)l.style.flex=2;var u=document.querySelector("#nb_comp_phone_popper_outer_"+n.seq),d=document.querySelector("#nb_comp_phone_wraper_"+n.seq);if(l&&u)u.popperInstance=new e.Popover(l,u,d,{clickExtra:function(){window.sensors&&window.sensors.track("site_component_client_mobile_click",{button_name:"\u7535\u8bdd",site_id:t})}})}if(3===n.compType){var m=document.querySelector("#nb_comp_form_icon_"+n.seq),p=document.querySelector("#nb_comp_form_icon_"+n.seq+"_img");if(m&&i===o.length-1)if(p.style.display="none",m.style.height="60px",m.style.fontSize="16px",m.style.transform="scale(1)",m.style.justifyContent="center",m.style.backgroundColor=r,m.style.color=a,3===o.length)m.style.flex=2;var _=document.querySelector("#nb_comp_form_popper_outer_"+n.seq),h=document.querySelector("#nb_comp_form_wraper_"+n.seq),g=document.querySelector("#nb_comp_form_popper_"+n.seq),b=document.querySelector("#nb_comp_form_dialog_"+n.seq);if(m&&_)_.popperInstance=new e.Popover(m,_,h,{showClose:!0,blockCloseOnClickModal:!0,onClose:function(){var e=g.formInstance||null;g.classList.remove("hide"),b.classList.add("hide"),e&&e.reset()},clickExtra:function(){window.sensors&&window.sensors.track("site_component_client_mobile_click",{button_name:"\u8868\u5355",site_id:t})}})}})},exports.initAiCode=function(){var e=document.createElement("script");e.id="mkdScript",e.type="text/javascript",e.src="https://wappass.baidu.com/static/machine/js/api/mkd.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},exports.init=function(e,n){if(exports.isShowComp(n)){var i=n.getServer("siteConfig")||{};if(i&&i.siteObj)t=i.siteObj.siteId;exports.renderHtml(),exports.initPopper(),exports.initAiCode(),e.init()}},exports}),define("embed/comp/mobile/compMHandler",["require","../../mobilelite/lib/ajax"],function(require){var e=require("../../mobilelite/lib/ajax"),exports={},t=void 0;return exports.handleAccept=function(e,n){window.sensors&&window.sensors.track("site_component_client_mobile_click",{button_name:"\u6c9f\u901a\u5de5\u5177",site_id:t.siteid||"-1"}),e.clickIcon(n)},exports.bindEvent=function(e,n,i,o){var r=i.getTplData(),a=r.mobileComps||[],s=document.querySelectorAll("#nb_comp_btn .nb-comp-item-mobile")||[];s=Array.prototype.slice.call(s,0),a.forEach(function(t){if(1===t.compType)e.domOn("nb_comp_im_icon_"+t.seq,"click",exports.handleAccept,!1);if(3===t.compType){var i=exports.genValidators(t);new n.Bform({el:"nb_comp_form_popper_"+t.seq,validators:i,onSuccess:function(e){var n={};for(var i in e)if(i.indexOf("dynamic")>=0&&i.indexOf("_")>=0)n[i]=e[i],delete e[i];e.extFields=n,e.bid=o.bid||"",e.orgId=o.eid||"",exports.aiCode(t,e)},onError:function(e){console.log(e,"\u6821\u9a8c\u5931\u8d25")},onReset:function(){var e=document.querySelector("#nb_comp_form_popper_outer_"+t.seq);e.popperInstance&&e.popperInstance.doClose()}})}}),t=o},exports.reloadAiCodeScript=function(e){var t=document.getElementById("mkdScript")||null;t&&t.parentNode.removeChild(t),window.PassMachine&&(window.PassMachine.mkd=null);var n=document.createElement("script");n.type="text/javascript",n.id="mkdScript",n.src="https://wappass.baidu.com/static/machine/js/api/mkd.js?d="+Date.now(),n.onload=n.onreadystatechange=function(){e&&e()};var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(n,i)},exports.aiCode=function(e,t){exports.reloadAiCodeScript(function(){window.thirdVerifyCode=null,window.PassMachine&&(window.PassMachine.haveMkd=null);var n="nb_comp_form_aicode_"+e.seq,i="nb_comp_form_wraper_"+e.seq,o=document.getElementById(i);if(window.PassMachine&&window.PassMachine.mkd){var r=window.PassMachine.mkd;window.thirdVerifyCode=new r({type:"slide",maskModule:!1,id:n,ak:"5509ba02827e33313d5802a9b902fd5e",spinConfig:{headTitle:"\u5b89\u5168\u9a8c\u8bc1",conTitle:"\u62d6\u52a8\u6ed1\u5757, \u4f7f\u56fe\u7247\u89d2\u5ea6\u4e3a\u6b63",color:"#4d4d4d"},slideConfig:{headTitle:"\u5b89\u5168\u9a8c\u8bc1",conTitle:"\u6ed1\u81f3\u6700\u53f3",bottomTitle:"\u4e3a\u4e86\u4f60\u7684\u5e10\u53f7\u5b89\u5168\uff0c\u672c\u6b21\u64cd\u4f5c\u9700\u8981\u8fdb\u884c\u5b89\u5168\u9a8c\u8bc1",color:"#4d4d4d",finishTitle:"\u6ed1\u52a8\u6210\u529f"},verifySuccessFn:function(n){t.ds=n.ds||"",t.tk=n.tk||"",exports.handleSubmit(t,e.seq)},closeFn:function(){console.log("\u6211\u5173\u95ed\u4e86\u6ed1\u5757\u9a8c\u8bc1\u7801")},initApiSuccessFn:function(){window.thirdVerifyCode.initVcode({},function(){setTimeout(function(){var e=o.clientHeight;window.thirdVerifyCode.odiv.style.borderRadius="20px 20px 0 0",window.thirdVerifyCode.odiv.style.height=e+"px",window.thirdVerifyCode.odiv.scrollTop=e},0)})}})}})},exports.handleSubmit=function(t,n){var i={params:JSON.stringify(t)},o={data:i,type:"jsonp",timeout:5e3,onsuccess:function(e){var t="";if(0==+e.code)exports.showFormDialog({formId:n});else t=e.msg||"",exports.showFormDialog({formId:n,type:"error",title:t});exports.hideAiCode()},onfail:function(e){console.log(e),exports.showFormDialog({formId:n,type:"error"}),exports.hideAiCode()}};e.ajax("https://aifanfan.baidu.com/crm/http/generic/affselfbuildsite/saveform",o),document.querySelectorAll("#nb_comp_form_popper_"+n+" .nb-comp-form-btn").forEach(function(e){e.setAttribute("disabled","disabled")})},exports.showFormDialog=function(e){var t=0===e.formId?e.formId:e.formId||"",n=e.type||"success",i=document.querySelector("#nb_comp_form_popper_outer_"+t),o=document.querySelector("#nb_comp_form_wraper_"+t);if(!o.style.height)o.style.height=o.offsetHeight-80+"px";var r=document.querySelector("#nb_comp_form_popper_"+t),a=r.formInstance||null,s=document.querySelector("#nb_comp_form_dialog_"+t),c=document.querySelector("#nb_comp_form_dialog_title_"+t),l=document.querySelector("#nb_comp_form_dialog_subtitle_"+t);if(!s.style.height){var f=(o.offsetHeight-100-48-l.offsetHeight)/2;s.style.height=(r.offsetHeight<180?180:r.offsetHeight)+100+"px",l.style.top=f+"px",s.style.backgroundPosition="center "+f+"px"}var u=document.querySelector("#nb_comp_dialog_btn_submit_"+t),d=document.querySelector("#nb_comp_dialog_btn_reset_"+t),m=document.querySelectorAll("#nb_comp_form_popper_"+t+" .nb-comp-form-btn-mobile");if("success"===n)u.classList.add("hide"),d.classList.remove("hide"),c.innerText=e.title||"\u63d0\u4ea4\u6210\u529f!",l.innerText=e.subTitle||"\u6211\u4eec\u5df2\u7ecf\u6536\u5230\u60a8\u63d0\u4ea4\u7684\u4fe1\u606f\uff0c\u76f8\u5173\u987e\u95ee\u4f1a\u5c3d\u5feb\u4e0e\u60a8\u7535\u8bdd\u8054\u7cfb\u3002",s.classList.remove("error"),s.classList.add("success");else u.classList.remove("hide"),d.classList.add("hide"),c.innerText=e.title||"\u63d0\u4ea4\u5931\u8d25!",l.innerText=e.subTitle||"\u62b1\u6b49\uff0c\u60a8\u7684\u4fe1\u606f\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u518d\u6b21\u63d0\u4ea4\u3002",s.classList.add("error");m.forEach(function(e){e.removeAttribute("disabled")}),r.classList.add("hide"),s.classList.remove("hide"),u.onclick=function(){window.thirdVerifyCode=null,window.PassMachine&&(window.PassMachine.haveMkd=null),a&&a.submit()},d.onclick=function(){r.classList.remove("hide"),s.classList.add("hide"),a&&a.reset(),i.popperInstance&&i.popperInstance.doClose()}},exports.hideAiCode=function(){var e=window.thirdVerifyCode||{};if(e.odiv)e.odiv.parentNode.removeChild(e.odiv)},exports.genValidators=function(e){var t={mobilePhone:"mobilePhone",companyPhone:"phone",telephone:"telephone"},n={};return(e.fieldSetting||[]).forEach(function(e){var i=n[e.fieldName]||{};if(e.required)i.required=!0;if(e.maxLength)i.maxLength=+e.maxLength;if(e.minLength)i.minLength=+e.minLength;if(e.rules&&e.rules.length)i.rules=e.rules;if(t[e.fieldName])i.type=t[e.fieldName];if(i.fieldType=e.fieldType,i.label=e.displayName,i.placeholder=e.placeholder,i.seq=+e.seq,"Select"===e.fieldType||"Multiselect"===e.fieldType)i.options=e.options;n[e.fieldName]=i}),n},exports.log=function(t){var n={type:"jsonp",data:{eventKey:t,pageId:"pc_10188",env:"WEB",sourceId:"aff",time:(new Date).getTime()}};e.ajax("https://aifanfan.baidu.com/s.gif",n)},exports.init=function(){exports.bindEvent()},exports}),define("embed/comp/mobile/compMobile.tpl",[],function(){return'\x3c!-- target: mobileComp --\x3e<div class="nb-comp-base-mobile" id="nb_comp_btn"><% for(var i = 0, l = data.mobileComps.length; i < l; i++) {var comp = data.comp = data.mobileComps[i]; %><% if (comp.compType == 1) { %><div id="nb_comp_im_icon_<%comp.seq%>" class="nb-comp-item-mobile"><i id="nb_comp_im_icon_<%comp.seq%>_img" class="nb-comp-item-im-mobile"></i><%comp.iconName%></div><% } %><% if (comp.compType == 2) { %><div id="nb_comp_phone_icon_<%comp.seq%>" class="nb-comp-item-mobile"><i id="nb_comp_phone_icon_<%comp.seq%>_img" class="nb-comp-item-phone-mobile"></i><%comp.iconName%></div><% } %><% if (comp.compType == 3) { %><div id="nb_comp_form_icon_<%comp.seq%>" class="nb-comp-item-mobile"><i id="nb_comp_form_icon_<%comp.seq%>_img" class="nb-comp-item-form-mobile"></i><%comp.iconName%></div><% } %><% } %></div><% for(var i = 0, l = data.mobileComps.length; i < l; i++) {var comp = data.comp = data.mobileComps[i]; %><% if (comp.compType == 2) { %><div id="nb_comp_phone_popper_outer_<%comp.seq%>" class="newBridge-popover-outer newBridge-popover-hide"><div id="nb_comp_phone_popper_<%comp.seq%>" class="new-bridge nb-comp-popper-mobile phone"><div class="nb-comp-phone-wrapper-mobile"><% for (var j = 0; j < comp.renderPhoneList.length; j++){%><div class="nb-comp-phone-mobile"><a href="tel:<%comp.phoneList[j].number%>"><%comp.renderPhoneList[j]%></a></div><% } %></div></div></div><% } %><% if (comp.compType == 3) { %><div id="nb_comp_form_popper_outer_<%comp.seq%>" class="newBridge-popover-outer newBridge-popover-hide"><div id="nb_comp_form_wraper_<%comp.seq%>" class="new-bridge nb-comp-popper-mobile form"><form id="nb_comp_form_popper_<%comp.seq%>" autocomplete="off" action accept-charset="utf-8" style="box-sizing: content-box;"><div class="nb-comp-form-header-mobile"><p class="nb-comp-form-title-mobile"><%comp.title%></p><% if (comp.desc) { %><p class="nb-comp-form-desc-mobile"><%comp.desc%></p><% } %></div><div class="nb-comp-form-content-mobile"><% for (var k = 0; k < comp.fieldSetting.length; k++){%><% if (comp.fieldSetting[k].fieldType == "Singleline" || comp.fieldSetting[k].fieldType == "Phone" || comp.fieldSetting[k].fieldType == "Multiline" || comp.fieldSetting[k].fieldType == "Suggest") { %><div class="nb-comp-form-item-wrapper"><label class="nb-comp-form-label"><%comp.fieldSetting[k].displayName%></label><input class="nb-comp-form-input" type="text" label="<%comp.fieldSetting[k].displayName%>" name="<%comp.fieldSetting[k].fieldName%>" placeholder="<%comp.fieldSetting[k].placeholder%>"/></div><%}%><% } %></div><div class="nb-comp-form-footer-mobile"><button class="nb-comp-form-btn-mobile submit"><%comp.submitBtnName%></button></div></form><div id="nb_comp_form_dialog_<%comp.seq%>" class="nb-comp-form-dialog-mobile hide"><div id="nb_comp_form_dialog_title_<%comp.seq%>" class="nb-comp-form-dialog-mobile-title">\u63d0\u4ea4\u6210\u529f</div><p id="nb_comp_form_dialog_subtitle_<%comp.seq%>" class="nb-comp-form-dialog-mobile-subtitle">\u6211\u4eec\u5df2\u7ecf\u6536\u5230\u60a8\u63d0\u4ea4\u7684\u4fe1\u606f\uff0c\u76f8\u5173\u987e\u95ee\u4f1a\u5c3d\u5feb\u4e0e\u60a8\u7535\u8bdd\u8054\u7cfb\u3002</p><div class="nb-comp-form-footer-mobile"><button id="nb_comp_dialog_btn_reset_<%comp.seq%>" class="nb-comp-form-dialog-btn-mobile submit">\u6211\u77e5\u9053\u4e86</button><button id="nb_comp_dialog_btn_submit_<%comp.seq%>" class="nb-comp-form-dialog-btn-mobile submit">\u518d\u6b21\u63d0\u4ea4</button></div></div><div id="nb_comp_form_aicode_<%comp.seq%>" class="nb-comp-form-aicode"></div></div></div><% } %><% } %>\x3c!-- end --\x3e'}),define("embed/comp/mobile/compDataForMobile",["require"],function(require){function e(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.activate){if(2===i.compType)i.renderPhoneList=t(i)}else e.splice(n,1),n--}}function t(e){for(var t=e.phoneList||[],n=[],i=0;i<t.length;i++){var o=t[i]||{};if(o.number)if(o.desc)n.push(o.desc+"\uff1a"+o.number);else n.push(o.number)}return n}var exports={};return exports.getTplData=function(t,n){var i=t.getServer("configBox").components,o=n.dataProcess(i);return e(o.mobileComps||[]),o},exports}),define("embed/comp/mobile/compMData",["require"],function(require){var exports={};return exports.dataProcess=function(e,t){return e.extend({},t)},exports}),define("embed/comp/compMConfig",["require","./mobile/compMMain","./mobile/compMHandler","./mobile/compMobile.tpl","./mobile/compDataForMobile","./mobile/compMData"],function(require){return{package:"mcomp",resource:{main:require("./mobile/compMMain"),handler:require("./mobile/compMHandler"),tpl:require("./mobile/compMobile.tpl"),data:require("./mobile/compDataForMobile"),mdata:require("./mobile/compMData")},injection:[{id:"mcomp.handler",method:{bindEvent:["mbase.events","mbase.form","mcomp.data","core.config"],handleAccept:["micon.phandler"]}},{id:"mcomp.main",method:{init:["mcomp.handler","data.config"],renderHtml:["mcomp.data","mcomp.tpl","common.util","mbase.dom","common.view"],initPopper:["mcomp.data"]}},{id:"mcomp.data",method:{getTplData:["data.config","mcomp.mdata"]}},{id:"mcomp.mdata",method:{dataProcess:["mbase.lib"]}}]}}),define("embed/icon/iconMain",["require","../mobilelite/lib/ajax"],function(require){var exports={},e=require("../mobilelite/lib/ajax");return exports.renderHtml=function(e,t,n,i,o,r,a){var s=e.getIconTplData();if("picon.data"===e._belong)if(s.hasOwnProperty("barrageIssue"))if(!s.hasOwnProperty("iconWidth")||!s.customerStyle.hasOwnProperty("rate")){if(1==+s.isCustomerStyle){var c=new Image;c.src=s.customerStyle.backImg,c.onload=function(){var e=c.width>500?500:c.width;if("group"===s.iconType)e=s.groupWidth+16;else e=s.customerStyle.iconWidth;var t=c.width/c.height,n=e/t,i=document.getElementById("nb_icon_wrap");if("group"!==s.iconType)i.style.height=n+"px";if(i.style.width=e+"px","group"===s.iconType&&!s.groupIconHeight){document.querySelector(".pc-group-newStyle-backimg").style.height=Math.ceil((s.groupWidth+16)/t)+"px"}var o=document.getElementById("nb_icon_inner_wrap");if(o)o.style.height=n+"px",o.style.width=e+"px"}}var l=n.template(t,s);i.appendHTML(l,o.getWrap())}else{var l=n.template(t,s);i.appendHTML(l,o.getWrap())}else{var l=n.template(t,s);i.appendHTML(l,o.getWrap())}else{var l=n.template(t,s);i.appendHTML(l,o.getWrap())}r.componentIsShow.icon=1},exports.init=function(t,n,i){n.getServer("configBox").seekIcon;if(!i.isShowComp(n)){exports.renderHtml(),t.init();var o=(new Date).getTime()-window.speedLogTime,r={type:"jsonp",data:{type:1,duration:o,logId:window.speedLogId,userId:n.getServer("siteObj").eid,sourceId:"AFFSpeed",time:(new Date).getTime()}};e.ajax("https://aifanfan.baidu.com/p.gif",r)}},exports}),define("embed/icon/iconHandler",["require"],function(require){var exports={};return exports.handleAccept=function(e,t){var n=["issue-item","issue-text","issue-icon"],i=!1;if(n.forEach(function(e){if(t.target.className.indexOf(e)>-1)i=!0}),!i)e.clickIcon("",t);else if(t.target.className.indexOf("issue-item")>-1){var o=t.target.querySelector(".issue-text");if(o.getAttribute&&o.getAttribute("data-key"))e.clickIcon(o);else e.clickIcon(o.innerText)}else{var o=t.target.parentElement.querySelector(".issue-text");if(o.getAttribute&&o.getAttribute("data-key"))e.clickIcon(o);else e.clickIcon(o.innerText)}},exports.bindEvent=function(e,t){e.domOn("nb_icon_wrap","click",exports.handleAccept,!1),t.bindEvent()},exports.init=function(){exports.bindEvent()},exports}),define("embed/icon/iconData",["require"],function(require){var exports={};return exports.getIconTplData=function(e,t){var n=e.getServer("configBox").seekIcon,i=e.getServer("configBox").webimConfig,o=t.dataProcess(n);if(1==+n.isCustomerStyle)o.backImg="background-image: url("+o.customerStyle.backImg+");";if(i)o.webImData=i;return o},exports}),define("embed/icon/mobile/iconMobileData",["require"],function(require){function e(e,t,n,i,o){var r={};switch(e){case"flag":var a=0;if("right-center"===t||"left-center"===t)a=i-Math.ceil(i/2);else a=i;if(o.isBDBox)a-=1;r.flagPosition="margin-top:"+a+"px",r.borderLeftWidth=Math.ceil(n/2)+"vw",r.borderRightWidth=n-parseInt(r.borderLeftWidth,10)+"vw";break;default:r={}}return r}function t(e){var t=+e.width,n=(e.height,+e.marginTop),i=+e.marginLeft,o=document.documentElement.clientWidth,r=document.documentElement.clientHeight;if(e.hasOwnProperty("autoConsult"))if(!e.isCustomerStyle)e.height=o*(.01*t);else if(e.customerStyle.hasOwnProperty("rate"))e.width=e.customerStyle.width,e.height=Math.ceil(o*(.01*e.customerStyle.width)/e.customerStyle.rate);else{var a=new Image;a.src=e.customerStyle.backImg,a.onload=function(){var t=a.width/a.height;if(!e.hasOwnProperty("width"))e.width=18;e.height=Math.ceil(o*(.01*e.width)/t);var n=document.getElementById("nb_icon_wrap");if(n)n.style.height=e.height+"px"}}else if(1===e.skinIndex||3===e.skinIndex||4===e.skinIndex){var s=t*o*.01;e.height=s,e.width=s}if(.01*e.width*o+i>o)e.horizontalAttr="right",e.horizontalPixel=0,e.marginLeft=o-e.width;else e.horizontalAttr="left",e.horizontalPixel=i;if(e.height+n>r)e.verticalAttr="bottom",e.verticalPixel=0,e.marginTop=r-e.width;else e.verticalAttr="top",e.verticalPixel=n;var c=window.innerWidth*(1-.01*t)-i;e.marginRight=c,e.leftOrRight=c<i?"right":"left"}var exports={};return exports.dataProcess=function(n,i,o){var r=n.extend({},o),a=["","circle","flag","sector","circle","flag"][o.skinIndex];return r.shape=e(a,o.position,o.width,o.height,i),t(r),r},exports}),define("embed/icon/mobile/iconMobile.tpl",[],function(){return'\x3c!-- target: iconicon --\x3e<% if (data.isFixedPosition == 1) { %><% if (data.skinIndex == 1 || data.skinIndex == 3 || data.skinIndex == 4) { %><% if (data.hasOwnProperty("barrageIconColorType")) { %><% if (data.hasOwnProperty("autoConsult")) { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-<%autoConsult%> nb-icon-<%position%> nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;"><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-1 nb-icon-<%position%> nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;"><% } %><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-<%position%> nb-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;"><% } %><% } else { %><% if (data.hasOwnProperty("barrageIconColorType")) { %><% if (data.hasOwnProperty("autoConsult")) { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-<%autoConsult%> nb-icon-<%position%> nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;"><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-1 nb-icon-<%position%> nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;"><% } %><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-<%position%> nb-icon-wrap-<%skinIndex%>" style="height:<%height%>%;width:<%width%>%;"><% } %><% } %><% if (data.isCustomerStyle == 1) { %><ins class="nb-icon-wrap-base nb-icon-customer" style="background-image:url(<%customerStyle.backImg%>); box-shadow: 0 0 0 0;"></ins><% }else { %><ins class="nb-icon-wrap-base nb-icon-wrap-<%skinIndex%>-<%position%>"></ins><% if ((data.skinIndex == 2 || data.skinIndex == 5) && !data.hasOwnProperty("barrageIconColorType")) { %><ins style="border-left-width: <%shape.borderLeftWidth%>;border-right-width: <%shape.borderRightWidth%>;" class="nb-icon-flag nb-icon-flag-<%skinIndex%>"></ins><% } %><% } %><div class="issueMarquee-<%barrageSwitch%>" id="issueMarquee"><div class="issue-box" id="issueBox"><% if (data.hasOwnProperty("hotIssues")) { %><% for (var j = 0; j < (data.hotIssues || []).length; j++){ %><% if (data.hotIssues[j].question) { %><p class="issue-item issue-item-<%barrageColor%>"><span class="issue-icon" style="background-color:<%barrageIconColor%>"></span><span class="issue-text" data-key="<%hotIssues[j].id%>"><%hotIssues[j].question%></span></p><% } %><% } %><% } else { %><% for (var j = 0; j < (data.barrageIssue || []).length; j++){ %><p class="issue-item issue-item-<%barrageColor%>"><span class="issue-icon" style="background-color:<%barrageIconColor%>"></span><span class="issue-text"><%barrageIssue[j]%></span></p><% } %><% } %></div></div></ins><% } else { %><% if (data.skinIndex == 1 || data.skinIndex == 3 || data.skinIndex == 4) { %><% if (data.hasOwnProperty("barrageIconColorType")) { %><% if (data.hasOwnProperty("autoConsult")) { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-<%autoConsult%> nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;<%horizontalAttr%>:<%horizontalPixel%>px;<%verticalAttr%>:<%verticalPixel%>px;"><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-1 nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;<%horizontalAttr%>:<%horizontalPixel%>px;<%verticalAttr%>:<%verticalPixel%>px;"><% } %><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;<%horizontalAttr%>:<%horizontalPixel%>px;<%verticalAttr%>:<%verticalPixel%>px;"><% } %><% } else { %><% if (data.hasOwnProperty("barrageIconColorType")) { %><% if (data.hasOwnProperty("autoConsult")) { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-<%autoConsult%> nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;<%horizontalAttr%>:<%horizontalPixel%>px;<%verticalAttr%>:<%verticalPixel%>px;"><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-consult-1 nb-new-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>%;<%horizontalAttr%>:<%horizontalPixel%>px;<%verticalAttr%>:<%verticalPixel%>px;"><% } %><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-<%skinIndex%>" style="height:<%height%>%;width:<%width%>%;<%horizontalAttr%>:<%horizontalPixel%>px;<%verticalAttr%>:<%verticalPixel%>px;"><% } %><% } %><% if (data.isCustomerStyle == 1) { %><ins class="nb-icon-wrap-base nb-icon-customer" style="background-image:url(<%customerStyle.backImg%>); box-shadow: 0 0 0 0;"></ins><% } else { %><ins class="nb-icon-wrap-base nb-icon-wrap-<%skinIndex%>-<%leftOrRight%>"></ins><% if ((data.skinIndex == 2 || data.skinIndex == 5) && !data.hasOwnProperty("barrageIconColorType")) { %><ins style="border-left-width: <%shape.borderLeftWidth%>;border-right-width: <%shape.borderRightWidth%>;" class="nb-icon-flag nb-icon-flag-<%skinIndex%>"></ins><% } %><% } %><div class="issueMarquee-<%barrageSwitch%>" id="issueMarquee"><div class="issue-box" id="issueBox"><% if (data.hasOwnProperty("hotIssues")) { %><% for (var j = 0; j < (data.hotIssues || []).length; j++){ %><% if (data.hotIssues[j].question) { %><p class="issue-item issue-item-<%barrageColor%>"><span class="issue-icon" style="background-color:<%barrageIconColor%>"></span><span class="issue-text" data-key="<%hotIssues[j].id%>"><%hotIssues[j].question%></span></p><% } %><% } %><% } else { %><% for (var j = 0; j < (data.barrageIssue || []).length; j++){ %><p class="issue-item issue-item-<%barrageColor%>"><span class="issue-icon" style="background-color:<%barrageIconColor%>"></span><span class="issue-text"><%barrageIssue[j]%></span></p><% } %><% } %></div></div></ins><% } %>'}),define("embed/icon/common/hotIssue/components/issueMarquee",["require"],function(require){function e(e,o){if(i=e.config,!i.barrageSwitch)return!1;n(o),setInterval(function(){t()},3e3)}function t(){var e=document.getElementById("issueBox"),t=e&&e.querySelectorAll(".issue-item");if(t){var n=(t||[]).length;if(n>1){if(t.forEach(function(e,n){var i=e.classList;if(i.contains("fade-in"))t[n].classList.remove("fade-in");else if(i.contains("fade-out"))t[n].classList.remove("fade-out")}),o>0)t[o-1].classList.add("fade-out");else t[n-1].classList.add("fade-out");if(t[o].classList.add("fade-in"),o===n-1)o=0;else o++}else t[o].classList.add("fade-in")}}function n(e){var t=document.getElementById("issueBox");if(t){var n=t.querySelectorAll(".issue-item"),o=document.documentElement.clientWidth;i.width;if((n||[]).length){var r=80,a=[];n.forEach(function(e){a.push(e.clientWidth)}),a.sort(function(e,t){return t-e}),r=a[0];var s="";if(i.isFixedPosition){var c=i.position.split("-");if(s+=c[0]+":0;","top"===c[1])s+="bottom:-5.8em;";else s+="top:0;"}else if(e){if(0===e.horizontalPixel)if("left"===e.horizontalAttr)s+="left:0;";else s+="right:0;";if(0===e.verticalPixel)if("bottom"===e.verticalAttr)s+="top:0;";else s+="bottom:-5.8em;"}else{if(i.marginTop>=40)s+="top:0;";else s+="bottom:-5.8em;";if(i.marginLeft>=o-r)s+="right:0;"}n.forEach(function(e){e.setAttribute("style",s)})}}}var i={},o=0;return e}),define("embed/icon/common/hotIssue/main",["require","./components/issueMarquee"],function(require){var e,t=require("./components/issueMarquee"),exports={};return exports.init=function(n,i){e=new t({id:"nb_icon_wrap",config:n},i)},exports}),define("embed/icon/mobile/iconMobileHandler",["require","../common/hotIssue/main"],function(require){var e=require("../common/hotIssue/main"),exports={};return exports.bindEvent=function(t,n,i,o){var r=o.getServer("configBox").components||{},a=o.getServer("configBox").seekIcon;if(!(r.comps&&r.comps.length>0))setTimeout(function(){e.init(a)},1e3)},exports.clickIcon=function(e,t,n,i){n.logClickIcon(),e.accept(0,i),t.hide(["nb_invite_wrap"])},exports}),define("embed/icon/mobile/iconMobileConsts",[],function(){return{PREFIXID:"nb_icon_"}}),define("embed/icon/iconMConfig",["require","./iconMain","./iconHandler","./iconData","./mobile/iconMobileData","./mobile/iconMobile.tpl","./mobile/iconMobileHandler","./mobile/iconMobileConsts"],function(require){return{package:"micon",resource:{main:require("./iconMain"),handler:require("./iconHandler"),data:require("./iconData"),mdata:require("./mobile/iconMobileData"),tpl:require("./mobile/iconMobile.tpl"),phandler:require("./mobile/iconMobileHandler"),consts:require("./mobile/iconMobileConsts")},injection:[{id:"micon.phandler",method:{bindEvent:["mbase.events","micon.consts","micon.phandler","data.config"],clickIcon:["mchat.chat","mbase.dom","log.main"],handleMouse:["micon.consts","mbase.events"]}},{id:"micon.mdata",method:{dataProcess:["mbase.lib","mbase.brower"]}},{id:"micon.main",method:{init:["micon.handler","data.config","mcomp.main"]}},{id:"micon.main",method:{renderHtml:["micon.data","micon.tpl","common.util","mbase.dom","common.view","log.main"]}},{id:"micon.data",method:{getIconTplData:["data.config","micon.mdata"]}},{id:"micon.handler",method:{bindEvent:["mbase.events","micon.phandler"],handleAccept:["micon.phandler"]}}],aspect:[{id:"micon.main",pointCut:["toolbar.main.init, , init"]}]}}),define("embed/log/mobileConfig",["require","./main"],function(require){return{package:"log",resource:{main:require("./main")},injection:[{id:"log.main",method:{init:["data.config","mchat.bid","core.config"],sendLog:["core.log","core.chat","core.config"],logClickSeek:["core.main","common.cookie"]}}],aspect:[{id:"log.main",pointCut:["micon.main.init, logRenderStart, ","icon.handle.acceptClick, ,logClickSeek","invite.operation.clickInvite, ,logClickSeek","minvite.main.init, , logRenderEnd","mchat.chat.builtComunicate, logEnterStart, ","mchat.chat.enterSuccess, ,logEnterEnd","mchat.leave.pageLeave, , leaveSite","micon.phandler.clickIcon, ,logClickSeek","minvite.mhandler.acceptInvite, ,logClickSeek","toolbar.main.clickOnlineConsult, ,logClickOnlineConsult","toolbar.main.clickDial, ,logClickDial","toolbar.main.clickGetConnect, ,logClickGetConnect"]}]}}),define("embed/toolbar/toolbarMain",["require","../comp/mobile/compMMain"],function(require){function e(e){for(var t=[],n=0;n<e.length;n++)if(1===e[n].enable)t.push(e[n].type);return t.join("_")}var exports={},t=require("../comp/mobile/compMMain"),n="nb_toolbar_",i={ONLINECONSULT:"onlineConsult",DIAL:"dial",GETCONNECT:"getConnect"},o=/^((http|https|ftp|\/\/):)/;return exports.updateOrientation=function(e){var t=window.innerWidth>window.innerHeight?"landscape":"portrait",n=e.g("nb_toolbar_wrap");if("portrait"===t)e.removeClass(n,"qiao-toolbar-horizontal"),e.addClass(n,"qiao-toolbar-vertical");else e.removeClass(n,"qiao-toolbar-vertical"),e.addClass(n,"qiao-toolbar-horizontal")},exports.dataProcess=function(e,t){for(var n=e.getServer("configBox").toolbar,r=0,a=0,s=0,c=n.iconOrder.length;s<c;s++){var l=n.iconOrder[s];if(0!==l.enable){switch(l.type){case i.ONLINECONSULT:l.href="javascript:void(0)";break;case i.DIAL:l.href="tel:"+l.phoneNumber;break;case i.GETCONNECT:if(!o.test(l.connectUrl))l.connectUrl="//"+l.connectUrl;l.href=l.connectUrl,l.target="_blank"}if(r++,a=s,l.last="",n.iconOrder[s].hasOwnProperty("btnBgColor"))n.styleVersion="1";else n.styleVersion="0"}}return n.wrapClass="qiao-toolbar-btn-"+["one","two","three"][r-1],n.iconOrder[a].last="qiao-toolbar-btn-last",n.bgColorPre="rgba("+t.hexToRgb(n.bgColor,!0).join(",")+","+n.opacity/100+")",n},exports.renderHtml=function(t,n,i,o,r){var a=exports.dataProcess(),s=t.template(n,a);i.appendHTML(s,o.getWrap()),r.componentIsShow.toolbar=e(a.iconOrder),exports.updateOrientation()},exports.clickOnlineConsult=function(e,t){e.accept(0),t.hide(["nb_invite_wrap"])},exports.clickDial=function(){},exports.clickGetConnect=function(){},exports.bindEvents=function(e,t){window.addEventListener("resize",exports.updateOrientation,!1),t.domOn(n+i.ONLINECONSULT,"click",exports.clickOnlineConsult,!1),t.domOn(n+i.DIAL,"click",exports.clickDial,!1),t.domOn(n+i.GETCONNECT,"click",exports.clickGetConnect,!1)},exports.init=function(e){var n=e.getServer("configBox").toolbar;if(0!=+(void 0===n?0:n.enable))if(!t.isShowComp(e))exports.renderHtml(),exports.bindEvents()},exports}),define("embed/toolbar/toolbar.tpl",[],function(){return'\x3c!-- target: toolbar --\x3e<% if (data.styleVersion != \'1\') { %><ins id="nb_toolbar_wrap" class="qiao-toolbar-wrapper <%wrapClass%>" style="height:<%height%>%;background:<%bgColorPre%>;bottom:<%bottomDistance%>%;"><% for (var i = 0, l = data.iconOrder.length; i < l; i++) { %><% if (data.iconOrder[i].enable == 1) { %><a id="nb_toolbar_<%iconOrder[i].type%>" class="<%iconOrder[i].last%>" href="<%iconOrder[i].href%>"<% if (data.iconOrder[i].target) { %>target="<%iconOrder[i].target%>"<% }%>style="background:<%iconOrder[i].btnColor%>;color:<%iconOrder[i].btnTxtColor%>;"><%iconOrder[i].btnTxt%></a><% } %><% } %></ins><% } else { %><ins id="nb_toolbar_wrap" class="qiao-toolbar-wrapper <%wrapClass%> qiao-toolbar-wrapper-new"><% for (var i = 0, l = data.iconOrder.length; i < l; i++) { %><% if (data.iconOrder[i].enable == 1) { %><% if (data.iconOrder[i].btnType == 0) { %><a id="nb_toolbar_<%iconOrder[i].type%>" class="<%iconOrder[i].last%> nb_toolbar_enable_btn" href="<%iconOrder[i].href%>"<% if (data.iconOrder[i].target) { %>target="<%iconOrder[i].target%>"<% }%>style="background:<%iconOrder[i].btnBgColor%>;color:#ffffff;"><%iconOrder[i].btnText%></a><% } else { %><a id="nb_toolbar_<%iconOrder[i].type%>" class="<%iconOrder[i].last%> nb_toolbar_btn" href="<%iconOrder[i].href%>"<% if (data.iconOrder[i].target) { %>target="<%iconOrder[i].target%>"<% }%>style="background:#ffffff;color:<%iconOrder[i].btnBgColor%>;border: 1px solid <%iconOrder[i].btnBgColor%>;"><%iconOrder[i].btnText%></a><% } %><% } %><% } %></ins><% } %>'}),define("embed/toolbar/toolbarConfig",["require","./toolbarMain","./toolbar.tpl"],function(require){return{package:"toolbar",resource:{main:require("./toolbarMain"),tpl:require("./toolbar.tpl")},injection:[{id:"toolbar.main",method:{init:["data.config"],renderHtml:["common.util","toolbar.tpl","mbase.dom","common.view","log.main"],bindEvents:["mbase.dom","mbase.events"],dataProcess:["data.config","mbase.lib"],updateOrientation:["mbase.dom"],clickOnlineConsult:["mchat.chat","mbase.dom"]}}]}}),define("embed/entry/mobile/mobileConfig",["require","im-core/bullConfig","im-lib/config","../../../base/baseMobileConfig","../../../common/mobileConfig","../../data/bullConfig","../../embedChat/mConfig","../../invite/inviteMConfig","../../comp/compMConfig","../../icon/iconMConfig","../../log/mobileConfig","../../toolbar/toolbarConfig"],function(require){return{package:"membed",importConfig:[require("im-core/bullConfig"),require("im-lib/config"),require("../../../base/baseMobileConfig"),require("../../../common/mobileConfig"),require("../../data/bullConfig"),require("../../embedChat/mConfig"),require("../../invite/inviteMConfig"),require("../../comp/compMConfig"),require("../../icon/iconMConfig"),require("../../log/mobileConfig"),require("../../toolbar/toolbarConfig")]}}),define("embed/entry/mobile/mobileHack",["require","common/view","base/mobile/dom"],function(require){var e=require("common/view"),t=require("base/mobile/dom"),exports={};return exports.init=function(){this.regex={initScale:/initial\-scale/},this.check()},exports.check=function(){var n=this,i=e.getWrap(),o=document.querySelectorAll('meta[name="viewport"]');o=[].slice.call(o);var r=!1;if(o.some(function(e){if(e.getAttribute("content").match(n.regex.initScale))return r=!0,!0}),!r)t.setStyle(i,"mobile-no-scale")},exports}),define("common/recorder/main",["require"],function(require){return function(){!function(e){"use strict";function t(e){this.id=++g,T();var t={type:"mp3",bitRate:16,sampleRate:16e3,onProcess:n};for(var i in e)t[i]=e[i];this.set=t,this._S=9,this.Sync={O:9,C:9}}var n=function(){},i=function(e){return new t(e)};i.LM="2022-08-06 20:51";var o="Recorder",r="getUserMedia",a="srcSampleRate",s="sampleRate";i.IsOpen=function(){var e=i.Stream;if(e){var t=e.getTracks&&e.getTracks()||e.audioTracks||[],n=t[0];if(n){var o=n.readyState;return"live"==o||o==n.LIVE}}return!1},i.BufferSize=4096,i.Destroy=function(){for(var e in _(o+" Destroy"),p(),c)c[e]()};var c={};i.BindDestroy=function(e,t){c[e]=t},i.Support=function(){var t=e.AudioContext;if(t||(t=e.webkitAudioContext),!t)return!1;var n=navigator.mediaDevices||{};return n[r]||(n=navigator)[r]||(n[r]=n.webkitGetUserMedia||n.mozGetUserMedia||n.msGetUserMedia),!!n[r]&&(i.Scope=n,i.Ctx&&"closed"!=i.Ctx.state||(i.Ctx=new t,i.BindDestroy("Ctx",function(){var e=i.Ctx;e&&e.close&&(e.close(),i.Ctx=0)})),!0)};var l="ConnectEnableWebM";i[l]=!0;var f="ConnectEnableWorklet";i[f]=!1;var u=function(t,n){var r,a,c,u=t.BufferSize||i.BufferSize,p=i.Ctx,h=t.Stream,g=function(e){var t=h._m=p.createMediaStreamSource(h),n=p.destination,i="createMediaStreamDestination";p[i]&&(n=p[i]()),t.connect(e),e.connect(n)},v="",y=h._call,w=function(e){for(var t in y){for(var n=e.length,i=new Int16Array(n),o=0,r=0;r<n;r++){var a=Math.max(-1,Math.min(1,e[r]));a=a<0?32768*a:32767*a,i[r]=a,o+=Math.abs(a)}for(var s in y)y[s](i,o);return}},S="ScriptProcessor",T="audioWorklet",k=o+" "+T,x="RecProc",I="MediaRecorder",E=I+".WebM.PCM",M=p.createScriptProcessor||p.createJavaScriptNode,A="\u3002\u7531\u4e8e"+T+"\u5185\u90e81\u79d2375\u6b21\u56de\u8c03\uff0c\u5728\u79fb\u52a8\u7aef\u53ef\u80fd\u4f1a\u6709\u6027\u80fd\u95ee\u9898\u5bfc\u81f4\u56de\u8c03\u4e22\u5931\u5f55\u97f3\u53d8\u77ed\uff0cPC\u7aef\u65e0\u5f71\u54cd\uff0c\u6682\u4e0d\u5efa\u8bae\u5f00\u542f"+T+"\u3002",R=function(){a=h.isWorklet=!1,d(h),_("Connect\u91c7\u7528\u8001\u7684"+S+"\uff0c"+(i[f]?"\u4f46\u5df2":"\u53ef")+"\u8bbe\u7f6e"+o+"."+f+"=true\u5c1d\u8bd5\u542f\u7528"+T+v+A,3);var e=h._p=M.call(p,u,1,1);g(e);var t="_D220626",n=i[t];n&&_("Use "+o+"."+t,3),e.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);n?(t=new Float32Array(t),setTimeout(function(){w(t)})):w(t)}},C=function(){r=h.isWebM=!1,m(h),a=h.isWorklet=!M||i[f];var t=e.AudioWorkletNode;if(a&&p[T]&&t){var n=function(){return a&&h._na},s=h._na=function(){""!==c&&(clearTimeout(c),c=setTimeout(function(){c=0,n()&&(_(T+"\u672a\u8fd4\u56de\u4efb\u4f55\u97f3\u9891\uff0c\u6062\u590d\u4f7f\u7528"+S,3),M&&R())},500))},l=function(){if(n()){var e=h._n=new t(p,x,{processorOptions:{bufferSize:u}});g(e),e.port.onmessage=function(e){c&&(clearTimeout(c),c=""),n()?w(e.data.val):a||_(T+"\u591a\u4f59\u56de\u8c03",3)},_("Connect\u91c7\u7528"+T+"\uff0c\u8bbe\u7f6e"+o+"."+f+"=false\u53ef\u6062\u590d\u8001\u5f0f"+S+v+A,3)}};p.resume()[y&&"finally"](function(){if(n())if(p[x])l();else{var e,t,i=(t="class "+x+" extends AudioWorkletProcessor{",t+="constructor "+(e=function(e){return e.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,k)})(function(e){DEL_super(e);var t=this,n=e.processorOptions.bufferSize;t.bufferSize=n,t.buffer=new Float32Array(2*n),t.pos=0,t.port.onmessage=function(e){e.data.kill&&(t.kill=!0,console.log("$RA kill call"))},console.log("$RA .ctor call",e)}),t+="process "+e(function(e,t,n){var i=this,o=i.bufferSize,r=i.buffer,a=i.pos;if((e=(e[0]||[])[0]||[]).length){r.set(e,a);var s=~~((a+=e.length)/o)*o;if(s){this.port.postMessage({val:r.slice(0,s)});var c=r.subarray(s,a);(r=new Float32Array(2*o)).set(c),a=c.length,i.buffer=r}i.pos=a}return!i.kill}),t+='}try{registerProcessor("'+x+'", '+x+')}catch(e){console.error("'+k+'\u6ce8\u518c\u5931\u8d25",e)}',"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(t))));p[T].addModule(i).then(function(e){n()&&(p[x]=1,l(),c&&s())})[y&&"catch"](function(e){_(T+".addModule\u5931\u8d25",1,e),n()&&R()})}})}else R()};!function(){var t=e[I],a="ondataavailable",f="audio/webm; codecs=pcm";r=h.isWebM=i[l];var d=t&&a in t.prototype&&t.isTypeSupported(f);if(v=d?"":"\uff08\u6b64\u6d4f\u89c8\u5668\u4e0d\u652f\u6301"+E+"\uff09",!n||!r||!d)return C();var m=function(){return r&&h._ra},g=(h._ra=function(){""!==c&&(clearTimeout(c),c=setTimeout(function(){m()&&(_(I+"\u672a\u8fd4\u56de\u4efb\u4f55\u97f3\u9891\uff0c\u964d\u7ea7\u4f7f\u7528"+T,3),C())},500))},Object.assign({mimeType:f},i.ConnectWebMOptions)),y=h._r=new t(h,g),k=h._rd={sampleRate:p[s]};y[a]=function(e){var t=new FileReader;t.onloadend=function(){if(m()){var e=b(new Uint8Array(t.result),k);if(!e)return;if(-1==e)return void C();c&&(clearTimeout(c),c=""),w(e)}else r||_(I+"\u591a\u4f59\u56de\u8c03",3)},t.readAsArrayBuffer(e.data)},y.start(~~(u/48)),_("Connect\u91c7\u7528"+E+"\uff0c\u8bbe\u7f6e"+o+"."+l+"=false\u53ef\u6062\u590d\u4f7f\u7528"+T+"\u6216\u8001\u5f0f"+S)}()},d=function(e){e._na=null,e._n&&(e._n.port.postMessage({kill:!0}),e._n.disconnect(),e._n=null)},m=function(e){e._ra=null,e._r&&(e._r.stop(),e._r=null)},p=function(e){var t=(e=e||i)==i,n=e.Stream;if(n&&(n._m&&(n._m.disconnect(),n._m=null),n._p&&(n._p.disconnect(),n._p.onaudioprocess=n._p=null),d(n),m(n),t)){for(var o=n.getTracks&&n.getTracks()||n.audioTracks||[],r=0;r<o.length;r++){var a=o[r];a.stop&&a.stop()}n.stop&&n.stop()}e.Stream=0};i.SampleData=function(e,t,n,i,o){i||(i={});var r=i.index||0,a=i.offset||0,s=i.frameNext||[];o||(o={});var c=o.frameSize||1;o.frameType&&(c="mp3"==o.frameType?1152:1);var l=e.length;l+1<r&&_("SampleData\u4f3c\u4e4e\u4f20\u5165\u4e86\u672a\u91cd\u7f6echunk "+r+">"+l,3);for(var f=0,u=r;u<l;u++)f+=e[u].length;f=Math.max(0,f-Math.floor(a));var d=t/n;1<d?f=Math.floor(f/d):(d=1,n=t),f+=s.length;for(var m=new Int16Array(f),p=0,u=0;u<s.length;u++)m[p]=s[u],p++;for(;r<l;r++){for(var h=e[r],u=a,g=h.length;u<g;){var b=Math.floor(u),v=Math.ceil(u),y=u-b,w=h[b],S=v<g?h[v]:(e[r+1]||[w])[0]||0;m[p]=w+(S-w)*y,p++,u+=d}a=u-g}s=null;var T=m.length%c;if(0<T){var k=2*(m.length-T);s=new Int16Array(m.buffer.slice(k)),m=new Int16Array(m.buffer.slice(0,k))}return{index:r,offset:a,frameNext:s,sampleRate:n,data:m}},i.PowerLevel=function(e,t){var n=e/t||0;return n<1251?Math.round(n/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(n/1e4)/Math.log(10)))))};var _=function(t,n){var i=new Date,r=("0"+i.getMinutes()).substr(-2)+":"+("0"+i.getSeconds()).substr(-2)+"."+("00"+i.getMilliseconds()).substr(-3),a=this&&this.envIn&&this.envCheck&&this.id,s=["["+r+" "+o+(a?":"+a:"")+"]"+t],c=arguments,l=e.console||{},f=2,u=l.log;for("number"==typeof n?u=1==n?l.error:3==n?l.warn:u:f=1;f<c.length;f++)s.push(c[f]);h?u&&u("[IsLoser]"+s[0],1<s.length?s:""):u.apply(l,s)},h=!0;try{h=!console.log.apply}catch(e){}i.CLog=_;var g=0;i.Sync={O:9,C:9},i.prototype=t.prototype={CLog:_,_streamStore:function(){return this.set.sourceStream?this:i},open:function(t,o){var a=this,s=a._streamStore();t=t||n;var c=function(e,t){t=!!t,a.CLog("\u5f55\u97f3open\u5931\u8d25\uff1a"+e+",isUserNotAllow:"+t,1),o&&o(e,t)},l=function(){a.CLog("open ok id:"+a.id),t(),a._SO=0},f=s.Sync,d=++f.O,m=f.C;a._O=a._O_=d,a._SO=a._S;var _=a.envCheck({envName:"H5",canProcess:!0});if(_)c("\u4e0d\u80fd\u5f55\u97f3\uff1a"+_);else if(a.set.sourceStream){if(!i.Support())return void c("\u4e0d\u652f\u6301\u6b64\u6d4f\u89c8\u5668\u4ece\u6d41\u4e2d\u83b7\u53d6\u5f55\u97f3");p(s),a.Stream=a.set.sourceStream,a.Stream._call={};try{u(s)}catch(t){return void c("\u4ece\u6d41\u4e2d\u6253\u5f00\u5f55\u97f3\u5931\u8d25\uff1a"+t.message)}l()}else{var h=function(t,n){try{e.top.a}catch(t){return void c('\u65e0\u6743\u5f55\u97f3(\u8de8\u57df\uff0c\u8bf7\u5c1d\u8bd5\u7ed9iframe\u6dfb\u52a0\u9ea6\u514b\u98ce\u8bbf\u95ee\u7b56\u7565\uff0c\u5982allow="camera;microphone")')}/Permission|Allow/i.test(t)?c("\u7528\u6237\u62d2\u7edd\u4e86\u5f55\u97f3\u6743\u9650",!0):!1===e.isSecureContext?c("\u6d4f\u89c8\u5668\u7981\u6b62\u4e0d\u5b89\u5168\u9875\u9762\u5f55\u97f3\uff0c\u53ef\u5f00\u542fhttps\u89e3\u51b3"):/Found/i.test(t)?c(n+"\uff0c\u65e0\u53ef\u7528\u9ea6\u514b\u98ce"):c(n)};if(i.IsOpen())l();else if(i.Support()){var g=function(e){setTimeout(function(){e._call={};var t=i.Stream;t&&(p(),e._call=t._call),i.Stream=e,function(){if(m!=f.C||!a._O){var e="open\u88ab\u53d6\u6d88";return d==f.O?a.close():e="open\u88ab\u4e2d\u65ad",c(e),!0}}()||(i.IsOpen()?(t&&a.CLog("\u53d1\u73b0\u540c\u65f6\u591a\u6b21\u8c03\u7528open",1),u(s,1),l()):c("\u5f55\u97f3\u529f\u80fd\u65e0\u6548\uff1a\u65e0\u97f3\u9891\u6d41"))},100)},b=function(e){var t=e.name||e.message||e.code+":"+e;a.CLog("\u8bf7\u6c42\u5f55\u97f3\u6743\u9650\u9519\u8bef",1,e),h(t,"\u65e0\u6cd5\u5f55\u97f3\uff1a"+t)},v={noiseSuppression:!1,echoCancellation:!1},y=a.set.audioTrackSet;for(var w in y)v[w]=y[w];v.sampleRate=i.Ctx.sampleRate;try{var S=i.Scope[r]({audio:v},g,b)}catch(t){a.CLog(r,3,t),S=i.Scope[r]({audio:!0},g,b)}S&&S.then&&S.then(g)[t&&"catch"](b)}else h("","\u6b64\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5f55\u97f3")}},close:function(e){e=e||n;var t=this,i=t._streamStore();t._stop();var o=i.Sync;if(t._O=0,t._O_!=o.O)return t.CLog("close\u88ab\u5ffd\u7565\uff08\u56e0\u4e3a\u540c\u65f6open\u4e86\u591a\u4e2arec\uff0c\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u4f1a\u771f\u6b63close\uff09",3),void e();o.C++,p(i),t.CLog("close"),e()},mock:function(e,t){var n=this;return n._stop(),n.isMock=1,n.mockEnvInfo=null,n.buffers=[e],n.recSize=e.length,n[a]=t,n},envCheck:function(t){var n,o=this.set,r="CPU_BE";if(n||i[r]||!e.Int8Array||new Int8Array(new Int32Array([1]).buffer)[0]||(T(r),n="\u4e0d\u652f\u6301CPU_BE\u67b6\u6784"),!n){var a=o.type;this[a+"_envCheck"]?n=this[a+"_envCheck"](t,o):o.takeoffEncodeChunk&&(n=a+"\u7c7b\u578b"+(this[a]?"":"(\u672a\u52a0\u8f7d\u7f16\u7801\u5668)")+"\u4e0d\u652f\u6301\u8bbe\u7f6etakeoffEncodeChunk")}return n||""},envStart:function(e,t){var n=this,i=n.set;n.isMock=e?1:0,n.mockEnvInfo=e,n.buffers=[],n.recSize=0,n.envInLast=0,n.envInFirst=0,n.envInFix=0,n.envInFixTs=[];var o=i[s];if(t<o?i[s]=t:o=0,n[a]=t,n.CLog(a+": "+t+" set."+s+": "+i[s]+(o?" \u5ffd\u7565"+o:""),o?3:0),n.engineCtx=0,n[i.type+"_start"]){var r=n.engineCtx=n[i.type+"_start"](i);r&&(r.pcmDatas=[],r.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var n=this,o=n.set,r=n.engineCtx,c=n[a],l=e.length,f=i.PowerLevel(t,l),u=n.buffers,d=u.length;u.push(e);var m=u,p=d,_=Date.now(),h=Math.round(l/c*1e3);n.envInLast=_,1==n.buffers.length&&(n.envInFirst=_-h);var g=n.envInFixTs;g.splice(0,0,{t:_,d:h});for(var b=_,v=0,y=0;y<g.length;y++){var w=g[y];if(3e3<_-w.t){g.length=y;break}b=w.t,v+=w.d}var S=g[1],T=_-b;if(T/3<T-v&&(S&&1e3<T||6<=g.length)){var k=_-S.t-h;if(h/5<k){var x=!o.disableEnvInFix;if(n.CLog("["+_+"]"+(x?"":"\u672a")+"\u8865\u507f"+k+"ms",3),n.envInFix+=k,x){var I=new Int16Array(k*c/1e3);l+=I.length,u.push(I)}}}var E=n.recSize,M=l,A=E+M;if(n.recSize=A,r){var R=i.SampleData(u,c,o[s],r.chunkInfo);r.chunkInfo=R,A=(E=r.pcmSize)+(M=R.data.length),r.pcmSize=A,u=r.pcmDatas,d=u.length,u.push(R.data),c=R[s]}var C=Math.round(A/c*1e3),B=u.length,P=m.length,L=function(){for(var e=O?0:-M,t=null==u[0],i=d;i<B;i++){var a=u[i];null==a?t=1:(e+=a.length,r&&a.length&&n[o.type+"_encode"](r,a))}if(t&&r)for(i=p,m[0]&&(i=0);i<P;i++)m[i]=null;t&&(e=O?M:0,u[0]=null),r?r.pcmSize+=e:n.recSize+=e},O=0,N="rec.set.onProcess";try{O=o.onProcess(u,f,C,c,d,L)}catch(e){console.error(N+"\u56de\u8c03\u51fa\u9519\u662f\u4e0d\u5141\u8bb8\u7684\uff0c\u9700\u4fdd\u8bc1\u4e0d\u4f1a\u629b\u5f02\u5e38",e)}var D=Date.now()-_;if(10<D&&1e3<n.envInFirst-_&&n.CLog(N+"\u4f4e\u6027\u80fd\uff0c\u8017\u65f6"+D+"ms",3),!0===O){var H=0;for(y=d;y<B;y++)null==u[y]?H=1:u[y]=new Int16Array(0);H?n.CLog("\u672a\u8fdb\u5165\u5f02\u6b65\u524d\u4e0d\u80fd\u6e05\u9664buffers",3):r?r.pcmSize-=M:n.recSize-=M}else L()},start:function(){var e=this,t=i.Ctx,n=1;if(e.set.sourceStream?e.Stream||(n=0):i.IsOpen()||(n=0),n)if(e.CLog("\u5f00\u59cb\u5f55\u97f3"),e._stop(),e.state=3,e.envStart(null,t[s]),e._SO&&e._SO+1!=e._S)e.CLog("start\u88ab\u4e2d\u65ad",3);else{e._SO=0;var o=function(){3==e.state&&(e.state=1,e.resume())};"suspended"==t.state?(e.CLog("wait ctx resume..."),t.resume().then(function(){e.CLog("ctx resume"),o()})):o()}else e.CLog("\u672aopen",1)},pause:function(){var e=this;e.state&&(e.state=2,e.CLog("pause"),delete e._streamStore().Stream._call[e.id])},resume:function(){var e,t=this;if(t.state){t.state=1,t.CLog("resume"),t.envResume();var n=t._streamStore().Stream;n._call[t.id]=function(e,n){1==t.state&&t.envIn(e,n)},(e=n)._na&&e._na(),e._ra&&e._ra()}},_stop:function(e){var t=this,n=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!e&&t[n.type+"_stop"]&&(t[n.type+"_stop"](t.engineCtx),t.engineCtx=0)},stop:function(e,t,n){var o,r=this,c=r.set,l=r.envInLast-r.envInFirst,f=l&&r.buffers.length;r.CLog("stop \u548cstart\u65f6\u5dee"+(l?l+"ms \u8865\u507f"+r.envInFix+"ms envIn:"+f+" fps:"+(f/l*1e3).toFixed(1):"-"));var u=function(){r._stop(),n&&r.close()},d=function(e){r.CLog("\u7ed3\u675f\u5f55\u97f3\u5931\u8d25\uff1a"+e,1),t&&t(e),u()},m=function(t,n){if(r.CLog("\u7ed3\u675f\u5f55\u97f3 \u7f16\u7801\u82b1"+(Date.now()-o)+"ms \u97f3\u9891\u65f6\u957f"+n+"ms \u6587\u4ef6\u5927\u5c0f"+t.size+"b"),c.takeoffEncodeChunk)r.CLog("\u542f\u7528takeoffEncodeChunk\u540estop\u8fd4\u56de\u7684blob\u957f\u5ea6\u4e3a0\u4e0d\u63d0\u4f9b\u97f3\u9891\u6570\u636e",3);else if(t.size<Math.max(100,n/2))return void d("\u751f\u6210\u7684"+c.type+"\u65e0\u6548");e&&e(t,n),u()};if(!r.isMock){var p=3==r.state;if(!r.state||p)return void d("\u672a\u5f00\u59cb\u5f55\u97f3"+(p?"\uff0c\u5f00\u59cb\u5f55\u97f3\u524d\u65e0\u7528\u6237\u4ea4\u4e92\u5bfc\u81f4AudioContext\u672a\u8fd0\u884c":""));r._stop(!0)}var _=r.recSize;if(_)if(r.buffers[0])if(r[c.type]){if(r.isMock){var h=r.envCheck(r.mockEnvInfo||{envName:"mock",canProcess:!1});if(h)return void d("\u5f55\u97f3\u9519\u8bef\uff1a"+h)}var g=r.engineCtx;if(r[c.type+"_complete"]&&g){var b=Math.round(g.pcmSize/c[s]*1e3);return o=Date.now(),void r[c.type+"_complete"](g,function(e){m(e,b)},d)}o=Date.now();var v=i.SampleData(r.buffers,r[a],c[s]);c[s]=v[s];var y=v.data;b=Math.round(y.length/c[s]*1e3),r.CLog("\u91c7\u6837"+_+"->"+y.length+" \u82b1:"+(Date.now()-o)+"ms"),setTimeout(function(){o=Date.now(),r[c.type](y,function(e){m(e,b)},function(e){d(e)})})}else d("\u672a\u52a0\u8f7d"+c.type+"\u7f16\u7801\u5668");else d("\u97f3\u9891buffers\u88ab\u91ca\u653e");else d("\u672a\u91c7\u96c6\u5230\u5f55\u97f3")}},e[o]&&(_("\u91cd\u590d\u5f15\u5165"+o,3),e[o].Destroy()),e[o]=i;var b=function(e,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var n=t.tracks,i=[t.pos[0]],o=function(){t.pos[0]=i[0]},r=t.bytes.length,a=new Uint8Array(r+e.length);if(a.set(t.bytes),a.set(e,r),t.bytes=a,!t._ht){if(w(a,i),S(a,i),!v(w(a,i),[24,83,128,103]))return;for(w(a,i);i[0]<a.length;){var c=w(a,i),l=S(a,i),f=[0],u=0;if(!l)return;if(v(c,[22,84,174,107])){for(;f[0]<l.length;){var d=w(l,f),m=S(l,f),p=[0],h={channels:0,sampleRate:0};if(v(d,[174]))for(;p[0]<m.length;){var g=w(m,p),b=S(m,p),T=[0];if(v(g,[215])){var k=y(b);h.number=k,n[k]=h}else if(v(g,[131])){var k=y(b);1==k?h.type="video":2==k?(h.type="audio",u||(t.track0=h),h.idx=u++):h.type="Type-"+k}else if(v(g,[134])){for(var x="",I=0;I<b.length;I++)x+=String.fromCharCode(b[I]);h.codec=x}else if(v(g,[225]))for(;T[0]<b.length;){var E=w(b,T),M=S(b,T);if(v(E,[181])){var k=0,A=new Uint8Array(M.reverse()).buffer;4==M.length?k=new Float32Array(A)[0]:8==M.length?k=new Float64Array(A)[0]:_("WebM Track !Float",1,M),h[s]=Math.round(k)}else v(E,[98,100])?h.bitDepth=y(M):v(E,[159])&&(h.channels=y(M))}}}t._ht=1,_("WebM Tracks",n),o();break}}}var R=t.track0;if(R){if(16==R.bitDepth&&/FLOAT/i.test(R.codec)&&(R.bitDepth=32,_("WebM 16\u653932\u4f4d",3)),R[s]!=t[s]||32!=R.bitDepth||R.channels<1||!/(\b|_)PCM\b/i.test(R.codec))return t.bytes=[],t.bad||_("WebM Track\u975e\u9884\u671f",3,t),-(t.bad=1);for(var C=[],B=0;i[0]<a.length;){var d=w(a,i),m=S(a,i);if(!m)break;if(v(d,[163])){var P=15&m[0],h=n[P];if(0===h.idx){for(var L=new Uint8Array(m.length-4),I=4;I<m.length;I++)L[I-4]=m[I];C.push(L),B+=L.length}}o()}if(B){var O=new Uint8Array(a.length-t.pos[0]);O.set(a.subarray(t.pos[0])),t.bytes=O,t.pos[0]=0;for(var L=new Uint8Array(B),I=0,N=0;I<C.length;I++)L.set(C[I],N),N+=C[I].length;var A=new Float32Array(L.buffer);if(1<R.channels){for(var D=[],I=0;I<A.length;)D.push(A[I]),I+=R.channels;A=new Float32Array(D)}return A}}},v=function(e,t){if(!e||e.length!=t.length)return!1;if(1==e.length)return e[0]==t[0];for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0},y=function(e){for(var t="",n=0;n<e.length;n++){var i=e[n];t+=(i<16?"0":"")+i.toString(16)}return parseInt(t,16)||0},w=function(e,t,n){var i=t[0];if(!(i>=e.length)){var o=e[i],r=("0000000"+o.toString(2)).substr(-8),a=/^(0*1)(\d*)$/.exec(r);if(a){var s=a[1].length,c=[];if(!(i+s>e.length)){for(var l=0;l<s;l++)c[l]=e[i],i++;return n&&(c[0]=parseInt(a[2]||"0",2)),t[0]=i,c}}}},S=function(e,t){var n=w(e,t,1);if(n){var i=y(n),o=t[0],r=[];if(i<2147483647){if(o+i>e.length)return;for(var a=0;a<i;a++)r[a]=e[o],o++}return t[0]=o,r}};i.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var T=i.Traffic=function(e){e=e?"/"+o+"/Report/"+e:"";var t=i.TrafficImgUrl;if(t){var n=i.Traffic,r=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],a=r[1]||"http://file/",s=(r[0]||a)+e;if(0==t.indexOf("//")&&(t=/^https:/i.test(s)?"https:"+t:"http:"+t),e&&(t=t+"&cu="+encodeURIComponent(a+e)),!n[s]){n[s]=1;(new Image).src=t,_("Traffic Analysis Image: "+(e||o+".TrafficImgUrl="+i.TrafficImgUrl))}}}}(window),"function"==typeof define&&define.amd&&define(function(){return Recorder}),"object"==typeof module&&module.exports&&(module.exports=Recorder),function(){"use strict";var e;Recorder.prototype.enc_mp3={stable:!0,testmsg:"\u91c7\u6837\u7387\u8303\u56f448000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000"},Recorder.prototype.mp3=function(e,t,n){var r=this.set,a=e.length,s=this.mp3_start(r);if(s)return this.mp3_encode(s,e),void this.mp3_complete(s,t,n,1);var c=new Recorder.lamejs.Mp3Encoder(1,r.sampleRate,r.bitRate),l=[],f=0,u=0,d=function(){if(f<a)0<(n=c.encodeBuffer(e.subarray(f,f+57600))).length&&(u+=n.buffer.byteLength,l.push(n.buffer)),f+=57600,setTimeout(d);else{var n;0<(n=c.flush()).length&&(u+=n.buffer.byteLength,l.push(n.buffer));var s=i.fn(l,u,a,r.sampleRate);o(s,r),t(new Blob(l,{type:"audio/mp3"}))}};d()},Recorder.BindDestroy("mp3Worker",function(){console.log("mp3Worker Destroy"),e&&e.terminate(),e=null}),Recorder.prototype.mp3_envCheck=function(e,t){var i="";return t.takeoffEncodeChunk&&(e.canProcess?n()||(i="\u5f53\u524d\u6d4f\u89c8\u5668\u7248\u672c\u592a\u4f4e\uff0c\u65e0\u6cd5\u5b9e\u65f6\u5904\u7406"):i=e.envName+"\u73af\u5883\u4e0d\u652f\u6301\u5b9e\u65f6\u5904\u7406"),i},Recorder.prototype.mp3_start=function(e){return n(e)};var t={id:0},n=function(n){var o=e;try{if(!o){var r=");wk_lame();var wk_ctxs={};self.onmessage="+function(e){var t=e.data,n=wk_ctxs[t.id];if("init"==t.action)wk_ctxs[t.id]={sampleRate:t.sampleRate,bitRate:t.bitRate,takeoff:t.takeoff,mp3Size:0,pcmSize:0,encArr:[],encObj:new wk_lame.Mp3Encoder(1,t.sampleRate,t.bitRate)};else if(!n)return;switch(t.action){case"stop":n.encObj=null,delete wk_ctxs[t.id];break;case"encode":n.pcmSize+=t.pcm.length,0<(i=n.encObj.encodeBuffer(t.pcm)).length&&(n.takeoff?self.postMessage({action:"takeoff",id:t.id,chunk:i}):(n.mp3Size+=i.buffer.byteLength,n.encArr.push(i.buffer)));break;case"complete":var i;0<(i=n.encObj.flush()).length&&(n.takeoff?self.postMessage({action:"takeoff",id:t.id,chunk:i}):(n.mp3Size+=i.buffer.byteLength,n.encArr.push(i.buffer)));var o=wk_mp3TrimFix.fn(n.encArr,n.mp3Size,n.pcmSize,n.sampleRate);self.postMessage({action:t.action,id:t.id,blob:new Blob(n.encArr,{type:"audio/mp3"}),meta:o})}};r+=";var wk_mp3TrimFix={rm:"+i.rm+",fn:"+i.fn+"}";var a=Recorder.lamejs.toString(),s=(window.URL||webkitURL).createObjectURL(new Blob(["var wk_lame=(",a,r],{type:"text/javascript"}));o=new Worker(s),setTimeout(function(){(window.URL||webkitURL).revokeObjectURL(s)},1e4),o.onmessage=function(e){var n=e.data,i=t[n.id];i&&("takeoff"==n.action?i.set.takeoffEncodeChunk(new Uint8Array(n.chunk.buffer)):(i.call&&i.call(n),i.call=null))}}var c={worker:o,set:n,takeoffQueue:[]};return n?(c.id=++t.id,t[c.id]=c,o.postMessage({action:"init",id:c.id,sampleRate:n.sampleRate,bitRate:n.bitRate,takeoff:!!n.takeoffEncodeChunk,x:new Int16Array(5)})):o.postMessage({x:new Int16Array(5)}),e=o,c}catch(n){return o&&o.terminate(),console.error(n),null}};Recorder.prototype.mp3_stop=function(e){if(e&&e.worker){e.worker.postMessage({action:"stop",id:e.id}),e.worker=null,delete t[e.id];var n=-1;for(var i in t)n++;n&&console.warn("mp3 worker\u5269"+n+"\u4e2a\u5728\u4e32\u884c\u7b49\u5f85")}},Recorder.prototype.mp3_encode=function(e,t){e&&e.worker&&e.worker.postMessage({action:"encode",id:e.id,pcm:t})},Recorder.prototype.mp3_complete=function(e,t,n,i){var r=this;e&&e.worker?(e.call=function(n){o(n.meta,e.set),t(n.blob),i&&r.mp3_stop(e)},e.worker.postMessage({action:"complete",id:e.id})):n("mp3\u7f16\u7801\u5668\u672a\u6253\u5f00")},Recorder.mp3ReadMeta=function(e,t){var n="object"==typeof window?window.parseInt:self.parseInt,i=new Uint8Array(e[0]||[]);if(i.length<4)return null;var o=function(e,t){return("0000000"+((t||i)[e]||0).toString(2)).substr(-8)},r=o(0)+o(1),a=o(2)+o(3);if(!/^1{11}/.test(r))return null;var s={"00":2.5,10:2,11:1}[r.substr(11,2)],c={"01":3}[r.substr(13,2)],l={1:[44100,48e3,32e3],2:[22050,24e3,16e3],2.5:[11025,12e3,8e3]}[s];l&&(l=l[n(a.substr(4,2),2)]);var f=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320]][1==s?1:0][n(a.substr(0,4),2)];if(!(s&&c&&f&&l))return null;for(var u=Math.round(8*t/f),d=1==c?384:2==c?1152:1==s?1152:576,m=d/l*1e3,p=Math.floor(d*f/8/l*1e3),_=0,h=0,g=0;g<e.length;g++){var b=e[g];if(p+3<=(h+=b.byteLength)){var v=new Uint8Array(b);_="1"==o(b.byteLength-(h-(p+3)+1),v).charAt(6);break}}return _&&p++,{version:s,layer:c,sampleRate:l,bitRate:f,duration:u,size:t,hasPadding:_,frameSize:p,frameDurationFloat:m}};var i={rm:Recorder.mp3ReadMeta,fn:function(e,t,n,i){var o=this.rm(e,t);if(!o)return{err:"mp3\u975e\u9884\u5b9a\u683c\u5f0f"};var r=Math.round(n/i*1e3),a=Math.floor((o.duration-r)/o.frameDurationFloat);if(0<a){var s=a*o.frameSize-(o.hasPadding?1:0);t-=s;for(var c=0,l=[],f=0;f<e.length;f++){var u=e[f];if(s<=0)break;s>=u.byteLength?(s-=u.byteLength,l.push(u),e.splice(f,1),f--):(e[f]=u.slice(s),c=u,s=0)}if(!this.rm(e,t)){for(c&&(e[0]=c),f=0;f<l.length;f++)e.splice(f,0,l[f]);o.err="fix\u540e\u6570\u636e\u9519\u8bef\uff0c\u5df2\u8fd8\u539f\uff0c\u9519\u8bef\u539f\u56e0\u4e0d\u660e"}var d=o.trimFix={};d.remove=a,d.removeDuration=Math.round(a*o.frameDurationFloat),d.duration=Math.round(8*t/o.bitRate)}return o}},o=function(e,t){var n="MP3\u4fe1\u606f ";(e.sampleRate&&e.sampleRate!=t.sampleRate||e.bitRate&&e.bitRate!=t.bitRate)&&(console.warn(n+"\u548c\u8bbe\u7f6e\u7684\u4e0d\u5339\u914dset:"+t.bitRate+"kbps "+t.sampleRate+"hz\uff0c\u5df2\u66f4\u65b0set:"+e.bitRate+"kbps "+e.sampleRate+"hz",t),t.sampleRate=e.sampleRate,t.bitRate=e.bitRate);var i=e.trimFix;i?(n+="Fix\u79fb\u9664"+i.remove+"\u5e27"+i.removeDuration+"ms -> "+i.duration+"ms",2<i.remove&&(e.err=(e.err?e.err+", ":"")+"\u79fb\u9664\u5e27\u6570\u8fc7\u591a")):n+=(e.duration||"-")+"ms",e.err?console.error(n,e.err,e):console.log(n,e)}}(),function(){"use strict";function e(){function t(e){return new Int8Array(e)}function n(e){return new Int16Array(e)}function i(e){return new Int32Array(e)}function o(e){return new Float32Array(e)}function r(e){return new Float64Array(e)}function a(e){if(1==e.length)return o(e[0]);var t=e[0];e=e.slice(1);for(var n=[],i=0;i<t;i++)n.push(a(e));return n}function s(e){if(1==e.length)return i(e[0]);var t=e[0];e=e.slice(1);for(var n=[],o=0;o<t;o++)n.push(s(e));return n}function c(e){if(1==e.length)return n(e[0]);var t=e[0];e=e.slice(1);for(var i=[],o=0;o<t;o++)i.push(c(e));return i}function l(e){if(1==e.length)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var n=[],i=0;i<t;i++)n.push(l(e));return n}function f(e){this.ordinal=e}function u(e){this.ordinal=e}function d(e){var t=e;this.ordinal=function(){return t}}function m(){function e(e){this.bits=0|e}function t(e,t,n,i,o,r){var a=.5946/t;for(e>>=1;0!=e--;)o[r++]=a>n[i++]?0:1,o[r++]=a>n[i++]?0:1}function n(e,t,n,i,o,r){var s=(e>>=1)%2;for(e>>=1;0!=e--;){var c,l,f,u,d,m,p,_;c=n[i++]*t,l=n[i++]*t,d=0|c,f=n[i++]*t,m=0|l,u=n[i++]*t,p=0|f,c+=a.adj43[d],_=0|u,l+=a.adj43[m],o[r++]=0|c,f+=a.adj43[p],o[r++]=0|l,u+=a.adj43[_],o[r++]=0|f,o[r++]=0|u}0!=s&&(d=0|(c=n[i++]*t),m=0|(l=n[i++]*t),c+=a.adj43[d],l+=a.adj43[m],o[r++]=0|c,o[r++]=0|l)}function o(e,t,n,i){var o=function(e,t,n){var i=0,o=0;do{var r=e[t++],a=e[t++];i<r&&(i=r),o<a&&(o=a)}while(t<n);return i<o&&(i=o),i}(e,t,n);switch(o){case 0:return o;case 1:return function(e,t,n,i){var o=0,r=O.ht[1].hlen;do{var a=2*e[t+0]+e[t+1];t+=2,o+=r[a]}while(t<n);return i.bits+=o,1}(e,t,n,i);case 2:case 3:return function(e,t,n,i,o){var r,a,s=0,c=O.ht[i].xlen;a=2==i?O.table23:O.table56;do{var l=e[t+0]*c+e[t+1];t+=2,s+=a[l]}while(t<n);return(r=65535&s)<(s>>=16)&&(s=r,i++),o.bits+=s,i}(e,t,n,c[o-1],i);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,n,i,o){var r=0,a=0,s=0,c=O.ht[i].xlen,l=O.ht[i].hlen,f=O.ht[i+1].hlen,u=O.ht[i+2].hlen;do{var d=e[t+0]*c+e[t+1];t+=2,r+=l[d],a+=f[d],s+=u[d]}while(t<n);var m=i;return a<r&&(r=a,m++),s<r&&(r=s,m=i+2),o.bits+=r,m}(e,t,n,c[o-1],i);default:if(w.IXMAX_VAL<o)return i.bits=w.LARGE_BITS,-1;var r,a;for(o-=15,r=24;r<32&&!(O.ht[r].linmax>=o);r++);for(a=r-8;a<24&&!(O.ht[a].linmax>=o);a++);return function(e,t,n,i,o,r){var a,s=65536*O.ht[i].xlen+O.ht[o].xlen,c=0;do{var l=e[t++],f=e[t++];0!=l&&(14<l&&(l=15,c+=s),l*=16),0!=f&&(14<f&&(f=15,c+=s),l+=f),c+=O.largetbl[l]}while(t<n);return(a=65535&c)<(c>>=16)&&(c=a,i=o),r.bits+=c,i}(e,t,n,a,r,i)}}function r(t,n,i,r,a,s,c,l){for(var f=n.big_values,u=2;u<x.SBMAX_l+1;u++){var d=t.scalefac_band.l[u];if(f<=d)break;var m=a[u-2]+n.count1bits;if(i.part2_3_length<=m)break;var p=new e(m),_=o(r,d,f,p);m=p.bits,i.part2_3_length<=m||(i.assign(n),i.part2_3_length=m,i.region0_count=s[u-2],i.region1_count=u-2-s[u-2],i.table_select[0]=c[u-2],i.table_select[1]=l[u-2],i.table_select[2]=_)}}var a=null;this.qupvt=null,this.setModules=function(e){this.qupvt=e,a=e};var s=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],c=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];this.noquant_count_bits=function(t,n,i){var r=n.l3_enc,a=Math.min(576,n.max_nonzero_coeff+2>>1<<1);for(null!=i&&(i.sfb_count1=0);1<a&&0==(r[a-1]|r[a-2]);a-=2);n.count1=a;for(var s=0,c=0;3<a;a-=4){var l;if(1<(2147483647&(r[a-1]|r[a-2]|r[a-3]|r[a-4])))break;l=2*(2*(2*r[a-4]+r[a-3])+r[a-2])+r[a-1],s+=O.t32l[l],c+=O.t33l[l]}var f=s;if(n.count1table_select=0,c<s&&(f=c,n.count1table_select=1),n.count1bits=f,0==(n.big_values=a))return f;if(n.block_type==x.SHORT_TYPE)(s=3*t.scalefac_band.s[3])>n.big_values&&(s=n.big_values),c=n.big_values;else if(n.block_type==x.NORM_TYPE){if(s=n.region0_count=t.bv_scf[a-2],c=n.region1_count=t.bv_scf[a-1],c=t.scalefac_band.l[s+c+2],s=t.scalefac_band.l[s+1],c<a){var u=new e(f);n.table_select[2]=o(r,c,a,u),f=u.bits}}else n.region0_count=7,n.region1_count=x.SBMAX_l-1-7-1,(c=a)<(s=t.scalefac_band.l[8])&&(s=c);if(s=Math.min(s,a),c=Math.min(c,a),0<s)u=new e(f),n.table_select[0]=o(r,0,s,u),f=u.bits;if(s<c)u=new e(f),n.table_select[1]=o(r,s,c,u),f=u.bits;if(2==t.use_best_huffman&&(n.part2_3_length=f,best_huffman_divide(t,n),f=n.part2_3_length),null!=i&&n.block_type==x.NORM_TYPE){for(var d=0;t.scalefac_band.l[d]<n.big_values;)d++;i.sfb_count1=d}return f},this.count_bits=function(e,i,o,r){var s=o.l3_enc,c=w.IXMAX_VAL/a.IPOW20(o.global_gain);if(o.xrpow_max>c)return w.LARGE_BITS;if(function(e,i,o,r,s){var c,l,f,u=0,d=0,m=0,p=0,_=i,h=0,g=_,b=0,v=e,y=0;for(f=null!=s&&r.global_gain==s.global_gain,l=r.block_type==x.SHORT_TYPE?38:21,c=0;c<=l;c++){var w=-1;if((f||r.block_type==x.NORM_TYPE)&&(w=r.global_gain-(r.scalefac[c]+(0!=r.preflag?a.pretab[c]:0)<<r.scalefac_scale+1)-8*r.subblock_gain[r.window[c]]),f&&s.step[c]==w)0!=d&&(n(d,o,v,y,g,b),d=0),0!=m&&(t(m,o,v,y,g,b),m=0);else{var S,T=r.width[c];if(u+r.width[c]>r.max_nonzero_coeff&&(S=r.max_nonzero_coeff-u+1,C.fill(i,r.max_nonzero_coeff,576,0),(T=S)<0&&(T=0),c=l+1),0==d&&0==m&&(g=_,b=h,v=e,y=p),null!=s&&0<s.sfb_count1&&c>=s.sfb_count1&&0<s.step[c]&&w>=s.step[c]?(0!=d&&(n(d,o,v,y,g,b),d=0,g=_,b=h,v=e,y=p),m+=T):(0!=m&&(t(m,o,v,y,g,b),m=0,g=_,b=h,v=e,y=p),d+=T),T<=0){0!=m&&(t(m,o,v,y,g,b),m=0),0!=d&&(n(d,o,v,y,g,b),d=0);break}}c<=l&&(h+=r.width[c],p+=r.width[c],u+=r.width[c])}0!=d&&(n(d,o,v,y,g,b),d=0),0!=m&&(t(m,o,v,y,g,b),m=0)}(i,s,a.IPOW20(o.global_gain),o,r),0!=(2&e.substep_shaping))for(var l=0,f=o.global_gain+o.scalefac_scale,u=.634521682242439/a.IPOW20(f),d=0;d<o.sfbmax;d++){var m,p=o.width[d];if(0==e.pseudohalf[d])l+=p;else for(m=l,l+=p;m<l;++m)s[m]=i[m]>=u?s[m]:0}return this.noquant_count_bits(e,o,r)},this.best_huffman_divide=function(t,n){var a=new S,s=n.l3_enc,c=i(23),l=i(23),f=i(23),u=i(23);if(n.block_type!=x.SHORT_TYPE||1!=t.mode_gr){a.assign(n),n.block_type==x.NORM_TYPE&&(function(t,n,i,r,a,s,c){for(var l=n.big_values,f=0;f<=22;f++)r[f]=w.LARGE_BITS;for(f=0;f<16;f++){var u=t.scalefac_band.l[f+1];if(l<=u)break;var d=0,m=new e(d),p=o(i,0,u,m);d=m.bits;for(var _=0;_<8;_++){var h=t.scalefac_band.l[f+_+2];if(l<=h)break;var g=d,b=o(i,u,h,m=new e(g));g=m.bits,r[f+_]>g&&(r[f+_]=g,s[(a[f+_]=f)+_]=p,c[f+_]=b)}}}(t,n,s,c,l,f,u),r(t,a,n,s,c,l,f,u));var d=a.big_values;if(!(0==d||1<(s[d-2]|s[d-1])||576<(d=n.count1+2))){a.assign(n),a.count1=d;for(var m=0,p=0;d>a.big_values;d-=4){var _=2*(2*(2*s[d-4]+s[d-3])+s[d-2])+s[d-1];m+=O.t32l[_],p+=O.t33l[_]}if(a.big_values=d,a.count1table_select=0,p<m&&(m=p,a.count1table_select=1),a.count1bits=m,a.block_type==x.NORM_TYPE)r(t,a,n,s,c,l,f,u);else{if(a.part2_3_length=m,d<(m=t.scalefac_band.l[8])&&(m=d),0<m){var h=new e(a.part2_3_length);a.table_select[0]=o(s,0,m,h),a.part2_3_length=h.bits}if(m<d)h=new e(a.part2_3_length),a.table_select[1]=o(s,m,d,h),a.part2_3_length=h.bits;n.part2_3_length>a.part2_3_length&&n.assign(a)}}}};var l=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],f=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],u=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],d=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];m.slen1_tab=u,m.slen2_tab=d,this.best_scalefac_store=function(e,t,n,i){var o,r,s,c,m=i.tt[t][n],p=0;for(o=s=0;o<m.sfbmax;o++){var _=m.width[o];for(s+=_,c=-_;c<0&&0==m.l3_enc[c+s];c++);0==c&&(m.scalefac[o]=p=-2)}if(0==m.scalefac_scale&&0==m.preflag){var h=0;for(o=0;o<m.sfbmax;o++)0<m.scalefac[o]&&(h|=m.scalefac[o]);if(0==(1&h)&&0!=h){for(o=0;o<m.sfbmax;o++)0<m.scalefac[o]&&(m.scalefac[o]>>=1);m.scalefac_scale=p=1}}if(0==m.preflag&&m.block_type!=x.SHORT_TYPE&&2==e.mode_gr){for(o=11;o<x.SBPSY_l&&!(m.scalefac[o]<a.pretab[o]&&-2!=m.scalefac[o]);o++);if(o==x.SBPSY_l){for(o=11;o<x.SBPSY_l;o++)0<m.scalefac[o]&&(m.scalefac[o]-=a.pretab[o]);m.preflag=p=1}}for(r=0;r<4;r++)i.scfsi[n][r]=0;for(2==e.mode_gr&&1==t&&i.tt[0][n].block_type!=x.SHORT_TYPE&&i.tt[1][n].block_type!=x.SHORT_TYPE&&(function(e,t){for(var n,i=t.tt[1][e],o=t.tt[0][e],r=0;r<O.scfsi_band.length-1;r++){for(n=O.scfsi_band[r];n<O.scfsi_band[r+1]&&!(o.scalefac[n]!=i.scalefac[n]&&0<=i.scalefac[n]);n++);if(n==O.scfsi_band[r+1]){for(n=O.scfsi_band[r];n<O.scfsi_band[r+1];n++)i.scalefac[n]=-1;t.scfsi[e][r]=1}}var a=0,s=0;for(n=0;n<11;n++)-1!=i.scalefac[n]&&(s++,a<i.scalefac[n]&&(a=i.scalefac[n]));for(var c=0,m=0;n<x.SBPSY_l;n++)-1!=i.scalefac[n]&&(m++,c<i.scalefac[n]&&(c=i.scalefac[n]));for(r=0;r<16;r++)if(a<l[r]&&c<f[r]){var p=u[r]*s+d[r]*m;i.part2_length>p&&(i.part2_length=p,i.scalefac_compress=r)}}(n,i),p=0),o=0;o<m.sfbmax;o++)-2==m.scalefac[o]&&(m.scalefac[o]=0);0!=p&&(2==e.mode_gr?this.scale_bitcount(m):this.scale_bitcount_lsf(e,m))};var p=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],_=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],h=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,n,i,o=0,r=0,s=e.scalefac;if(e.block_type==x.SHORT_TYPE)i=p,0!=e.mixed_block_flag&&(i=_);else if(i=h,0==e.preflag){for(n=11;n<x.SBPSY_l&&!(s[n]<a.pretab[n]);n++);if(n==x.SBPSY_l)for(e.preflag=1,n=11;n<x.SBPSY_l;n++)s[n]-=a.pretab[n]}for(n=0;n<e.sfbdivide;n++)o<s[n]&&(o=s[n]);for(;n<e.sfbmax;n++)r<s[n]&&(r=s[n]);for(e.part2_length=w.LARGE_BITS,t=0;t<16;t++)o<l[t]&&r<f[t]&&e.part2_length>i[t]&&(e.part2_length=i[t],e.scalefac_compress=t);return e.part2_length==w.LARGE_BITS};var g=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,t){var n,o,r,s,c,l,f,u,d=i(4),m=t.scalefac;for(n=0!=t.preflag?2:0,f=0;f<4;f++)d[f]=0;if(t.block_type==x.SHORT_TYPE){o=1;var p=a.nr_of_sfb_block[n][o];for(r=u=0;r<4;r++)for(s=p[r]/3,f=0;f<s;f++,u++)for(c=0;c<3;c++)m[3*u+c]>d[r]&&(d[r]=m[3*u+c])}else for(o=0,p=a.nr_of_sfb_block[n][o],r=u=0;r<4;r++)for(s=p[r],f=0;f<s;f++,u++)m[u]>d[r]&&(d[r]=m[u]);for(l=!1,r=0;r<4;r++)d[r]>g[n][r]&&(l=!0);if(!l){var _,h,v,y;for(t.sfb_partition_table=a.nr_of_sfb_block[n][o],r=0;r<4;r++)t.slen[r]=b[d[r]];switch(_=t.slen[0],h=t.slen[1],v=t.slen[2],y=t.slen[3],n){case 0:t.scalefac_compress=(5*_+h<<4)+(v<<2)+y;break;case 1:t.scalefac_compress=400+(5*_+h<<2)+v;break;case 2:t.scalefac_compress=500+3*_+h;break;default:B.err.printf("intensity stereo not implemented yet\n")}}if(!l)for(r=t.part2_length=0;r<4;r++)t.part2_length+=t.slen[r]*t.sfb_partition_table[r];return l};var b=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var n,i=0;e.scalefac_band.l[++i]<t;);for(n=s[i][0];e.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=s[i][0]),e.bv_scf[t-2]=n,n=s[i][1];e.scalefac_band.l[n+e.bv_scf[t-2]+2]>t;)n--;n<0&&(n=s[i][1]),e.bv_scf[t-1]=n}}}function p(){}function _(){this.setModules=function(e,t,n){};var e=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.updateMusicCRC=function(t,n,i,o){for(var r=0;r<o;++r)t[0]=(a=n[i+r],s=(s=t[0])>>8^e[255&(s^a)]);var a,s}}function h(){function e(e,t,n){for(;0<n;){var i;0==I&&(I=8,k++,e.header[e.w_ptr].write_timing==T&&(o=e,B.arraycopy(o.header[o.w_ptr].buf,0,S,k,o.sideinfo_len),k+=o.sideinfo_len,T+=8*o.sideinfo_len,o.w_ptr=o.w_ptr+1&E.MAX_HEADER_BUF-1),S[k]=0),n-=i=Math.min(n,I),I-=i,S[k]|=t>>n<<I,T+=i}var o}function n(e,t,n){for(;0<n;){var i;0==I&&(I=8,S[++k]=0),n-=i=Math.min(n,I),I-=i,S[k]|=t>>n<<I,T+=i}}function o(t,n){var i,o=t.internal_flags;if(8<=n&&(e(o,76,8),n-=8),8<=n&&(e(o,65,8),n-=8),8<=n&&(e(o,77,8),n-=8),8<=n&&(e(o,69,8),n-=8),32<=n){var r=y.getLameShortVersion();if(32<=n)for(i=0;i<r.length&&8<=n;++i)n-=8,e(o,r.charCodeAt(i),8)}for(;1<=n;n-=1)e(o,o.ancillary_flag,1),o.ancillary_flag^=t.disable_reservoir?0:1}function r(e,t,n){for(var i=e.header[e.h_ptr].ptr;0<n;){var o=Math.min(n,8-(7&i));n-=o,e.header[e.h_ptr].buf[i>>3]|=t>>n<<8-(7&i)-o,i+=o}e.header[e.h_ptr].ptr=i}function s(e,t){e<<=8;for(var n=0;n<8;n++)0!=(65536&((t<<=1)^(e<<=1)))&&(t^=g);return t}function c(t,n){var i,o=O.ht[n.count1table_select+32],r=0,a=n.big_values,s=n.big_values;for(i=(n.count1-n.big_values)/4;0<i;--i){var c=0,l=0;0!=n.l3_enc[a+0]&&(l+=8,n.xr[s+0]<0&&c++),0!=n.l3_enc[a+1]&&(l+=4,c*=2,n.xr[s+1]<0&&c++),0!=n.l3_enc[a+2]&&(l+=2,c*=2,n.xr[s+2]<0&&c++),0!=n.l3_enc[a+3]&&(l++,c*=2,n.xr[s+3]<0&&c++),a+=4,s+=4,e(t,c+o.table[l],o.hlen[l]),r+=o.hlen[l]}return r}function l(t,n,i,o,r){var a=O.ht[n],s=0;if(0==n)return s;for(var c=i;c<o;c+=2){var l=0,f=0,u=a.xlen,d=a.xlen,m=0,p=r.l3_enc[c],_=r.l3_enc[c+1];if(0!=p&&(r.xr[c]<0&&m++,l--),15<n){if(14<p)m|=p-15<<1,f=u,p=15;if(14<_)m<<=u,m|=_-15,f+=u,_=15;d=16}0!=_&&(m<<=1,r.xr[c+1]<0&&m++,l--),p=p*d+_,f-=l,l+=a.hlen[p],e(t,a.table[p],l),e(t,m,f),s+=l+f}return s}function f(e,t){var n=3*e.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var i=l(e,t.table_select[0],0,n,t);return i+=l(e,t.table_select[1],n,t.big_values,t)}function u(e,t){var n,i,o,r;n=t.big_values;var a=t.region0_count+1;return o=e.scalefac_band.l[a],a+=t.region1_count+1,n<o&&(o=n),n<(r=e.scalefac_band.l[a])&&(r=n),i=l(e,t.table_select[0],0,o,t),i+=l(e,t.table_select[1],o,r,t),i+=l(e,t.table_select[2],r,n,t)}function d(){this.total=0}function _(e,t){var n,i,o,r,a,s=e.internal_flags;return a=s.w_ptr,-1==(r=s.h_ptr-1)&&(r=E.MAX_HEADER_BUF-1),n=s.header[r].write_timing-T,0<=(t.total=n)&&(i=1+r-a,r<a&&(i=1+r-a+E.MAX_HEADER_BUF),n-=8*i*s.sideinfo_len),n+=o=h.getframebits(e),t.total+=o,t.total%8!=0?t.total=1+t.total/8:t.total=t.total/8,t.total+=k+1,n<0&&B.err.println("strange error flushing buffer ... \n"),n}var h=this,g=32773,b=null,v=null,y=null,w=null;this.setModules=function(e,t,n,i){b=e,v=t,y=n,w=i};var S=null,T=0,k=0,I=0;this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?O.bitrate_table[e.version][n.bitrate_index]:e.brate,8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=s(255&t[2],n),n=s(255&t[3],n);for(var i=6;i<e.sideinfo_len;i++)n=s(255&t[i],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,n,i=e.internal_flags,r=i.h_ptr-1;if(-1==r&&(r=E.MAX_HEADER_BUF-1),t=i.l3_side,!((n=_(e,new d))<0)){if(o(e,n),i.ResvSize=0,t.main_data_begin=0,i.findReplayGain){var a=b.GetTitleGain(i.rgdata);i.RadioGain=0|Math.floor(10*a+.5)}i.findPeakSample&&(i.noclipGainChange=0|Math.ceil(20*R(i.PeakSample/32767)*10),0<i.noclipGainChange&&(EQ(e.scale,1)||EQ(e.scale,0))?i.noclipScale=Math.floor(32767/i.PeakSample*100)/100:i.noclipScale=-1)}},this.add_dummy_byte=function(e,t,i){for(var o,r=e.internal_flags;0<i--;)for(n(0,t,8),o=0;o<E.MAX_HEADER_BUF;++o)r.header[o].write_timing+=8},this.format_bitstream=function(t){var n,i=t.internal_flags;n=i.l3_side;var a=this.getframebits(t);o(t,n.resvDrain_pre),function(e,t){var n,i,o,a=e.internal_flags;if(n=a.l3_side,a.header[a.h_ptr].ptr=0,C.fill(a.header[a.h_ptr].buf,0,a.sideinfo_len,0),e.out_samplerate<16e3?r(a,4094,12):r(a,4095,12),r(a,e.version,1),r(a,1,2),r(a,e.error_protection?0:1,1),r(a,a.bitrate_index,4),r(a,a.samplerate_index,2),r(a,a.padding,1),r(a,e.extension,1),r(a,e.mode.ordinal(),2),r(a,a.mode_ext,2),r(a,e.copyright,1),r(a,e.original,1),r(a,e.emphasis,2),e.error_protection&&r(a,0,16),1==e.version){for(r(a,n.main_data_begin,9),2==a.channels_out?r(a,n.private_bits,3):r(a,n.private_bits,5),o=0;o<a.channels_out;o++){var s;for(s=0;s<4;s++)r(a,n.scfsi[o][s],1)}for(i=0;i<2;i++)for(o=0;o<a.channels_out;o++)r(a,(c=n.tt[i][o]).part2_3_length+c.part2_length,12),r(a,c.big_values/2,9),r(a,c.global_gain,8),r(a,c.scalefac_compress,4),c.block_type!=x.NORM_TYPE?(r(a,1,1),r(a,c.block_type,2),r(a,c.mixed_block_flag,1),14==c.table_select[0]&&(c.table_select[0]=16),r(a,c.table_select[0],5),14==c.table_select[1]&&(c.table_select[1]=16),r(a,c.table_select[1],5),r(a,c.subblock_gain[0],3),r(a,c.subblock_gain[1],3),r(a,c.subblock_gain[2],3)):(r(a,0,1),14==c.table_select[0]&&(c.table_select[0]=16),r(a,c.table_select[0],5),14==c.table_select[1]&&(c.table_select[1]=16),r(a,c.table_select[1],5),14==c.table_select[2]&&(c.table_select[2]=16),r(a,c.table_select[2],5),r(a,c.region0_count,4),r(a,c.region1_count,3)),r(a,c.preflag,1),r(a,c.scalefac_scale,1),r(a,c.count1table_select,1)}else for(r(a,n.main_data_begin,8),r(a,n.private_bits,a.channels_out),o=i=0;o<a.channels_out;o++){var c;r(a,(c=n.tt[i][o]).part2_3_length+c.part2_length,12),r(a,c.big_values/2,9),r(a,c.global_gain,8),r(a,c.scalefac_compress,9),c.block_type!=x.NORM_TYPE?(r(a,1,1),r(a,c.block_type,2),r(a,c.mixed_block_flag,1),14==c.table_select[0]&&(c.table_select[0]=16),r(a,c.table_select[0],5),14==c.table_select[1]&&(c.table_select[1]=16),r(a,c.table_select[1],5),r(a,c.subblock_gain[0],3),r(a,c.subblock_gain[1],3),r(a,c.subblock_gain[2],3)):(r(a,0,1),14==c.table_select[0]&&(c.table_select[0]=16),r(a,c.table_select[0],5),14==c.table_select[1]&&(c.table_select[1]=16),r(a,c.table_select[1],5),14==c.table_select[2]&&(c.table_select[2]=16),r(a,c.table_select[2],5),r(a,c.region0_count,4),r(a,c.region1_count,3)),r(a,c.scalefac_scale,1),r(a,c.count1table_select,1)}e.error_protection&&CRC_writeheader(a,a.header[a.h_ptr].buf);var l=a.h_ptr;a.h_ptr=l+1&E.MAX_HEADER_BUF-1,a.header[a.h_ptr].write_timing=a.header[l].write_timing+t,a.h_ptr==a.w_ptr&&B.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(t,a);var s=8*i.sideinfo_len;if(s+=function(t){var n,i,o,r,a=0,s=t.internal_flags,l=s.l3_side;if(1==t.version)for(n=0;n<2;n++)for(i=0;i<s.channels_out;i++){var d=l.tt[n][i],p=m.slen1_tab[d.scalefac_compress],_=m.slen2_tab[d.scalefac_compress];for(o=r=0;o<d.sfbdivide;o++)-1!=d.scalefac[o]&&(e(s,d.scalefac[o],p),r+=p);for(;o<d.sfbmax;o++)-1!=d.scalefac[o]&&(e(s,d.scalefac[o],_),r+=_);d.block_type==x.SHORT_TYPE?r+=f(s,d):r+=u(s,d),a+=r+=c(s,d)}else for(i=n=0;i<s.channels_out;i++){var h,g,b=0;if(g=o=r=0,(d=l.tt[n][i]).block_type==x.SHORT_TYPE){for(;g<4;g++){var v=d.sfb_partition_table[g]/3,y=d.slen[g];for(h=0;h<v;h++,o++)e(s,Math.max(d.scalefac[3*o+0],0),y),e(s,Math.max(d.scalefac[3*o+1],0),y),e(s,Math.max(d.scalefac[3*o+2],0),y),b+=3*y}r+=f(s,d)}else{for(;g<4;g++)for(v=d.sfb_partition_table[g],y=d.slen[g],h=0;h<v;h++,o++)e(s,Math.max(d.scalefac[o],0),y),b+=y;r+=u(s,d)}a+=b+(r+=c(s,d))}return a}(t),o(t,n.resvDrain_post),s+=n.resvDrain_post,n.main_data_begin+=(a-s)/8,_(t,new d)!=i.ResvSize&&B.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*n.main_data_begin!=i.ResvSize&&(B.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size: %d \nresv drain (post) %d \nresv drain (pre) %d \nheader and sideinfo: %d \ndata bits: %d \ntotal bits: %d (remainder: %d) \nbitsperframe: %d \n",8*n.main_data_begin,i.ResvSize,n.resvDrain_post,n.resvDrain_pre,8*i.sideinfo_len,s-n.resvDrain_post-8*i.sideinfo_len,s,s%8,a),B.err.println("This is a fatal error. It has several possible causes:"),B.err.println("90%% LAME compiled with buggy version of gcc using advanced optimizations"),B.err.println(" 9%% Your system is overclocked"),B.err.println(" 1%% bug in LAME encoding library"),i.ResvSize=8*n.main_data_begin),1e9<T){var l;for(l=0;l<E.MAX_HEADER_BUF;++l)i.header[l].write_timing-=T;T=0}return 0},this.copy_buffer=function(e,t,n,o,r){var s=k+1;if(s<=0)return 0;if(0!=o&&o<s)return-1;if(B.arraycopy(S,0,t,n,s),k=-1,(I=0)!=r){var c=i(1);if(c[0]=e.nMusicCRC,w.updateMusicCRC(c,t,n,s),e.nMusicCRC=c[0],0<s&&(e.VBR_seek_table.nBytesWritten+=s),e.decode_on_the_fly)for(var l,f=a([2,1152]),u=s,d=-1;0!=d;)if(d=v.hip_decode1_unclipped(e.hip,t,n,u,f[0],f[1]),u=0,-1==d&&(d=0),0<d){if(e.findPeakSample){for(l=0;l<d;l++)f[0][l]>e.PeakSample?e.PeakSample=f[0][l]:-f[0][l]>e.PeakSample&&(e.PeakSample=-f[0][l]);if(1<e.channels_out)for(l=0;l<d;l++)f[1][l]>e.PeakSample?e.PeakSample=f[1][l]:-f[1][l]>e.PeakSample&&(e.PeakSample=-f[1][l])}if(e.findReplayGain&&b.AnalyzeSamples(e.rgdata,f[0],0,f[1],0,d,e.channels_out)==p.GAIN_ANALYSIS_ERROR)return-6}}return s},this.init_bit_stream_w=function(e){S=t(A.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,k=-1,T=I=0}}function g(e,t,n,i){this.xlen=e,this.linmax=t,this.table=n,this.hlen=i}function b(e){this.bits=e}function v(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}function y(e,t,n,o){this.l=i(1+x.SBMAX_l),this.s=i(1+x.SBMAX_s),this.psfb21=i(1+x.PSFB21),this.psfb12=i(1+x.PSFB12);var r=this.l,a=this.s;4==arguments.length&&(this.arrL=e,this.arrS=t,this.arr21=n,this.arr12=o,B.arraycopy(this.arrL,0,r,0,Math.min(this.arrL.length,this.l.length)),B.arraycopy(this.arrS,0,a,0,Math.min(this.arrS.length,this.s.length)),B.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),B.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}function w(){function e(e,t){var n=a.ATHformula(t,e);return n-=d,n=Math.pow(10,n/10+e.ATHlower)}function t(e){this.s=e}var n=null,r=null,a=null;this.setModules=function(e,t,i){n=e,r=t,a=i},this.IPOW20=function(e){return _[e]};var s=2.220446049250313e-16,c=w.IXMAX_VAL+2,l=w.Q_MAX,f=w.Q_MAX2,d=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var m=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=m,this.sfBandIndex=[new y([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new y([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var p=o(l+f+1),_=o(l),g=o(c),S=o(c);this.adj43=S,this.iteration_init=function(t){var i,o=t.internal_flags,r=o.l3_side;if(0==o.iteration_init_init){for(o.iteration_init_init=1,r.main_data_begin=0,function(t){for(var n=t.internal_flags.ATH.l,i=t.internal_flags.ATH.psfb21,o=t.internal_flags.ATH.s,r=t.internal_flags.ATH.psfb12,a=t.internal_flags,s=t.out_samplerate,c=0;c<x.SBMAX_l;c++){var l=a.scalefac_band.l[c],f=a.scalefac_band.l[c+1];n[c]=L.MAX_VALUE;for(var u=l;u<f;u++){var d=e(t,u*s/1152);n[c]=Math.min(n[c],d)}}for(c=0;c<x.PSFB21;c++)for(l=a.scalefac_band.psfb21[c],f=a.scalefac_band.psfb21[c+1],i[c]=L.MAX_VALUE,u=l;u<f;u++)d=e(t,u*s/1152),i[c]=Math.min(i[c],d);for(c=0;c<x.SBMAX_s;c++){for(l=a.scalefac_band.s[c],f=a.scalefac_band.s[c+1],o[c]=L.MAX_VALUE,u=l;u<f;u++)d=e(t,u*s/384),o[c]=Math.min(o[c],d);o[c]*=a.scalefac_band.s[c+1]-a.scalefac_band.s[c]}for(c=0;c<x.PSFB12;c++){for(l=a.scalefac_band.psfb12[c],f=a.scalefac_band.psfb12[c+1],r[c]=L.MAX_VALUE,u=l;u<f;u++)d=e(t,u*s/384),r[c]=Math.min(r[c],d);r[c]*=a.scalefac_band.s[13]-a.scalefac_band.s[12]}if(t.noATH){for(c=0;c<x.SBMAX_l;c++)n[c]=1e-20;for(c=0;c<x.PSFB21;c++)i[c]=1e-20;for(c=0;c<x.SBMAX_s;c++)o[c]=1e-20;for(c=0;c<x.PSFB12;c++)r[c]=1e-20}a.ATH.floor=10*R(e(t,-1))}(t),g[0]=0,i=1;i<c;i++)g[i]=Math.pow(i,4/3);for(i=0;i<c-1;i++)S[i]=i+1-Math.pow(.5*(g[i]+g[i+1]),.75);for(S[i]=.5,i=0;i<l;i++)_[i]=Math.pow(2,-.1875*(i-210));for(i=0;i<=l+f;i++)p[i]=Math.pow(2,.25*(i-210-f));var a,s,u,d;for(n.huffman_init(o),32<=(i=t.exp_nspsytune>>2&63)&&(i-=64),a=Math.pow(10,i/4/10),32<=(i=t.exp_nspsytune>>8&63)&&(i-=64),s=Math.pow(10,i/4/10),32<=(i=t.exp_nspsytune>>14&63)&&(i-=64),u=Math.pow(10,i/4/10),32<=(i=t.exp_nspsytune>>20&63)&&(i-=64),d=u*Math.pow(10,i/4/10),i=0;i<x.SBMAX_l;i++)m=i<=6?a:i<=13?s:i<=20?u:d,o.nsPsy.longfact[i]=m;for(i=0;i<x.SBMAX_s;i++){var m;m=i<=5?a:i<=10?s:i<=11?u:d,o.nsPsy.shortfact[i]=m}}},this.on_pe=function(e,t,n,o,a,s){var c,l,f=e.internal_flags,u=0,d=i(2),m=new b(u),p=r.ResvMaxBits(e,o,m,s),_=(u=m.bits)+p;for(E.MAX_BITS_PER_GRANULE<_&&(_=E.MAX_BITS_PER_GRANULE),l=c=0;l<f.channels_out;++l)n[l]=Math.min(E.MAX_BITS_PER_CHANNEL,u/f.channels_out),d[l]=0|n[l]*t[a][l]/700-n[l],d[l]>3*o/4&&(d[l]=3*o/4),d[l]<0&&(d[l]=0),d[l]+n[l]>E.MAX_BITS_PER_CHANNEL&&(d[l]=Math.max(0,E.MAX_BITS_PER_CHANNEL-n[l])),c+=d[l];if(p<c)for(l=0;l<f.channels_out;++l)d[l]=p*d[l]/c;for(l=0;l<f.channels_out;++l)n[l]+=d[l],p-=d[l];for(l=c=0;l<f.channels_out;++l)c+=n[l];if(E.MAX_BITS_PER_GRANULE<c)for(l=0;l<f.channels_out;++l)n[l]*=E.MAX_BITS_PER_GRANULE,n[l]/=c,n[l];return _},this.reduce_side=function(e,t,n,i){var o=.33*(.5-t)/.5;o<0&&(o=0),.5<o&&(o=.5);var r=0|.5*o*(e[0]+e[1]);r>E.MAX_BITS_PER_CHANNEL-e[0]&&(r=E.MAX_BITS_PER_CHANNEL-e[0]),r<0&&(r=0),125<=e[1]&&(125<e[1]-r?(e[0]<n&&(e[0]+=r),e[1]-=r):(e[0]+=e[1]-125,e[1]=125)),i<(r=e[0]+e[1])&&(e[0]=i*e[0]/r,e[1]=i*e[1]/r)},this.athAdjust=function(e,t,n){var i=90.30873362,o=P.FAST_LOG10_X(t,10),r=e*e,a=0;return o-=n,1e-20<r&&(a=1+P.FAST_LOG10_X(r,10/i)),a<0&&(a=0),o*=a,o+=n+i-94.82444863,Math.pow(10,.1*o)},this.calc_xmin=function(e,t,n,i){var o,r=0,a=e.internal_flags,c=0,l=0,f=a.ATH,d=n.xr,m=e.VBR==u.vbr_mtrh?1:0,p=a.masking_lower;for(e.VBR!=u.vbr_mtrh&&e.VBR!=u.vbr_mt||(p=1),o=0;o<n.psy_lmax;o++){T=(S=e.VBR==u.vbr_rh||e.VBR==u.vbr_mtrh?athAdjust(f.adjust,f.l[o],f.floor):f.adjust*f.l[o])/(v=n.width[o]),k=s,A=v>>1,M=0;do{M+=R=d[c]*d[c],k+=R<T?R:T,M+=C=d[++c]*d[c],k+=C<T?C:T,c++}while(0<--A);if(S<M&&l++,o==x.SBPSY_l)k<(E=S*a.nsPsy.longfact[o])&&(k=E);if(0!=m&&(S=k),!e.ATHonly)if(0<(I=t.en.l[o]))E=M*t.thm.l[o]*p/I,0!=m&&(E*=a.nsPsy.longfact[o]),S<E&&(S=E);i[r++]=0!=m?S:S*a.nsPsy.longfact[o]}var _=575;if(n.block_type!=x.SHORT_TYPE)for(var g=576;0!=g--&&h.EQ(d[g],0);)_=g;n.max_nonzero_coeff=_;for(var b=n.sfb_smin;o<n.psymax;b++,o+=3){var v,y,w;for(w=e.VBR==u.vbr_rh||e.VBR==u.vbr_mtrh?athAdjust(f.adjust,f.s[b],f.floor):f.adjust*f.s[b],v=n.width[o],y=0;y<3;y++){var S,T,k,I,E,M=0,A=v>>1;T=w/v,k=s;do{var R,C;M+=R=d[c]*d[c],k+=R<T?R:T,M+=C=d[++c]*d[c],k+=C<T?C:T,c++}while(0<--A);if(w<M&&l++,b==x.SBPSY_s)k<(E=w*a.nsPsy.shortfact[b])&&(k=E);if(S=0!=m?k:w,!e.ATHonly&&!e.ATHshort)if(0<(I=t.en.s[b][y]))E=M*t.thm.s[b][y]*p/I,0!=m&&(E*=a.nsPsy.shortfact[b]),S<E&&(S=E);i[r++]=0!=m?S:S*a.nsPsy.shortfact[b]}e.useTemporal&&(i[r-3]>i[r-3+1]&&(i[r-3+1]+=(i[r-3]-i[r-3+1])*a.decay),i[r-3+1]>i[r-3+2]&&(i[r-3+2]+=(i[r-3+1]-i[r-3+2])*a.decay))}return l},this.calc_noise_core=function(e,t,n,i){var r=0,a=t.s,s=e.l3_enc;if(a>e.count1)for(;0!=n--;)l=e.xr[a],a++,r+=l*l,l=e.xr[a],a++,r+=l*l;else if(a>e.big_values){var c=o(2);for(c[0]=0,c[1]=i;0!=n--;)l=Math.abs(e.xr[a])-c[s[a]],a++,r+=l*l,l=Math.abs(e.xr[a])-c[s[a]],a++,r+=l*l}else for(;0!=n--;){var l;l=Math.abs(e.xr[a])-g[s[a]]*i,a++,r+=l*l,l=Math.abs(e.xr[a])-g[s[a]]*i,a++,r+=l*l}return t.s=a,r},this.calc_noise=function(e,n,i,o,r){var a,s,c=0,l=0,f=0,u=0,d=0,_=-20,h=0,g=e.scalefac,b=0;for(a=o.over_SSD=0;a<e.psymax;a++){var v,y=e.global_gain-(g[b++]+(0!=e.preflag?m[a]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[a]],S=0;if(null!=r&&r.step[a]==y)S=r.noise[a],h+=e.width[a],i[c++]=S/n[l++],S=r.noise_log[a];else{var T,k=p[y+w.Q_MAX2];if(s=e.width[a]>>1,h+e.width[a]>e.max_nonzero_coeff)s=0<(T=e.max_nonzero_coeff-h+1)?T>>1:0;var x=new t(h);S=this.calc_noise_core(e,x,s,k),h=x.s,null!=r&&(r.step[a]=y,r.noise[a]=S),S=i[c++]=S/n[l++],S=P.FAST_LOG10(Math.max(S,1e-20)),null!=r&&(r.noise_log[a]=S)}if(null!=r&&(r.global_gain=e.global_gain),d+=S,0<S)v=Math.max(0|10*S+.5,1),o.over_SSD+=v*v,f++,u+=S;_=Math.max(_,S)}return o.over_count=f,o.tot_noise=d,o.over_noise=u,o.max_noise=_,f},this.set_pinfo=function(e,t,n,i,r){var a,s,c,l,f,u=e.internal_flags,d=0==t.scalefac_scale?.5:1,p=t.scalefac,_=o(N.SFBMAX),h=o(N.SFBMAX),g=new v;calc_xmin(e,n,t,_),calc_noise(t,_,h,g,null);var b=0;for(s=t.sfb_lmax,t.block_type!=x.SHORT_TYPE&&0==t.mixed_block_flag&&(s=22),a=0;a<s;a++){var y=u.scalefac_band.l[a],w=(S=u.scalefac_band.l[a+1])-y;for(l=0;b<S;b++)l+=t.xr[b]*t.xr[b];l/=w,f=1e15,u.pinfo.en[i][r][a]=f*l,u.pinfo.xfsf[i][r][a]=f*_[a]*h[a]/w,0<n.en.l[a]&&!e.ATHonly?l/=n.en.l[a]:l=0,u.pinfo.thr[i][r][a]=f*Math.max(l*n.thm.l[a],u.ATH.l[a]),(u.pinfo.LAMEsfb[i][r][a]=0)!=t.preflag&&11<=a&&(u.pinfo.LAMEsfb[i][r][a]=-d*m[a]),a<x.SBPSY_l&&(u.pinfo.LAMEsfb[i][r][a]-=d*p[a])}if(t.block_type==x.SHORT_TYPE)for(s=a,a=t.sfb_smin;a<x.SBMAX_s;a++){y=u.scalefac_band.s[a],w=(S=u.scalefac_band.s[a+1])-y;for(var S,T=0;T<3;T++){for(l=0,c=y;c<S;c++)l+=t.xr[b]*t.xr[b],b++;l=Math.max(l/w,1e-20),f=1e15,u.pinfo.en_s[i][r][3*a+T]=f*l,u.pinfo.xfsf_s[i][r][3*a+T]=f*_[s]*h[s]/w,0<n.en.s[a][T]?l/=n.en.s[a][T]:l=0,(e.ATHonly||e.ATHshort)&&(l=0),u.pinfo.thr_s[i][r][3*a+T]=f*Math.max(l*n.thm.s[a][T],u.ATH.s[a]),u.pinfo.LAMEsfb_s[i][r][3*a+T]=-2*t.subblock_gain[T],a<x.SBPSY_s&&(u.pinfo.LAMEsfb_s[i][r][3*a+T]-=d*p[s]),s++}}u.pinfo.LAMEqss[i][r]=t.global_gain,u.pinfo.LAMEmainbits[i][r]=t.part2_3_length+t.part2_length,u.pinfo.LAMEsfbits[i][r]=t.part2_length,u.pinfo.over[i][r]=g.over_count,u.pinfo.max_noise[i][r]=10*g.max_noise,u.pinfo.over_noise[i][r]=10*g.over_noise,u.pinfo.tot_noise[i][r]=10*g.tot_noise,u.pinfo.over_SSD[i][r]=g.over_SSD}}function S(){function e(e){return new Int32Array(e)}this.xr=o(576),this.l3_enc=i(576),this.scalefac=i(N.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=i(3),this.subblock_gain=i(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=i(N.SFBMAX),this.window=i(N.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=i(4),this.max_nonzero_coeff=0;var t=this;this.assign=function(n){var i;t.xr=(i=n.xr,new Float32Array(i)),t.l3_enc=e(n.l3_enc),t.scalefac=e(n.scalefac),t.xrpow_max=n.xrpow_max,t.part2_3_length=n.part2_3_length,t.big_values=n.big_values,t.count1=n.count1,t.global_gain=n.global_gain,t.scalefac_compress=n.scalefac_compress,t.block_type=n.block_type,t.mixed_block_flag=n.mixed_block_flag,t.table_select=e(n.table_select),t.subblock_gain=e(n.subblock_gain),t.region0_count=n.region0_count,t.region1_count=n.region1_count,t.preflag=n.preflag,t.scalefac_scale=n.scalefac_scale,t.count1table_select=n.count1table_select,t.part2_length=n.part2_length,t.sfb_lmax=n.sfb_lmax,t.sfb_smin=n.sfb_smin,t.psy_lmax=n.psy_lmax,t.sfbmax=n.sfbmax,t.psymax=n.psymax,t.sfbdivide=n.sfbdivide,t.width=e(n.width),t.window=e(n.window),t.count1bits=n.count1bits,t.sfb_partition_table=n.sfb_partition_table.slice(0),t.slen=e(n.slen),t.max_nonzero_coeff=n.max_nonzero_coeff}}function T(){function e(e){this.ordinal=e}function t(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function n(e,t,n,i,o){var r;switch(e){default:case 9:0<t.over_count?(r=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(r=n.bits<t.bits)):r=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:r=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&h.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=function(e,t){for(var n,i=1e-37,o=0;o<t.psymax;o++)i+=(n=e[o],P.FAST_LOG10(.368+.632*n*n*n));return Math.max(1e-20,i)}(o,i);case 1:r=n.max_noise<t.max_noise;break;case 2:r=n.tot_noise<t.tot_noise;break;case 3:r=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:r=n.max_noise<=0&&.2<t.max_noise||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&0<t.max_noise&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||0<n.max_noise&&-.05<t.max_noise&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||0<n.max_noise&&-.1<t.max_noise&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:r=n.over_noise<t.over_noise||h.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:r=n.over_noise<t.over_noise||h.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||h.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:r=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(r=r&&n.bits<t.bits),r}function r(e,n,i,o,r){var a=e.internal_flags;!function(e,t,n,i,o){var r,a=e.internal_flags;r=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var s=0,c=0;c<t.sfbmax;c++)s<n[c]&&(s=n[c]);var l=a.noise_shaping_amp;switch(3==l&&(l=o?2:1),l){case 2:break;case 1:1<s?s=Math.pow(s,.5):s*=.95;break;case 0:default:1<s?s=1:s*=.95}var f=0;for(c=0;c<t.sfbmax;c++){var u,d=t.width[c];if(f+=d,!(n[c]<s)){if(0!=(2&a.substep_shaping)&&(a.pseudohalf[c]=0==a.pseudohalf[c]?1:0,0==a.pseudohalf[c]&&2==a.noise_shaping_amp))return;for(t.scalefac[c]++,u=-d;u<0;u++)i[f+u]*=r,i[f+u]>t.xrpow_max&&(t.xrpow_max=i[f+u]);if(2==a.noise_shaping_amp)return}}}(e,n,i,o,r);var s=t(n);return!(s||(s=2==a.mode_gr?l.scale_bitcount(n):l.scale_bitcount_lsf(a,n))&&(1<a.noise_shaping&&(C.fill(a.pseudohalf,0),0==n.scalefac_scale?(function(e,t){for(var n=0,i=0;i<e.sfbmax;i++){var o=e.width[i],r=e.scalefac[i];if(0!=e.preflag&&(r+=c.pretab[i]),n+=o,0!=(1&r)){r++;for(var a=-o;a<0;a++)t[n+a]*=1.2968395546510096,t[n+a]>e.xrpow_max&&(e.xrpow_max=t[n+a])}e.scalefac[i]=r>>1}e.preflag=0,e.scalefac_scale=1}(n,o),s=!1):n.block_type==x.SHORT_TYPE&&0<a.subblock_gain&&(s=function(e,t,n){var i,o=t.scalefac;for(i=0;i<t.sfb_lmax;i++)if(16<=o[i])return!0;for(var r=0;r<3;r++){var a=0,s=0;for(i=t.sfb_lmax+r;i<t.sfbdivide;i+=3)a<o[i]&&(a=o[i]);for(;i<t.sfbmax;i+=3)s<o[i]&&(s=o[i]);if(!(a<16&&s<8)){if(7<=t.subblock_gain[r])return!0;t.subblock_gain[r]++;var l=e.scalefac_band.l[t.sfb_lmax];for(i=t.sfb_lmax+r;i<t.sfbmax;i+=3){var f=t.width[i],u=o[i];if(0<=(u-=4>>t.scalefac_scale))o[i]=u,l+=3*f;else{o[i]=0;var d=210+(u<<t.scalefac_scale+1);p=c.IPOW20(d),l+=f*(r+1);for(var m=-f;m<0;m++)n[l+m]*=p,n[l+m]>t.xrpow_max&&(t.xrpow_max=n[l+m]);l+=f*(3-r-1)}}var p=c.IPOW20(202);for(l+=t.width[i]*(r+1),m=-t.width[i];m<0;m++)n[l+m]*=p,n[l+m]>t.xrpow_max&&(t.xrpow_max=n[l+m])}}return!1}(a,n,o)||t(n))),s||(s=2==a.mode_gr?l.scale_bitcount(n):l.scale_bitcount_lsf(a,n)),s))}var a,s,c;this.rv=null,this.qupvt=null;var l,f=new function(){this.setModules=function(e,t){}};this.setModules=function(e,t,n,i){a=e,s=t,this.rv=t,c=n,this.qupvt=n,l=i,f.setModules(c,l)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var i=e.tt[t][0].xr[n],o=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(i+o)*(.5*P.SQRT2),e.tt[t][1].xr[n]=(i-o)*(.5*P.SQRT2)}},this.init_xrpow=function(e,t,n){var i=0,o=0|t.max_nonzero_coeff;if(t.xrpow_max=0,C.fill(n,o,576,0),1e-20<(i=function(e,t,n,i){for(var o=i=0;o<=n;++o){var r=Math.abs(e.xr[o]);i+=r,t[o]=Math.sqrt(r*Math.sqrt(r)),t[o]>e.xrpow_max&&(e.xrpow_max=t[o])}return i}(t,n,o,i))){var r=0;0!=(2&e.substep_shaping)&&(r=1);for(var a=0;a<t.psymax;a++)e.pseudohalf[a]=r;return!0}return C.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=x.SBPSY_l,t.sfb_smin=x.SBPSY_s,t.psy_lmax=e.sfb21_extra?x.SBMAX_l:x.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var n=0;n<x.SBMAX_l;n++)t.width[n]=e.scalefac_band.l[n+1]-e.scalefac_band.l[n],t.window[n]=3;if(t.block_type==x.SHORT_TYPE){var i=o(576);t.sfb_smin=0,(t.sfb_lmax=0)!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*e.mode_gr+4),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?x.SBMAX_s:x.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(x.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var r=e.scalefac_band.l[t.sfb_lmax];for(B.arraycopy(t.xr,0,i,0,576),n=t.sfb_smin;n<x.SBMAX_s;n++)for(var a=e.scalefac_band.s[n],s=e.scalefac_band.s[n+1],l=0;l<3;l++)for(var f=a;f<s;f++)t.xr[r++]=i[3*f+l];var u=t.sfb_lmax;for(n=t.sfb_smin;n<x.SBMAX_s;n++)t.width[u]=t.width[u+1]=t.width[u+2]=e.scalefac_band.s[n+1]-e.scalefac_band.s[n],t.window[u]=0,t.window[u+1]=1,t.window[u+2]=2,u+=3}t.count1bits=0,t.sfb_partition_table=c.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,C.fill(t.scalefac,0),function(e,t){var n=e.ATH,i=t.xr;if(t.block_type!=x.SHORT_TYPE)for(var o=!1,r=x.PSFB21-1;0<=r&&!o;r--){var a=e.scalefac_band.psfb21[r],s=e.scalefac_band.psfb21[r+1],l=c.athAdjust(n.adjust,n.psfb21[r],n.floor);1e-12<e.nsPsy.longfact[21]&&(l*=e.nsPsy.longfact[21]);for(var f=s-1;a<=f;f--){if(!(Math.abs(i[f])<l)){o=!0;break}i[f]=0}}else for(var u=0;u<3;u++)for(o=!1,r=x.PSFB12-1;0<=r&&!o;r--){s=(a=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*u+(e.scalefac_band.psfb12[r]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[r+1]-e.scalefac_band.psfb12[r]);var d=c.athAdjust(n.adjust,n.psfb12[r],n.floor);for(1e-12<e.nsPsy.shortfact[12]&&(d*=e.nsPsy.shortfact[12]),f=s-1;a<=f;f--){if(!(Math.abs(i[f])<d)){o=!0;break}i[f]=0}}}(e,t)},e.BINSEARCH_NONE=new e(0),e.BINSEARCH_UP=new e(1),e.BINSEARCH_DOWN=new e(2),this.trancate_smallspectrums=function(e,t,n,i){var r=o(N.SFBMAX);if((0!=(4&e.substep_shaping)||t.block_type!=x.SHORT_TYPE)&&0==(128&e.substep_shaping)){c.calc_noise(t,n,r,new v,null);for(var a=0;a<576;a++){var s=0;0!=t.l3_enc[a]&&(s=Math.abs(t.xr[a])),i[a]=s}a=0;var f=8;t.block_type==x.SHORT_TYPE&&(f=6);do{var u,d,m,p,_=t.width[f];if(a+=_,!(1<=r[f]||(C.sort(i,a-_,_),h.EQ(i[a-1],0)))){u=(1-r[f])*n[f],p=d=0;do{var g;for(m=1;p+m<_&&!h.NEQ(i[p+a-_],i[p+a+m-_]);m++);if(u<(g=i[p+a-_]*i[p+a-_]*m)){0!=p&&(d=i[p+a-_-1]);break}u-=g,p+=m}while(p<_);if(!h.EQ(d,0))for(;Math.abs(t.xr[a-_])<=d&&(t.l3_enc[a-_]=0),0<--_;);}}while(++f<t.psymax);t.part2_3_length=l.noquant_count_bits(e,t,null)}},this.outer_loop=function(t,a,s,f,d,m){var p=t.internal_flags,_=new S,h=o(576),g=o(N.SFBMAX),b=new v,y=new function(){this.global_gain=0,this.sfb_count1=0,this.step=i(39),this.noise=o(39),this.noise_log=o(39)},w=9999999,T=!1,k=!1,I=0;if(function(t,n,i,o,r){var a,s=t.CurrentStep[o],c=!1,f=t.OldValue[o],u=e.BINSEARCH_NONE;for(n.global_gain=f,i-=n.part2_length;;){var d;if(a=l.count_bits(t,r,n,null),1==s||a==i)break;i<a?(u==e.BINSEARCH_DOWN&&(c=!0),c&&(s/=2),u=e.BINSEARCH_UP,d=s):(u==e.BINSEARCH_UP&&(c=!0),c&&(s/=2),u=e.BINSEARCH_DOWN,d=-s),n.global_gain+=d,n.global_gain<0&&(c=!(n.global_gain=0)),255<n.global_gain&&(n.global_gain=255,c=!0)}for(;i<a&&n.global_gain<255;)n.global_gain++,a=l.count_bits(t,r,n,null);t.CurrentStep[o]=4<=f-n.global_gain?4:2,t.OldValue[o]=n.global_gain,n.part2_3_length=a}(p,a,m,d,f),0==p.noise_shaping)return 100;c.calc_noise(a,s,g,b,y),b.bits=a.part2_3_length,_.assign(a);var E=0;for(B.arraycopy(f,0,h,0,576);!T;){do{var M,A=new v,R=255;if(M=0!=(2&p.substep_shaping)?20:3,p.sfb21_extra){if(1<g[_.sfbmax])break;if(_.block_type==x.SHORT_TYPE&&(1<g[_.sfbmax+1]||1<g[_.sfbmax+2]))break}if(!r(t,_,g,f,k))break;0!=_.scalefac_scale&&(R=254);var C=m-_.part2_length;if(C<=0)break;for(;(_.part2_3_length=l.count_bits(p,f,_,y))>C&&_.global_gain<=R;)_.global_gain++;if(_.global_gain>R)break;if(0==b.over_count){for(;(_.part2_3_length=l.count_bits(p,f,_,y))>w&&_.global_gain<=R;)_.global_gain++;if(_.global_gain>R)break}if(c.calc_noise(_,s,g,A,y),A.bits=_.part2_3_length,0!=(n(a.block_type!=x.SHORT_TYPE?t.quant_comp:t.quant_comp_short,b,A,_,g)?1:0))w=a.part2_3_length,b=A,a.assign(_),E=0,B.arraycopy(f,0,h,0,576);else if(0==p.full_outer_loop){if(++E>M&&0==b.over_count)break;if(3==p.noise_shaping_amp&&k&&30<E)break;if(3==p.noise_shaping_amp&&k&&15<_.global_gain-I)break}}while(_.global_gain+_.scalefac_scale<255);3==p.noise_shaping_amp?k?T=!0:(_.assign(a),B.arraycopy(h,0,f,0,576),E=0,I=_.global_gain,k=!0):T=!0}return t.VBR==u.vbr_rh||t.VBR==u.vbr_mtrh?B.arraycopy(h,0,f,0,576):0!=(1&p.substep_shaping)&&trancate_smallspectrums(p,a,s,f),b.over_count},this.iteration_finish_one=function(e,t,n){var i=e.l3_side,o=i.tt[t][n];l.best_scalefac_store(e,t,n,i),1==e.use_best_huffman&&l.best_huffman_divide(e,o),s.ResvAdjust(e,o)},this.VBR_encode_granule=function(e,t,n,i,r,a,s){var c,l=e.internal_flags,f=new S,u=o(576),d=s,m=s+1,p=(s+a)/2,_=0,h=l.sfb21_extra;for(C.fill(f.l3_enc,0);l.sfb21_extra=!(d-42<p)&&h,outer_loop(e,t,n,i,r,p)<=0?(_=1,m=t.part2_3_length,f.assign(t),B.arraycopy(i,0,u,0,576),c=(s=m-32)-a,p=(s+a)/2):(c=s-(a=p+32),p=(s+a)/2,0!=_&&(_=2,t.assign(f),B.arraycopy(u,0,i,0,576))),12<c;);l.sfb21_extra=h,2==_&&B.arraycopy(f.l3_enc,0,t.l3_enc,0,576)},this.get_framebits=function(e,t){var n=e.internal_flags;n.bitrate_index=n.VBR_min_bitrate;var i=a.getframebits(e);n.bitrate_index=1,i=a.getframebits(e);for(var o=1;o<=n.VBR_max_bitrate;o++){n.bitrate_index=o;var r=new b(i);t[o]=s.ResvFrameBegin(e,r),i=r.bits}},this.VBR_old_prepare=function(e,t,n,i,o,r,a,l,f){var u,d=e.internal_flags,m=0,p=1,_=0;d.bitrate_index=d.VBR_max_bitrate;var h=s.ResvFrameBegin(e,new b(0))/d.mode_gr;get_framebits(e,r);for(var g=0;g<d.mode_gr;g++){var v=c.on_pe(e,t,l[g],h,g,0);d.mode_ext==x.MPG_MD_MS_LR&&(ms_convert(d.l3_side,g),c.reduce_side(l[g],n[g],h,v));for(var y=0;y<d.channels_out;++y){var w=d.l3_side.tt[g][y];w.block_type!=x.SHORT_TYPE?(m=1.28/(1+Math.exp(3.5-t[g][y]/300))-.05,u=d.PSY.mask_adjust-m):(m=2.56/(1+Math.exp(3.5-t[g][y]/300))-.14,u=d.PSY.mask_adjust_short-m),d.masking_lower=Math.pow(10,.1*u),init_outer_loop(d,w),f[g][y]=c.calc_xmin(e,i[g][y],w,o[g][y]),0!=f[g][y]&&(p=0),a[g][y]=126,_+=l[g][y]}}for(g=0;g<d.mode_gr;g++)for(y=0;y<d.channels_out;y++)_>r[d.VBR_max_bitrate]&&(l[g][y]*=r[d.VBR_max_bitrate],l[g][y]/=_),a[g][y]>l[g][y]&&(a[g][y]=l[g][y]);return p},this.bitpressure_strategy=function(e,t,n,i){for(var o=0;o<e.mode_gr;o++)for(var r=0;r<e.channels_out;r++){for(var a=e.l3_side.tt[o][r],s=t[o][r],c=0,l=0;l<a.psy_lmax;l++)s[c++]*=1+.029*l*l/x.SBMAX_l/x.SBMAX_l;if(a.block_type==x.SHORT_TYPE)for(l=a.sfb_smin;l<x.SBMAX_s;l++)s[c++]*=1+.029*l*l/x.SBMAX_s/x.SBMAX_s,s[c++]*=1+.029*l*l/x.SBMAX_s/x.SBMAX_s,s[c++]*=1+.029*l*l/x.SBMAX_s/x.SBMAX_s;i[o][r]=0|Math.max(n[o][r],.9*i[o][r])}},this.VBR_new_prepare=function(e,t,n,i,o,r){var a,l=e.internal_flags,f=1,u=0,d=0;if(e.free_format)l.bitrate_index=0,m=new b(u),a=s.ResvFrameBegin(e,m),u=m.bits,o[0]=a;else{l.bitrate_index=l.VBR_max_bitrate;var m=new b(u);s.ResvFrameBegin(e,m),u=m.bits,get_framebits(e,o),a=o[l.VBR_max_bitrate]}for(var p=0;p<l.mode_gr;p++){c.on_pe(e,t,r[p],u,p,0),l.mode_ext==x.MPG_MD_MS_LR&&ms_convert(l.l3_side,p);for(var _=0;_<l.channels_out;++_){var h=l.l3_side.tt[p][_];l.masking_lower=Math.pow(10,.1*l.PSY.mask_adjust),init_outer_loop(l,h),0!=c.calc_xmin(e,n[p][_],h,i[p][_])&&(f=0),d+=r[p][_]}}for(p=0;p<l.mode_gr;p++)for(_=0;_<l.channels_out;_++)a<d&&(r[p][_]*=a,r[p][_]/=d);return f},this.calc_target_bits=function(e,t,n,i,o,r){var l,f,u,d,m=e.internal_flags,p=m.l3_side,_=0;m.bitrate_index=m.VBR_max_bitrate;var h=new b(_);for(r[0]=s.ResvFrameBegin(e,h),_=h.bits,m.bitrate_index=1,_=a.getframebits(e)-8*m.sideinfo_len,o[0]=_/(m.mode_gr*m.channels_out),_=e.VBR_mean_bitrate_kbps*e.framesize*1e3,0!=(1&m.substep_shaping)&&(_*=1.09),_/=e.out_samplerate,_-=8*m.sideinfo_len,_/=m.mode_gr*m.channels_out,(l=.93+.07*(11-e.compression_ratio)/5.5)<.9&&(l=.9),1<l&&(l=1),f=0;f<m.mode_gr;f++){var g=0;for(u=0;u<m.channels_out;u++){if(i[f][u]=int(l*_),700<t[f][u]){var v=int((t[f][u]-700)/1.4),y=p.tt[f][u];i[f][u]=int(l*_),y.block_type==x.SHORT_TYPE&&v<_/2&&(v=_/2),3*_/2<v?v=3*_/2:v<0&&(v=0),i[f][u]+=v}i[f][u]>E.MAX_BITS_PER_CHANNEL&&(i[f][u]=E.MAX_BITS_PER_CHANNEL),g+=i[f][u]}if(E.MAX_BITS_PER_GRANULE<g)for(u=0;u<m.channels_out;++u)i[f][u]*=E.MAX_BITS_PER_GRANULE,i[f][u]/=g}if(m.mode_ext==x.MPG_MD_MS_LR)for(f=0;f<m.mode_gr;f++)c.reduce_side(i[f],n[f],_*m.channels_out,E.MAX_BITS_PER_GRANULE);for(f=d=0;f<m.mode_gr;f++)for(u=0;u<m.channels_out;u++)i[f][u]>E.MAX_BITS_PER_CHANNEL&&(i[f][u]=E.MAX_BITS_PER_CHANNEL),d+=i[f][u];if(d>r[0])for(f=0;f<m.mode_gr;f++)for(u=0;u<m.channels_out;u++)i[f][u]*=r[0],i[f][u]/=d}}function k(){this.thm=new I,this.en=new I}function x(){var e=x.FFTOFFSET,t=x.MPG_MD_MS_LR,n=null,r=this.psy=null,s=null,c=null;this.setModules=function(e,t,i,o){n=e,this.psy=t,r=t,s=o,c=i};var f=new function(){function e(e,t,i){for(var o,r,a,s=10,c=t+238-14-286,l=-15;l<0;l++){var f,u,d;f=n[s+-10],u=e[c+-224]*f,d=e[t+224]*f,f=n[s+-9],u+=e[c+-160]*f,d+=e[t+160]*f,f=n[s+-8],u+=e[c+-96]*f,d+=e[t+96]*f,f=n[s+-7],u+=e[c+-32]*f,d+=e[t+32]*f,f=n[s+-6],u+=e[c+32]*f,d+=e[t+-32]*f,f=n[s+-5],u+=e[c+96]*f,d+=e[t+-96]*f,f=n[s+-4],u+=e[c+160]*f,d+=e[t+-160]*f,f=n[s+-3],u+=e[c+224]*f,d+=e[t+-224]*f,f=n[s+-2],u+=e[t+-256]*f,d-=e[c+256]*f,f=n[s+-1],u+=e[t+-192]*f,d-=e[c+192]*f,f=n[s+0],u+=e[t+-128]*f,d-=e[c+128]*f,f=n[s+1],u+=e[t+-64]*f,d-=e[c+64]*f,f=n[s+2],u+=e[t+0]*f,d-=e[c+0]*f,f=n[s+3],u+=e[t+64]*f,d-=e[c+-64]*f,f=n[s+4],u+=e[t+128]*f,d-=e[c+-128]*f,f=n[s+5],u+=e[t+192]*f,f=(d-=e[c+-192]*f)-(u*=n[s+6]),i[30+2*l]=d+u,i[31+2*l]=n[s+7]*f,s+=18,t--,c++}d=e[t+-16]*n[s+-10],u=e[t+-32]*n[s+-2],d+=(e[t+-48]-e[t+16])*n[s+-9],u+=e[t+-96]*n[s+-1],d+=(e[t+-80]+e[t+48])*n[s+-8],u+=e[t+-160]*n[s+0],d+=(e[t+-112]-e[t+80])*n[s+-7],u+=e[t+-224]*n[s+1],d+=(e[t+-144]+e[t+112])*n[s+-6],u-=e[t+32]*n[s+2],d+=(e[t+-176]-e[t+144])*n[s+-5],u-=e[t+96]*n[s+3],d+=(e[t+-208]+e[t+176])*n[s+-4],u-=e[t+160]*n[s+4],d+=(e[t+-240]-e[t+208])*n[s+-3],o=(u-=e[t+224])-d,r=u+d,d=i[14],u=i[15]-d,i[31]=r+d,i[30]=o+u,i[15]=o-u,i[14]=r-d,a=i[28]-i[0],i[0]+=i[28],i[28]=a*n[s+-36+7],a=i[29]-i[1],i[1]+=i[29],i[29]=a*n[s+-36+7],a=i[26]-i[2],i[2]+=i[26],i[26]=a*n[s+-72+7],a=i[27]-i[3],i[3]+=i[27],i[27]=a*n[s+-72+7],a=i[24]-i[4],i[4]+=i[24],i[24]=a*n[s+-108+7],a=i[25]-i[5],i[5]+=i[25],i[25]=a*n[s+-108+7],a=i[22]-i[6],i[6]+=i[22],i[22]=a*P.SQRT2,a=i[23]-i[7],i[7]+=i[23],i[23]=a*P.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],a=i[6],i[6]=i[31]-a,i[31]=i[31]+a,a=i[7],i[7]=i[30]-a,i[30]=i[30]+a,a=i[22],i[22]=i[15]-a,i[15]=i[15]+a,a=i[23],i[23]=i[14]-a,i[14]=i[14]+a,a=i[20]-i[8],i[8]+=i[20],i[20]=a*n[s+-180+7],a=i[21]-i[9],i[9]+=i[21],i[21]=a*n[s+-180+7],a=i[18]-i[10],i[10]+=i[18],i[18]=a*n[s+-216+7],a=i[19]-i[11],i[11]+=i[19],i[19]=a*n[s+-216+7],a=i[16]-i[12],i[12]+=i[16],i[16]=a*n[s+-252+7],a=i[17]-i[13],i[13]+=i[17],i[17]=a*n[s+-252+7],a=-i[20]+i[24],i[20]+=i[24],i[24]=a*n[s+-216+7],a=-i[21]+i[25],i[21]+=i[25],i[25]=a*n[s+-216+7],a=i[4]-i[8],i[4]+=i[8],i[8]=a*n[s+-216+7],a=i[5]-i[9],i[5]+=i[9],i[9]=a*n[s+-216+7],a=i[0]-i[12],i[0]+=i[12],i[12]=a*n[s+-72+7],a=i[1]-i[13],i[1]+=i[13],i[13]=a*n[s+-72+7],a=i[16]-i[28],i[16]+=i[28],i[28]=a*n[s+-72+7],a=-i[17]+i[29],i[17]+=i[29],i[29]=a*n[s+-72+7],a=P.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=a,a=P.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=a,a=P.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=a-i[18],a=P.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=a-i[19],a=i[2],i[19]-=i[3],i[3]-=a,i[2]=i[31]-a,i[31]+=a,a=i[3],i[11]-=i[19],i[18]-=a,i[3]=i[30]-a,i[30]+=a,a=i[18],i[27]-=i[11],i[19]-=a,i[18]=i[15]-a,i[15]+=a,a=i[19],i[10]-=a,i[19]=i[14]-a,i[14]+=a,a=i[10],i[11]-=a,i[10]=i[23]-a,i[23]+=a,a=i[11],i[26]-=a,i[11]=i[22]-a,i[22]+=a,a=i[26],i[27]-=a,i[26]=i[7]-a,i[7]+=a,a=i[27],i[27]=i[6]-a,i[6]+=a,a=P.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=a,a=P.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=a,a=P.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=a,a=P.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=a,a=-P.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=a-i[8],a=-P.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=a-i[9],a=-P.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=a-i[25],a=-P.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=a-i[24],a=i[24]-i[16],i[24]=a,a=i[20]-a,i[20]=a,a=i[28]-a,i[28]=a,a=i[25]-i[17],i[25]=a,a=i[21]-a,i[21]=a,a=i[29]-a,i[29]=a,a=i[17]-i[1],i[17]=a,a=i[9]-a,i[9]=a,a=i[25]-a,i[25]=a,a=i[5]-a,i[5]=a,a=i[21]-a,i[21]=a,a=i[13]-a,i[13]=a,a=i[29]-a,i[29]=a,a=i[1]-i[0],i[1]=a,a=i[16]-a,i[16]=a,a=i[17]-a,i[17]=a,a=i[8]-a,i[8]=a,a=i[9]-a,i[9]=a,a=i[24]-a,i[24]=a,a=i[25]-a,i[25]=a,a=i[4]-a,i[4]=a,a=i[5]-a,i[5]=a,a=i[20]-a,i[20]=a,a=i[21]-a,i[21]=a,a=i[12]-a,i[12]=a,a=i[13]-a,i[13]=a,a=i[28]-a,i[28]=a,a=i[29]-a,i[29]=a,a=i[0],i[0]+=i[31],i[31]-=a,a=i[1],i[1]+=i[30],i[30]-=a,a=i[16],i[16]+=i[15],i[15]-=a,a=i[17],i[17]+=i[14],i[14]-=a,a=i[8],i[8]+=i[23],i[23]-=a,a=i[9],i[9]+=i[22],i[22]-=a,a=i[24],i[24]+=i[7],i[7]-=a,a=i[25],i[25]+=i[6],i[6]-=a,a=i[4],i[4]+=i[27],i[27]-=a,a=i[5],i[5]+=i[26],i[26]-=a,a=i[20],i[20]+=i[11],i[11]-=a,a=i[21],i[21]+=i[10],i[10]-=a,a=i[12],i[12]+=i[19],i[19]-=a,a=i[13],i[13]+=i[18],i[18]-=a,a=i[28],i[28]+=i[3],i[3]-=a,a=i[29],i[29]+=i[2],i[2]-=a}function t(e,t){for(var n=0;n<3;n++){var o,r,a,s,c,l;r=(s=e[t+6]*i[x.SHORT_TYPE][0]-e[t+15])+(o=e[t+0]*i[x.SHORT_TYPE][2]-e[t+9]),a=s-o,c=(s=e[t+15]*i[x.SHORT_TYPE][0]+e[t+6])+(o=e[t+9]*i[x.SHORT_TYPE][2]+e[t+0]),l=-s+o,o=2.069978111953089e-11*(e[t+3]*i[x.SHORT_TYPE][1]-e[t+12]),s=2.069978111953089e-11*(e[t+12]*i[x.SHORT_TYPE][1]+e[t+3]),e[t+0]=1.90752519173728e-11*r+o,e[t+15]=1.90752519173728e-11*-c+s,a=.8660254037844387*a*1.907525191737281e-11,c=.5*c*1.907525191737281e-11+s,e[t+3]=a-c,e[t+6]=a+c,r=.5*r*1.907525191737281e-11-o,l=.8660254037844387*l*1.907525191737281e-11,e[t+9]=r+l,e[t+12]=r-l,t++}}var n=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*P.SQRT2*.5/2384e-9,.017876148*P.SQRT2*.5/2384e-9,.003134727*P.SQRT2*.5/2384e-9,.002457142*P.SQRT2*.5/2384e-9,971317e-9*P.SQRT2*.5/2384e-9,218868e-9*P.SQRT2*.5/2384e-9,101566e-9*P.SQRT2*.5/2384e-9,13828e-9*P.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],i=[[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.40084909404969e-13,6.423305872147839e-13,2.382191739347918e-13,5.456116108943412e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758252e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558783e-12,8.371015190102974e-13,2.599706096327376e-13,-5.456116108943412e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758252e-12,-2.858043359288076e-12,-2.156177623817898e-12,-1.475637723558783e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347923e-13,-6.423305872147843e-13,-9.400849094049696e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049694e-13,-6.42330587214784e-13,-2.382191739347918e-13],[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.400849094049688e-13,6.423305872147841e-13,2.382191739347918e-13,5.456116108943413e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758253e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558782e-12,8.371015190102975e-13,2.599706096327376e-13,-5.461314069809755e-12,-4.921085770524055e-12,-4.343405037091838e-12,-3.732668368707687e-12,-3.093523840190885e-12,-2.430835727329465e-12,-1.734679010007751e-12,-9.74825365660928e-13,-2.797435120168326e-13,0,0,0,0,0,0,-2.283748241799531e-13,-4.037858874020686e-13,-2.146547464825323e-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531e-13,4.037858874020686e-13,2.146547464825323e-13,5.461314069809755e-12,4.921085770524055e-12,4.343405037091838e-12,3.732668368707687e-12,3.093523840190885e-12,2.430835727329466e-12,1.734679010007751e-12,9.74825365660928e-13,2.797435120168326e-13,-5.456116108943413e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758253e-12,-2.858043359288075e-12,-2.156177623817898e-12,-1.475637723558782e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347913e-13,-6.423305872147834e-13,-9.400849094049688e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049688e-13,-6.423305872147841e-13,-2.382191739347918e-13]],r=i[x.SHORT_TYPE],a=i[x.SHORT_TYPE],s=i[x.SHORT_TYPE],c=i[x.SHORT_TYPE],l=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];this.mdct_sub48=function(n,f,u){for(var d,m,p,_,h,g,b,v,y,w,S,T,k,I,E,M,A,R,P,L,O,N=f,D=286,H=0;H<n.channels_out;H++){for(var q=0;q<n.mode_gr;q++){for(var j,U=n.l3_side.tt[q][H],F=U.xr,V=0,Y=n.sb_sample[H][1-q],W=0,X=0;X<9;X++)for(e(N,D,Y[W]),e(N,D+32,Y[W+1]),W+=2,D+=64,j=1;j<32;j+=2)Y[W-1][j]*=-1;for(j=0;j<32;j++,V+=18){var G=U.block_type,z=n.sb_sample[H][q],K=n.sb_sample[H][1-q];if(0!=U.mixed_block_flag&&j<2&&(G=0),n.amp_filter[j]<1e-12)C.fill(F,V+0,V+18,0);else{if(n.amp_filter[j]<1)for(X=0;X<18;X++)K[X][l[j]]*=n.amp_filter[j];if(G==x.SHORT_TYPE){for(X=-3;X<0;X++){var Q=i[x.SHORT_TYPE][X+3];F[V+3*X+9]=z[9+X][l[j]]*Q-z[8-X][l[j]],F[V+3*X+18]=z[14-X][l[j]]*Q+z[15+X][l[j]],F[V+3*X+10]=z[15+X][l[j]]*Q-z[14-X][l[j]],F[V+3*X+19]=K[2-X][l[j]]*Q+K[3+X][l[j]],F[V+3*X+11]=K[3+X][l[j]]*Q-K[2-X][l[j]],F[V+3*X+20]=K[8-X][l[j]]*Q+K[9+X][l[j]]}t(F,V)}else{var Z=o(18);for(X=-9;X<0;X++){var J,$;J=i[G][X+27]*K[X+9][l[j]]+i[G][X+36]*K[8-X][l[j]],$=i[G][X+9]*z[X+9][l[j]]-i[G][X+18]*z[8-X][l[j]],Z[X+9]=J-$*r[3+X+9],Z[X+18]=J*r[3+X+9]+$}d=F,m=V,O=L=P=R=A=M=E=I=k=T=S=w=y=v=b=g=h=_=void 0,g=(p=Z)[17]-p[9],v=p[15]-p[11],y=p[14]-p[12],w=p[0]+p[8],S=p[1]+p[7],T=p[2]+p[6],k=p[3]+p[5],d[m+17]=w+T-k-(S-p[4]),h=(w+T-k)*a[19]+(S-p[4]),_=(g-v-y)*a[18],d[m+5]=_+h,d[m+6]=_-h,b=(p[16]-p[10])*a[18],S=S*a[19]+p[4],_=g*a[12]+b+v*a[13]+y*a[14],h=-w*a[16]+S-T*a[17]+k*a[15],d[m+1]=_+h,d[m+2]=_-h,_=g*a[13]-b-v*a[14]+y*a[12],h=-w*a[17]+S-T*a[15]+k*a[16],d[m+9]=_+h,d[m+10]=_-h,_=g*a[14]-b+v*a[12]-y*a[13],h=w*a[15]-S+T*a[16]-k*a[17],d[m+13]=_+h,d[m+14]=_-h,I=p[8]-p[0],M=p[6]-p[2],A=p[5]-p[3],R=p[17]+p[9],P=p[16]+p[10],L=p[15]+p[11],O=p[14]+p[12],d[m+0]=R+L+O+(P+p[13]),_=(R+L+O)*a[19]-(P+p[13]),h=(I-M+A)*a[18],d[m+11]=_+h,d[m+12]=_-h,E=(p[7]-p[1])*a[18],P=p[13]-P*a[19],_=R*a[15]-P+L*a[16]+O*a[17],h=I*a[14]+E+M*a[12]+A*a[13],d[m+3]=_+h,d[m+4]=_-h,_=-R*a[17]+P-L*a[15]-O*a[16],h=I*a[13]+E-M*a[14]-A*a[12],d[m+7]=_+h,d[m+8]=_-h,_=-R*a[16]+P-L*a[17]-O*a[15],h=I*a[12]-E+M*a[13]-A*a[14],d[m+15]=_+h,d[m+16]=_-h}}if(G!=x.SHORT_TYPE&&0!=j)for(X=7;0<=X;--X){var ee,te;ee=F[V+X]*s[20+X]+F[V+-1-X]*c[28+X],te=F[V+X]*c[28+X]-F[V+-1-X]*s[20+X],F[V+-1-X]=ee,F[V+X]=te}}}if(N=u,D=286,1==n.mode_gr)for(var ne=0;ne<18;ne++)B.arraycopy(n.sb_sample[H][1][ne],0,n.sb_sample[H][0][ne],0,32)}}};this.lame_encode_mp3_frame=function(m,p,_,h,g,b){var v,y=l([2,2]);y[0][0]=new k,y[0][1]=new k,y[1][0]=new k,y[1][1]=new k;var w,S=l([2,2]);S[0][0]=new k,S[0][1]=new k,S[1][0]=new k,S[1][1]=new k;var T,I,E,M=[null,null],A=m.internal_flags,R=a([2,4]),C=[.5,.5],P=[[0,0],[0,0]],L=[[0,0],[0,0]];if(M[0]=p,M[1]=_,0==A.lame_encode_frame_init&&function(e,t){var n,i,r=e.internal_flags;if(0==r.lame_encode_frame_init){var a,s,c=o(2014),l=o(2014);for(r.lame_encode_frame_init=1,s=a=0;a<286+576*(1+r.mode_gr);++a)a<576*r.mode_gr?(c[a]=0,2==r.channels_out&&(l[a]=0)):(c[a]=t[0][s],2==r.channels_out&&(l[a]=t[1][s]),++s);for(i=0;i<r.mode_gr;i++)for(n=0;n<r.channels_out;n++)r.l3_side.tt[i][n].block_type=x.SHORT_TYPE;f.mdct_sub48(r,c,l)}}(m,M),A.padding=0,(A.slot_lag-=A.frac_SpF)<0&&(A.slot_lag+=m.out_samplerate,A.padding=1),0!=A.psymodel){var O=[null,null],N=0,D=i(2);for(E=0;E<A.mode_gr;E++){for(I=0;I<A.channels_out;I++)O[I]=M[I],N=576+576*E-x.FFTOFFSET;if(0!=(m.VBR==u.vbr_mtrh||m.VBR==u.vbr_mt?r.L3psycho_anal_vbr(m,O,N,E,y,S,P[E],L[E],R[E],D):r.L3psycho_anal_ns(m,O,N,E,y,S,P[E],L[E],R[E],D)))return-4;for(m.mode==d.JOINT_STEREO&&(C[E]=R[E][2]+R[E][3],0<C[E]&&(C[E]=R[E][3]/C[E])),I=0;I<A.channels_out;I++){var H=A.l3_side.tt[E][I];H.block_type=D[I],H.mixed_block_flag=0}}}else for(E=0;E<A.mode_gr;E++)for(I=0;I<A.channels_out;I++)A.l3_side.tt[E][I].block_type=x.NORM_TYPE,A.l3_side.tt[E][I].mixed_block_flag=0,L[E][I]=P[E][I]=700;if(function(e){var t,n;if(0!=e.ATH.useAdjust)if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,.03125<(n*=e.ATH.aaSensitivityP))1<=e.ATH.adjust?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var i=31.98*n+625e-6;e.ATH.adjust>=i?(e.ATH.adjust*=.075*i+.925,e.ATH.adjust<i&&(e.ATH.adjust=i)):e.ATH.adjustLimit>=i?e.ATH.adjust=i:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=i}else e.ATH.adjust=1}(A),f.mdct_sub48(A,M[0],M[1]),A.mode_ext=x.MPG_MD_LR_LR,m.force_ms)A.mode_ext=x.MPG_MD_MS_LR;else if(m.mode==d.JOINT_STEREO){var q=0,j=0;for(E=0;E<A.mode_gr;E++)for(I=0;I<A.channels_out;I++)q+=L[E][I],j+=P[E][I];if(q<=1*j){var U=A.l3_side.tt[0],F=A.l3_side.tt[A.mode_gr-1];U[0].block_type==U[1].block_type&&F[0].block_type==F[1].block_type&&(A.mode_ext=x.MPG_MD_MS_LR)}}if(A.mode_ext==t?(w=S,T=L):(w=y,T=P),m.analysis&&null!=A.pinfo)for(E=0;E<A.mode_gr;E++)for(I=0;I<A.channels_out;I++)A.pinfo.ms_ratio[E]=A.ms_ratio[E],A.pinfo.ms_ener_ratio[E]=C[E],A.pinfo.blocktype[E][I]=A.l3_side.tt[E][I].block_type,A.pinfo.pe[E][I]=T[E][I],B.arraycopy(A.l3_side.tt[E][I].xr,0,A.pinfo.xr[E][I],0,576),A.mode_ext==t&&(A.pinfo.ers[E][I]=A.pinfo.ers[E][I+2],B.arraycopy(A.pinfo.energy[E][I+2],0,A.pinfo.energy[E][I],0,A.pinfo.energy[E][I].length));if(m.VBR==u.vbr_off||m.VBR==u.vbr_abr){var V,Y;for(V=0;V<18;V++)A.nsPsy.pefirbuf[V]=A.nsPsy.pefirbuf[V+1];for(E=Y=0;E<A.mode_gr;E++)for(I=0;I<A.channels_out;I++)Y+=T[E][I];for(A.nsPsy.pefirbuf[18]=Y,Y=A.nsPsy.pefirbuf[9],V=0;V<9;V++)Y+=(A.nsPsy.pefirbuf[V]+A.nsPsy.pefirbuf[18-V])*x.fircoef[V];for(Y=3350*A.mode_gr*A.channels_out/Y,E=0;E<A.mode_gr;E++)for(I=0;I<A.channels_out;I++)T[E][I]*=Y}if(A.iteration_loop.iteration_loop(m,T,C,w),n.format_bitstream(m),v=n.copy_buffer(A,h,g,b,1),m.bWriteVbrTag&&s.addVbrFrame(m),m.analysis&&null!=A.pinfo){for(I=0;I<A.channels_out;I++){var W;for(W=0;W<e;W++)A.pinfo.pcmdata[I][W]=A.pinfo.pcmdata[I][W+m.framesize];for(W=e;W<1600;W++)A.pinfo.pcmdata[I][W]=M[I][W-e]}c.set_frame_pinfo(m,w)}return function(e){var t,n;for(e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var i=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(i=4),e.bitrate_blockType_Hist[e.bitrate_index][i]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][i]++,e.bitrate_blockType_Hist[15][5]++}}(A),v}}function I(){this.l=o(x.SBMAX_l),this.s=a([x.SBMAX_s,3]);var e=this;this.assign=function(t){B.arraycopy(t.l,0,e.l,0,x.SBMAX_l);for(var n=0;n<x.SBMAX_s;n++)for(var i=0;i<3;i++)e.s[n][i]=t.s[n][i]}}function E(){function e(){this.write_timing=0,this.ptr=0,this.buf=t(n)}var n=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=a([2,E.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[i(4),i(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new S},this.ms_ratio=o(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=i(2),this.CurrentStep=i(2),this.masking_lower=0,this.bv_scf=i(576),this.pseudohalf=i(N.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*E.BPC+1),this.itime=r(2),this.sideinfo_len=0,this.sb_sample=a([2,2,18,x.SBLIMIT]),this.amp_filter=o(32),this.header=new Array(E.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new y,this.minval_l=o(x.CBANDS),this.minval_s=o(x.CBANDS),this.nb_1=a([4,x.CBANDS]),this.nb_2=a([4,x.CBANDS]),this.nb_s1=a([4,x.CBANDS]),this.nb_s2=a([4,x.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=o(4),this.loudness_sq=a([2,2]),this.loudness_sq_save=o(2),this.mld_l=o(x.SBMAX_l),this.mld_s=o(x.SBMAX_s),this.bm_l=i(x.SBMAX_l),this.bo_l=i(x.SBMAX_l),this.bm_s=i(x.SBMAX_s),this.bo_s=i(x.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=s([x.CBANDS,2]),this.s3ind_s=s([x.CBANDS,2]),this.numlines_s=i(x.CBANDS),this.numlines_l=i(x.CBANDS),this.rnumlines_l=o(x.CBANDS),this.mld_cb_l=o(x.CBANDS),this.mld_cb_s=o(x.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=o(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=i(2),this.nsPsy=new function(){this.last_en_subshort=a([4,9]),this.lastAttacks=i(4),this.pefirbuf=o(19),this.longfact=o(x.SBMAX_l),this.shortfact=o(x.SBMAX_s),this.attackthre=0,this.attackthre_s=0},this.VBR_seek_table=new function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=s([16,5]),this.bitrate_blockType_Hist=s([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var c=0;c<this.en.length;c++)this.en[c]=new I;for(c=0;c<this.thm.length;c++)this.thm[c]=new I;for(c=0;c<this.header.length;c++)this.header[c]=new e}function M(){function e(e){return e}function t(e,t){for(var n=0,i=0;i<x.BLKSIZE/2;++i)n+=e[i]*t.ATH.eql_w[i];return n*=G}function n(n,i,o,r,a,s,c,l,f,u,d){var m=n.internal_flags;if(f<2)j.fft_long(m,r[a],f,u,d),j.fft_short(m,s[c],f,u,d);else if(2==f){for(var p=x.BLKSIZE-1;0<=p;--p){var _=r[a+0][p],h=r[a+1][p];r[a+0][p]=(_+h)*P.SQRT2*.5,r[a+1][p]=(_-h)*P.SQRT2*.5}for(var g=2;0<=g;--g)for(p=x.BLKSIZE_s-1;0<=p;--p)_=s[c+0][g][p],h=s[c+1][g][p],s[c+0][g][p]=(_+h)*P.SQRT2*.5,s[c+1][g][p]=(_-h)*P.SQRT2*.5}for(i[0]=e(r[a+0][0]),i[0]*=i[0],p=x.BLKSIZE/2-1;0<=p;--p){var b=r[a+0][x.BLKSIZE/2-p],v=r[a+0][x.BLKSIZE/2+p];i[x.BLKSIZE/2-p]=e(.5*(b*b+v*v))}for(g=2;0<=g;--g)for(o[g][0]=s[c+0][g][0],o[g][0]*=o[g][0],p=x.BLKSIZE_s/2-1;0<=p;--p)b=s[c+0][g][x.BLKSIZE_s/2-p],v=s[c+0][g][x.BLKSIZE_s/2+p],o[g][x.BLKSIZE_s/2-p]=e(.5*(b*b+v*v));var y=0;for(p=11;p<x.HBLKSIZE;p++)y+=i[p];if(m.tot_ener[f]=y,n.analysis){for(p=0;p<x.HBLKSIZE;p++)m.pinfo.energy[l][f][p]=m.pinfo.energy_save[f][p],m.pinfo.energy_save[f][p]=i[p];m.pinfo.pe[l][f]=m.pe[f]}2==n.athaa_loudapprox&&f<2&&(m.loudness_sq[l][f]=m.loudness_sq_save[f],m.loudness_sq_save[f]=t(i,m))}function r(e,t,n,i,o,r){var a;if(e<t){if(!(t<e*H))return e+t;a=t/e}else{if(t*H<=e)return e+t;a=e/t}if(e+=t,i+3<=6){if(D<=a)return e;var s=0|P.FAST_LOG10_X(a,16);return e*ne[s]}var c,l;return s=0|P.FAST_LOG10_X(a,16),t=0!=r?o.ATH.cb_s[n]*o.ATH.adjust:o.ATH.cb_l[n]*o.ATH.adjust,e<q*t?t<e?(c=1,s<=13&&(c=ie[s]),l=P.FAST_LOG10_X(e/t,10/15),e*((te[s]-c)*l+c)):13<s?e:e*ie[s]:e*te[s]}function s(e,t,n){var i;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(i=e<t?t/e:e/t,-2<=n&&n<=2){if(D<=i)return e+t;var o=0|P.FAST_LOG10_X(i,16);return(e+t)*oe[o]}return i<H?e+t:(e<t&&(e=t),e)}function c(e,t,n,i,o){var r,a,s=0,c=0;for(r=a=0;r<x.SBMAX_s;++a,++r){for(var l=e.bo_s[r],f=e.npart_s,u=l<f?l:f;a<u;)s+=t[a],c+=n[a],a++;if(e.en[i].s[r][o]=s,e.thm[i].s[r][o]=c,f<=a){++r;break}var d=e.PSY.bo_s_weight[r],m=1-d;s=d*t[a],c=d*n[a],e.en[i].s[r][o]+=s,e.thm[i].s[r][o]+=c,s=m*t[a],c=m*n[a]}for(;r<x.SBMAX_s;++r)e.en[i].s[r][o]=0,e.thm[i].s[r][o]=0}function l(e,t,n,i){var o,r,a=0,s=0;for(o=r=0;o<x.SBMAX_l;++r,++o){for(var c=e.bo_l[o],l=e.npart_l,f=c<l?c:l;r<f;)a+=t[r],s+=n[r],r++;if(e.en[i].l[o]=a,e.thm[i].l[o]=s,l<=r){++o;break}var u=e.PSY.bo_l_weight[o],d=1-u;a=u*t[r],s=u*n[r],e.en[i].l[o]+=a,e.thm[i].l[o]+=s,a=d*t[r],s=d*n[r]}for(;o<x.SBMAX_l;++o)e.en[i].l[o]=0,e.thm[i].l[o]=0}function m(e,t,n,i,o,r){var a,s,c=e.internal_flags;for(s=a=0;s<c.npart_s;++s){for(var l=0,f=0,u=c.numlines_s[s],d=0;d<u;++d,++a){var m=t[r][a];l+=m,f<m&&(f=m)}n[s]=l}for(a=s=0;s<c.npart_s;s++){var p=c.s3ind_s[s][0],_=c.s3_ss[a++]*n[p];for(++p;p<=c.s3ind_s[s][1];)_+=c.s3_ss[a]*n[p],++a,++p;var h=Y*c.nb_s1[o][s];if(i[s]=Math.min(_,h),c.blocktype_old[1&o]==x.SHORT_TYPE){h=W*c.nb_s2[o][s];var g=i[s];i[s]=Math.min(h,g)}c.nb_s2[o][s]=c.nb_s1[o][s],c.nb_s1[o][s]=_}for(;s<=x.CBANDS;++s)n[s]=0,i[s]=0}function p(e,t,n){return 1<=n?e:n<=0?t:0<t?Math.pow(e/t,n)*t:0}function _(e,t){for(var n=309.07,i=0;i<x.SBMAX_s-1;i++)for(var o=0;o<3;o++){var r=e.thm.s[i][o];if(0<r){var a=r*t,s=e.en.s[i][o];a<s&&(n+=1e10*a<s?re[i]*(10*U):re[i]*P.FAST_LOG10(s/a))}}return n}function h(e,t){for(var n=281.0575,i=0;i<x.SBMAX_l-1;i++){var o=e.thm.l[i];if(0<o){var r=o*t,a=e.en.l[i];r<a&&(n+=1e10*r<a?ae[i]*(10*U):ae[i]*P.FAST_LOG10(a/r))}}return n}function g(e,t,n,i,o){var r,a;for(r=a=0;r<e.npart_l;++r){var s,c=0,l=0;for(s=0;s<e.numlines_l[r];++s,++a){var f=t[a];c+=f,l<f&&(l=f)}n[r]=c,i[r]=l,o[r]=c*e.rnumlines_l[r]}}function b(e,t,n,i){var o=ee.length-1,r=0,a=n[r]+n[r+1];for(0<a?((s=t[r])<t[r+1]&&(s=t[r+1]),o<(c=0|(a=20*(2*s-a)/(a*(e.numlines_l[r]+e.numlines_l[r+1]-1))))&&(c=o),i[r]=c):i[r]=0,r=1;r<e.npart_l-1;r++){var s,c;if(0<(a=n[r-1]+n[r]+n[r+1]))(s=t[r-1])<t[r]&&(s=t[r]),s<t[r+1]&&(s=t[r+1]),o<(c=0|(a=20*(3*s-a)/(a*(e.numlines_l[r-1]+e.numlines_l[r]+e.numlines_l[r+1]-1))))&&(c=o),i[r]=c;else i[r]=0}0<(a=n[r-1]+n[r])?((s=t[r-1])<t[r]&&(s=t[r]),o<(c=0|(a=20*(2*s-a)/(a*(e.numlines_l[r-1]+e.numlines_l[r]-1))))&&(c=o),i[r]=c):i[r]=0}function v(t,n,i,o,r,a,s,c){var l=t.internal_flags;if(o<2)j.fft_long(l,s[c],o,n,i);else if(2==o)for(var f=x.BLKSIZE-1;0<=f;--f){var u=s[c+0][f],d=s[c+1][f];s[c+0][f]=(u+d)*P.SQRT2*.5,s[c+1][f]=(u-d)*P.SQRT2*.5}for(a[0]=e(s[c+0][0]),a[0]*=a[0],f=x.BLKSIZE/2-1;0<=f;--f){var m=s[c+0][x.BLKSIZE/2-f],p=s[c+0][x.BLKSIZE/2+f];a[x.BLKSIZE/2-f]=e(.5*(m*m+p*p))}var _=0;for(f=11;f<x.HBLKSIZE;f++)_+=a[f];if(l.tot_ener[o]=_,t.analysis){for(f=0;f<x.HBLKSIZE;f++)l.pinfo.energy[r][o][f]=l.pinfo.energy_save[o][f],l.pinfo.energy_save[o][f]=a[f];l.pinfo.pe[r][o]=l.pe[o]}}function y(t,n,i,o,r,a,s,c){var l=t.internal_flags;if(0==r&&o<2&&j.fft_short(l,s[c],o,n,i),2==o)for(var f=x.BLKSIZE_s-1;0<=f;--f){var u=s[c+0][r][f],d=s[c+1][r][f];s[c+0][r][f]=(u+d)*P.SQRT2*.5,s[c+1][r][f]=(u-d)*P.SQRT2*.5}for(a[r][0]=s[c+0][r][0],a[r][0]*=a[r][0],f=x.BLKSIZE_s/2-1;0<=f;--f){var m=s[c+0][r][x.BLKSIZE_s/2-f],p=s[c+0][r][x.BLKSIZE_s/2+f];a[r][x.BLKSIZE_s/2-f]=e(.5*(m*m+p*p))}}function w(e,t,n){if(0==n)for(var i=0;i<e.npart_s;i++)e.nb_s2[t][i]=e.nb_s1[t][i],e.nb_s1[t][i]=0}function S(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function T(e,t,n,i,r,a){var c,l,f,u=e.internal_flags,d=new float[x.CBANDS],m=o(x.CBANDS),p=new int[x.CBANDS];for(f=l=0;f<u.npart_s;++f){var _=0,h=0,g=u.numlines_s[f];for(c=0;c<g;++c,++l){var b=t[a][l];_+=b,h<b&&(h=b)}n[f]=_,d[f]=h,m[f]=_/g}for(;f<x.CBANDS;++f)d[f]=0,m[f]=0;for(function(e,t,n,i){var o=ee.length-1,r=0,a=n[r]+n[r+1];for(0<a?((s=t[r])<t[r+1]&&(s=t[r+1]),o<(c=0|(a=20*(2*s-a)/(a*(e.numlines_s[r]+e.numlines_s[r+1]-1))))&&(c=o),i[r]=c):i[r]=0,r=1;r<e.npart_s-1;r++){var s,c;0<(a=n[r-1]+n[r]+n[r+1])?((s=t[r-1])<t[r]&&(s=t[r]),s<t[r+1]&&(s=t[r+1]),o<(c=0|(a=20*(3*s-a)/(a*(e.numlines_s[r-1]+e.numlines_s[r]+e.numlines_s[r+1]-1))))&&(c=o),i[r]=c):i[r]=0}0<(a=n[r-1]+n[r])?((s=t[r-1])<t[r]&&(s=t[r]),o<(c=0|(a=20*(2*s-a)/(a*(e.numlines_s[r-1]+e.numlines_s[r]-1))))&&(c=o),i[r]=c):i[r]=0}(u,d,m,p),l=f=0;f<u.npart_s;f++){var v,y,w,S,T,k=u.s3ind_s[f][0],I=u.s3ind_s[f][1];for(v=p[k],y=1,S=u.s3_ss[l]*n[k]*ee[p[k]],++l,++k;k<=I;)v+=p[k],y+=1,S=s(S,w=u.s3_ss[l]*n[k]*ee[p[k]],k-f),++l,++k;S*=T=.5*ee[v=(1+2*v)/(2*y)],i[f]=S,u.nb_s2[r][f]=u.nb_s1[r][f],u.nb_s1[r][f]=S,w=d[f],w*=u.minval_s[f],w*=T,i[f]>w&&(i[f]=w),1<u.masking_lower&&(i[f]*=u.masking_lower),i[f]>n[f]&&(i[f]=n[f]),u.masking_lower<1&&(i[f]*=u.masking_lower)}for(;f<x.CBANDS;++f)n[f]=0,i[f]=0}function k(e,t,n,r,a){var c,l=o(x.CBANDS),f=o(x.CBANDS),u=i(x.CBANDS+2);g(e,t,n,l,f),b(e,l,f,u);var d=0;for(c=0;c<e.npart_l;c++){var m,p,_,h=e.s3ind[c][0],v=e.s3ind[c][1],y=0,w=0;for(y=u[h],w+=1,p=e.s3_ll[d]*n[h]*ee[u[h]],++d,++h;h<=v;)y+=u[h],w+=1,p=s(p,m=e.s3_ll[d]*n[h]*ee[u[h]],h-c),++d,++h;if(p*=_=.5*ee[y=(1+2*y)/(2*w)],e.blocktype_old[1&a]==x.SHORT_TYPE){var S=F*e.nb_1[a][c];r[c]=0<S?Math.min(p,S):Math.min(p,n[c]*z)}else{var T=V*e.nb_2[a][c],k=F*e.nb_1[a][c];T<=0&&(T=p),k<=0&&(k=p),S=e.blocktype_old[1&a]==x.NORM_TYPE?Math.min(k,T):k,r[c]=Math.min(p,S)}e.nb_2[a][c]=e.nb_1[a][c],e.nb_1[a][c]=p,m=l[c],m*=e.minval_l[c],m*=_,r[c]>m&&(r[c]=m),1<e.masking_lower&&(r[c]*=e.masking_lower),r[c]>n[c]&&(r[c]=n[c]),e.masking_lower<1&&(r[c]*=e.masking_lower)}for(;c<x.CBANDS;++c)n[c]=0,r[c]=0}function I(e,t,n,i,o,r,a){for(var s,c,l=2*r,f=0<r?Math.pow(10,o):1,u=0;u<a;++u){var d=e[2][u],m=e[3][u],p=t[0][u],_=t[1][u],h=t[2][u],g=t[3][u];if(p<=1.58*_&&_<=1.58*p){var b=n[u]*m,v=n[u]*d;c=Math.max(h,Math.min(g,b)),s=Math.max(g,Math.min(h,v))}else c=h,s=g;if(0<r){var y,w,S=i[u]*f;if(y=Math.min(Math.max(p,S),Math.max(_,S)),0<(w=(h=Math.max(c,S))+(g=Math.max(s,S)))&&y*l<w){var T=y*l/w;h*=T,g*=T}c=Math.min(h,c),s=Math.min(g,s)}d<c&&(c=d),m<s&&(s=m),t[2][u]=c,t[3][u]=s}}function E(e,t){var n;return(n=0<=e?27*-e:e*t)<=-72?0:Math.exp(n*Q)}function M(e){var t,n,i=0;for(i=0;1e-20<E(i,e);i-=1);for(o=i,r=0;1e-12<Math.abs(r-o);)0<E(i=(r+o)/2,e)?r=i:o=i;t=o;var o,r;for(i=0,i=0;1e-20<E(i,e);i+=1);for(o=0,r=i;1e-12<Math.abs(r-o);)0<E(i=(r+o)/2,e)?o=i:r=i;n=r;var a,s=0;for(a=0;a<=1e3;++a)s+=E(i=t+a*(n-t)/1e3,e);return 1001/(s*(n-t))}function A(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function R(e,t,n,r,a,s,c,l,f,u,d,m){var p,_=o(x.CBANDS+1),h=l/(15<m?1152:384),g=i(x.HBLKSIZE);l/=f;var b=0,v=0;for(p=0;p<x.CBANDS;p++){var y;for(C=A(l*b),_[p]=l*b,y=b;A(l*y)-C<X&&y<=f/2;y++);for(e[p]=y-b,v=p+1;b<y;)g[b++]=p;if(f/2<b){b=f/2,++p;break}}_[p]=l*b;for(var w=0;w<m;w++){var S,T,k,I,E;k=u[w],I=u[w+1],(S=0|Math.floor(.5+d*(k-.5)))<0&&(S=0),f/2<(T=0|Math.floor(.5+d*(I-.5)))&&(T=f/2),n[w]=(g[S]+g[T])/2,t[w]=g[T];var M=h*I;c[w]=(M-_[t[w]])/(_[t[w]+1]-_[t[w]]),c[w]<0?c[w]=0:1<c[w]&&(c[w]=1),E=A(l*u[w]*d),E=Math.min(E,15.5)/15.5,s[w]=Math.pow(10,1.25*(1-Math.cos(Math.PI*E))-2.5)}for(var R=b=0;R<v;R++){var C,B,P=e[R];C=A(l*b),B=A(l*(b+P-1)),r[R]=.5*(C+B),C=A(l*(b-.5)),B=A(l*(b+P-.5)),a[R]=B-C,b+=P}return v}function B(e,t,n,i,r,s){var c,l,f,u,d,m,p=a([x.CBANDS,x.CBANDS]),_=0;if(s)for(var h=0;h<t;h++)for(c=0;c<t;c++){var g=(l=n[h]-n[c],m=d=u=f=void 0,f=l,u=.5<=(f*=0<=f?3:1.5)&&f<=2.5?8*((m=f-.5)*m-2*m):0,((d=15.811389+7.5*(f+=.474)-17.5*Math.sqrt(1+f*f))<=-60?0:(f=Math.exp((u+d)*Q),f/=.6609193))*i[c]);p[h][c]=g*r[h]}else for(c=0;c<t;c++){var b=15+Math.min(21/n[c],12),v=M(b);for(h=0;h<t;h++)g=v*E(n[h]-n[c],b)*i[c],p[h][c]=g*r[h]}for(h=0;h<t;h++){for(c=0;c<t&&!(0<p[h][c]);c++);for(e[h][0]=c,c=t-1;0<c&&!(0<p[h][c]);c--);e[h][1]=c,_+=e[h][1]-e[h][0]+1}var y=o(_),w=0;for(h=0;h<t;h++)for(c=e[h][0];c<=e[h][1];c++)y[w++]=p[h][c];return y}function O(e){var t=A(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function N(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}var D,H,q,j=new function(){function e(e,t,n){var o,r,a,s=0,c=t+(n<<=1);o=4;do{var l,f,u,d,m,p,_;for(_=o>>1,p=(m=(d=o)<<1)+d,o=m<<1,a=(r=t)+_;S=e[r+0]-e[r+d],w=e[r+0]+e[r+d],I=e[r+m]-e[r+p],k=e[r+m]+e[r+p],e[r+m]=w-k,e[r+0]=w+k,e[r+p]=S-I,e[r+d]=S+I,S=e[a+0]-e[a+d],w=e[a+0]+e[a+d],I=P.SQRT2*e[a+p],k=P.SQRT2*e[a+m],e[a+m]=w-k,e[a+0]=w+k,e[a+p]=S-I,e[a+d]=S+I,a+=o,(r+=o)<c;);for(f=i[s+0],l=i[s+1],u=1;u<_;u++){var h,g;h=1-2*l*l,g=2*l*f,r=t+u,a=t+d-u;do{var b,v,y,w,S,T,k,x,I,E;v=g*e[r+d]-h*e[a+d],b=h*e[r+d]+g*e[a+d],S=e[r+0]-b,w=e[r+0]+b,T=e[a+0]-v,y=e[a+0]+v,v=g*e[r+p]-h*e[a+p],b=h*e[r+p]+g*e[a+p],I=e[r+m]-b,k=e[r+m]+b,E=e[a+m]-v,x=e[a+m]+v,v=l*k-f*E,b=f*k+l*E,e[r+m]=w-b,e[r+0]=w+b,e[a+p]=T-v,e[a+d]=T+v,v=f*x-l*I,b=l*x+f*I,e[a+m]=y-b,e[a+0]=y+b,e[r+p]=S-v,e[r+d]=S+v,a+=o,r+=o}while(r<c);f=(h=f)*i[s+0]-l*i[s+1],l=h*i[s+1]+l*i[s+0]}s+=2}while(o<n)}var t=o(x.BLKSIZE),n=o(x.BLKSIZE_s/2),i=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],r=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(t,i,o,a,s){for(var c=0;c<3;c++){var l=x.BLKSIZE_s/2,f=65535&192*(c+1),u=x.BLKSIZE_s/8-1;do{var d,m,p,_,h,g=255&r[u<<2];m=(d=n[g]*a[o][s+g+f])-(h=n[127-g]*a[o][s+g+f+128]),d+=h,_=(p=n[g+64]*a[o][s+g+f+64])-(h=n[63-g]*a[o][s+g+f+192]),p+=h,l-=4,i[c][l+0]=d+p,i[c][l+2]=d-p,i[c][l+1]=m+_,i[c][l+3]=m-_,m=(d=n[g+1]*a[o][s+g+f+1])-(h=n[126-g]*a[o][s+g+f+129]),d+=h,_=(p=n[g+65]*a[o][s+g+f+65])-(h=n[62-g]*a[o][s+g+f+193]),p+=h,i[c][l+x.BLKSIZE_s/2+0]=d+p,i[c][l+x.BLKSIZE_s/2+2]=d-p,i[c][l+x.BLKSIZE_s/2+1]=m+_,i[c][l+x.BLKSIZE_s/2+3]=m-_}while(0<=--u);e(i[c],l,x.BLKSIZE_s/2)}},this.fft_long=function(n,i,o,a,s){var c=x.BLKSIZE/8-1,l=x.BLKSIZE/2;do{var f,u,d,m,p,_=255&r[c];u=(f=t[_]*a[o][s+_])-(p=t[_+512]*a[o][s+_+512]),f+=p,m=(d=t[_+256]*a[o][s+_+256])-(p=t[_+768]*a[o][s+_+768]),d+=p,i[0+(l-=4)]=f+d,i[l+2]=f-d,i[l+1]=u+m,i[l+3]=u-m,u=(f=t[_+1]*a[o][s+_+1])-(p=t[_+513]*a[o][s+_+513]),f+=p,m=(d=t[_+257]*a[o][s+_+257])-(p=t[_+769]*a[o][s+_+769]),d+=p,i[l+x.BLKSIZE/2+0]=f+d,i[l+x.BLKSIZE/2+2]=f-d,i[l+x.BLKSIZE/2+1]=u+m,i[l+x.BLKSIZE/2+3]=u-m}while(0<=--c);e(i,l,x.BLKSIZE/2)},this.init_fft=function(e){for(var i=0;i<x.BLKSIZE;i++)t[i]=.42-.5*Math.cos(2*Math.PI*(i+.5)/x.BLKSIZE)+.08*Math.cos(4*Math.PI*(i+.5)/x.BLKSIZE);for(i=0;i<x.BLKSIZE_s/2;i++)n[i]=.5*(1-Math.cos(2*Math.PI*(i+.5)/x.BLKSIZE_s))}},U=2.302585092994046,F=2,V=16,Y=2,W=16,X=.34,G=1/217621504/(x.BLKSIZE/2),z=.3,K=21,Q=.2302585093,Z=8,J=23,$=15,ee=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],te=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],ne=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],ie=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276],oe=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],re=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],ae=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],se=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_ns=function(e,t,s,v,y,w,S,T,k,I){var E,M,A,R,B,P,L,O,N,D,H=e.internal_flags,q=a([2,x.BLKSIZE]),j=a([2,3,x.BLKSIZE_s]),U=o(x.CBANDS+1),Y=o(x.CBANDS+1),W=o(x.CBANDS+2),X=i(2),G=i(2),Q=a([2,576]),Z=i(x.CBANDS+2),J=i(x.CBANDS+2);for(C.fill(J,0),E=H.channels_out,e.mode==d.JOINT_STEREO&&(E=4),N=e.VBR==u.vbr_off?0==H.ResvMax?0:H.ResvSize/H.ResvMax*.5:e.VBR==u.vbr_rh||e.VBR==u.vbr_mtrh||e.VBR==u.vbr_mt?.6:1,M=0;M<H.channels_out;M++){var $=t[M],te=s+576-350-K+192;for(R=0;R<576;R++){var ne,ie;for(ne=$[te+R+10],B=ie=0;B<(K-1)/2-1;B+=2)ne+=se[B]*($[te+R+B]+$[te+R+K-B]),ie+=se[B+1]*($[te+R+B+1]+$[te+R+K-B-1]);Q[M][R]=ne+ie}y[v][M].en.assign(H.en[M]),y[v][M].thm.assign(H.thm[M]),2<E&&(w[v][M].en.assign(H.en[M+2]),w[v][M].thm.assign(H.thm[M+2]))}for(M=0;M<E;M++){var oe,re=o(12),ae=[0,0,0,0],ce=o(12),le=1,fe=o(x.CBANDS),ue=o(x.CBANDS),de=[0,0,0,0],me=o(x.HBLKSIZE),pe=a([3,x.HBLKSIZE_s]);for(R=0;R<3;R++)re[R]=H.nsPsy.last_en_subshort[M][R+6],ce[R]=re[R]/H.nsPsy.last_en_subshort[M][R+4],ae[0]+=re[R];if(2==M)for(R=0;R<576;R++){var _e,he;_e=Q[0][R],he=Q[1][R],Q[0][R]=_e+he,Q[1][R]=_e-he}var ge=Q[1&M],be=0;for(R=0;R<9;R++){for(var ve=be+64,ye=1;be<ve;be++)ye<Math.abs(ge[be])&&(ye=Math.abs(ge[be]));H.nsPsy.last_en_subshort[M][R]=re[R+3]=ye,ae[1+R/3]+=ye,ye>re[R+3-2]?ye/=re[R+3-2]:ye=re[R+3-2]>10*ye?re[R+3-2]/(10*ye):0,ce[R+3]=ye}if(e.analysis){var we=ce[0];for(R=1;R<12;R++)we<ce[R]&&(we=ce[R]);H.pinfo.ers[v][M]=H.pinfo.ers_save[M],H.pinfo.ers_save[M]=we}for(oe=3==M?H.nsPsy.attackthre_s:H.nsPsy.attackthre,R=0;R<12;R++)0==de[R/3]&&ce[R]>oe&&(de[R/3]=R%3+1);for(R=1;R<4;R++)(ae[R-1]>ae[R]?ae[R-1]/ae[R]:ae[R]/ae[R-1])<1.7&&(de[R]=0,1==R&&(de[0]=0));for(0!=de[0]&&0!=H.nsPsy.lastAttacks[M]&&(de[0]=0),3!=H.nsPsy.lastAttacks[M]&&de[0]+de[1]+de[2]+de[3]==0||((le=0)!=de[1]&&0!=de[0]&&(de[1]=0),0!=de[2]&&0!=de[1]&&(de[2]=0),0!=de[3]&&0!=de[2]&&(de[3]=0)),M<2?G[M]=le:0==le&&(G[0]=G[1]=0),k[M]=H.tot_ener[M],n(e,me,pe,q,1&M,j,1&M,v,M,t,s),g(H,me,U,fe,ue),b(H,fe,ue,Z),O=0;O<3;O++){var Se,Te;for(m(e,pe,Y,W,M,O),c(H,Y,W,M,O),L=0;L<x.SBMAX_s;L++){if(Te=H.thm[M].s[L][O],Te*=.8,2<=de[O]||1==de[O+1]){var ke=0!=O?O-1:2;ye=p(H.thm[M].s[L][ke],Te,.6*N),Te=Math.min(Te,ye)}if(1==de[O])ke=0!=O?O-1:2,ye=p(H.thm[M].s[L][ke],Te,z*N),Te=Math.min(Te,ye);else if(0!=O&&3==de[O-1]||0==O&&3==H.nsPsy.lastAttacks[M])ke=2!=O?O+1:0,ye=p(H.thm[M].s[L][ke],Te,z*N),Te=Math.min(Te,ye);Se=re[3*O+3]+re[3*O+4]+re[3*O+5],6*re[3*O+5]<Se&&(Te*=.5,6*re[3*O+4]<Se&&(Te*=.5)),H.thm[M].s[L][O]=Te}}for(H.nsPsy.lastAttacks[M]=de[2],A=P=0;A<H.npart_l;A++){for(var xe=H.s3ind[A][0],Ie=U[xe]*ee[Z[xe]],Ee=H.s3_ll[P++]*Ie;++xe<=H.s3ind[A][1];)Ie=U[xe]*ee[Z[xe]],Ee=r(Ee,H.s3_ll[P++]*Ie,xe,xe-A,H,0);Ee*=.158489319246111,H.blocktype_old[1&M]==x.SHORT_TYPE?W[A]=Ee:W[A]=p(Math.min(Ee,Math.min(F*H.nb_1[M][A],V*H.nb_2[M][A])),Ee,N),H.nb_2[M][A]=H.nb_1[M][A],H.nb_1[M][A]=Ee}for(;A<=x.CBANDS;++A)U[A]=0,W[A]=0;l(H,U,W,M)}for(e.mode!=d.STEREO&&e.mode!=d.JOINT_STEREO||0<e.interChRatio&&function(e,t){var n=e.internal_flags;if(1<n.channels_out){for(var i=0;i<x.SBMAX_l;i++){var o=n.thm[0].l[i],r=n.thm[1].l[i];n.thm[0].l[i]+=r*t,n.thm[1].l[i]+=o*t}for(i=0;i<x.SBMAX_s;i++)for(var a=0;a<3;a++)o=n.thm[0].s[i][a],r=n.thm[1].s[i][a],n.thm[0].s[i][a]+=r*t,n.thm[1].s[i][a]+=o*t}}(e,e.interChRatio),e.mode==d.JOINT_STEREO&&(function(e){for(var t=0;t<x.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],i=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var o=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=i,e.thm[3].l[t]=o}for(t=0;t<x.SBMAX_s;t++)for(var r=0;r<3;r++)e.thm[0].s[t][r]>1.58*e.thm[1].s[t][r]||e.thm[1].s[t][r]>1.58*e.thm[0].s[t][r]||(n=e.mld_s[t]*e.en[3].s[t][r],i=Math.max(e.thm[2].s[t][r],Math.min(e.thm[3].s[t][r],n)),n=e.mld_s[t]*e.en[2].s[t][r],o=Math.max(e.thm[3].s[t][r],Math.min(e.thm[2].s[t][r],n)),e.thm[2].s[t][r]=i,e.thm[3].s[t][r]=o)}(H),D=e.msfix,0<Math.abs(D)&&function(e,t,n){var i=t,o=Math.pow(10,n);t*=2,i*=2;for(var r=0;r<x.SBMAX_l;r++)f=e.ATH.cb_l[e.bm_l[r]]*o,(s=Math.min(Math.max(e.thm[0].l[r],f),Math.max(e.thm[1].l[r],f)))*t<(c=Math.max(e.thm[2].l[r],f))+(l=Math.max(e.thm[3].l[r],f))&&(c*=u=s*i/(c+l),l*=u),e.thm[2].l[r]=Math.min(c,e.thm[2].l[r]),e.thm[3].l[r]=Math.min(l,e.thm[3].l[r]);for(o*=x.BLKSIZE_s/x.BLKSIZE,r=0;r<x.SBMAX_s;r++)for(var a=0;a<3;a++){var s,c,l,f,u;f=e.ATH.cb_s[e.bm_s[r]]*o,(s=Math.min(Math.max(e.thm[0].s[r][a],f),Math.max(e.thm[1].s[r][a],f)))*t<(c=Math.max(e.thm[2].s[r][a],f))+(l=Math.max(e.thm[3].s[r][a],f))&&(c*=u=s*t/(c+l),l*=u),e.thm[2].s[r][a]=Math.min(e.thm[2].s[r][a],c),e.thm[3].s[r][a]=Math.min(e.thm[3].s[r][a],l)}}(H,D,e.ATHlower*H.ATH.adjust)),function(e,t,n,i){var o=e.internal_flags;e.short_blocks!=f.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<o.channels_out;r++)i[r]=x.NORM_TYPE,e.short_blocks==f.short_block_dispensed&&(t[r]=1),e.short_blocks==f.short_block_forced&&(t[r]=0),0!=t[r]?o.blocktype_old[r]==x.SHORT_TYPE&&(i[r]=x.STOP_TYPE):(i[r]=x.SHORT_TYPE,o.blocktype_old[r]==x.NORM_TYPE&&(o.blocktype_old[r]=x.START_TYPE),o.blocktype_old[r]==x.STOP_TYPE&&(o.blocktype_old[r]=x.SHORT_TYPE)),n[r]=o.blocktype_old[r],o.blocktype_old[r]=i[r]}(e,G,I,X),M=0;M<E;M++){var Me,Ae,Re,Ce=0;1<M?(Me=T,Ce=-2,Ae=x.NORM_TYPE,I[0]!=x.SHORT_TYPE&&I[1]!=x.SHORT_TYPE||(Ae=x.SHORT_TYPE),Re=w[v][M-2]):(Me=S,Ce=0,Ae=I[M],Re=y[v][M]),Me[Ce+M]=Ae==x.SHORT_TYPE?_(Re,H.masking_lower):h(Re,H.masking_lower),e.analysis&&(H.pinfo.pe[v][M]=Me[Ce+M])}return 0};var ce=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_vbr=function(e,n,r,s,u,m,g,b,E,M){var A,R,C,B,P,L=e.internal_flags,O=o(x.HBLKSIZE),N=a([3,x.HBLKSIZE_s]),D=a([2,x.BLKSIZE]),H=a([2,3,x.BLKSIZE_s]),q=a([4,x.CBANDS]),j=a([4,x.CBANDS]),U=a([4,3]),F=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],V=i(2),Y=e.mode==d.JOINT_STEREO?4:L.channels_out;!function(e,t,n,i,r,s,c,l,f,u){for(var m=a([2,576]),p=e.internal_flags,_=p.channels_out,h=e.mode==d.JOINT_STEREO?4:_,g=0;g<_;g++){firbuf=t[g];for(var b=n+576-350-K+192,v=0;v<576;v++){var y,w;y=firbuf[b+v+10];for(var S=w=0;S<(K-1)/2-1;S+=2)y+=ce[S]*(firbuf[b+v+S]+firbuf[b+v+K-S]),w+=ce[S+1]*(firbuf[b+v+S+1]+firbuf[b+v+K-S-1]);m[g][v]=y+w}r[i][g].en.assign(p.en[g]),r[i][g].thm.assign(p.thm[g]),2<h&&(s[i][g].en.assign(p.en[g+2]),s[i][g].thm.assign(p.thm[g+2]))}for(g=0;g<h;g++){var T=o(12),k=o(12),x=[0,0,0,0],I=m[1&g],E=0,M=3==g?p.nsPsy.attackthre_s:p.nsPsy.attackthre,A=1;if(2==g)for(v=0,S=576;0<S;++v,--S){var R=m[0][v],C=m[1][v];m[0][v]=R+C,m[1][v]=R-C}for(v=0;v<3;v++)k[v]=p.nsPsy.last_en_subshort[g][v+6],T[v]=k[v]/p.nsPsy.last_en_subshort[g][v+4],x[0]+=k[v];for(v=0;v<9;v++){for(var B=E+64,P=1;E<B;E++)P<Math.abs(I[E])&&(P=Math.abs(I[E]));p.nsPsy.last_en_subshort[g][v]=k[v+3]=P,x[1+v/3]+=P,P>k[v+3-2]?P/=k[v+3-2]:P=k[v+3-2]>10*P?k[v+3-2]/(10*P):0,T[v+3]=P}for(v=0;v<3;++v){var L=k[3*v+3]+k[3*v+4]+k[3*v+5],O=1;6*k[3*v+5]<L&&(O*=.5,6*k[3*v+4]<L&&(O*=.5)),l[g][v]=O}if(e.analysis){var N=T[0];for(v=1;v<12;v++)N<T[v]&&(N=T[v]);p.pinfo.ers[i][g]=p.pinfo.ers_save[g],p.pinfo.ers_save[g]=N}for(v=0;v<12;v++)0==f[g][v/3]&&T[v]>M&&(f[g][v/3]=v%3+1);for(v=1;v<4;v++){var D=x[v-1],H=x[v];Math.max(D,H)<4e4&&D<1.7*H&&H<1.7*D&&(1==v&&f[g][0]<=f[g][v]&&(f[g][0]=0),f[g][v]=0)}f[g][0]<=p.nsPsy.lastAttacks[g]&&(f[g][0]=0),3!=p.nsPsy.lastAttacks[g]&&f[g][0]+f[g][1]+f[g][2]+f[g][3]==0||((A=0)!=f[g][1]&&0!=f[g][0]&&(f[g][1]=0),0!=f[g][2]&&0!=f[g][1]&&(f[g][2]=0),0!=f[g][3]&&0!=f[g][2]&&(f[g][3]=0)),g<2?u[g]=A:0==A&&(u[0]=u[1]=0),c[g]=p.tot_ener[g]}}(e,n,r,s,u,m,E,U,F,V),function(e,t){var n=e.internal_flags;e.short_blocks!=f.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var i=0;i<n.channels_out;i++)e.short_blocks==f.short_block_dispensed&&(t[i]=1),e.short_blocks==f.short_block_forced&&(t[i]=0)}(e,V);for(var W=0;W<Y;W++)v(e,n,r,W,s,O,D,G=1&W),R=s,C=W,B=O,P=void 0,P=(A=e).internal_flags,2==A.athaa_loudapprox&&C<2&&(P.loudness_sq[R][C]=P.loudness_sq_save[C],P.loudness_sq_save[C]=t(B,P)),0!=V[G]?k(L,O,q[W],j[W],W):S(L,W);for(V[0]+V[1]==2&&e.mode==d.JOINT_STEREO&&I(q,j,L.mld_cb_l,L.ATH.cb_l,e.ATHlower*L.ATH.adjust,e.msfix,L.npart_l),W=0;W<Y;W++)0!=V[G=1&W]&&l(L,q[W],j[W],W);for(var X=0;X<3;X++){for(W=0;W<Y;++W)0!=V[G=1&W]?w(L,W,X):(y(e,n,r,W,X,N,H,G),T(e,N,q[W],j[W],W,X));for(V[0]+V[1]==0&&e.mode==d.JOINT_STEREO&&I(q,j,L.mld_cb_s,L.ATH.cb_s,e.ATHlower*L.ATH.adjust,e.msfix,L.npart_s),W=0;W<Y;++W)0==V[G=1&W]&&c(L,q[W],j[W],W,X)}for(W=0;W<Y;W++){var G;if(0==V[G=1&W])for(var Q=0;Q<x.SBMAX_s;Q++){var Z=o(3);for(X=0;X<3;X++){var J=L.thm[W].s[Q][X];if(J*=.8,2<=F[W][X]||1==F[W][X+1]){var $=0!=X?X-1:2,ee=p(L.thm[W].s[Q][$],J,.36);J=Math.min(J,ee)}else if(1==F[W][X])$=0!=X?X-1:2,ee=p(L.thm[W].s[Q][$],J,.6*z),J=Math.min(J,ee);else if(0!=X&&3==F[W][X-1]||0==X&&3==L.nsPsy.lastAttacks[W])$=2!=X?X+1:0,ee=p(L.thm[W].s[Q][$],J,.6*z),J=Math.min(J,ee);J*=U[W][X],Z[X]=J}for(X=0;X<3;X++)L.thm[W].s[Q][X]=Z[X]}}for(W=0;W<Y;W++)L.nsPsy.lastAttacks[W]=F[W][2];for(function(e,t,n){for(var i=e.internal_flags,o=0;o<i.channels_out;o++){var r=x.NORM_TYPE;0!=t[o]?i.blocktype_old[o]==x.SHORT_TYPE&&(r=x.STOP_TYPE):(r=x.SHORT_TYPE,i.blocktype_old[o]==x.NORM_TYPE&&(i.blocktype_old[o]=x.START_TYPE),i.blocktype_old[o]==x.STOP_TYPE&&(i.blocktype_old[o]=x.SHORT_TYPE)),n[o]=i.blocktype_old[o],i.blocktype_old[o]=r}}(e,V,M),W=0;W<Y;W++){var te,ne,ie,oe;1<W?(te=b,ne=-2,ie=x.NORM_TYPE,M[0]!=x.SHORT_TYPE&&M[1]!=x.SHORT_TYPE||(ie=x.SHORT_TYPE),oe=m[s][W-2]):(te=g,ne=0,ie=M[W],oe=u[s][W]),te[ne+W]=ie==x.SHORT_TYPE?_(oe,L.masking_lower):h(oe,L.masking_lower),e.analysis&&(L.pinfo.pe[s][W]=te[ne+W])}return 0},this.psymodel_init=function(e){var t,n=e.internal_flags,i=!0,r=13,a=0,s=0,c=-8.25,l=-4.5,f=o(x.CBANDS),d=o(x.CBANDS),m=o(x.CBANDS),p=e.out_samplerate;switch(e.experimentalZ){default:case 0:i=!0;break;case 1:i=e.VBR!=u.vbr_mtrh&&e.VBR!=u.vbr_mt;break;case 2:i=!1;break;case 3:r=8,a=-1.75,s=-.0125,c=-8.25,l=-2.25}for(n.ms_ener_ratio_old=.25,n.blocktype_old[0]=n.blocktype_old[1]=x.NORM_TYPE,t=0;t<4;++t){for(var _=0;_<x.CBANDS;++_)n.nb_1[t][_]=1e20,n.nb_2[t][_]=1e20,n.nb_s1[t][_]=n.nb_s2[t][_]=1;for(var h=0;h<x.SBMAX_l;h++)n.en[t].l[h]=1e20,n.thm[t].l[h]=1e20;for(_=0;_<3;++_){for(h=0;h<x.SBMAX_s;h++)n.en[t].s[h][_]=1e20,n.thm[t].s[h][_]=1e20;n.nsPsy.lastAttacks[t]=0}for(_=0;_<9;_++)n.nsPsy.last_en_subshort[t][_]=10}for(n.loudness_sq_save[0]=n.loudness_sq_save[1]=0,n.npart_l=R(n.numlines_l,n.bo_l,n.bm_l,f,d,n.mld_l,n.PSY.bo_l_weight,p,x.BLKSIZE,n.scalefac_band.l,x.BLKSIZE/1152,x.SBMAX_l),t=0;t<n.npart_l;t++){var g=a;f[t]>=r&&(g=s*(f[t]-r)/(24-r)+a*(24-f[t])/(24-r)),m[t]=Math.pow(10,g/10),0<n.numlines_l[t]?n.rnumlines_l[t]=1/n.numlines_l[t]:n.rnumlines_l[t]=0}n.s3_ll=B(n.s3ind,n.npart_l,f,d,m,i);var b;for(_=0,t=0;t<n.npart_l;t++){w=L.MAX_VALUE;for(var v=0;v<n.numlines_l[t];v++,_++){var y=p*_/(1e3*x.BLKSIZE);S=this.ATHformula(1e3*y,e)-20,S=Math.pow(10,.1*S),(S*=n.numlines_l[t])<w&&(w=S)}n.ATH.cb_l[t]=w,6<(w=20*f[t]/10-20)&&(w=100),w<-15&&(w=-15),w-=8,n.minval_l[t]=Math.pow(10,w/10)*n.numlines_l[t]}for(n.npart_s=R(n.numlines_s,n.bo_s,n.bm_s,f,d,n.mld_s,n.PSY.bo_s_weight,p,x.BLKSIZE_s,n.scalefac_band.s,x.BLKSIZE_s/384,x.SBMAX_s),t=_=0;t<n.npart_s;t++){var w;for(g=c,f[t]>=r&&(g=l*(f[t]-r)/(24-r)+c*(24-f[t])/(24-r)),m[t]=Math.pow(10,g/10),w=L.MAX_VALUE,v=0;v<n.numlines_s[t];v++,_++){var S;y=p*_/(1e3*x.BLKSIZE_s),S=this.ATHformula(1e3*y,e)-20,S=Math.pow(10,.1*S),(S*=n.numlines_s[t])<w&&(w=S)}n.ATH.cb_s[t]=w,w=7*f[t]/12-7,12<f[t]&&(w*=1+3.1*Math.log(1+w)),f[t]<12&&(w*=1+2.3*Math.log(1-w)),w<-15&&(w=-15),w-=8,n.minval_s[t]=Math.pow(10,w/10)*n.numlines_s[t]}n.s3_ss=B(n.s3ind_s,n.npart_s,f,d,m,i),D=Math.pow(10,(Z+1)/16),H=Math.pow(10,(J+1)/16),q=Math.pow(10,$/10),j.init_fft(n),n.decay=Math.exp(-1*U/(.01*p/192)),b=3.5,0!=(2&e.exp_nspsytune)&&(b=1),0<Math.abs(e.msfix)&&(b=e.msfix),e.msfix=b;for(var T=0;T<n.npart_l;T++)n.s3ind[T][1]>n.npart_l-1&&(n.s3ind[T][1]=n.npart_l-1);var k=576*n.mode_gr/p;if(n.ATH.decay=Math.pow(10,-1.2*k),n.ATH.adjust=.01,-(n.ATH.adjustLimit=1)!=e.ATHtype){var I=e.out_samplerate/x.BLKSIZE,E=0;for(t=y=0;t<x.BLKSIZE/2;++t)y+=I,n.ATH.eql_w[t]=1/Math.pow(10,this.ATHformula(y,e)/10),E+=n.ATH.eql_w[t];for(E=1/E,t=x.BLKSIZE/2;0<=--t;)n.ATH.eql_w[t]*=E}for(T=_=0;T<n.npart_s;++T)for(t=0;t<n.numlines_s[T];++t)++_;for(T=_=0;T<n.npart_l;++T)for(t=0;t<n.numlines_l[T];++t)++_;for(t=_=0;t<n.npart_l;t++)y=p*(_+n.numlines_l[t]/2)/(1*x.BLKSIZE),n.mld_cb_l[t]=O(y),_+=n.numlines_l[t];for(;t<x.CBANDS;++t)n.mld_cb_l[t]=1;for(t=_=0;t<n.npart_s;t++)y=p*(_+n.numlines_s[t]/2)/(1*x.BLKSIZE_s),n.mld_cb_s[t]=O(y),_+=n.numlines_s[t];for(;t<x.CBANDS;++t)n.mld_cb_s[t]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=N(e,9);break;case 1:n=N(e,-1);break;case 2:n=N(e,0);break;case 3:n=N(e,1)+6;break;case 4:n=N(e,t.ATHcurve);break;default:n=N(e,0)}return n}}function A(){function e(){this.lowerlimit=0}function t(e,t){this.lowpass=t}function n(e){return 1<e?0:e<=0?1:Math.cos(Math.PI/2*e)}function r(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1;case 32e3:return t.version=1,2;case 22050:return t.version=0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}function a(e,t,n){n<16e3&&(t=2);for(var i=O.bitrate_table[t][1],o=2;o<=14;o++)0<O.bitrate_table[t][o]&&Math.abs(O.bitrate_table[t][o]-e)<Math.abs(i-e)&&(i=O.bitrate_table[t][o]);return i}function l(e,t,n){n<16e3&&(t=2);for(var i=0;i<=14;i++)if(0<O.bitrate_table[t][i]&&O.bitrate_table[t][i]==e)return i;return-1}function m(e,n){var i=[new t(8,2e3),new t(16,3700),new t(24,3900),new t(32,5500),new t(40,7e3),new t(48,7500),new t(56,1e4),new t(64,11e3),new t(80,13500),new t(96,15100),new t(112,15600),new t(128,17e3),new t(160,17500),new t(192,18600),new t(224,19400),new t(256,19700),new t(320,20500)],o=k.nearestBitrateFullIndex(n);e.lowerlimit=i[o].lowpass}function _(e){var t=x.BLKSIZE+e.framesize-x.FFTOFFSET;return t=Math.max(t,512+e.framesize-32)}function g(e,t,n,i,o,r){var a=k.enc.lame_encode_mp3_frame(e,t,n,i,o,r);return e.frameNum++,a}function v(){this.n_in=0,this.n_out=0}function y(){this.num_used=0}function w(e,t,n){var i=Math.PI*t;(e/=n)<0&&(e=0),1<e&&(e=1);var o=e-.5,r=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(o)<1e-9?i/Math.PI:r*Math.sin(n*i*o)/(Math.PI*n*o)}function S(e,t,n,i,r,a,s,c,l){var f,u,d=e.internal_flags,m=0,p=e.out_samplerate/function e(t,n){return 0!=n?e(n,t%n):t}(e.out_samplerate,e.in_samplerate);E.BPC<p&&(p=E.BPC);var _=Math.abs(d.resample_ratio-Math.floor(.5+d.resample_ratio))<1e-4?1:0,h=1/d.resample_ratio;1<h&&(h=1);var g=31;0==g%2&&--g;var b=(g+=_)+1;if(0==d.fill_buffer_resample_init){for(d.inbuf_old[0]=o(b),d.inbuf_old[1]=o(b),f=0;f<=2*p;++f)d.blackfilt[f]=o(b);for(d.itime[0]=0,m=d.itime[1]=0;m<=2*p;m++){var v=0,y=(m-p)/(2*p);for(f=0;f<=g;f++)v+=d.blackfilt[m][f]=w(f-y,h,g);for(f=0;f<=g;f++)d.blackfilt[m][f]/=v}d.fill_buffer_resample_init=1}var S=d.inbuf_old[l];for(u=0;u<i;u++){var T,k;if(T=u*d.resample_ratio,s<=g+(m=0|Math.floor(T-d.itime[l]))-g/2)break;y=T-d.itime[l]-(m+g%2*.5),k=0|Math.floor(2*y*p+p+.5);var x=0;for(f=0;f<=g;++f){var I=f+m-g/2;x+=(I<0?S[b+I]:r[a+I])*d.blackfilt[k][f]}t[n+u]=x}if(c.num_used=Math.min(s,g+m-g/2),d.itime[l]+=c.num_used-u*d.resample_ratio,c.num_used>=b)for(f=0;f<b;f++)S[f]=r[a+c.num_used+f-b];else{var M=b-c.num_used;for(f=0;f<M;++f)S[f]=S[f+c.num_used];for(m=0;f<b;++f,++m)S[f]=r[a+m]}return u}function T(e,t,n,i,o,r){var a=e.internal_flags;if(a.resample_ratio<.9999||1.0001<a.resample_ratio)for(var s=0;s<a.channels_out;s++){var c=new y;r.n_out=S(e,t[s],a.mf_size,e.framesize,n[s],i,o,c,s),r.n_in=c.num_used}else{r.n_out=Math.min(e.framesize,o),r.n_in=r.n_out;for(var l=0;l<r.n_out;++l)t[0][a.mf_size+l]=n[0][i+l],2==a.channels_out&&(t[1][a.mf_size+l]=n[1][i+l])}}var k=this;A.V9=410,A.V8=420,A.V7=430,A.V6=440,A.V5=450,A.V4=460,A.V3=470,A.V2=480,A.V1=490,A.V0=500,A.R3MIX=1e3,A.STANDARD=1001,A.EXTREME=1002,A.INSANE=1003,A.STANDARD_FAST=1004,A.EXTREME_FAST=1005,A.MEDIUM=1006,A.MEDIUM_FAST=1007;var I,R,C,P,L;A.LAME_MAXMP3BUFFER=147456;var D,H,q,j=new M;this.enc=new x,this.setModules=function(e,t,n,i,o,r,a,s,c){I=e,R=t,C=n,P=i,L=o,D=r,H=s,q=c,this.enc.setModules(R,j,P,D)};var U=4294479419;this.lame_init=function(){var e,t,n=new function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=d.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null};return 0!=((e=n).class_id=U,t=e.internal_flags=new E,e.mode=d.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=u.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=x.ENCDELAY+x.POSTDELAY,e.encoder_padding=0,t.mf_size=x.ENCDELAY-x.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0)?null:(n.lame_allocated_gfp=1,n)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,i=0,o=0,r=0;r=t[16],i=t[o=16],n=16;for(var a=0;a<16;a++)if(Math.max(e,t[a+1])!=e){r=t[a+1],o=a+1,i=t[a],n=a;break}return e-i<r-e?n:o},this.lame_init_params=function(t){var c,_,g,v=t.internal_flags;if(v.Class_ID=0,null==v.ATH&&(v.ATH=new function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=o(x.SBMAX_l),this.s=o(x.SBMAX_s),this.psfb21=o(x.PSFB21),this.psfb12=o(x.PSFB12),this.cb_l=o(x.CBANDS),this.cb_s=o(x.CBANDS),this.eql_w=o(x.BLKSIZE/2)}),null==v.PSY&&(v.PSY=new function(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=o(x.SBMAX_l),this.bo_s_weight=o(x.SBMAX_s)}),null==v.rgdata&&(v.rgdata=new function(){}),v.channels_in=t.num_channels,1==v.channels_in&&(t.mode=d.MONO),v.channels_out=t.mode==d.MONO?1:2,v.mode_ext=x.MPG_MD_MS_LR,t.mode==d.MONO&&(t.force_ms=!1),t.VBR==u.vbr_off&&128!=t.VBR_mean_bitrate_kbps&&0==t.brate&&(t.brate=t.VBR_mean_bitrate_kbps),t.VBR==u.vbr_off||t.VBR==u.vbr_mtrh||t.VBR==u.vbr_mt||(t.free_format=!1),t.VBR==u.vbr_off&&0==t.brate&&h.EQ(t.compression_ratio,0)&&(t.compression_ratio=11.025),t.VBR==u.vbr_off&&0<t.compression_ratio&&(0==t.out_samplerate&&(t.out_samplerate=map2MP3Frequency(int(.97*t.in_samplerate))),t.brate=0|16*t.out_samplerate*v.channels_out/(1e3*t.compression_ratio),v.samplerate_index=r(t.out_samplerate,t),t.free_format||(t.brate=a(t.brate,t.version,t.out_samplerate))),0!=t.out_samplerate&&(t.out_samplerate<16e3?(t.VBR_mean_bitrate_kbps=Math.max(t.VBR_mean_bitrate_kbps,8),t.VBR_mean_bitrate_kbps=Math.min(t.VBR_mean_bitrate_kbps,64)):t.out_samplerate<32e3?(t.VBR_mean_bitrate_kbps=Math.max(t.VBR_mean_bitrate_kbps,8),t.VBR_mean_bitrate_kbps=Math.min(t.VBR_mean_bitrate_kbps,160)):(t.VBR_mean_bitrate_kbps=Math.max(t.VBR_mean_bitrate_kbps,32),t.VBR_mean_bitrate_kbps=Math.min(t.VBR_mean_bitrate_kbps,320))),0==t.lowpassfreq){var y=16e3;switch(t.VBR){case u.vbr_off:m(w=new e,t.brate),y=w.lowerlimit;break;case u.vbr_abr:var w;m(w=new e,t.VBR_mean_bitrate_kbps),y=w.lowerlimit;break;case u.vbr_rh:var S=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=t.VBR_q&&t.VBR_q<=9){var T=S[t.VBR_q],k=S[t.VBR_q+1],E=t.VBR_q_frac;y=linear_int(T,k,E)}else y=19500;break;default:if(S=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950],0<=t.VBR_q&&t.VBR_q<=9)T=S[t.VBR_q],k=S[t.VBR_q+1],E=t.VBR_q_frac,y=linear_int(T,k,E);else y=19500}t.mode!=d.MONO||t.VBR!=u.vbr_off&&t.VBR!=u.vbr_abr||(y*=1.5),t.lowpassfreq=0|y}if(0==t.out_samplerate&&(2*t.lowpassfreq>t.in_samplerate&&(t.lowpassfreq=t.in_samplerate/2),t.out_samplerate=(c=0|t.lowpassfreq,_=t.in_samplerate,g=44100,48e3<=_?g=48e3:44100<=_?g=44100:32e3<=_?g=32e3:24e3<=_?g=24e3:22050<=_?g=22050:16e3<=_?g=16e3:12e3<=_?g=12e3:11025<=_?g=11025:8e3<=_&&(g=8e3),-1==c?g:(c<=15960&&(g=44100),c<=15250&&(g=32e3),c<=11220&&(g=24e3),c<=9970&&(g=22050),c<=7230&&(g=16e3),c<=5420&&(g=12e3),c<=4510&&(g=11025),c<=3970&&(g=8e3),_<g?44100<_?48e3:32e3<_?44100:24e3<_?32e3:22050<_?24e3:16e3<_?22050:12e3<_?16e3:11025<_?12e3:8e3<_?11025:8e3:g))),t.lowpassfreq=Math.min(20500,t.lowpassfreq),t.lowpassfreq=Math.min(t.out_samplerate/2,t.lowpassfreq),t.VBR==u.vbr_off&&(t.compression_ratio=16*t.out_samplerate*v.channels_out/(1e3*t.brate)),t.VBR==u.vbr_abr&&(t.compression_ratio=16*t.out_samplerate*v.channels_out/(1e3*t.VBR_mean_bitrate_kbps)),t.bWriteVbrTag||(t.findReplayGain=!1,t.decode_on_the_fly=!1,v.findPeakSample=!1),v.findReplayGain=t.findReplayGain,v.decode_on_the_fly=t.decode_on_the_fly,v.decode_on_the_fly&&(v.findPeakSample=!0),v.findReplayGain&&I.InitGainAnalysis(v.rgdata,t.out_samplerate)==p.INIT_GAIN_ANALYSIS_ERROR)return t.internal_flags=null,-6;switch(v.decode_on_the_fly&&!t.decode_only&&(null!=v.hip&&q.hip_decode_exit(v.hip),v.hip=q.hip_decode_init()),v.mode_gr=t.out_samplerate<=24e3?1:2,t.framesize=576*v.mode_gr,t.encoder_delay=x.ENCDELAY,v.resample_ratio=t.in_samplerate/t.out_samplerate,t.VBR){case u.vbr_mt:case u.vbr_rh:case u.vbr_mtrh:t.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][t.VBR_q];break;case u.vbr_abr:t.compression_ratio=16*t.out_samplerate*v.channels_out/(1e3*t.VBR_mean_bitrate_kbps);break;default:t.compression_ratio=16*t.out_samplerate*v.channels_out/(1e3*t.brate)}if(t.mode==d.NOT_SET&&(t.mode=d.JOINT_STEREO),0<t.highpassfreq?(v.highpass1=2*t.highpassfreq,0<=t.highpasswidth?v.highpass2=2*(t.highpassfreq+t.highpasswidth):v.highpass2=2*t.highpassfreq,v.highpass1/=t.out_samplerate,v.highpass2/=t.out_samplerate):(v.highpass1=0,v.highpass2=0),0<t.lowpassfreq?(v.lowpass2=2*t.lowpassfreq,0<=t.lowpasswidth?(v.lowpass1=2*(t.lowpassfreq-t.lowpasswidth),v.lowpass1<0&&(v.lowpass1=0)):v.lowpass1=2*t.lowpassfreq,v.lowpass1/=t.out_samplerate,v.lowpass2/=t.out_samplerate):(v.lowpass1=0,v.lowpass2=0),function(e){var t=e.internal_flags,i=32,o=-1;if(0<t.lowpass1){for(var r=999,a=0;a<=31;a++)(f=a/31)>=t.lowpass2&&(i=Math.min(i,a)),t.lowpass1<f&&f<t.lowpass2&&(r=Math.min(r,a));t.lowpass1=999==r?(i-.75)/31:(r-.75)/31,t.lowpass2=i/31}if(0<t.highpass2&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,B.err.println("Warning: highpass filter disabled. highpass frequency too small\n")),0<t.highpass2){var s=-1;for(a=0;a<=31;a++)(f=a/31)<=t.highpass1&&(o=Math.max(o,a)),t.highpass1<f&&f<t.highpass2&&(s=Math.max(s,a));t.highpass1=o/31,t.highpass2=-1==s?(o+.75)/31:(s+.75)/31}for(a=0;a<32;a++){var c,l,f=a/31;c=t.highpass2>t.highpass1?n((t.highpass2-f)/(t.highpass2-t.highpass1+1e-20)):1,l=t.lowpass2>t.lowpass1?n((f-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[a]=c*l}}(t),v.samplerate_index=r(t.out_samplerate,t),v.samplerate_index<0)return t.internal_flags=null,-1;if(t.VBR==u.vbr_off){if(t.free_format)v.bitrate_index=0;else if(t.brate=a(t.brate,t.version,t.out_samplerate),v.bitrate_index=l(t.brate,t.version,t.out_samplerate),v.bitrate_index<=0)return t.internal_flags=null,-1}else v.bitrate_index=1;t.analysis&&(t.bWriteVbrTag=!1),null!=v.pinfo&&(t.bWriteVbrTag=!1),R.init_bit_stream_w(v);for(var A,F,V,Y=v.samplerate_index+3*t.version+6*(t.out_samplerate<16e3?1:0),W=0;W<x.SBMAX_l+1;W++)v.scalefac_band.l[W]=P.sfBandIndex[Y].l[W];for(W=0;W<x.PSFB21+1;W++){var X=(v.scalefac_band.l[22]-v.scalefac_band.l[21])/x.PSFB21,G=v.scalefac_band.l[21]+W*X;v.scalefac_band.psfb21[W]=G}for(v.scalefac_band.psfb21[x.PSFB21]=576,W=0;W<x.SBMAX_s+1;W++)v.scalefac_band.s[W]=P.sfBandIndex[Y].s[W];for(W=0;W<x.PSFB12+1;W++)X=(v.scalefac_band.s[13]-v.scalefac_band.s[12])/x.PSFB12,G=v.scalefac_band.s[12]+W*X,v.scalefac_band.psfb12[W]=G;for(v.scalefac_band.psfb12[x.PSFB12]=192,1==t.version?v.sideinfo_len=1==v.channels_out?21:36:v.sideinfo_len=1==v.channels_out?13:21,t.error_protection&&(v.sideinfo_len+=2),F=(A=t).internal_flags,A.frameNum=0,A.write_id3tag_automatic&&H.id3tag_write_v2(A),F.bitrate_stereoMode_Hist=s([16,5]),F.bitrate_blockType_Hist=s([16,6]),F.PeakSample=0,A.bWriteVbrTag&&D.InitVbrTag(A),v.Class_ID=U,V=0;V<19;V++)v.nsPsy.pefirbuf[V]=700*v.mode_gr*v.channels_out;switch(-1==t.ATHtype&&(t.ATHtype=4),t.VBR){case u.vbr_mt:t.VBR=u.vbr_mtrh;case u.vbr_mtrh:null==t.useTemporal&&(t.useTemporal=!1),C.apply_preset(t,500-10*t.VBR_q,0),t.quality<0&&(t.quality=LAME_DEFAULT_QUALITY),t.quality<5&&(t.quality=0),5<t.quality&&(t.quality=5),v.PSY.mask_adjust=t.maskingadjust,v.PSY.mask_adjust_short=t.maskingadjust_short,t.experimentalY?v.sfb21_extra=!1:v.sfb21_extra=44e3<t.out_samplerate,v.iteration_loop=new VBRNewIterationLoop(L);break;case u.vbr_rh:C.apply_preset(t,500-10*t.VBR_q,0),v.PSY.mask_adjust=t.maskingadjust,v.PSY.mask_adjust_short=t.maskingadjust_short,t.experimentalY?v.sfb21_extra=!1:v.sfb21_extra=44e3<t.out_samplerate,6<t.quality&&(t.quality=6),t.quality<0&&(t.quality=LAME_DEFAULT_QUALITY),v.iteration_loop=new VBROldIterationLoop(L);break;default:var z;v.sfb21_extra=!1,t.quality<0&&(t.quality=LAME_DEFAULT_QUALITY),(z=t.VBR)==u.vbr_off&&(t.VBR_mean_bitrate_kbps=t.brate),C.apply_preset(t,t.VBR_mean_bitrate_kbps,0),t.VBR=z,v.PSY.mask_adjust=t.maskingadjust,v.PSY.mask_adjust_short=t.maskingadjust_short,v.iteration_loop=z==u.vbr_off?new function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,n,r){var a,s=e.internal_flags,c=o(N.SFBMAX),l=o(576),f=i(2),u=0,d=s.l3_side,m=new b(u);this.quantize.rv.ResvFrameBegin(e,m),u=m.bits;for(var p=0;p<s.mode_gr;p++){a=this.quantize.qupvt.on_pe(e,t,f,u,p,p),s.mode_ext==x.MPG_MD_MS_LR&&(this.quantize.ms_convert(s.l3_side,p),this.quantize.qupvt.reduce_side(f,n[p],u,a));for(var _=0;_<s.channels_out;_++){var h,g,v=d.tt[p][_];v.block_type!=x.SHORT_TYPE?(h=0,g=s.PSY.mask_adjust-h):(h=0,g=s.PSY.mask_adjust_short-h),s.masking_lower=Math.pow(10,.1*g),this.quantize.init_outer_loop(s,v),this.quantize.init_xrpow(s,v,l)&&(this.quantize.qupvt.calc_xmin(e,r[p][_],v,c),this.quantize.outer_loop(e,v,c,l,_,f[_])),this.quantize.iteration_finish_one(s,p,_)}}this.quantize.rv.ResvFrameEnd(s,u)}}(L):new ABRIterationLoop(L)}if(t.VBR!=u.vbr_off){if(v.VBR_min_bitrate=1,v.VBR_max_bitrate=14,t.out_samplerate<16e3&&(v.VBR_max_bitrate=8),0!=t.VBR_min_bitrate_kbps&&(t.VBR_min_bitrate_kbps=a(t.VBR_min_bitrate_kbps,t.version,t.out_samplerate),v.VBR_min_bitrate=l(t.VBR_min_bitrate_kbps,t.version,t.out_samplerate),v.VBR_min_bitrate<0))return-1;if(0!=t.VBR_max_bitrate_kbps&&(t.VBR_max_bitrate_kbps=a(t.VBR_max_bitrate_kbps,t.version,t.out_samplerate),v.VBR_max_bitrate=l(t.VBR_max_bitrate_kbps,t.version,t.out_samplerate),v.VBR_max_bitrate<0))return-1;t.VBR_min_bitrate_kbps=O.bitrate_table[t.version][v.VBR_min_bitrate],t.VBR_max_bitrate_kbps=O.bitrate_table[t.version][v.VBR_max_bitrate],t.VBR_mean_bitrate_kbps=Math.min(O.bitrate_table[t.version][v.VBR_max_bitrate],t.VBR_mean_bitrate_kbps),t.VBR_mean_bitrate_kbps=Math.max(O.bitrate_table[t.version][v.VBR_min_bitrate],t.VBR_mean_bitrate_kbps)}return t.tune&&(v.PSY.mask_adjust+=t.tune_value_a,v.PSY.mask_adjust_short+=t.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,-(t.noise_shaping_stop=1)==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(t),t.athaa_type<0?v.ATH.useAdjust=3:v.ATH.useAdjust=t.athaa_type,v.ATH.aaSensitivityP=Math.pow(10,t.athaa_sensitivity/-10),null==t.short_blocks&&(t.short_blocks=f.short_block_allowed),t.short_blocks!=f.short_block_allowed||t.mode!=d.JOINT_STEREO&&t.mode!=d.STEREO||(t.short_blocks=f.short_block_coupled),t.quant_comp<0&&(t.quant_comp=1),t.quant_comp_short<0&&(t.quant_comp_short=0),t.msfix<0&&(t.msfix=0),t.exp_nspsytune=1|t.exp_nspsytune,t.internal_flags.nsPsy.attackthre<0&&(t.internal_flags.nsPsy.attackthre=M.NSATTACKTHRE),t.internal_flags.nsPsy.attackthre_s<0&&(t.internal_flags.nsPsy.attackthre_s=M.NSATTACKTHRE_S),t.scale<0&&(t.scale=1),t.ATHtype<0&&(t.ATHtype=4),t.ATHcurve<0&&(t.ATHcurve=4),t.athaa_loudapprox<0&&(t.athaa_loudapprox=2),t.interChRatio<0&&(t.interChRatio=0),null==t.useTemporal&&(t.useTemporal=!0),v.slot_lag=v.frac_SpF=0,t.VBR==u.vbr_off&&(v.slot_lag=v.frac_SpF=72e3*(t.version+1)*t.brate%t.out_samplerate|0),P.iteration_init(t),j.psymodel_init(t),0},this.lame_encode_flush=function(e,t,n,i){var o,r,a,s,l=e.internal_flags,f=c([2,1152]),u=0,d=l.mf_samples_to_encode-x.POSTDELAY,m=_(e);if(l.mf_samples_to_encode<1)return 0;for(o=0,e.in_samplerate!=e.out_samplerate&&(d+=16*e.out_samplerate/e.in_samplerate),(a=e.framesize-d%e.framesize)<576&&(a+=e.framesize),s=(d+(e.encoder_padding=a))/e.framesize;0<s&&0<=u;){var p=m-l.mf_size,h=e.frameNum;p*=e.in_samplerate,1152<(p/=e.out_samplerate)&&(p=1152),p<1&&(p=1),r=i-o,0==i&&(r=0),n+=u=this.lame_encode_buffer(e,f[0],f[1],p,t,n,r),o+=u,s-=h!=e.frameNum?1:0}if(u<(l.mf_samples_to_encode=0))return u;if(r=i-o,0==i&&(r=0),R.flush_bitstream(e),(u=R.copy_buffer(l,t,n,r,1))<0)return u;if(n+=u,r=i-(o+=u),0==i&&(r=0),e.write_id3tag_automatic){if(H.id3tag_write_v1(e),(u=R.copy_buffer(l,t,n,r,0))<0)return u;o+=u}return o},this.lame_encode_buffer=function(e,t,n,i,r,a,s){var c,l,f=e.internal_flags,u=[null,null];if(f.Class_ID!=U)return-3;if(0==i)return 0;l=i,(null==(c=f).in_buffer_0||c.in_buffer_nsamples<l)&&(c.in_buffer_0=o(l),c.in_buffer_1=o(l),c.in_buffer_nsamples=l),u[0]=f.in_buffer_0,u[1]=f.in_buffer_1;for(var d=0;d<i;d++)u[0][d]=t[d],1<f.channels_in&&(u[1][d]=n[d]);return function(e,t,n,i,o,r,a){var s,c,l,f,u,d=e.internal_flags,m=0,b=[null,null],y=[null,null];if(d.Class_ID!=U)return-3;if(0==i)return 0;if((u=R.copy_buffer(d,o,r,a,0))<0)return u;if(r+=u,m+=u,y[0]=t,y[1]=n,h.NEQ(e.scale,0)&&h.NEQ(e.scale,1))for(c=0;c<i;++c)y[0][c]*=e.scale,2==d.channels_out&&(y[1][c]*=e.scale);if(h.NEQ(e.scale_left,0)&&h.NEQ(e.scale_left,1))for(c=0;c<i;++c)y[0][c]*=e.scale_left;if(h.NEQ(e.scale_right,0)&&h.NEQ(e.scale_right,1))for(c=0;c<i;++c)y[1][c]*=e.scale_right;if(2==e.num_channels&&1==d.channels_out)for(c=0;c<i;++c)y[0][c]=.5*(y[0][c]+y[1][c]),y[1][c]=0;f=_(e),b[0]=d.mfbuf[0],b[1]=d.mfbuf[1];for(var w=0;0<i;){var S=[null,null],k=0,E=0;S[0]=y[0],S[1]=y[1];var M=new v;if(T(e,b,S,w,i,M),k=M.n_in,E=M.n_out,d.findReplayGain&&!d.decode_on_the_fly&&I.AnalyzeSamples(d.rgdata,b[0],d.mf_size,b[1],d.mf_size,E,d.channels_out)==p.GAIN_ANALYSIS_ERROR)return-6;if(i-=k,w+=k,d.channels_out,d.mf_size+=E,d.mf_samples_to_encode<1&&(d.mf_samples_to_encode=x.ENCDELAY+x.POSTDELAY),d.mf_samples_to_encode+=E,d.mf_size>=f){var A=a-m;if(0==a&&(A=0),(s=g(e,b[0],b[1],o,r,A))<0)return s;for(r+=s,m+=s,d.mf_size-=e.framesize,d.mf_samples_to_encode-=e.framesize,l=0;l<d.channels_out;l++)for(c=0;c<d.mf_size;c++)b[l][c]=b[l][c+e.framesize]}}return m}(e,u[0],u[1],i,r,a,s)}}var R=function(e){return Math.log(e)/Math.log(10)},C={fill:function(e,t,n,i){if(2==arguments.length)for(var o=0;o<e.length;o++)e[o]=t;else for(o=t;o<n;o++)e[o]=i}},B={arraycopy:function(e,t,n,i,o){for(var r=t+o;t<r;)n[i++]=e[t++]}},P={};P.SQRT2=1.4142135623730951,P.FAST_LOG10=function(e){return R(e)},P.FAST_LOG10_X=function(e,t){return R(e)*t},f.short_block_allowed=new f(0),f.short_block_coupled=new f(1),f.short_block_dispensed=new f(2),f.short_block_forced=new f(3);var L={};L.MAX_VALUE=3.4028235e38,u.vbr_off=new u(0),u.vbr_mt=new u(1),u.vbr_rh=new u(2),u.vbr_abr=new u(3),u.vbr_mtrh=new u(4),u.vbr_default=u.vbr_mtrh,d.STEREO=new d(0),d.JOINT_STEREO=new d(1),d.DUAL_CHANNEL=new d(2),d.MONO=new d(3),d.NOT_SET=new d(4),p.STEPS_per_dB=100,p.MAX_dB=120,p.GAIN_NOT_ENOUGH_SAMPLES=-24601,p.GAIN_ANALYSIS_ERROR=0,p.GAIN_ANALYSIS_OK=1,p.INIT_GAIN_ANALYSIS_ERROR=0,p.INIT_GAIN_ANALYSIS_OK=1,p.MAX_ORDER=p.YULE_ORDER=10,p.MAX_SAMPLES_PER_WINDOW=(p.MAX_SAMP_FREQ=48e3)*(p.RMS_WINDOW_TIME_NUMERATOR=1)/(p.RMS_WINDOW_TIME_DENOMINATOR=20)+1,_.NUMTOCENTRIES=100,_.MAXFRAMESIZE=2880,h.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},h.NEQ=function(e,t){return!h.EQ(e,t)};var O={};O.t1HB=[1,1,1,0],O.t2HB=[1,2,1,3,1,1,3,2,0],O.t3HB=[3,2,1,1,1,1,3,2,0],O.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],O.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],O.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],O.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],O.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],O.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],O.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],O.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],O.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],O.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],O.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],O.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],O.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],O.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],O.t1l=[1,4,3,5],O.t2l=[1,4,7,4,5,7,6,7,8],O.t3l=[2,3,7,4,4,7,6,7,8],O.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],O.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],O.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],O.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],O.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],O.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],O.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],O.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],O.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],O.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],O.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],O.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],O.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],O.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],O.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],O.ht=[new g(0,0,null,null),new g(2,0,O.t1HB,O.t1l),new g(3,0,O.t2HB,O.t2l),new g(3,0,O.t3HB,O.t3l),new g(0,0,null,null),new g(4,0,O.t5HB,O.t5l),new g(4,0,O.t6HB,O.t6l),new g(6,0,O.t7HB,O.t7l),new g(6,0,O.t8HB,O.t8l),new g(6,0,O.t9HB,O.t9l),new g(8,0,O.t10HB,O.t10l),new g(8,0,O.t11HB,O.t11l),new g(8,0,O.t12HB,O.t12l),new g(16,0,O.t13HB,O.t13l),new g(0,0,null,O.t16_5l),new g(16,0,O.t15HB,O.t15l),new g(1,1,O.t16HB,O.t16l),new g(2,3,O.t16HB,O.t16l),new g(3,7,O.t16HB,O.t16l),new g(4,15,O.t16HB,O.t16l),new g(6,63,O.t16HB,O.t16l),new g(8,255,O.t16HB,O.t16l),new g(10,1023,O.t16HB,O.t16l),new g(13,8191,O.t16HB,O.t16l),new g(4,15,O.t24HB,O.t24l),new g(5,31,O.t24HB,O.t24l),new g(6,63,O.t24HB,O.t24l),new g(7,127,O.t24HB,O.t24l),new g(8,255,O.t24HB,O.t24l),new g(9,511,O.t24HB,O.t24l),new g(11,2047,O.t24HB,O.t24l),new g(13,8191,O.t24HB,O.t24l),new g(0,0,O.t32HB,O.t32l),new g(0,0,O.t33HB,O.t33l)],O.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],O.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],O.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],O.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],O.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],O.scfsi_band=[0,6,11,16,21],w.Q_MAX=257,w.Q_MAX2=116,w.LARGE_BITS=1e5,w.IXMAX_VAL=8206;var N={};N.SFBMAX=3*x.SBMAX_s,x.ENCDELAY=576,x.POSTDELAY=1152,x.FFTOFFSET=224+(x.MDCTDELAY=48),x.DECDELAY=528,x.SBLIMIT=32,x.CBANDS=64,x.SBPSY_l=21,x.SBPSY_s=12,x.SBMAX_l=22,x.SBMAX_s=13,x.PSFB21=6,x.PSFB12=6,x.HBLKSIZE=(x.BLKSIZE=1024)/2+1,x.HBLKSIZE_s=(x.BLKSIZE_s=256)/2+1,x.NORM_TYPE=0,x.START_TYPE=1,x.SHORT_TYPE=2,x.STOP_TYPE=3,x.MPG_MD_LR_LR=0,x.MPG_MD_LR_I=1,x.MPG_MD_MS_LR=2,x.MPG_MD_MS_I=3,x.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3.898045e-17,.0467745*5,.50455,.756825,.187098*5],E.MFSIZE=3456+x.ENCDELAY-x.MDCTDELAY,E.MAX_HEADER_BUF=256,E.MAX_BITS_PER_CHANNEL=4095,E.MAX_BITS_PER_GRANULE=7680,E.BPC=320,N.SFBMAX=3*x.SBMAX_s,e.Mp3Encoder=function(e,n,i){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,n=44100,i=128);var o=new A,r=new function(){this.setModules=function(e,t){}},a=new p,s=new h,c=new function(){function e(e,t,n,i,o,r,a,s,c,l,f,u,d,m,p){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=i,this.st_lrm=o,this.st_s=r,this.masking_adj=a,this.masking_adj_short=s,this.ath_lower=c,this.ath_curve=l,this.ath_sensitivity=f,this.interch=u,this.safejoint=d,this.sfb21mod=m,this.msfix=p}function t(e,t,n,i,o,r,a,s,c,l,f,u,d,m){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=i,this.nsmsfix=o,this.st_lrm=r,this.st_s=a,this.nsbass=s,this.scale=c,this.masking_adj=l,this.ath_lower=f,this.ath_curve=u,this.interch=d,this.sfscale=m}function n(e,t,n){var i,o,s=e.VBR==u.vbr_rh?r:a,c=e.VBR_q_frac,l=s[t],f=s[t+1],d=l;l.st_lrm=l.st_lrm+c*(f.st_lrm-l.st_lrm),l.st_s=l.st_s+c*(f.st_s-l.st_s),l.masking_adj=l.masking_adj+c*(f.masking_adj-l.masking_adj),l.masking_adj_short=l.masking_adj_short+c*(f.masking_adj_short-l.masking_adj_short),l.ath_lower=l.ath_lower+c*(f.ath_lower-l.ath_lower),l.ath_curve=l.ath_curve+c*(f.ath_curve-l.ath_curve),l.ath_sensitivity=l.ath_sensitivity+c*(f.ath_sensitivity-l.ath_sensitivity),l.interch=l.interch+c*(f.interch-l.interch),l.msfix=l.msfix+c*(f.msfix-l.msfix),i=e,(o=d.vbr_q)<0&&(o=0),9<o&&(o=9),i.VBR_q=o,(i.VBR_q_frac=0)!=n?e.quant_comp=d.quant_comp:0<Math.abs(e.quant_comp- -1)||(e.quant_comp=d.quant_comp),0!=n?e.quant_comp_short=d.quant_comp_s:0<Math.abs(e.quant_comp_short- -1)||(e.quant_comp_short=d.quant_comp_s),0!=d.expY&&(e.experimentalY=0!=d.expY),0!=n?e.internal_flags.nsPsy.attackthre=d.st_lrm:0<Math.abs(e.internal_flags.nsPsy.attackthre- -1)||(e.internal_flags.nsPsy.attackthre=d.st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=d.st_s:0<Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)||(e.internal_flags.nsPsy.attackthre_s=d.st_s),0!=n?e.maskingadjust=d.masking_adj:0<Math.abs(e.maskingadjust-0)||(e.maskingadjust=d.masking_adj),0!=n?e.maskingadjust_short=d.masking_adj_short:0<Math.abs(e.maskingadjust_short-0)||(e.maskingadjust_short=d.masking_adj_short),0!=n?e.ATHlower=-d.ath_lower/10:0<Math.abs(10*-e.ATHlower-0)||(e.ATHlower=-d.ath_lower/10),0!=n?e.ATHcurve=d.ath_curve:0<Math.abs(e.ATHcurve- -1)||(e.ATHcurve=d.ath_curve),0!=n?e.athaa_sensitivity=d.ath_sensitivity:0<Math.abs(e.athaa_sensitivity- -1)||(e.athaa_sensitivity=d.ath_sensitivity),0<d.interch&&(0!=n?e.interChRatio=d.interch:0<Math.abs(e.interChRatio- -1)||(e.interChRatio=d.interch)),0<d.safejoint&&(e.exp_nspsytune=e.exp_nspsytune|d.safejoint),0<d.sfb21mod&&(e.exp_nspsytune=e.exp_nspsytune|d.sfb21mod<<20),0!=n?e.msfix=d.msfix:0<Math.abs(e.msfix- -1)||(e.msfix=d.msfix),0==n&&(e.VBR_q=t,e.VBR_q_frac=c)}function i(e,t,n){var i=t,r=o.nearestBitrateFullIndex(t);if(e.VBR=u.vbr_abr,e.VBR_mean_bitrate_kbps=i,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,320<e.VBR_mean_bitrate_kbps&&(e.disable_reservoir=!0),0<s[r].safejoint&&(e.exp_nspsytune=2|e.exp_nspsytune),0<s[r].sfscale&&(e.internal_flags.noise_shaping=2),0<Math.abs(s[r].nsbass)){var a=int(4*s[r].nsbass);a<0&&(a+=64),e.exp_nspsytune=e.exp_nspsytune|a<<2}return 0!=n?e.quant_comp=s[r].quant_comp:0<Math.abs(e.quant_comp- -1)||(e.quant_comp=s[r].quant_comp),0!=n?e.quant_comp_short=s[r].quant_comp_s:0<Math.abs(e.quant_comp_short- -1)||(e.quant_comp_short=s[r].quant_comp_s),0!=n?e.msfix=s[r].nsmsfix:0<Math.abs(e.msfix- -1)||(e.msfix=s[r].nsmsfix),0!=n?e.internal_flags.nsPsy.attackthre=s[r].st_lrm:0<Math.abs(e.internal_flags.nsPsy.attackthre- -1)||(e.internal_flags.nsPsy.attackthre=s[r].st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=s[r].st_s:0<Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)||(e.internal_flags.nsPsy.attackthre_s=s[r].st_s),0!=n?e.scale=s[r].scale:0<Math.abs(e.scale- -1)||(e.scale=s[r].scale),0!=n?e.maskingadjust=s[r].masking_adj:0<Math.abs(e.maskingadjust-0)||(e.maskingadjust=s[r].masking_adj),0<s[r].masking_adj?0!=n?e.maskingadjust_short=.9*s[r].masking_adj:0<Math.abs(e.maskingadjust_short-0)||(e.maskingadjust_short=.9*s[r].masking_adj):0!=n?e.maskingadjust_short=1.1*s[r].masking_adj:0<Math.abs(e.maskingadjust_short-0)||(e.maskingadjust_short=1.1*s[r].masking_adj),0!=n?e.ATHlower=-s[r].ath_lower/10:0<Math.abs(10*-e.ATHlower-0)||(e.ATHlower=-s[r].ath_lower/10),0!=n?e.ATHcurve=s[r].ath_curve:0<Math.abs(e.ATHcurve- -1)||(e.ATHcurve=s[r].ath_curve),0!=n?e.interChRatio=s[r].interch:0<Math.abs(e.interChRatio- -1)||(e.interChRatio=s[r].interch),t}var o;this.setModules=function(e){o=e};var r=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],a=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)],s=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];this.apply_preset=function(e,t,o){switch(t){case A.R3MIX:t=A.V3,e.VBR=u.vbr_mtrh;break;case A.MEDIUM:t=A.V4,e.VBR=u.vbr_rh;break;case A.MEDIUM_FAST:t=A.V4,e.VBR=u.vbr_mtrh;break;case A.STANDARD:t=A.V2,e.VBR=u.vbr_rh;break;case A.STANDARD_FAST:t=A.V2,e.VBR=u.vbr_mtrh;break;case A.EXTREME:t=A.V0,e.VBR=u.vbr_rh;break;case A.EXTREME_FAST:t=A.V0,e.VBR=u.vbr_mtrh;break;case A.INSANE:return t=320,e.preset=t,i(e,t,o),e.VBR=u.vbr_off,t}switch(e.preset=t){case A.V9:return n(e,9,o),t;case A.V8:return n(e,8,o),t;case A.V7:return n(e,7,o),t;case A.V6:return n(e,6,o),t;case A.V5:return n(e,5,o),t;case A.V4:return n(e,4,o),t;case A.V3:return n(e,3,o),t;case A.V2:return n(e,2,o),t;case A.V1:return n(e,1,o),t;case A.V0:return n(e,0,o),t}return 8<=t&&t<=320?i(e,t,o):(e.preset=0,t)}},l=new w,f=new T,g=new _,b=new function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}},v=new function(){this.setModules=function(e,t){}},y=new function(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,n){var i,o=t.internal_flags,r=o.l3_side,a=e.getframebits(t);n.bits=(a-8*o.sideinfo_len)/o.mode_gr;var s=2048*o.mode_gr-8;320<t.brate?i=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(i=11520,t.strict_ISO&&(i=8*int(32e4/(t.out_samplerate/1152)/8+.5))),o.ResvMax=i-a,o.ResvMax>s&&(o.ResvMax=s),(o.ResvMax<0||t.disable_reservoir)&&(o.ResvMax=0);var c=n.bits*o.mode_gr+Math.min(o.ResvSize,o.ResvMax);return i<c&&(c=i),r.resvDrain_pre=0,null!=o.pinfo&&(o.pinfo.mean_bits=n.bits/2,o.pinfo.resvsize=o.ResvSize),c},this.ResvMaxBits=function(e,t,n,i){var o,r=e.internal_flags,a=r.ResvSize,s=r.ResvMax;0!=i&&(a+=t),0!=(1&r.substep_shaping)&&(s*=.9),n.bits=t,9*s<10*a?(o=a-9*s/10,n.bits+=o,r.substep_shaping|=128):(o=0,r.substep_shaping&=127,e.disable_reservoir||0!=(1&r.substep_shaping)||(n.bits-=.1*t));var c=a<6*r.ResvMax/10?a:6*r.ResvMax/10;return(c-=o)<0&&(c=0),c},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var n,i=e.l3_side;e.ResvSize+=t*e.mode_gr;var o=0;i.resvDrain_post=0,(i.resvDrain_pre=0)!=(n=e.ResvSize%8)&&(o+=n),0<(n=e.ResvSize-o-e.ResvMax)&&(o+=n);var r=Math.min(8*i.main_data_begin,o)/8;i.resvDrain_pre+=8*r,o-=8*r,e.ResvSize-=8*r,i.main_data_begin-=r,i.resvDrain_post+=o,e.ResvSize-=o}},S=new m,k=new function(){this.setModules=function(e,t,n){}},x=new function(){};o.setModules(a,s,c,l,f,g,b,v,x),s.setModules(a,x,b,g),v.setModules(s,b),c.setModules(o),f.setModules(s,y,l,S),l.setModules(S,y,o.enc.psy),y.setModules(s),S.setModules(l),g.setModules(o,s,b),r.setModules(k,x),k.setModules(b,v,c);var I=o.lame_init();I.num_channels=e,I.in_samplerate=n,I.out_samplerate=n,I.brate=i,I.mode=d.STEREO,I.quality=3,I.bWriteVbrTag=!1,I.disable_reservoir=!0,I.write_id3tag_automatic=!1,o.lame_init_params(I);var E=1152,M=0|1.25*E+7200,R=t(M);this.encodeBuffer=function(n,i){1==e&&(i=n),n.length>E&&(E=n.length,R=t(M=0|1.25*E+7200));var r=o.lame_encode_buffer(I,n,i,n.length,R,0,M);return new Int8Array(R.subarray(0,r))},this.flush=function(){var e=o.lame_encode_flush(I,R,0,M);return new Int8Array(R.subarray(0,e))}}}e(),Recorder.lamejs=e}()}}),define("lib/recorder/main",["common/recorder/main"],function(e){return e}),define("base/pc/brower",[],function(){var e,t=document,n=new RegExp("msie (\\d+\\.\\d+)|trident","i");return{ie:function(){return n.test(navigator.userAgent)?t.documentMode||+RegExp.$1:e}(),isBDBox:/ baiduboxapp\//i.test(navigator.userAgent),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,isStrict:function(){return"CSS1Compat"===t.compatMode},isMobile:function(){return!!navigator.userAgent.match(/.*Mobile.*/)||"ontouchstart"in window}()}}),define("cl",["require","./base/pc/brower"],function(require){var exports={},e=require("./base/pc/brower");return exports.load=function(t,n,i,o){var r=document.createElement("link");if(r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href",n.toUrl(t)),("object"==typeof r.onload||"object"==typeof r.onreadystatechange)&&!e.isBDBox){var a=!1;r.onload=function(){r.onreadystatechange=null,r.onload=null,i(!0),a=!0},r.onreadystatechange=function(){if(/^loaded|complete$/.test(this.readyState))this.onreadystatechange=null,r.onload=null,i(!0),a=!0},setTimeout(function(){if(!a)i(!0)},3e3)}else i(!0);(document.getElementsByTagName("head")[0]||document.body).appendChild(r)},exports}),define("lib/css",["cl"],function(e){return e}),define("common/css",["cl"],function(e){return e}),define("embed/entry/mobile/main",["require","bull","./mobileConfig","im-core/config","./mobileHack","../../../common/recorder/main","cl!../../css/mobile/main.css","../../../base/mobile/event"],function(require){var exports={},e=require("bull"),t=require("./mobileConfig"),n=require("im-core/config"),i=require("./mobileHack"),o=require("../../../common/recorder/main");return exports.init=function(){require("cl!../../css/mobile/main.css"),e.init(t);try{exports.initSensorSDK(),exports.initWeirwood(),o()}catch(e){console.error(e)}var i=e.get("data.config"),r=i.getServer().configBox.blackWhiteList||!1,r=i.getServer().configBox.blackWhiteList||!1,a=i.getServer().configBox.webim.isOpenAutoDirectCom||!1,s=i.getServer().configBox.webim.autoDuration||0,c=!1;if(r&&r.type>-1){for(var l=location.href,f=l,u=l.length-1;u>0&&"/"===l[u];u--)f=l.substr(0,u);if(1==+r.type)r.siteBlackWhiteList.forEach(function(e){if("*"===e.charAt(e.length-1)){if(0===f.indexOf(e.substr(0,e.length-1)))c=!0}else if(f===e)c=!0;else if(e.length>f.length&&0===e.indexOf(f)){var t=e.substr(f.length,e.length-1);if(/^[/]+$/.test(t))c=!0}});else c=!0,r.siteBlackWhiteList.forEach(function(e){if("*"===e.charAt(e.length-1)){if(0===f.indexOf(e.substr(0,e.length-1)))c=!1}else if(f===e)c=!1;else if(e.length>f.length){var t=e.substr(f.length,e.length-1);if(/^[/]+$/.test(t))c=!1}});if(c)return}e.get("log.main").init(),this.bindEvent(),e.get("mcomp.main").init(),e.get("toolbar.main").init(),this.handle(),(0,(false||document.getElementById("newBridge")).require)(["embed/mobilelite/main"],function(e){});var d=n.bid||"";if(a&&+i.getServer().siteObj.isCsOnline){null,chatUrl="mobile/chat";var f=i.getServer().siteObj.webRoot+chatUrl+"?siteId="+i.getServer().siteObj.siteId+"&userId="+i.getServer().siteObj.userId+"&siteToken="+i.getServer().siteObj.siteToken;if(d)f+="&bid="+d;setTimeout(function(){location.href=f},1e3*s)}},exports.bindEvent=function(){function e(e){e.stopPropagation()}var t=require("../../../base/mobile/event"),n="newBridge";t.domOn(n,"touchsatart",e),t.domOn(n,"touchmove",e),t.domOn(n,"touchend",e)},exports.handle=function(){i.init()},exports.initSensorSDK=function(){if(function(e){var t=e.sdk_url,n=e.name,i=window,o=document,r="script",a=null,s=null;if(void 0!==i.sensorsDataAnalytic201505)return!1;i.sensorsDataAnalytic201505=n,i[n]=i[n]||function(e){return function(){(i[n]._q=i[n]._q||[]).push([e,arguments])}};for(var c=["track","quick","register","registerPage","registerOnce","trackSignup","trackAbtest","setProfile","setOnceProfile","appendProfile","incrementProfile","deleteProfile","unsetProfile","identify","login","logout","trackLink","clearAllRegister","getAppStatus"],l=0;l<c.length;l++)i[n][c[l]]=i[n].call(null,c[l]);if(!i[n]._t)a=o.createElement(r),s=o.getElementsByTagName(r)[0],a.async=1,a.src=t,a.setAttribute("charset","UTF-8"),i[n].para=e,s.parentNode.insertBefore(a,s)}({sdk_url:"https://aiff.cdn.bcebos.com/sensors%2Fonline%2Fsa-sdk-javascript-1.25.3%2Fsensorsdata.min.js",heatmap_url:"https://aiff.cdn.bcebos.com/sensors%2Fonline%2Fsa-sdk-javascript-1.25.3%2Fheatmap.min.js",name:"sensors",server_url:"https://affprism.baidu.com/sa?project=production",send_type:"ajax",heatmap:{scroll_notice_map:"not_collect",clickmap:"not_collect"},is_track_single_page:!0,show_log:!1}),sensors.registerPage({platform_type:"JavaScript"}),!localStorage.getItem("sensors_logout")){localStorage.setItem("sensors_logout",1);var e,t=new RegExp("(^| )login_id=([^;]*)(;|$)"),n=(e=document.cookie.match(t))?unescape(e[2]):"";if(n)sensors.logout(),sensors.login(n)}},exports.initWeirwood=function(){!function(e,t){var n=e.createElement(t),i=e.getElementsByTagName(t)[0];n.src="https://dmpstatic.cdn.bcebos.com/weirwood-sdk/1/bundle.min.js",n.onload=function(e){var t={common:{buildid:"1.0.0",token:"1ec70d10d8d64cf68e6d522ac01b9556",ignoreUrls:[]},error:{collectWindowErrors:!0,collectUnhandledRejections:!0,collectResourceLoadErrors:!0,sampleRate:.1},perf:{sampleRate:0,disable:!0}};Weirwood.init(t)},i.parentNode.insertBefore(n,i),console.log("embed initWeirwood done!")}(document,"script")},exports}),require(["embed/entry/mobile/main"],function(n){document.getElementById("newBridge").deferOnce.on(n.init.bind(n))})}();
